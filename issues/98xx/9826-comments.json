[
   {
      "body" : "Was able to reproduce this locally (after ~150 times running in a loop). Will debug.",
      "created_at" : "2017-02-22T16:54:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9826#issuecomment-281729857",
      "id" : 281729857,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9826",
      "updated_at" : "2017-02-22T16:54:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/281729857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "I think I see the cause of the error. \"involvesWatchonly\" can be true either if source or destination address of the transaction is watch only, but the test doesn't know anything about the source address of the transaction. The test is trying to assert that the destination is not watchonly when money is being sent to an address with an imported private key. But once in a while due to coin selection the source address will be watchonly and cause the check to fail. I can modify the test to only send from non-watchonly sources by adding a new node to the test and sending money from that node. Using sendfrom(\"\") RPC would be another alternative since all the watchonly addresses all have non-empty labels. However the sendfrom RPC is deprecated and also appears to be broken (https://botbot.me/freenode/bitcoin-core-dev/msg/81405475/)",
      "created_at" : "2017-02-22T23:52:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9826#issuecomment-281844262",
      "id" : 281844262,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9826",
      "updated_at" : "2017-02-22T23:52:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/281844262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "@ryanofsky Thanks for investigating. That makes a lot of sense.\r\n\r\n>Using sendfrom(\"\") RPC would be another alternative since all the watchonly addresses all have non-empty labels.\r\n\r\nThat's a common misunderstanding: sendfrom doesn't, and never had any influence on coin selection. It just changes what internal account the send is charged to.\r\n\r\nSo yes I guess the solution would be to send from another node. Or change the sequence of the test.\r\n",
      "created_at" : "2017-02-23T09:03:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9826#issuecomment-281934722",
      "id" : 281934722,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9826",
      "updated_at" : "2017-02-23T09:03:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/281934722",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Implemented rescan test fix in #9839 and sendfrom help update in #9840.\r\n\r\nIt does seem like it would be easy to add a feature to sendtoaddress/fundrawtransaction that would allow labels to be used for coin selection. This would have been nice here, and it seems the type of feature that could be touted as an advantage of the label concept over the account concept after #7729, but I don't know if it actually would have practical uses outside of qa testing.",
      "created_at" : "2017-02-23T19:05:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9826#issuecomment-282088404",
      "id" : 282088404,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9826",
      "updated_at" : "2017-02-23T19:05:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/282088404",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "That would be a nice feature to have, I guess, some time after account functionality has been removed and replaced with label API. When it's added with account functionality still in place it's going to magnify confusion even more, as people would assume account balance = amount of coins on labeled UTXOs.",
      "created_at" : "2017-02-24T09:20:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9826#issuecomment-282243878",
      "id" : 282243878,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9826",
      "updated_at" : "2017-02-24T09:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/282243878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I think that multiwallet is a better abstraction for keeping coins separated.\r\n\r\nIf you had a `send...` RPC that restricted coin selection to labelled coins, but don't prevent other RPCs that don't have this restriction, what do you do with change? Say you have a coin C1 (0.3 BTC) with label L1, and C2 (0.2 BTC) with label L2. Someone issues a normal `sendtoaddress`, which spends C1 and C2, and creates C3 (0.4 BTC) to the payee, and C4 (0.1 BTC) as change back to you. What label does C4 get? 60% L1 and 40% L2?\r\n\r\nTo make this work, you need to prevent any spends that cross multiple labels, and that point you've just recreated multiwallet in a less understandable way.",
      "created_at" : "2017-02-24T09:31:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9826#issuecomment-282246246",
      "id" : 282246246,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9826",
      "updated_at" : "2017-02-24T09:35:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/282246246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Agreed on that, multiwallet is a better abstraction for that.",
      "created_at" : "2017-02-24T09:46:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9826#issuecomment-282249226",
      "id" : 282249226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9826",
      "updated_at" : "2017-02-24T09:46:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/282249226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Also agree. With multiwallet, this whole test could run one node instead of several.",
      "created_at" : "2017-02-24T10:43:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9826#issuecomment-282261344",
      "id" : 282261344,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9826",
      "updated_at" : "2017-02-24T10:43:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/282261344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
