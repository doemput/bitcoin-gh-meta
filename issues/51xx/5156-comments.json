[
   {
      "body" : "I've seen this problem too. I was debugging it to discard any blame on my own code, but yes, it looks like an off by one error somewhere in the undo handling code.",
      "created_at" : "2014-10-28T16:34:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/5156#issuecomment-60786891",
      "id" : 60786891,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5156",
      "updated_at" : "2014-10-28T16:34:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/60786891",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1192483?v=3",
         "events_url" : "https://api.github.com/users/rdponticelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rdponticelli/followers",
         "following_url" : "https://api.github.com/users/rdponticelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rdponticelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rdponticelli",
         "id" : 1192483,
         "login" : "rdponticelli",
         "organizations_url" : "https://api.github.com/users/rdponticelli/orgs",
         "received_events_url" : "https://api.github.com/users/rdponticelli/received_events",
         "repos_url" : "https://api.github.com/users/rdponticelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rdponticelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rdponticelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rdponticelli"
      }
   },
   {
      "body" : "Might this be related to the breakage of IsInitialBlockDownload? I think I haven't seen this issue since I'm running #5158 in my test nodes....",
      "created_at" : "2014-11-13T14:20:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/5156#issuecomment-62896293",
      "id" : 62896293,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5156",
      "updated_at" : "2014-11-13T14:20:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62896293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1192483?v=3",
         "events_url" : "https://api.github.com/users/rdponticelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rdponticelli/followers",
         "following_url" : "https://api.github.com/users/rdponticelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rdponticelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rdponticelli",
         "id" : 1192483,
         "login" : "rdponticelli",
         "organizations_url" : "https://api.github.com/users/rdponticelli/orgs",
         "received_events_url" : "https://api.github.com/users/rdponticelli/received_events",
         "repos_url" : "https://api.github.com/users/rdponticelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rdponticelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rdponticelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rdponticelli"
      }
   },
   {
      "body" : "This may be fixed by #5241; before that was not always a guarantee that data is synced to disk before a database record is written that refers to it. Though I would be surprised if it was introduced recently; it's been that way since 0.8.0.",
      "created_at" : "2014-11-13T14:48:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/5156#issuecomment-62900410",
      "id" : 62900410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5156",
      "updated_at" : "2014-11-13T14:48:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62900410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@rdponticelli Oh, IsInitialBlockDownload() not working would indeed potentially make this worse, as there used to be a sync call only when not in IBD.",
      "created_at" : "2014-11-13T14:50:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/5156#issuecomment-62900626",
      "id" : 62900626,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5156",
      "updated_at" : "2014-11-13T14:50:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/62900626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Closing this, I haven't had this issue running master for a long time.",
      "created_at" : "2014-12-05T11:36:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/5156#issuecomment-65778837",
      "id" : 65778837,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5156",
      "updated_at" : "2014-12-05T11:36:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/65778837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Just noticed the error in v0.12. Check level 4, as you can see. \r\nNo obvious reason as far as I can tell. I haven't used the wallet on this instance, don't know if that may be relevant.\r\n\r\n```\r\n$ tail -f /blockchain/bitcoin/debug.log\r\n2016-02-28 12:40:57 * Using 3.0MiB for block index database\r\n2016-02-28 12:40:57 * Using 10.5MiB for chain state database\r\n2016-02-28 12:40:57 * Using 10.5MiB for in-memory UTXO set\r\n2016-02-28 12:40:57 init message: Loading block index...\r\n2016-02-28 12:40:57 Opening LevelDB in /blockchain/bitcoin/blocks/index\r\n2016-02-28 12:40:58 Opened LevelDB successfully\r\n2016-02-28 12:40:58 Using obfuscation key for /blockchain/bitcoin/blocks/index: 0000000000000000\r\n2016-02-28 12:40:58 Opening LevelDB in /blockchain/bitcoin/chainstate\r\n2016-02-28 12:40:59 Opened LevelDB successfully\r\n2016-02-28 12:40:59 Using obfuscation key for /blockchain/bitcoin/chainstate: 0000000000000000\r\n2016-02-28 12:41:27 LoadBlockIndexDB: last block file = 455\r\n2016-02-28 12:41:27 LoadBlockIndexDB: last block file info: CBlockFileInfo(blocks=25, size=19372704, heights=399135...400158, time=2016-02-19...2016-02-26)\r\n2016-02-28 12:41:27 Checking all blk files are present...\r\n2016-02-28 12:41:28 LoadBlockIndexDB: transaction index enabled\r\n2016-02-28 12:41:28 LoadBlockIndexDB(): address index enabled\r\n2016-02-28 12:41:28 LoadBlockIndexDB: hashBestChain=00000000000000000163b2dc23a6bd86ba7ff0d01bafb8d8d70e6485fa313449 height=399596 date=2016-02-22 17:06:37 progress=0.995791\r\n2016-02-28 12:41:28 init message: Verifying blocks...\r\n2016-02-28 12:41:28 Verifying last 24 blocks at level 4\r\n2016-02-28 12:42:17 No coin database inconsistencies in last 4 blocks (9089 transactions)\r\n2016-02-28 12:42:17  block index           79978ms\r\n2016-02-28 12:42:17 init message: Loading wallet...\r\n2016-02-28 12:42:17 nFileVersion = 120000\r\n2016-02-28 12:42:17 Keys: 102 plaintext, 0 encrypted, 102 w/ metadata, 102 total\r\n2016-02-28 12:42:17  wallet                  171ms\r\n2016-02-28 12:42:17 init message: Activating best chain...\r\n2016-02-28 12:42:17 mapBlockIndex.size() = 400396\r\n2016-02-28 12:42:17 nBestHeight = 399596\r\n2016-02-28 12:42:17 setKeyPool.size() = 101\r\n2016-02-28 12:42:17 mapWallet.size() = 0\r\n2016-02-28 12:42:17 mapAddressBook.size() = 1\r\n2016-02-28 12:42:17 torcontrol thread start\r\n2016-02-28 12:42:17 init message: Loading addresses...\r\n2016-02-28 12:42:17 ERROR: Read: Deserialize or I/O error - CAutoFile::read: end of file\r\n2016-02-28 12:42:17 Invalid or missing banlist.dat; recreating\r\n2016-02-28 12:42:17 Loaded 128 addresses from peers.dat  6ms\r\n```",
      "created_at" : "2016-02-28T12:48:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/5156#issuecomment-189864276",
      "id" : 189864276,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5156",
      "updated_at" : "2016-02-28T12:49:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/189864276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13134193?v=3",
         "events_url" : "https://api.github.com/users/unsystemizer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/unsystemizer/followers",
         "following_url" : "https://api.github.com/users/unsystemizer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/unsystemizer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/unsystemizer",
         "id" : 13134193,
         "login" : "unsystemizer",
         "organizations_url" : "https://api.github.com/users/unsystemizer/orgs",
         "received_events_url" : "https://api.github.com/users/unsystemizer/received_events",
         "repos_url" : "https://api.github.com/users/unsystemizer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/unsystemizer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/unsystemizer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/unsystemizer"
      }
   },
   {
      "body" : "@unsystemizer I read over it thrice, there's no verification error in that log at all?\r\n```\r\n2016-02-28 12:41:28 init message: Verifying blocks...\r\n2016-02-28 12:41:28 Verifying last 24 blocks at level 4\r\n2016-02-28 12:42:17 No coin database inconsistencies in last 4 blocks (9089 transactions)\r\n```\r\nAlso please open a new issue if you're having problems, don't post to an issue from years ago (which in retrospect had to do with a dying storage device).",
      "created_at" : "2016-03-03T13:56:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/5156#issuecomment-191769935",
      "id" : 191769935,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5156",
      "updated_at" : "2016-03-03T13:57:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/191769935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj - one of the questions raised in the original post was that `Read: Deserialize or I/O error - CAutoFile::read: end of file` was appearing even though no corruption was present, but if I misread that then it was a mistake to post a follow up on that. I didn't intend to pollute the issue with unrelated stuff, sorry.",
      "created_at" : "2016-03-03T14:14:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/5156#issuecomment-191779786",
      "id" : 191779786,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5156",
      "updated_at" : "2016-03-03T14:14:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/191779786",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/13134193?v=3",
         "events_url" : "https://api.github.com/users/unsystemizer/events{/privacy}",
         "followers_url" : "https://api.github.com/users/unsystemizer/followers",
         "following_url" : "https://api.github.com/users/unsystemizer/following{/other_user}",
         "gists_url" : "https://api.github.com/users/unsystemizer/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/unsystemizer",
         "id" : 13134193,
         "login" : "unsystemizer",
         "organizations_url" : "https://api.github.com/users/unsystemizer/orgs",
         "received_events_url" : "https://api.github.com/users/unsystemizer/received_events",
         "repos_url" : "https://api.github.com/users/unsystemizer/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/unsystemizer/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/unsystemizer/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/unsystemizer"
      }
   },
   {
      "body" : "That one is harmless, it has to do with peers.dat or banlist.dat which will should just be recreated next time.\r\n",
      "created_at" : "2016-03-03T14:19:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/5156#issuecomment-191781442",
      "id" : 191781442,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5156",
      "updated_at" : "2016-03-03T14:19:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/191781442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
