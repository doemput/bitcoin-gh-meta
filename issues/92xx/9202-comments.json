[
   {
      "body" : "@laanwj I was playing around with this type of timing earlier and read that I should be wary of rdtsc getting reordered with respect to other instructions and that if you can't use rdtscp instead, then you should add a serializing instruction first like cpuid.   Also do you not have any issues with the thread migrating to another core?  I had to set cpu affinity.\r\n\r\nI couldn't find where I was reading all that, but here is one link:\r\nhttp://blog.regehr.org/archives/330\r\n\r\n",
      "created_at" : "2016-11-22T15:38:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9202#issuecomment-262274371",
      "id" : 262274371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9202",
      "updated_at" : "2016-11-22T15:38:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262274371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "> I was playing around with this type of timing earlier and read that I should be wary of rdtsc getting reordered with respect to other instructions\r\n\r\nYes, both the compiler and the CPU pipeline may reorder it. In this specific case it's not too bad, though, because the call is already from a function (State::KeepRunning) called inside the benchmark. So there is quite some overhead already, making reordering by a few instructions probably unnoticeable in the noise.\r\n\r\n> and that if you can't use rdtscp instead, then you should add a serializing instruction first like cpuid. \r\n\r\nI didn't know that. Although rdtscp seems not to be available on all x86 processors. I'll leave that as a future improvement.\r\n\r\nx86 is already precise and low-overhead compared to the ARM path which has to do a syscall (the instructions aren't available to user-space).\r\n\r\n> Also do you not have any issues with the thread migrating to another core? I had to set cpu affinity.\r\n\r\nIndeed, calling bench with e.g. `taskset -c 0 bench_bitcoin` will likely get more precise cycle measurements.",
      "created_at" : "2016-11-23T05:54:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9202#issuecomment-262439410",
      "id" : 262439410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9202",
      "updated_at" : "2016-11-23T06:31:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262439410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Running on OSX (3.4GHz i7)\r\n```\r\n#Benchmark,count,min,max,average,min_cycles,max_cycles,average_cycles\r\nBase58CheckEncode,262144,0.000003828128683,0.000004008295946,0.000003908591680,12985,13597,13260\r\nBase58Decode,983040,0.000000999269105,0.000001138963853,0.000001040822341,3389,3863,3530\r\nBase58Encode,425984,0.000002385859261,0.000002805812983,0.000002487964454,8093,9517,8440\r\nCCoinsCaching,106496,0.000009394483641,0.000010205199942,0.000010016403394,31871,34618,33978\r\nCoinSelection,480,0.002068780362606,0.002542287111282,0.002170727153619,7017890,8624174,7364277\r\nDeserializeAndCheckBlockTest,96,0.010975986719131,0.011605978012085,0.011256289978822,37233600,39370829,38184392\r\nDeserializeBlockTest,112,0.009186625480652,0.010600864887238,0.009532500590597,31163698,35960873,32339308\r\nLockedPool,640,0.001598000526428,0.001764506101608,0.001673145219684,5420783,5985758,5675764\r\nMempoolEviction,14336,0.000070976559073,0.000092454254627,0.000074292616253,240772,313630,252040\r\nRIPEMD160,416,0.002447441220284,0.002628095448017,0.002492115474664,8302338,8915072,8453936\r\nRollingBloom-refresh,1,0.000569000000000,0.000569000000000,0.000569000000000\r\nRollingBloom-refresh,1,0.000112000000000,0.000112000000000,0.000112000000000\r\nRollingBloom-refresh,1,0.000121000000000,0.000121000000000,0.000121000000000\r\nRollingBloom-refresh,1,0.000109000000000,0.000109000000000,0.000109000000000\r\nRollingBloom-refresh,1,0.000109000000000,0.000109000000000,0.000109000000000\r\nRollingBloom-refresh,1,0.000112000000000,0.000112000000000,0.000112000000000\r\nRollingBloom-refresh,1,0.000114000000000,0.000114000000000,0.000114000000000\r\nRollingBloom-refresh,1,0.000112000000000,0.000112000000000,0.000112000000000\r\nRollingBloom-refresh,1,0.000114000000000,0.000114000000000,0.000114000000000\r\nRollingBloom-refresh,1,0.000115000000000,0.000115000000000,0.000115000000000\r\nRollingBloom-refresh,1,0.000125000000000,0.000125000000000,0.000125000000000\r\nRollingBloom-refresh,1,0.000111000000000,0.000111000000000,0.000111000000000\r\nRollingBloom-refresh,1,0.000108000000000,0.000108000000000,0.000108000000000\r\nRollingBloom-refresh,1,0.000113000000000,0.000113000000000,0.000113000000000\r\nRollingBloom-refresh,1,0.000116000000000,0.000116000000000,0.000116000000000\r\nRollingBloom-refresh,1,0.000114000000000,0.000114000000000,0.000114000000000\r\nRollingBloom-refresh,1,0.000109000000000,0.000109000000000,0.000109000000000\r\nRollingBloom-refresh,1,0.000116000000000,0.000116000000000,0.000116000000000\r\nRollingBloom-refresh,1,0.000149000000000,0.000149000000000,0.000149000000000\r\nRollingBloom-refresh,1,0.000113000000000,0.000113000000000,0.000113000000000\r\nRollingBloom-refresh,1,0.000114000000000,0.000114000000000,0.000114000000000\r\nRollingBloom-refresh,1,0.000112000000000,0.000112000000000,0.000112000000000\r\nRollingBloom-refresh,1,0.000111000000000,0.000111000000000,0.000111000000000\r\nRollingBloom-refresh,1,0.000112000000000,0.000112000000000,0.000112000000000\r\nRollingBloom,1441792,0.000000725554855,0.000000796730092,0.000000755561731,2465,2702,2563\r\nSHA1,576,0.001806784421206,0.001858018338680,0.001830946240160,6129109,6302896,6211558\r\nSHA256,240,0.004244878888130,0.004624485969543,0.004340062538783,14399626,15688224,14722663\r\nSHA256_32b,4,0.300903081893921,0.302513957023621,0.301708519458771,1020885060,1026209988,1023547524\r\nSHA512,384,0.002580255270004,0.002831816673279,0.002633192886909,8752964,9606202,8932496\r\nSipHash_32b,28,0.036777973175049,0.037643551826477,0.037094610077994,124759771,127697052,125844822\r\nSleep100ms,10,0.102699518203735,0.104491472244263,0.103782296180725,348388267,354464246,352058326\r\nTrig,67108864,0.000000015213971,0.000000016026718,0.000000015468853,51,54,52\r\nVerifyScriptBench,6144,0.000170339830220,0.000214513391256,0.000176954781637,577836,727691,600278\r\n```",
      "created_at" : "2016-11-23T06:40:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9202#issuecomment-262443586",
      "id" : 262443586,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9202",
      "updated_at" : "2016-11-23T06:40:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262443586",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "body" : "@fanquake: did you compile with `-O2` or `-O0` (`--enable-debug`)?",
      "created_at" : "2016-11-23T07:18:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9202#issuecomment-262447458",
      "id" : 262447458,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9202",
      "updated_at" : "2016-11-23T07:18:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262447458",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "It looks like `RollingBloom-refresh` bench is not changed to the new output format.\r\n",
      "created_at" : "2016-11-23T10:20:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9202#issuecomment-262476986",
      "id" : 262476986,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9202",
      "updated_at" : "2016-11-23T10:22:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262476986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Yes those  lines are \"faked\" they don't go through the framework. so cycles\nis missing there, it will only be shown for the total. not a big deal,\nthough there will need to be a proper solution for nested benchmarks at\nsome point that doesn't involve printing from inside the benchmarked code.\nNot in this pull though.\n",
      "created_at" : "2016-11-23T11:06:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9202#issuecomment-262486079",
      "id" : 262486079,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9202",
      "updated_at" : "2016-11-23T11:06:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262486079",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Agreed.\r\n\r\nACK https://github.com/bitcoin/bitcoin/pull/9202/commits/35328187463a7078b4206e394c21d5515929c7de",
      "created_at" : "2016-11-23T11:10:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9202#issuecomment-262486715",
      "id" : 262486715,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9202",
      "updated_at" : "2016-11-23T11:10:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262486715",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "@jonasschnelli\r\n#### --enable-debug\r\n```\r\nOptions used to compile and link:\r\n  debug enabled = yes\r\n  target os     = darwin\r\n  build os      = darwin\r\n\r\n  CC            = /usr/local/bin/ccache gcc\r\n  CFLAGS        = -g -O2 -g3 -O0\r\n  CPPFLAGS      = -Qunused-arguments  -DDEBUG -DDEBUG_LOCKORDER -DHAVE_BUILD_INFO -D__STDC_FORMAT_MACROS -I/usr/local/opt/berkeley-db4/include -DMAC_OSX\r\n  CXX           = /usr/local/bin/ccache g++ -std=c++11\r\n  CXXFLAGS      = -g -O2 -g3 -O0 -Wall -Wextra -Wformat -Wformat-security -Wno-unused-parameter -Wno-self-assign -Wno-unused-local-typedef -Wno-deprecated-register\r\n  LDFLAGS       =  -Wl,-headerpad_max_install_names -Wl,-dead_strip\r\n```\r\n```\r\n#Benchmark,count,min,max,average,min_cycles,max_cycles,average_cycles\r\nBase58CheckEncode,30720,0.000034503871575,0.000035417033359,0.000034728871348,117174,120144,117818\r\nBase58Decode,73728,0.000013721641153,0.000014259770978,0.000013993813708,46547,48372,47470\r\nBase58Encode,40960,0.000023265369236,0.000028600101359,0.000024570309324,78931,97019,83356\r\nCCoinsCaching,13312,0.000073989387602,0.000080669764429,0.000076363722865,250992,273651,259056\r\nCoinSelection,104,0.009642988443375,0.011777520179749,0.009857095204867,32711658,40027011,33439357\r\nDeserializeAndCheckBlockTest,12,0.087463498115540,0.089210510253906,0.088053584098816,296699541,302626002,298725543\r\nDeserializeBlockTest,16,0.068791985511780,0.069242000579834,0.068972617387772,233362289,234886757,233973693\r\nLockedPool,160,0.004223585128784,0.006983995437622,0.006671081483364,14328786,23691500,22631932\r\nMempoolEviction,2560,0.000405104830861,0.000430928543210,0.000418359413743,1374232,1461820,1419187\r\nRIPEMD160,20,0.053014993667603,0.053706049919128,0.053378355503082,179840289,182186794,181088217\r\nRollingBloom,229376,0.000004121757229,0.000005482856068,0.000004432338756,13982,18599,15035\r\nSHA1,56,0.018210709095001,0.019991517066956,0.018770660672869,61774970,67816841,63680293\r\nSHA256,32,0.032343983650208,0.033765912055969,0.033258154988289,109720940,114543363,112829591\r\nSHA256_32b,2,2.213187932968140,2.213187932968140,2.213187932968140,7508019029,7508019029,7508019029\r\nSHA512,52,0.020092487335205,0.020573496818542,0.020253401536208,68158867,69791050,68705021\r\nSipHash_32b,8,0.155891418457031,0.157407522201538,0.156427383422852,528826462,534114465,530680206\r\nSleep100ms,10,0.100543022155762,0.104717016220093,0.102999615669250,341066705,355370400,349431503\r\nTrig,62914560,0.000000015808098,0.000000016690024,0.000000016066789,53,56,54\r\nVerifyScriptBench,3584,0.000285433605313,0.000293343327940,0.000287477991411,968261,996237,975283\r\n```",
      "created_at" : "2016-11-23T11:18:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9202#issuecomment-262488309",
      "id" : 262488309,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9202",
      "updated_at" : "2016-11-23T11:18:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262488309",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
