[
   {
      "body" : "E.g.:-\r\n\r\n```\r\n2016-12-02 19:48:57.973416 recv new best header 000000000000000002c98773446aac1c780435c172eda7bcc8044060654a9ca8 (441603) peer=73\r\n2016-12-02 19:48:57.974570 send sendcmpct (no announce) ver=1 peer=23\r\n2016-12-02 19:48:57.975228 send sendcmpct (announce) ver=1 peer=73\r\n2016-12-02 19:48:57.975901 send getdata cmpctblock 000000000000000002c98773446aac1c780435c172eda7bcc8044060654a9ca8 (441603) peer=73\r\n2016-12-02 19:48:58.930527 Incoming cmpctblock (14576 of 17132 bytes) chk=8a684f74 from peer=3\r\n2016-12-02 19:48:58.932063 recv best header 000000000000000002c98773446aac1c780435c172eda7bcc8044060654a9ca8 (441603) peer=23\r\n2016-12-02 19:48:58.957902 Incoming cmpctblock (14576 of 17132 bytes) chk=4fda2093 from peer=622\r\n2016-12-02 19:48:59.032385 recv cmpctblock 000000000000000002c98773446aac1c780435c172eda7bcc8044060654a9ca8 (441603) size=17132 peer=622\r\n2016-12-02 19:48:59.069218 recv cmpctblock 000000000000000002c98773446aac1c780435c172eda7bcc8044060654a9ca8 (441603) size=17132 peer=3\r\n2016-12-02 19:48:59.393061 recv best header 000000000000000002c98773446aac1c780435c172eda7bcc8044060654a9ca8 (441603) peer=33\r\n2016-12-02 19:48:59.980811 recv best header 000000000000000002c98773446aac1c780435c172eda7bcc8044060654a9ca8 (441603) peer=1628\r\n2016-12-02 19:49:00.063698 recv best header 000000000000000002c98773446aac1c780435c172eda7bcc8044060654a9ca8 (441603) peer=58\r\n2016-12-02 19:49:00.125696 recv best header 000000000000000002c98773446aac1c780435c172eda7bcc8044060654a9ca8 (441603) peer=2141\r\n2016-12-02 19:49:00.183047 recv best header 000000000000000002c98773446aac1c780435c172eda7bcc8044060654a9ca8 (441603) peer=268\r\n2016-12-02 19:49:00.201492 recv best header 000000000000000002c98773446aac1c780435c172eda7bcc8044060654a9ca8 (441603) peer=1114\r\n2016-12-02 19:49:00.256338 Incoming cmpctblock (14576 of 17132 bytes) chk=084e622b from peer=73\r\n2016-12-02 19:49:00.348837 recv cmpctblock 000000000000000002c98773446aac1c780435c172eda7bcc8044060654a9ca8 (441603) size=17132 peer=73\r\n2016-12-02 19:49:00.453634 send getblocktxn 000000000000000002c98773446aac1c780435c172eda7bcc8044060654a9ca8 (441603) indexes=2812 size=60 peer=73\r\n```\r\n\r\ni.e. it is not until the cmpctblock that was requested arrives that the blocktxns are finally requested.\r\n\r\nBlock propagation time is therefore delayed unnecessarily as the blocktxns could be requested from the peer that first provides the cmpctblock. ",
      "created_at" : "2016-12-04T02:57:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9242#issuecomment-264681115",
      "id" : 264681115,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9242",
      "updated_at" : "2016-12-04T03:00:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264681115",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "I have something working, which seems (to me at least) better behavior than the current behaviour:-\r\n\r\n```\r\n2016-12-12 06:08:08.294900 recv new best header 000000000000000001eaac17c38bb5734549af9fefda55eb6baee5e5f974ef96 (443086) age=40s peer=44\r\n2016-12-12 06:08:08.294952 send getdata cmpctblock 000000000000000001eaac17c38bb5734549af9fefda55eb6baee5e5f974ef96 (443086) peer=44\r\n2016-12-12 06:08:08.295022 send sendcmpct (no announce) ver=1 peer=52\r\n2016-12-12 06:08:08.295131 send sendcmpct (announce) ver=1 peer=44\r\n2016-12-12 06:08:08.343020 recv best cmpctblock 000000000000000001eaac17c38bb5734549af9fefda55eb6baee5e5f974ef96 (443086) age=40s size=5660 peer=52\r\n2016-12-12 06:08:08.343120 MarkBlockAsReceived: first=44, peer=52\r\n2016-12-12 06:08:08.345246 send getblocktxn 000000000000000001eaac17c38bb5734549af9fefda55eb6baee5e5f974ef96 (443086) indexes=2 size=59 peer=52\r\n2016-12-12 06:08:08.454836 recv best header 000000000000000001eaac17c38bb5734549af9fefda55eb6baee5e5f974ef96 (443086) age=40s peer=51\r\n2016-12-12 06:08:08.627894 Incoming cmpctblock (4248 of 5660 bytes) chk=33157dc1 from peer=44\r\n2016-12-12 06:08:08.707884 recv best cmpctblock 000000000000000001eaac17c38bb5734549af9fefda55eb6baee5e5f974ef96 (443086) age=40s size=5660 peer=56\r\n2016-12-12 06:08:08.707987 MarkBlockAsReceived: first=52, peer=56\r\n2016-12-12 06:08:08.710195 send getblocktxn 000000000000000001eaac17c38bb5734549af9fefda55eb6baee5e5f974ef96 (443086) indexes=2 size=59 peer=56\r\n2016-12-12 06:08:08.767387 recv blocktxn 000000000000000001eaac17c38bb5734549af9fefda55eb6baee5e5f974ef96 (443086) indexes=2 size=3514 expected-peer=56 peer=52\r\n2016-12-12 06:08:08.779325 made block 000000000000000001eaac17c38bb5734549af9fefda55eb6baee5e5f974ef96 size=437170 txs: mempool=895 req=2\r\n```\r\n",
      "created_at" : "2016-12-12T06:18:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9242#issuecomment-266351643",
      "id" : 266351643,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9242",
      "updated_at" : "2016-12-12T06:18:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/266351643",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Also speeds up block propagation in instances where only the full block would have been requested:-\r\n\r\n```\r\n2016-12-12 07:18:43.335164 recv new best header 000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 (443090) age=32s peer=4\r\n2016-12-12 07:18:43.335368 send getdata block 000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 (443090) peer=4\r\n2016-12-12 07:18:43.982027 Incoming cmpctblock (7176 of 11460 bytes) chk=2cebf26b from peer=5\r\n2016-12-12 07:18:44.004116 recv best header 000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 (443090) age=33s peer=15\r\n2016-12-12 07:18:44.174490 recv best header 000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 (443090) age=33s peer=1\r\n2016-12-12 07:18:44.185140 recv best header 000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 (443090) age=33s peer=11\r\n2016-12-12 07:18:44.187417 recv best header 000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 (443090) age=33s peer=13\r\n2016-12-12 07:18:44.192600 recv best cmpctblock 000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 (443090) age=33s size=11460 peer=5\r\n2016-12-12 07:18:44.192702 MarkBlockAsReceived: first=4, peer=5\r\n2016-12-12 07:18:44.198876 send getblocktxn 000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 (443090) indexes=4 size=63 peer=5\r\n2016-12-12 07:18:44.540087 recv best header 000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 (443090) age=33s peer=3\r\n2016-12-12 07:18:44.641163 recv best header 000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 (443090) age=33s peer=2\r\n2016-12-12 07:18:44.758474 recv blocktxn 000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 (443090) indexes=4 size=1596 peer=5\r\n2016-12-12 07:18:44.784560 made block 000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 size=998001 txs: mempool=1869 req=4\r\n2016-12-12 07:18:57.060002 UpdateTip: new best=000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 (443090) ver=0x20000000 age=46s tx=1874\r\n2016-12-12 07:18:57.060115  warning='2 of last 100 blocks have unexpected version'\r\n2016-12-12 07:18:57.500227 Incoming block (174156 of 998001 bytes) chk=64d1c13a from peer=4\r\n2016-12-12 07:19:26.547916 recv block 000000000000000003087cfe7be23ba7c120a77e6ab73c3d54504e170e121b03 (443090) age=75s size=998001 peer=4\r\n```\r\nA further improvement could be to disconnect the node sending the full-block once we have validated the block constructed from blocktxns to save bandwidth. Out of scope for #9325 though.",
      "created_at" : "2016-12-12T07:23:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/9242#issuecomment-266359548",
      "id" : 266359548,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9242",
      "updated_at" : "2016-12-12T07:40:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/266359548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   }
]
