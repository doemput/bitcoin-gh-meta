[
   {
      "body" : "There should probably be a function in the place where mempool acceptance is decided (main.cpp now, validation.cpp after The Main Split) to do preliminary checking like thid.",
      "created_at" : "2016-12-02T04:58:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-264373661",
      "id" : 264373661,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-02T04:58:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264373661",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Probably not for now but when I read this code I wondered if we need an \"available balance\"-- e.g. the sum of the coins that selectcoins would consider using... so that transaction failures due to this (and spendunconfirmed set off) are more explicable.",
      "created_at" : "2016-12-02T14:52:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-264471388",
      "id" : 264471388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-02T14:52:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264471388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "FWIW, I think this should be backported. ",
      "created_at" : "2016-12-02T14:53:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-264471546",
      "id" : 264471546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-02T14:53:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264471546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "While writing tests I found that this logic somehow is falling through on non-default ancestorcount limit. Debugging.",
      "created_at" : "2016-12-02T16:45:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-264500746",
      "id" : 264500746,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-02T16:58:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264500746",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90679559"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90679559"
         }
      },
      "body" : "Since we've already checked that pcoin is in the mempool, we don't need to do any of this -- we can just use the cached values.  (I think the only way the calculation you do below can fail is if the limits are violated during a reorg.) ",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-02T17:00:47Z",
      "diff_hunk" : "@@ -1957,6 +1957,20 @@ void CWallet::AvailableCoins(vector<COutput>& vCoins, bool fOnlyConfirmed, const\n             if (nDepth == 0 && !pcoin->InMempool())\n                 continue;\n \n+            LockPoints lp;\n+            CTxMemPoolEntry entry(*pcoin, 0, 0, 0, 0, false, 0, false, 0, lp);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90679559",
      "id" : 90679559,
      "original_commit_id" : "98a1649bc393b93d3267cdd337ba53fd8830520d",
      "original_position" : 5,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11199365,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90679559",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "Updated the pull request to new design discussed on IRC.",
      "created_at" : "2016-12-02T21:02:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-264561768",
      "id" : 264561768,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-02T21:02:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264561768",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90723028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90723028"
         }
      },
      "body" : "nit: add documentation to this function that the tx must be in the mempool in order to call?",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-02T21:28:52Z",
      "diff_hunk" : "@@ -400,6 +400,7 @@ class CWalletTx : public CMerkleTx\n     bool IsEquivalentTo(const CWalletTx& tx) const;\n \n     bool InMempool() const;\n+    uint64_t GetMempoolAncestorCount() const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90723028",
      "id" : 90723028,
      "original_commit_id" : "0160c530eceb4817622c2717e71d58e921c102f5",
      "original_position" : 4,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 11243767,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90723028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90723761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90723761"
         }
      },
      "body" : "Perhaps worth a comment here that we're assuming `AvailableCoins()` has already filtered out any unconfirmed and not-in-mempool coins?",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-02T21:33:15Z",
      "diff_hunk" : "@@ -2042,6 +2048,9 @@ bool CWallet::SelectCoinsMinConf(const CAmount& nTargetValue, int nConfMine, int\n         if (output.nDepth < (pcoin->IsFromMe(ISMINE_ALL) ? nConfMine : nConfTheirs))\n             continue;\n \n+        if (pcoin->InMempool() && pcoin->GetMempoolAncestorCount() > nMaxAncestors)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90723761",
      "id" : 90723761,
      "original_commit_id" : "0160c530eceb4817622c2717e71d58e921c102f5",
      "original_position" : 26,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11243767,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90723761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90724255"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90724255"
         }
      },
      "body" : "nit: perhaps this comment should be \"Lastly, ensure this tx will pass the mempool's chain limits\"",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-02T21:36:51Z",
      "diff_hunk" : "@@ -2558,6 +2558,21 @@ bool CWallet::CreateTransaction(const vector<CRecipient>& vecSend, CWalletTx& wt\n         }\n     }\n \n+    // Lastly, ensure it doesn't have too many ancestors",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90724255",
      "id" : 90724255,
      "original_commit_id" : "82c4fe2eebfd051dd840168775f008fad611e114",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11243767,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90724255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90724556"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90724556"
         }
      },
      "body" : "The errString filled in by CMPA might be useful for debugging issues (eg a LogPrintf() so that someone debugging could inspect), though i see we don't log any info about the transaction we tried to generate, so maybe not worth it...",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-02T21:38:55Z",
      "diff_hunk" : "@@ -2558,6 +2558,21 @@ bool CWallet::CreateTransaction(const vector<CRecipient>& vecSend, CWalletTx& wt\n         }\n     }\n \n+    // Lastly, ensure it doesn't have too many ancestors\n+    // don't retry if so.\n+    LockPoints lp;\n+    CTxMemPoolEntry entry(txNew, 0, 0, 0, 0, false, 0, false, 0, lp);\n+    CTxMemPool::setEntries setAncestors;\n+    size_t nLimitAncestors = GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT);\n+    size_t nLimitAncestorSize = GetArg(\"-limitancestorsize\", DEFAULT_ANCESTOR_SIZE_LIMIT)*1000;\n+    size_t nLimitDescendants = GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT);\n+    size_t nLimitDescendantSize = GetArg(\"-limitdescendantsize\", DEFAULT_DESCENDANT_SIZE_LIMIT)*1000;\n+    std::string errString;\n+    if (!mempool.CalculateMemPoolAncestors(entry, setAncestors, nLimitAncestors, nLimitAncestorSize, nLimitDescendants, nLimitDescendantSize, errString)) {\n+        strFailReason = _(\"Transaction has too long of a mempool chain\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90724556",
      "id" : 90724556,
      "original_commit_id" : "82c4fe2eebfd051dd840168775f008fad611e114",
      "original_position" : 15,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11243767,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90724556",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "I also think this is good for backport.",
      "created_at" : "2016-12-02T22:18:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-264577692",
      "id" : 264577692,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-02T22:18:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264577692",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90730979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90730979"
         }
      },
      "body" : "I think you need the pcoin->InMempool() check you had before, in case you're looking at in-chain coins?",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-02T22:24:32Z",
      "diff_hunk" : "@@ -2042,6 +2048,9 @@ bool CWallet::SelectCoinsMinConf(const CAmount& nTargetValue, int nConfMine, int\n         if (output.nDepth < (pcoin->IsFromMe(ISMINE_ALL) ? nConfMine : nConfTheirs))\n             continue;\n \n+        if (pcoin->GetMempoolAncestorCount() > nMaxAncestors)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90730979",
      "id" : 90730979,
      "original_commit_id" : "9cdba4b999e5d9e5aa21fcbf4105d800c627e6ff",
      "original_position" : 26,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11251834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90730979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90734154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90734154"
         }
      },
      "body" : "Inequality here is wrong, should be `>=` I believe. This will never fire as-is. I should be able to easily test this fix.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-02T22:50:39Z",
      "diff_hunk" : "@@ -2042,6 +2048,9 @@ bool CWallet::SelectCoinsMinConf(const CAmount& nTargetValue, int nConfMine, int\n         if (output.nDepth < (pcoin->IsFromMe(ISMINE_ALL) ? nConfMine : nConfTheirs))\n             continue;\n \n+        if (pcoin->InMempool() && pcoin->GetMempoolAncestorCount() > nMaxAncestors)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90734154",
      "id" : 90734154,
      "original_commit_id" : "0160c530eceb4817622c2717e71d58e921c102f5",
      "original_position" : 26,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11255078,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90734154",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "Looks good! -- so, I think the additional test in \"Don't return success\"  should be controlled by an option, since the failure is only temporary (at least once we fix the rebroadcast bug) and many callers handle failure to create a transaction poorly. I might even go as far as to suggest that this option be set in 0.13.2 to continue to create the transaction because that would be less of an API change.  Perhaps @sdaftuar or @laanwj has an opinion on that?\r\n\r\nOther than that, utACK.",
      "created_at" : "2016-12-04T19:11:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-264723778",
      "id" : 264723778,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-04T19:11:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264723778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Couple of fixes/changes:\r\n\r\n>if (pcoin->InMempool() && pcoin->GetMempoolAncestorCount() > nMaxAncestors)\r\n\r\nis now\r\n\r\n>if (pcoin->InMempool() && pcoin->GetMempoolAncestorCount() >= nMaxAncestors)\r\n\r\nso it actually filters correctly on the very last call of SelectCoinsMinConf.\r\n\r\nI also revamped the tests to catch the various cases.\r\n\r\n@gmaxwell we'll have to catch that logic in two places, SelectCoinsMinConf(at the last instance of it) and at the end of CreateTransaction. I suppose once rebroadcasting is fixed, we can set the default to \"false\" and let it take care of it. I'll wait to see what others are thinking. I think current behavior is horrendous :)",
      "created_at" : "2016-12-04T19:45:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-264725932",
      "id" : 264725932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-04T19:47:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264725932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "Current behavior is horrendous indeed. Thank you for working on this.",
      "created_at" : "2016-12-05T02:42:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-264755836",
      "id" : 264755836,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-05T02:42:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264755836",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell No strong opinion on the issue of default behavior for 0.13.2, but given that you currently have to restart your node in order to rebroadcast, I'd lean towards making the default behavior be to enforce this new restriction, rather than create a tx that doesn't make it to the mempool.",
      "created_at" : "2016-12-05T19:59:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-264960077",
      "id" : 264960077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-05T19:59:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264960077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90949725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90949725"
         }
      },
      "body" : "@morcos and I were discussing, I think this would make more sense to limit based on both ancestor and descendant count, something like:\r\n\r\n```\r\nif (pcoin->InMempool() && max(pcoin->GetMempoolAncestorCount(), pcoin->GetMempoolDescendantCount()) >= nMaxChain)\r\n    continue;\r\n````\r\n\r\nOtherwise, if you have an unspent output with 1 ancestor but 25 descendants, you (needlessly) could fail on one of the early calls.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-05T20:35:05Z",
      "diff_hunk" : "@@ -2042,6 +2048,9 @@ bool CWallet::SelectCoinsMinConf(const CAmount& nTargetValue, int nConfMine, int\n         if (output.nDepth < (pcoin->IsFromMe(ISMINE_ALL) ? nConfMine : nConfTheirs))\n             continue;\n \n+        if (pcoin->InMempool() && pcoin->GetMempoolAncestorCount() >= nMaxAncestors)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90949725",
      "id" : 90949725,
      "original_commit_id" : "b077aa7d7ad9d5a04ff84a4e2b40a4387909e699",
      "original_position" : 26,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11463311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90949725",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90950540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90950540"
         }
      },
      "body" : "Instead of N/4, N/2, and N for the ancestor/chain limit passed in to SCMC, how about: 2, 4, N/2, N?  (And set N = min(limitancestorcount, limitdescendantcount), assuming we go with ancestor and descendant limiting as I mentioned in another comment.)  This way we first try utxo's from transactions that have no ancestors or descendants, which should provide a strong preference for not creating long chains.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-05T20:39:53Z",
      "diff_hunk" : "@@ -2167,10 +2176,14 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT);\n+\n     bool res = nTargetValue <= nValueFromPresetInputs ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, vCoins, setCoinsRet, nValueRet) ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, vCoins, setCoinsRet, nValueRet) ||\n-        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, vCoins, setCoinsRet, nValueRet));\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, 0, vCoins, setCoinsRet, nValueRet) ||\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, 0, vCoins, setCoinsRet, nValueRet) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, nLimitAncestors/4, vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, nLimitAncestors/2, vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, nLimitAncestors, vCoins, setCoinsRet, nValueRet));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r90950540",
      "id" : 90950540,
      "original_commit_id" : "b077aa7d7ad9d5a04ff84a4e2b40a4387909e699",
      "original_position" : 46,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11464139,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/90950540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "@sdaftuar made sense to me, done",
      "created_at" : "2016-12-05T21:59:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-264991330",
      "id" : 264991330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-05T21:59:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264991330",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : ">  but given that you currently have to restart your node in order to rebroadcast\r\n\r\nWhy is that so? You can't take the tx hex and send it through `sendrawtransaction` in this case?",
      "created_at" : "2016-12-06T06:09:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-265069249",
      "id" : 265069249,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-06T06:09:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265069249",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91020541"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91020541"
         }
      },
      "body" : "Specifying const for a pass-by-value argument has no effect in the declaration. You can add const in the function definition if you want to protect yourself from accidentally modifying the variable even when the definition doesn't have const.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T06:47:15Z",
      "diff_hunk" : "@@ -685,7 +688,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n      * completion the coin set and corresponding actual target value is\n      * assembled\n      */\n-    bool SelectCoinsMinConf(const CAmount& nTargetValue, int nConfMine, int nConfTheirs, std::vector<COutput> vCoins, std::set<std::pair<const CWalletTx*,unsigned int> >& setCoinsRet, CAmount& nValueRet) const;\n+    bool SelectCoinsMinConf(const CAmount& nTargetValue, const int nConfMine, const int nConfTheirs, const uint64_t nMaxAncestors, std::vector<COutput> vCoins, std::set<std::pair<const CWalletTx*,unsigned int> >& setCoinsRet, CAmount& nValueRet) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91020541",
      "id" : 91020541,
      "original_commit_id" : "f74f7630231e048b213a62d827f38b0144eb4423",
      "original_position" : 15,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 11530993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91020541",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91020564"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91020564"
         }
      },
      "body" : "What if nLimitAncestors is less than 4?",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T06:47:32Z",
      "diff_hunk" : "@@ -2167,10 +2182,15 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+\n     bool res = nTargetValue <= nValueFromPresetInputs ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, vCoins, setCoinsRet, nValueRet) ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, vCoins, setCoinsRet, nValueRet) ||\n-        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, vCoins, setCoinsRet, nValueRet));\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, 0, vCoins, setCoinsRet, nValueRet) ||\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, 0, vCoins, setCoinsRet, nValueRet) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 2, vCoins, setCoinsRet, nValueRet)) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91020564",
      "id" : 91020564,
      "original_commit_id" : "f74f7630231e048b213a62d827f38b0144eb4423",
      "original_position" : 50,
      "path" : "src/wallet/wallet.cpp",
      "position" : 32,
      "pull_request_review_id" : 11530993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91020564",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91020709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91020709"
         }
      },
      "body" : "Can you abstract this fragment out, and turn it into a CTxMempool method?",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T06:49:47Z",
      "diff_hunk" : "@@ -2565,6 +2565,20 @@ bool CWallet::CreateTransaction(const vector<CRecipient>& vecSend, CWalletTx& wt\n         }\n     }\n \n+    // Lastly, ensure this tx will pass the mempool's chain limits",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91020709",
      "id" : 91020709,
      "original_commit_id" : "8f1ae0c931bdb0fe9ba3c608f26c03c2b1ca594a",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11530993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91020709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "> but given that you currently have to restart your node in order to rebroadcast\r\n\r\nHow about we fix that? (#9290)",
      "created_at" : "2016-12-06T06:57:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-265075841",
      "id" : 265075841,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-06T06:57:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265075841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91021322"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91021322"
         }
      },
      "body" : "It calls Selectmincoins redundantly a bit... this doesn't seem like a big deal to me.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T06:58:06Z",
      "diff_hunk" : "@@ -2167,10 +2182,15 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+\n     bool res = nTargetValue <= nValueFromPresetInputs ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, vCoins, setCoinsRet, nValueRet) ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, vCoins, setCoinsRet, nValueRet) ||\n-        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, vCoins, setCoinsRet, nValueRet));\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, 0, vCoins, setCoinsRet, nValueRet) ||\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, 0, vCoins, setCoinsRet, nValueRet) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 2, vCoins, setCoinsRet, nValueRet)) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91021322",
      "id" : 91021322,
      "original_commit_id" : "f74f7630231e048b213a62d827f38b0144eb4423",
      "original_position" : 50,
      "path" : "src/wallet/wallet.cpp",
      "position" : 32,
      "pull_request_review_id" : 11531761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91021322",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@laanwj Regarding rebroadcast, I meant without doing something herculean -- I think with current behavior you'd have to first find the txid that was committed but then not broadcast (since the RPC call will just return failure), and then rebroadcast it using something like sendrawtransaction.  But anyway it should be moot after #9290, which I think makes sense.",
      "created_at" : "2016-12-06T14:47:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-265167748",
      "id" : 265167748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-06T14:47:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265167748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "Moderately-tested ACK 2da773454c02990665ecd1b03f60a6ab09bdf22d\r\n\r\nI tried to test this a couple different ways.  One simple demonstration of this PR's benefit was in a situation where you have 2 (confirmed) UTXO's in your wallet, and you're sending lots of small valued transactions to addresses outside your wallet.  Before this PR, the test would consistently fail at the 26th spend (with the ensuing chaos of the rpc call failure, while the transaction was still committed).  After this PR, I'm able to consistently create 50 transactions before failure, which is optimal.",
      "created_at" : "2016-12-06T15:55:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-265187196",
      "id" : 265187196,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-06T15:55:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265187196",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91117882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91117882"
         }
      },
      "body" : "I don't think is likely to save us many lines seeing as CMPA is called with these parameters exactly once elsewhere(and we'd still have to pass entry), and further this block may get removed if https://github.com/bitcoin/bitcoin/pull/9290 or something like it happens is merged.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T16:40:30Z",
      "diff_hunk" : "@@ -2565,6 +2565,20 @@ bool CWallet::CreateTransaction(const vector<CRecipient>& vecSend, CWalletTx& wt\n         }\n     }\n \n+    // Lastly, ensure this tx will pass the mempool's chain limits",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91117882",
      "id" : 91117882,
      "original_commit_id" : "8f1ae0c931bdb0fe9ba3c608f26c03c2b1ca594a",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11627487,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91117882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91125212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91125212"
         }
      },
      "body" : "Overall I find this test a bit hard to follow.  I wonder if you could make it a bit clearer.\r\n\r\nIt does a good job of testing that the send failures don't leave funds unavailable (b/c the transaction isn't committed), but I'm not sure that's even what @gmaxwell wants, although I do think it is a good idea.   But it doesn't test the hopefully more optimal behavior of being less likely to create these long chains.\r\n\r\nAlso, please , please, please, please don't use getbalance(\"*\"), you can use getbalance() + getunconfirmedbalance() if you need the total including mempool transactions...",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T17:12:04Z",
      "diff_hunk" : "@@ -346,5 +348,60 @@ def run_test (self):\n         assert_equal(coinbase_tx_1[\"transactions\"][0][\"blockhash\"], blocks[1])\n         assert_equal(len(self.nodes[0].listsinceblock(blocks[1])[\"transactions\"]), 0)\n \n+        # ===== Check that wallet doesn't \"lose\" funds chaining =====\n+        # ============ too many transactions together ===============\n+\n+        # Get all non-zero utxos together\n+        chain_addrs = [self.nodes[0].getnewaddress(), self.nodes[0].getnewaddress()]\n+        singletxid = self.nodes[0].sendtoaddress(chain_addrs[0], self.nodes[0].getbalance(), \"\", \"\", True)\n+        self.nodes[0].generate(1)\n+        node0_balance = self.nodes[0].getbalance()\n+        # Now split into two chains\n+        rawtx = self.nodes[0].createrawtransaction([{\"txid\":singletxid, \"vout\":0}], {chain_addrs[0]:self.nodes[0].getbalance()/2-Decimal('0.01'), chain_addrs[1]:self.nodes[0].getbalance()/2-Decimal('0.01')})\n+        signedtx = self.nodes[0].signrawtransaction(rawtx)\n+        singletxid = self.nodes[0].sendrawtransaction(signedtx[\"hex\"])\n+        txids = [singletxid, singletxid]\n+        # Swap output addrs if not aligned\n+        if chain_addrs[0] == self.nodes[0].getrawtransaction(singletxid, True)[\"vout\"][1][\"scriptPubKey\"][\"addresses\"][0]:\n+            chain_addrs = [chain_addrs[1], chain_addrs[0]]\n+\n+        # Use sendtoaddress with only one output at a time, successfully\n+        vout = 1\n+        for chainindex in range(chainlimit-1):\n+            for i in range(2):\n+                self.nodes[0].lockunspent(False, [{\"txid\":txids[(i+1)%2], \"vout\":vout}])\n+                amount = self.nodes[0].listunspent(0, 0, [chain_addrs[i]])[0][\"amount\"]\n+                txids[i] = self.nodes[0].sendtoaddress(chain_addrs[i], amount, \"\", \"\", True)\n+                self.nodes[0].lockunspent(True, [{\"txid\":txids[(i+1)%2], \"vout\":vout}])\n+\n+                vout = 0\n+                node0_balance = self.nodes[0].getbalance()\n+\n+                # If combining should fail, check\n+                if chainindex > chainlimit/2:\n+                    try:\n+                        self.nodes[0].sendtoaddress(chain_addrs[0], node0_balance, \"\", \"\", True)\n+                        assert(False)\n+                    except JSONRPCException as e:\n+                        assert_equal(node0_balance, self.nodes[0].getbalance())\n+                        if chainindex == chainlimit-2:\n+                            # Last one is too long for each input as well\n+                            assert(\"Insufficient\" in e.error['message'])\n+                        else:\n+                            assert(\"too long\" in e.error['message'])\n+\n+        # Or each individually\n+        for i in range(2):\n+            self.nodes[0].lockunspent(False, [{\"txid\":txids[(i+1)%2], \"vout\":0}])\n+            amount = self.nodes[0].listunspent(0, 0, [chain_addrs[i]])[0][\"amount\"]\n+            try:\n+                txids[i] = self.nodes[0].sendtoaddress(chain_addrs[i], amount, \"\", \"\", True)\n+                assert(False)\n+            except JSONRPCException as e:\n+                assert(\"Insufficient funds\" in e.error['message'])\n+            self.nodes[0].lockunspent(True, [{\"txid\":txids[(i+1)%2], \"vout\":0}])\n+\n+        assert_equal(node0_balance, self.nodes[0].getbalance(\"*\", 0))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91125212",
      "id" : 91125212,
      "original_commit_id" : "2da773454c02990665ecd1b03f60a6ab09bdf22d",
      "original_position" : 71,
      "path" : "qa/rpc-tests/wallet.py",
      "position" : null,
      "pull_request_review_id" : 11634593,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91125212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91134993"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91134993"
         }
      },
      "body" : "Particularly I was interested in checking it errors out when, and how. So I build two long chains, start checking that sending will fail due to final checks when combining the chains, not \"lack of coins\", then once it gets long enough, both coins are already too long to include.\r\n\r\nThis test might be too obscure/specific, but it helped convince me that the code is doing what I wanted it to do. I should probably add a simple test like @sdaftuar 's where it shows it preferentially choosing shorter chained outputs first.\r\n\r\n>please don't use getbalance(\"*\")\r\n\r\nLeftover, sorry. Will fix.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T18:00:03Z",
      "diff_hunk" : "@@ -346,5 +348,60 @@ def run_test (self):\n         assert_equal(coinbase_tx_1[\"transactions\"][0][\"blockhash\"], blocks[1])\n         assert_equal(len(self.nodes[0].listsinceblock(blocks[1])[\"transactions\"]), 0)\n \n+        # ===== Check that wallet doesn't \"lose\" funds chaining =====\n+        # ============ too many transactions together ===============\n+\n+        # Get all non-zero utxos together\n+        chain_addrs = [self.nodes[0].getnewaddress(), self.nodes[0].getnewaddress()]\n+        singletxid = self.nodes[0].sendtoaddress(chain_addrs[0], self.nodes[0].getbalance(), \"\", \"\", True)\n+        self.nodes[0].generate(1)\n+        node0_balance = self.nodes[0].getbalance()\n+        # Now split into two chains\n+        rawtx = self.nodes[0].createrawtransaction([{\"txid\":singletxid, \"vout\":0}], {chain_addrs[0]:self.nodes[0].getbalance()/2-Decimal('0.01'), chain_addrs[1]:self.nodes[0].getbalance()/2-Decimal('0.01')})\n+        signedtx = self.nodes[0].signrawtransaction(rawtx)\n+        singletxid = self.nodes[0].sendrawtransaction(signedtx[\"hex\"])\n+        txids = [singletxid, singletxid]\n+        # Swap output addrs if not aligned\n+        if chain_addrs[0] == self.nodes[0].getrawtransaction(singletxid, True)[\"vout\"][1][\"scriptPubKey\"][\"addresses\"][0]:\n+            chain_addrs = [chain_addrs[1], chain_addrs[0]]\n+\n+        # Use sendtoaddress with only one output at a time, successfully\n+        vout = 1\n+        for chainindex in range(chainlimit-1):\n+            for i in range(2):\n+                self.nodes[0].lockunspent(False, [{\"txid\":txids[(i+1)%2], \"vout\":vout}])\n+                amount = self.nodes[0].listunspent(0, 0, [chain_addrs[i]])[0][\"amount\"]\n+                txids[i] = self.nodes[0].sendtoaddress(chain_addrs[i], amount, \"\", \"\", True)\n+                self.nodes[0].lockunspent(True, [{\"txid\":txids[(i+1)%2], \"vout\":vout}])\n+\n+                vout = 0\n+                node0_balance = self.nodes[0].getbalance()\n+\n+                # If combining should fail, check\n+                if chainindex > chainlimit/2:\n+                    try:\n+                        self.nodes[0].sendtoaddress(chain_addrs[0], node0_balance, \"\", \"\", True)\n+                        assert(False)\n+                    except JSONRPCException as e:\n+                        assert_equal(node0_balance, self.nodes[0].getbalance())\n+                        if chainindex == chainlimit-2:\n+                            # Last one is too long for each input as well\n+                            assert(\"Insufficient\" in e.error['message'])\n+                        else:\n+                            assert(\"too long\" in e.error['message'])\n+\n+        # Or each individually\n+        for i in range(2):\n+            self.nodes[0].lockunspent(False, [{\"txid\":txids[(i+1)%2], \"vout\":0}])\n+            amount = self.nodes[0].listunspent(0, 0, [chain_addrs[i]])[0][\"amount\"]\n+            try:\n+                txids[i] = self.nodes[0].sendtoaddress(chain_addrs[i], amount, \"\", \"\", True)\n+                assert(False)\n+            except JSONRPCException as e:\n+                assert(\"Insufficient funds\" in e.error['message'])\n+            self.nodes[0].lockunspent(True, [{\"txid\":txids[(i+1)%2], \"vout\":0}])\n+\n+        assert_equal(node0_balance, self.nodes[0].getbalance(\"*\", 0))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91134993",
      "id" : 91134993,
      "original_commit_id" : "2da773454c02990665ecd1b03f60a6ab09bdf22d",
      "original_position" : 71,
      "path" : "qa/rpc-tests/wallet.py",
      "position" : null,
      "pull_request_review_id" : 11644330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91134993",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "Added init flag `-rejectlongwalletchains` which is by default `True`. When set to false only the preferential SelectCoinsMinConf behavior remains, with the last iteration accepting any length.",
      "created_at" : "2016-12-06T18:09:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-265225927",
      "id" : 265225927,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-06T18:09:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265225927",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91139948"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91139948"
         }
      },
      "body" : "So now when nLimitAncestors is set to 3 it will violate it here?",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T18:26:30Z",
      "diff_hunk" : "@@ -2167,10 +2182,16 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    bool frejectLongChains = GetBoolArg(\"-rejectlongwalletchains\", DEFAULT_REJECT_TOOLONG_CHAINS);\n+\n     bool res = nTargetValue <= nValueFromPresetInputs ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, vCoins, setCoinsRet, nValueRet) ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, vCoins, setCoinsRet, nValueRet) ||\n-        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, vCoins, setCoinsRet, nValueRet));\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, 0, vCoins, setCoinsRet, nValueRet) ||\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, 0, vCoins, setCoinsRet, nValueRet) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 2, vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 4, vCoins, setCoinsRet, nValueRet)) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91139948",
      "id" : 91139948,
      "original_commit_id" : "6ba348b69438e76d45a14ffc75ccec65af7155ae",
      "original_position" : 52,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11649416,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91139948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91140477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91140477"
         }
      },
      "body" : "Perhaps just pick larger denominators? n/10, n/5, n/2, n(or inf).",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T18:29:16Z",
      "diff_hunk" : "@@ -2167,10 +2182,16 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    bool frejectLongChains = GetBoolArg(\"-rejectlongwalletchains\", DEFAULT_REJECT_TOOLONG_CHAINS);\n+\n     bool res = nTargetValue <= nValueFromPresetInputs ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, vCoins, setCoinsRet, nValueRet) ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, vCoins, setCoinsRet, nValueRet) ||\n-        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, vCoins, setCoinsRet, nValueRet));\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, 0, vCoins, setCoinsRet, nValueRet) ||\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, 0, vCoins, setCoinsRet, nValueRet) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 2, vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 4, vCoins, setCoinsRet, nValueRet)) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91140477",
      "id" : 91140477,
      "original_commit_id" : "6ba348b69438e76d45a14ffc75ccec65af7155ae",
      "original_position" : 52,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11649929,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91140477",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91144763"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91144763"
         }
      },
      "body" : "@gmaxwell We're already not guaranteed to find an optimal spend, this is just best-efforts anyway, so in my opinion it's not worth trying to optimize further for users using unusual values of these policy limits, which we already discourage changes to by hiding away in help-debug.\r\n\r\nAt any rate I think having explicit small values here is overall a win, in case someone were using non-default arguments for nLimitAncestors -- this ensures that the coin selection is always first going to try coins that have no ancestors/descendants.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T18:49:43Z",
      "diff_hunk" : "@@ -2167,10 +2182,16 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    bool frejectLongChains = GetBoolArg(\"-rejectlongwalletchains\", DEFAULT_REJECT_TOOLONG_CHAINS);\n+\n     bool res = nTargetValue <= nValueFromPresetInputs ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, vCoins, setCoinsRet, nValueRet) ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, vCoins, setCoinsRet, nValueRet) ||\n-        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, vCoins, setCoinsRet, nValueRet));\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, 0, vCoins, setCoinsRet, nValueRet) ||\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, 0, vCoins, setCoinsRet, nValueRet) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 2, vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 4, vCoins, setCoinsRet, nValueRet)) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91144763",
      "id" : 91144763,
      "original_commit_id" : "6ba348b69438e76d45a14ffc75ccec65af7155ae",
      "original_position" : 52,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11654362,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91144763",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91154197"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91154197"
         }
      },
      "body" : "0, (N+1)/4, (N+1)/2, N (or inf)   gives all unique results for everything except 1 and 2... so the user would waste some computation for 1,2.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T19:33:16Z",
      "diff_hunk" : "@@ -2167,10 +2182,16 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    bool frejectLongChains = GetBoolArg(\"-rejectlongwalletchains\", DEFAULT_REJECT_TOOLONG_CHAINS);\n+\n     bool res = nTargetValue <= nValueFromPresetInputs ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, vCoins, setCoinsRet, nValueRet) ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, vCoins, setCoinsRet, nValueRet) ||\n-        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, vCoins, setCoinsRet, nValueRet));\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, 0, vCoins, setCoinsRet, nValueRet) ||\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, 0, vCoins, setCoinsRet, nValueRet) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 2, vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 4, vCoins, setCoinsRet, nValueRet)) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91154197",
      "id" : 91154197,
      "original_commit_id" : "6ba348b69438e76d45a14ffc75ccec65af7155ae",
      "original_position" : 52,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11663873,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91154197",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91172856"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91172856"
         }
      },
      "body" : "Restating my suggestion:  It's better to have more small number attempts because the large attempts will intermix chains and trash your short chains.  So  min(2,limit/4), min(4, limit/3), limit/2, limit would be a better pick... for example",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T21:16:46Z",
      "diff_hunk" : "@@ -2167,10 +2182,16 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    bool frejectLongChains = GetBoolArg(\"-rejectlongwalletchains\", DEFAULT_REJECT_TOOLONG_CHAINS);\n+\n     bool res = nTargetValue <= nValueFromPresetInputs ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, vCoins, setCoinsRet, nValueRet) ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, vCoins, setCoinsRet, nValueRet) ||\n-        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, vCoins, setCoinsRet, nValueRet));\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, 0, vCoins, setCoinsRet, nValueRet) ||\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, 0, vCoins, setCoinsRet, nValueRet) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 2, vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 4, vCoins, setCoinsRet, nValueRet)) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91172856",
      "id" : 91172856,
      "original_commit_id" : "6ba348b69438e76d45a14ffc75ccec65af7155ae",
      "original_position" : 52,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11682741,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91172856",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91173373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91173373"
         }
      },
      "body" : "ok sounds good to me",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T21:19:01Z",
      "diff_hunk" : "@@ -2167,10 +2182,16 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    bool frejectLongChains = GetBoolArg(\"-rejectlongwalletchains\", DEFAULT_REJECT_TOOLONG_CHAINS);\n+\n     bool res = nTargetValue <= nValueFromPresetInputs ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, vCoins, setCoinsRet, nValueRet) ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, vCoins, setCoinsRet, nValueRet) ||\n-        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, vCoins, setCoinsRet, nValueRet));\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, 0, vCoins, setCoinsRet, nValueRet) ||\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, 0, vCoins, setCoinsRet, nValueRet) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 2, vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 4, vCoins, setCoinsRet, nValueRet)) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91173373",
      "id" : 91173373,
      "original_commit_id" : "6ba348b69438e76d45a14ffc75ccec65af7155ae",
      "original_position" : 52,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11683235,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91173373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91177265"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91177265"
         }
      },
      "body" : "done",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-06T21:38:07Z",
      "diff_hunk" : "@@ -2167,10 +2182,16 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    bool frejectLongChains = GetBoolArg(\"-rejectlongwalletchains\", DEFAULT_REJECT_TOOLONG_CHAINS);\n+\n     bool res = nTargetValue <= nValueFromPresetInputs ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, vCoins, setCoinsRet, nValueRet) ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, vCoins, setCoinsRet, nValueRet) ||\n-        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, vCoins, setCoinsRet, nValueRet));\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, 0, vCoins, setCoinsRet, nValueRet) ||\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, 0, vCoins, setCoinsRet, nValueRet) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 2, vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, 4, vCoins, setCoinsRet, nValueRet)) ||",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91177265",
      "id" : 91177265,
      "original_commit_id" : "6ba348b69438e76d45a14ffc75ccec65af7155ae",
      "original_position" : 52,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 11687147,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91177265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "This is the prettiest blue bike-shed ever.  ACK.",
      "created_at" : "2016-12-07T03:03:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-265342460",
      "id" : 265342460,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-07T03:03:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265342460",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Note that if someone uses `-rejectlongwalletchains=0`, then in my simple use-case above (2 confirmed UTXOs that you're repeatedly making small spends from) this current code will unnecessarily produce a too-long-chain, because we don't try calling SCMC with nlimitancestors.\r\n\r\nAfter #9290 and #9302 I think this won't be a big deal, so given that we're defaulting this to true I don't think it matters much, and this shed has been repainted so many times we're probably running out of paint.  re-ACK cb6a6be.",
      "created_at" : "2016-12-08T21:02:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-265854485",
      "id" : 265854485,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-08T21:02:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265854485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91640237"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91640237"
         }
      },
      "body" : "These seem like they would be more appropriate on CTxMemPool?",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-09T00:48:55Z",
      "diff_hunk" : "@@ -1740,6 +1740,18 @@ bool CWalletTx::InMempool() const\n     return false;\n }\n \n+uint64_t CWalletTx::GetMempoolAncestorCount() const\n+{\n+    LOCK(mempool.cs);\n+    return mempool.mapTx.find(GetHash())->GetCountWithAncestors();\n+}\n+\n+uint64_t CWalletTx::GetMempoolDescendantCount() const\n+{\n+    LOCK(mempool.cs);\n+    return mempool.mapTx.find(GetHash())->GetCountWithDescendants();\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91640237",
      "id" : 91640237,
      "original_commit_id" : "cb6a6bec0ab213990bed5bf69cae010e97cae93e",
      "original_position" : 14,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 12151108,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91640237",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91649003"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91649003"
         }
      },
      "body" : "Why would we compare the descendant count to the max *ancestors*? Shouldn't it be compared to max descendants?",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-09T02:20:53Z",
      "diff_hunk" : "@@ -2042,6 +2054,9 @@ bool CWallet::SelectCoinsMinConf(const CAmount& nTargetValue, int nConfMine, int\n         if (output.nDepth < (pcoin->IsFromMe(ISMINE_ALL) ? nConfMine : nConfTheirs))\n             continue;\n \n+        if (pcoin->InMempool() && std::max(pcoin->GetMempoolAncestorCount(), pcoin->GetMempoolDescendantCount()) >= nMaxAncestors)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91649003",
      "id" : 91649003,
      "original_commit_id" : "cb6a6bec0ab213990bed5bf69cae010e97cae93e",
      "original_position" : 32,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 12151108,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91649003",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91649184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91649184"
         }
      },
      "body" : "Probably should capitalise the 'R' in the var name.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-09T02:22:30Z",
      "diff_hunk" : "@@ -2167,10 +2182,16 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    bool frejectLongChains = GetBoolArg(\"-rejectlongwalletchains\", DEFAULT_REJECT_TOOLONG_CHAINS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91649184",
      "id" : 91649184,
      "original_commit_id" : "cb6a6bec0ab213990bed5bf69cae010e97cae93e",
      "original_position" : 43,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 12151108,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91649184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91649251"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91649251"
         }
      },
      "body" : "Shouldn't `nLimitAncestors` here be `(nLimitAncestors - 1)`, because otherwise the new transaction would be 1 beyond the limit?",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-09T02:23:23Z",
      "diff_hunk" : "@@ -2167,10 +2182,16 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    bool frejectLongChains = GetBoolArg(\"-rejectlongwalletchains\", DEFAULT_REJECT_TOOLONG_CHAINS);\n+\n     bool res = nTargetValue <= nValueFromPresetInputs ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, vCoins, setCoinsRet, nValueRet) ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, vCoins, setCoinsRet, nValueRet) ||\n-        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, vCoins, setCoinsRet, nValueRet));\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, 0, vCoins, setCoinsRet, nValueRet) ||\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, 0, vCoins, setCoinsRet, nValueRet) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, std::min((size_t)2, nLimitAncestors/4), vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, std::min((size_t)4, nLimitAncestors/3), vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, nLimitAncestors/2, vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, frejectLongChains ? nLimitAncestors : std::numeric_limits<uint64_t>::max(), vCoins, setCoinsRet, nValueRet));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91649251",
      "id" : 91649251,
      "original_commit_id" : "cb6a6bec0ab213990bed5bf69cae010e97cae93e",
      "original_position" : 54,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 12151108,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91649251",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91649323"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91649323"
         }
      },
      "body" : "Even if `frejectLongChains` is set, shouldn't we prefer coins <nLimitAncestors when possible?",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-09T02:23:56Z",
      "diff_hunk" : "@@ -2167,10 +2182,16 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    bool frejectLongChains = GetBoolArg(\"-rejectlongwalletchains\", DEFAULT_REJECT_TOOLONG_CHAINS);\n+\n     bool res = nTargetValue <= nValueFromPresetInputs ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, vCoins, setCoinsRet, nValueRet) ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, vCoins, setCoinsRet, nValueRet) ||\n-        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, vCoins, setCoinsRet, nValueRet));\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, 0, vCoins, setCoinsRet, nValueRet) ||\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, 0, vCoins, setCoinsRet, nValueRet) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, std::min((size_t)2, nLimitAncestors/4), vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, std::min((size_t)4, nLimitAncestors/3), vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, nLimitAncestors/2, vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, frejectLongChains ? nLimitAncestors : std::numeric_limits<uint64_t>::max(), vCoins, setCoinsRet, nValueRet));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91649323",
      "id" : 91649323,
      "original_commit_id" : "cb6a6bec0ab213990bed5bf69cae010e97cae93e",
      "original_position" : 54,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 12151108,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91649323",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91649505"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91649505"
         }
      },
      "body" : "Might be best to have the default const, variable, and argument be more closely matched.\r\n\r\nSuggest `DEFAULT_WALLET_REJECT_LONG_CHAINS`, `fRejectLongChains`, and `-walletrejectlongchains`",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-09T02:26:11Z",
      "diff_hunk" : "@@ -2167,10 +2182,16 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    bool frejectLongChains = GetBoolArg(\"-rejectlongwalletchains\", DEFAULT_REJECT_TOOLONG_CHAINS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91649505",
      "id" : 91649505,
      "original_commit_id" : "cb6a6bec0ab213990bed5bf69cae010e97cae93e",
      "original_position" : 43,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 12151108,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91649505",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91649802"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91649802"
         }
      },
      "body" : "Might make sense to make a `bool CalculateMemPoolAncestors(const CTxMemPoolEntry &entry, setEntries &setAncestors, std::string &errString, bool fSearchForParents = true) const;` for this common code.\r\n\r\nOTOH, we should probably split the policy logic out of ATMP, so this refactoring may not make sense long-term.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-09T02:29:56Z",
      "diff_hunk" : "@@ -2545,6 +2566,21 @@ bool CWallet::CreateTransaction(const vector<CRecipient>& vecSend, CWalletTx& wt\n         }\n     }\n \n+    if (GetBoolArg(\"-rejectlongwalletchains\", DEFAULT_REJECT_TOOLONG_CHAINS)) {\n+        // Lastly, ensure this tx will pass the mempool's chain limits\n+        LockPoints lp;\n+        CTxMemPoolEntry entry(txNew, 0, 0, 0, 0, false, 0, false, 0, lp);\n+        CTxMemPool::setEntries setAncestors;\n+        size_t nLimitAncestors = GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT);\n+        size_t nLimitAncestorSize = GetArg(\"-limitancestorsize\", DEFAULT_ANCESTOR_SIZE_LIMIT)*1000;\n+        size_t nLimitDescendants = GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT);\n+        size_t nLimitDescendantSize = GetArg(\"-limitdescendantsize\", DEFAULT_DESCENDANT_SIZE_LIMIT)*1000;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91649802",
      "id" : 91649802,
      "original_commit_id" : "cb6a6bec0ab213990bed5bf69cae010e97cae93e",
      "original_position" : 70,
      "path" : "src/wallet/wallet.cpp",
      "position" : 52,
      "pull_request_review_id" : 12151108,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91649802",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91709459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91709459"
         }
      },
      "body" : "misnomer, nMaxAncestors is the minimum of the two parameters. Will fix.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-09T12:42:28Z",
      "diff_hunk" : "@@ -2042,6 +2054,9 @@ bool CWallet::SelectCoinsMinConf(const CAmount& nTargetValue, int nConfMine, int\n         if (output.nDepth < (pcoin->IsFromMe(ISMINE_ALL) ? nConfMine : nConfTheirs))\n             continue;\n \n+        if (pcoin->InMempool() && std::max(pcoin->GetMempoolAncestorCount(), pcoin->GetMempoolDescendantCount()) >= nMaxAncestors)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91709459",
      "id" : 91709459,
      "original_commit_id" : "cb6a6bec0ab213990bed5bf69cae010e97cae93e",
      "original_position" : 32,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 12220090,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91709459",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91711390"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91711390"
         }
      },
      "body" : "the count counts the coin itself in the chain length, so I think it's right as-is. `>=` is the check to reject.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-09T12:58:43Z",
      "diff_hunk" : "@@ -2167,10 +2182,16 @@ bool CWallet::SelectCoins(const vector<COutput>& vAvailableCoins, const CAmount&\n             ++it;\n     }\n \n+    size_t nLimitAncestors = std::min(GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT), GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    bool frejectLongChains = GetBoolArg(\"-rejectlongwalletchains\", DEFAULT_REJECT_TOOLONG_CHAINS);\n+\n     bool res = nTargetValue <= nValueFromPresetInputs ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, vCoins, setCoinsRet, nValueRet) ||\n-        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, vCoins, setCoinsRet, nValueRet) ||\n-        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, vCoins, setCoinsRet, nValueRet));\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 6, 0, vCoins, setCoinsRet, nValueRet) ||\n+        SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 1, 1, 0, vCoins, setCoinsRet, nValueRet) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, std::min((size_t)2, nLimitAncestors/4), vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, std::min((size_t)4, nLimitAncestors/3), vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, nLimitAncestors/2, vCoins, setCoinsRet, nValueRet)) ||\n+        (bSpendZeroConfChange && SelectCoinsMinConf(nTargetValue - nValueFromPresetInputs, 0, 1, frejectLongChains ? nLimitAncestors : std::numeric_limits<uint64_t>::max(), vCoins, setCoinsRet, nValueRet));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91711390",
      "id" : 91711390,
      "original_commit_id" : "cb6a6bec0ab213990bed5bf69cae010e97cae93e",
      "original_position" : 54,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 12222105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91711390",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "Anticipating other changes to wallet https://github.com/bitcoin/bitcoin/pull/9302 https://github.com/bitcoin/bitcoin/pull/9290 , I changed the default for rejecting wallet transactions to false, and took the opportunity to put on a couple more layers of paint with renaming suggestions by @luke-jr , made a much simpler test that just checks for wallet coin preferential treatment, always have the wallet attempt an at-limit coin selection and then followup with an anything goes attempt if arguments allow.",
      "created_at" : "2016-12-09T13:43:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-266016712",
      "id" : 266016712,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-09T13:44:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/266016712",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "@instagibbs Test fails-- otherwise looking fine to me.",
      "created_at" : "2016-12-10T21:23:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-266241108",
      "id" : 266241108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-10T21:23:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/266241108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "forgot to rename the param in description, fixed",
      "created_at" : "2016-12-10T21:43:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-266242095",
      "id" : 266242095,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-10T21:43:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/266242095",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91856842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91856842"
         }
      },
      "body" : "I don't think it makes sense to expose such a detail to every user. (Note that all the `-limit<whatever>` options are only displayed to advanced users.)",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-11T14:25:17Z",
      "diff_hunk" : "@@ -3347,6 +3384,7 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n                                                             CURRENCY_UNIT, FormatMoney(DEFAULT_TRANSACTION_MINFEE)));\n     strUsage += HelpMessageOpt(\"-paytxfee=<amt>\", strprintf(_(\"Fee (in %s/kB) to add to transactions you send (default: %s)\"),\n                                                             CURRENCY_UNIT, FormatMoney(payTxFee.GetFeePerK())));\n+    strUsage += HelpMessageOpt(\"-walletrejectlongchains\", strprintf(_(\"Wallet will not create transactions that violate mempool chain limits (default: %u\"), DEFAULT_WALLET_REJECT_LONG_CHAINS));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91856842",
      "id" : 91856842,
      "original_commit_id" : "5d7edcdbfb78ad2f928e90e01a1b607ed1d3d9bc",
      "original_position" : 85,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 12367495,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91856842",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91856947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91856947"
         }
      },
      "body" : "In light of search for a general solution to the problem, you might want to consider introducing an option that makes the wallet ignore whatever mempool policies are in place right now.\r\n\r\nWhen this option is enabled, we get the current behavior, i.e. transactions might not be accepted to the mempool and might not be relayed. However, when the option is disabled and the mempool policy is considered during transaction creation, every transaction that is created also is accepted to the mempool. If no such transaction can be created, the call fails.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-11T14:30:14Z",
      "diff_hunk" : "@@ -3347,6 +3384,7 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n                                                             CURRENCY_UNIT, FormatMoney(DEFAULT_TRANSACTION_MINFEE)));\n     strUsage += HelpMessageOpt(\"-paytxfee=<amt>\", strprintf(_(\"Fee (in %s/kB) to add to transactions you send (default: %s)\"),\n                                                             CURRENCY_UNIT, FormatMoney(payTxFee.GetFeePerK())));\n+    strUsage += HelpMessageOpt(\"-walletrejectlongchains\", strprintf(_(\"Wallet will not create transactions that violate mempool chain limits (default: %u\"), DEFAULT_WALLET_REJECT_LONG_CHAINS));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91856947",
      "id" : 91856947,
      "original_commit_id" : "5d7edcdbfb78ad2f928e90e01a1b607ed1d3d9bc",
      "original_position" : 85,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 12367593,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91856947",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Concept ACK",
      "created_at" : "2016-12-11T14:30:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-266285447",
      "id" : 266285447,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-11T14:30:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/266285447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91860881"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91860881"
         }
      },
      "body" : "I believe the consensus is to have all temporary failures return a txid, and rebroadcast the transaction when it can, entering it into the mempool.\r\n\r\nre:detailing to every user, fair enough. I've moved it under `showDebug`, which I believe is what you meant.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-11T17:50:25Z",
      "diff_hunk" : "@@ -3347,6 +3384,7 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n                                                             CURRENCY_UNIT, FormatMoney(DEFAULT_TRANSACTION_MINFEE)));\n     strUsage += HelpMessageOpt(\"-paytxfee=<amt>\", strprintf(_(\"Fee (in %s/kB) to add to transactions you send (default: %s)\"),\n                                                             CURRENCY_UNIT, FormatMoney(payTxFee.GetFeePerK())));\n+    strUsage += HelpMessageOpt(\"-walletrejectlongchains\", strprintf(_(\"Wallet will not create transactions that violate mempool chain limits (default: %u\"), DEFAULT_WALLET_REJECT_LONG_CHAINS));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r91860881",
      "id" : 91860881,
      "original_commit_id" : "5d7edcdbfb78ad2f928e90e01a1b607ed1d3d9bc",
      "original_position" : 85,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 12370992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91860881",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "Tested ACK 63c17b8\r\n\r\nHowever I still don't really love the test.  For instance the test doesn't work if you haven't set the ancestor limit lower than the default.  It's in general tricky to test behavior which depends on the vagaries of coin selection, but one simple improvement to this test would be to send the coins to a different nodes address so then we only have the change to consider for subsequent spends and not the outputs themselves.  This would make it so you could reliably send (number of original outputs * chain limits) transactions as long as the change is large compared to the value you're sending.\r\n\r\nHowever it would be nice if we could stop rebasing this PR and get it merged, so if you do want to change the test, please don't modify the other two commits...\r\n",
      "created_at" : "2016-12-12T17:29:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-266495064",
      "id" : 266495064,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-12T17:29:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/266495064",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "ACK.",
      "created_at" : "2016-12-13T01:01:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-266603543",
      "id" : 266603543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-13T01:01:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/266603543",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92078687"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92078687"
         }
      },
      "body" : "Given that we don't hold `mempool.cs` here, the transaction could be removed from the mempool in between the `pcoin->InMempool()` and `pcoin->GetMempoolAncestorCount()` calls, causing a segfault in the latter. Please abstract this whole conditional out into a method on `CTxMempool`, which takes the limit value and the txid, and returns whether the transaction is in the pool and satisfies the limits.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-13T01:13:44Z",
      "diff_hunk" : "@@ -2042,6 +2054,9 @@ bool CWallet::SelectCoinsMinConf(const CAmount& nTargetValue, int nConfMine, int\n         if (output.nDepth < (pcoin->IsFromMe(ISMINE_ALL) ? nConfMine : nConfTheirs))\n             continue;\n \n+        if (pcoin->InMempool() && std::max(pcoin->GetMempoolAncestorCount(), pcoin->GetMempoolDescendantCount()) >= nMaxAncestors)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92078687",
      "id" : 92078687,
      "original_commit_id" : "cb6a6bec0ab213990bed5bf69cae010e97cae93e",
      "original_position" : 32,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 12588186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92078687",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92078915"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92078915"
         }
      },
      "body" : "Agree with @luke-jr, but I think we need something higher-level anyway (see further).",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-13T01:15:42Z",
      "diff_hunk" : "@@ -1740,6 +1740,18 @@ bool CWalletTx::InMempool() const\n     return false;\n }\n \n+uint64_t CWalletTx::GetMempoolAncestorCount() const\n+{\n+    LOCK(mempool.cs);\n+    return mempool.mapTx.find(GetHash())->GetCountWithAncestors();\n+}\n+\n+uint64_t CWalletTx::GetMempoolDescendantCount() const\n+{\n+    LOCK(mempool.cs);\n+    return mempool.mapTx.find(GetHash())->GetCountWithDescendants();\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92078915",
      "id" : 92078915,
      "original_commit_id" : "cb6a6bec0ab213990bed5bf69cae010e97cae93e",
      "original_position" : 14,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 12588186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92078915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92079514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92079514"
         }
      },
      "body" : "I don't care that it's called only once - this just doesn't seem like code that belongs in the wallet (which shouldn't need to know about the mempool's policy limits as much as possible). Having it abstracted probably makes it usable for other purposes too.\r\n\r\nAlso, #9290 does not mean we can't do belt and suspender checks to avoid producing long chains. Not adding such a transaction to the wallet (and mempool) is still superior to just adding it to the wallet and relying on retransmit to get it to go through at a later point in time.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-13T01:20:53Z",
      "diff_hunk" : "@@ -2545,6 +2567,21 @@ bool CWallet::CreateTransaction(const vector<CRecipient>& vecSend, CWalletTx& wt\n         }\n     }\n \n+    if (GetBoolArg(\"-walletrejectlongchains\", DEFAULT_WALLET_REJECT_LONG_CHAINS)) {\n+        // Lastly, ensure this tx will pass the mempool's chain limits",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92079514",
      "id" : 92079514,
      "original_commit_id" : "63c17b821619322f8e7ba32381c62ebef23f5a3d",
      "original_position" : 64,
      "path" : "src/wallet/wallet.cpp",
      "position" : 45,
      "pull_request_review_id" : 12588186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92079514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92079574"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92079574"
         }
      },
      "body" : "Why false?",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-13T01:21:27Z",
      "diff_hunk" : "@@ -53,6 +53,8 @@ static const CAmount MIN_CHANGE = CENT;\n static const bool DEFAULT_SPEND_ZEROCONF_CHANGE = true;\n //! Default for -sendfreetransactions\n static const bool DEFAULT_SEND_FREE_TRANSACTIONS = false;\n+//! Default for -walletrejectlongchains\n+static const bool DEFAULT_WALLET_REJECT_LONG_CHAINS = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92079574",
      "id" : 92079574,
      "original_commit_id" : "63c17b821619322f8e7ba32381c62ebef23f5a3d",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 12588186,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92079574",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Replaced SCMC mempool check with more generalized check in CTxMempool.\r\n\r\nre: default I disagree, I think that the default behavior here makes more sense unless the user has a way of probing for something like `GetBalanceWithinChainLimits()`.",
      "created_at" : "2016-12-13T14:28:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-266752017",
      "id" : 266752017,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-13T14:28:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/266752017",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92179493"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92179493"
         }
      },
      "body" : "Should we call this something other than **Coin**WithinLimit?  Seems like coins are not something that the mempool is aware of.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-13T14:33:19Z",
      "diff_hunk" : "@@ -605,6 +605,9 @@ class CTxMemPool\n     /** Expire all transaction (and their dependencies) in the mempool older than time. Return the number of removed transactions. */\n     int Expire(int64_t time);\n \n+    /** Returns false if the transaction is in the mempool and not within the chain limit specified. */\n+    bool CoinWithinLimit(const uint256& txid, size_t chainLimit) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92179493",
      "id" : 92179493,
      "original_commit_id" : "383c0854d5682c300f3a3b14afb728c74211d7f7",
      "original_position" : 5,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 12689232,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92179493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92180310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92180310"
         }
      },
      "body" : "`TransactionWithinChainLimit`?",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-13T14:36:48Z",
      "diff_hunk" : "@@ -605,6 +605,9 @@ class CTxMemPool\n     /** Expire all transaction (and their dependencies) in the mempool older than time. Return the number of removed transactions. */\n     int Expire(int64_t time);\n \n+    /** Returns false if the transaction is in the mempool and not within the chain limit specified. */\n+    bool CoinWithinLimit(const uint256& txid, size_t chainLimit) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92180310",
      "id" : 92180310,
      "original_commit_id" : "383c0854d5682c300f3a3b14afb728c74211d7f7",
      "original_position" : 5,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 12690016,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92180310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92390777"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92390777"
         }
      },
      "body" : "It is the least change in behavior, so makes sense in case this is still considered for backport.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-14T13:21:38Z",
      "diff_hunk" : "@@ -53,6 +53,8 @@ static const CAmount MIN_CHANGE = CENT;\n static const bool DEFAULT_SPEND_ZEROCONF_CHANGE = true;\n //! Default for -sendfreetransactions\n static const bool DEFAULT_SEND_FREE_TRANSACTIONS = false;\n+//! Default for -walletrejectlongchains\n+static const bool DEFAULT_WALLET_REJECT_LONG_CHAINS = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92390777",
      "id" : 92390777,
      "original_commit_id" : "63c17b821619322f8e7ba32381c62ebef23f5a3d",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : 5,
      "pull_request_review_id" : 12904303,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92390777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92982566"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92982566"
         }
      },
      "body" : "You're doing 3 map lookups here. What about\r\n```c++\r\nauto it = mapTx.find(txid);\r\nreturn it != mapTx.end() && it->GetCountWithAncestors() < chainLimit &&\r\n    it->GetCountWithDescendants() < chainLimit;\r\n```\r\n",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-19T07:56:53Z",
      "diff_hunk" : "@@ -1142,3 +1142,10 @@ void CTxMemPool::TrimToSize(size_t sizelimit, std::vector<uint256>* pvNoSpendsRe\n     if (maxFeeRateRemoved > CFeeRate(0))\n         LogPrint(\"mempool\", \"Removed %u txn, rolling minimum fee bumped to %s\\n\", nTxnRemoved, maxFeeRateRemoved.ToString());\n }\n+\n+bool CTxMemPool::TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const {\n+    LOCK(cs);\n+    if (exists(txid) && std::max(mapTx.find(txid)->GetCountWithAncestors(), mapTx.find(txid)->GetCountWithDescendants()) >= chainLimit)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r92982566",
      "id" : 92982566,
      "original_commit_id" : "0b2294a980319cbffa8612ce993e0ecaa26fa509",
      "original_position" : 7,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 13502979,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92982566",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "utACK 5882c099d9af6e8566d0bf46fb1da424a4373bf8, with one nit.",
      "created_at" : "2016-12-19T08:02:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-267903812",
      "id" : 267903812,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-19T08:02:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267903812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "fixed @sipa nit",
      "created_at" : "2016-12-19T14:51:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-267982624",
      "id" : 267982624,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-19T14:51:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267982624",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "Travis doesn't agree with your change, it seems.",
      "created_at" : "2016-12-19T15:47:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-267997903",
      "id" : 267997903,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-19T15:47:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267997903",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj yes the logic made no sense, it will reject anything not in mempool rather than anything in mempool with too long a chain. Fixed.",
      "created_at" : "2016-12-19T15:55:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-268000141",
      "id" : 268000141,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-19T15:55:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268000141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r93123140"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93123140"
         }
      },
      "body" : "nit: you forgot to const-ify the first two ints which you did in the .cpp",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-19T21:28:19Z",
      "diff_hunk" : "@@ -685,7 +687,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n      * completion the coin set and corresponding actual target value is\n      * assembled\n      */\n-    bool SelectCoinsMinConf(const CAmount& nTargetValue, int nConfMine, int nConfTheirs, std::vector<COutput> vCoins, std::set<std::pair<const CWalletTx*,unsigned int> >& setCoinsRet, CAmount& nValueRet) const;\n+    bool SelectCoinsMinConf(const CAmount& nTargetValue, int nConfMine, int nConfTheirs, uint64_t nMaxAncestors, std::vector<COutput> vCoins, std::set<std::pair<const CWalletTx*,unsigned int> >& setCoinsRet, CAmount& nValueRet) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r93123140",
      "id" : 93123140,
      "original_commit_id" : "ff79329ccfe3ee4387b9de72d82431c7b8132272",
      "original_position" : 14,
      "path" : "src/wallet/wallet.h",
      "position" : 14,
      "pull_request_review_id" : 13645351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93123140",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r93126373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93126373"
         }
      },
      "body" : "Agreed, though in the interest of backporting and getting 0.13.2 out cleaing up the interface here probably isnt the priority. Lets do it in another pr.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-19T21:46:07Z",
      "diff_hunk" : "@@ -2545,6 +2567,21 @@ bool CWallet::CreateTransaction(const vector<CRecipient>& vecSend, CWalletTx& wt\n         }\n     }\n \n+    if (GetBoolArg(\"-walletrejectlongchains\", DEFAULT_WALLET_REJECT_LONG_CHAINS)) {\n+        // Lastly, ensure this tx will pass the mempool's chain limits",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r93126373",
      "id" : 93126373,
      "original_commit_id" : "63c17b821619322f8e7ba32381c62ebef23f5a3d",
      "original_position" : 64,
      "path" : "src/wallet/wallet.cpp",
      "position" : 45,
      "pull_request_review_id" : 13645351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93126373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r93130302"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93130302"
         }
      },
      "body" : "Note that by not filling in the sigOpsCost here we dont have that information for the virtual transaction size, so you could still run over the limit here. I don't think its a big deal, but we should fix when we clean things up in 0.14 as suggested two lines up.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-19T22:07:31Z",
      "diff_hunk" : "@@ -2545,6 +2555,21 @@ bool CWallet::CreateTransaction(const vector<CRecipient>& vecSend, CWalletTx& wt\n         }\n     }\n \n+    if (GetBoolArg(\"-walletrejectlongchains\", DEFAULT_WALLET_REJECT_LONG_CHAINS)) {\n+        // Lastly, ensure this tx will pass the mempool's chain limits\n+        LockPoints lp;\n+        CTxMemPoolEntry entry(txNew, 0, 0, 0, 0, false, 0, false, 0, lp);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r93130302",
      "id" : 93130302,
      "original_commit_id" : "ff79329ccfe3ee4387b9de72d82431c7b8132272",
      "original_position" : 47,
      "path" : "src/wallet/wallet.cpp",
      "position" : 47,
      "pull_request_review_id" : 13645351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93130302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r93157542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93157542"
         }
      },
      "body" : "This really should be indented.",
      "commit_id" : "cee16123f550f6baad0205f776831f39d026758b",
      "created_at" : "2016-12-20T01:42:38Z",
      "diff_hunk" : "@@ -1145,7 +1145,7 @@ void CTxMemPool::TrimToSize(size_t sizelimit, std::vector<uint256>* pvNoSpendsRe\n \n bool CTxMemPool::TransactionWithinChainLimit(const uint256& txid, size_t chainLimit) const {\n     LOCK(cs);\n-    if (exists(txid) && std::max(mapTx.find(txid)->GetCountWithAncestors(), mapTx.find(txid)->GetCountWithDescendants()) >= chainLimit)\n-        return false;\n-    return true;\n+    auto it = mapTx.find(txid);\n+    return it == mapTx.end() || (it->GetCountWithAncestors() < chainLimit &&\n+    it->GetCountWithDescendants() < chainLimit);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#discussion_r93157542",
      "id" : 93157542,
      "original_commit_id" : "ff79329ccfe3ee4387b9de72d82431c7b8132272",
      "original_position" : 9,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 13679300,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9262",
      "updated_at" : "2016-12-20T01:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93157542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Backported in #9382, removing label",
      "created_at" : "2016-12-20T12:41:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9262#issuecomment-268233947",
      "id" : 268233947,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9262",
      "updated_at" : "2016-12-20T12:41:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268233947",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
