{
   "assignee" : null,
   "assignees" : [],
   "body" : "(Split out and rewritten chunk of #8631. I'll rebase that on top of this post-merge and reopen.)\r\n\r\nThis is a prerequisite for async network handling. As-is, we don't have enough control over the shutdown process to be able to deal with async connecting and send/recv.\r\n\r\nIn particular, we need to be sure that message processing has shut down before forcing all networking down, otherwise we run the risk of trying to process a node's messages during its destruction. This is not a problem now because the current sync model works fine with all threads being interrupted at the same time.\r\n\r\nAnd if that's not a satisfactory reason for the change, it also gets rid of a nice chunk of boost threading (and simplifies the rebase of #8631 :)\r\n\r\nTo accomplish this, we need to:\r\n- Set a flag to interrupt all net threads\r\n- notify all blocked condvars\r\n- replace MilliSleep (since they're boost interruption points)\r\n- teach init to Interrupt/Stop, similar to some of the other subsystems.\r\n\r\nThe MilliSleeps are replaced with condvars that check for the thread's interrupt flag. Since the flags are atomic, there's no need for real locking, so these condvars use a dummy CNullLock.\r\n\r\nWith all of that done, we may as well switch away from boost threads, since we're no longer dependent on interruption.\r\n\r\n@TheBlueMatt 3f3f0b4bce0fb34e803b4893594b44df1f2effe3 is the awkward change I mentioned on IRC. The global will be cleaned up when we move processing into a class as a next step (something like https://github.com/theuni/bitcoin/commit/3f598dbe7100c7c6c7bfb7e10210585327ed9d31)",
   "closed_at" : "2017-01-04T11:22:12Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 33,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289/comments",
   "created_at" : "2016-12-06T03:02:13Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289",
   "id" : 193670934,
   "labels" : [
      {
         "color" : "E6F6D6",
         "default" : false,
         "id" : 135961,
         "name" : "Refactoring",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289/labels{/name}",
   "locked" : false,
   "milestone" : {
      "closed_at" : null,
      "closed_issues" : 42,
      "created_at" : "2016-06-13T14:18:51Z",
      "creator" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      },
      "description" : "",
      "due_on" : null,
      "html_url" : "https://github.com/bitcoin/bitcoin/milestone/21",
      "id" : 1823680,
      "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/21/labels",
      "number" : 21,
      "open_issues" : 31,
      "state" : "open",
      "title" : "0.14.0",
      "updated_at" : "2017-01-04T12:35:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/21"
   },
   "number" : 9289,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/9289.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9289",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/9289.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9289"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "net: drop boost::thread_group",
   "updated_at" : "2017-01-04T11:22:12Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9289",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
      "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
      "followers_url" : "https://api.github.com/users/theuni/followers",
      "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/theuni",
      "id" : 417043,
      "login" : "theuni",
      "organizations_url" : "https://api.github.com/users/theuni/orgs",
      "received_events_url" : "https://api.github.com/users/theuni/received_events",
      "repos_url" : "https://api.github.com/users/theuni/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/theuni"
   }
}
