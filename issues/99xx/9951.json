{
   "assignee" : null,
   "assignees" : [],
   "body" : "My immediate goal with this is to make it easier to use a different key/value store instead of BerkeleyDB, for a sandboxing project. However, it is an improvement also for BerkeleyDB.\r\n\r\nSteps:\r\n\r\n- Abstract database handle from explicit strFilename  into CWalletDBWrapper. For many databases, a usable handle involves more than just a filename. Also make the field private.\r\n\r\n- Get rid of fFileBacked - it is only used by the tests, and used inconsistly - for example CWallet::AddToWallet doesn't check it at all, and that's not quite the only place (see AbandonWallet). Fixing would be a lot of  work and lead to disjointed code.\r\n\r\n  But it is not necessary. Instead move the concern to ignoring operations with a dummy database to CDB. There were very few changes necessary for this.\r\n\r\n- Reduce references to global bitdb. CWalletDBWrapper carries this environment information around so there is less need to refer to global scope. Besides being cleaner, this could allow use of multiple database environments at some point.\r\n\r\n- CWalletDB now contains a CDB instead of inheriting from it. This makes it easier to replace the internal transaction with a different database, without leaking through internals.\r\n\r\nFuture:\r\n\r\n- The eventual goal of \"CWalletDBWrapper\" is like \"CDBWrapper\", to move further database functionality there from \"CDB\" (which is really a \"CDBBatch\", a database transaction object). Not renaming it nor CWalletDB here to not interfere unduly much with other open wallet pulls.\r\n\r\n- Two maps inside bitdb that refer to wallet files by name could be removed,\r\n  and converted to fields on CWalletDBWrapper:\r\n\r\n    std::map<std::string, int> mapFileUseCount;\r\n    std::map<std::string, Db*> mapDb;",
   "closed_at" : "2017-04-24T14:47:46Z",
   "closed_by" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 10,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9951/comments",
   "created_at" : "2017-03-08T14:47:52Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9951/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951",
   "id" : 212754400,
   "labels" : [
      {
         "color" : "02d7e1",
         "default" : false,
         "id" : 149424,
         "name" : "Wallet",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9951/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 9951,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/9951.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9951",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/9951.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9951"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Wallet database handling abstractions/simplifications",
   "updated_at" : "2017-04-24T14:47:46Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9951",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   }
}
