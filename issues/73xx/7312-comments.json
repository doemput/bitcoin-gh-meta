[
   {
      "body" : "This is way too late for 0.12...",
      "created_at" : "2016-01-07T17:35:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-169748063",
      "id" : 169748063,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-07T17:35:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/169748063",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "@luke-jr I don't think we can release 0.12 without this.  With mempool eviction combined with the new behaviour that unconfirmed txs still tie up the coins they spend even if the txs are not in the mempool, users may end up with permanently unspendable coins frequently.\r\n\r\nWe discussed making this change in conjunction with the other changes back in November, but it appears to have slipped through the cracks.\r\n",
      "created_at" : "2016-01-07T17:45:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-169752951",
      "id" : 169752951,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-07T17:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/169752951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49119119"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49119119"
         }
      },
      "body" : "`CMerkleTx::GetDepthInMainChain()` is slightly expansive (and `IsSpent()` gets called a lot). Would caching `mit->second.GetDepthInMainChain()` make sense? Or do we expect the compiler does it internally (I don't think so)?",
      "commit_id" : "d11fc1695c0453ef22a633e516726f82717dd1d9",
      "created_at" : "2016-01-07T20:05:04Z",
      "diff_hunk" : "@@ -455,8 +457,10 @@ bool CWallet::IsSpent(const uint256& hash, unsigned int n) const\n     {\n         const uint256& wtxid = it->second;\n         std::map<uint256, CWalletTx>::const_iterator mit = mapWallet.find(wtxid);\n-        if (mit != mapWallet.end() && mit->second.GetDepthInMainChain() >= 0)\n-            return true; // Spent\n+        if (mit != mapWallet.end()) {\n+            if (mit->second.GetDepthInMainChain() > 0  || (mit->second.GetDepthInMainChain() == 0 && !mit->second.isAbandoned()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49119119",
      "id" : 49119119,
      "original_commit_id" : "9726a520ee2e11d567bbc63901bf1cdde328d658",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T13:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49119119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49120293"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49120293"
         }
      },
      "body" : "nit: I probably would do it also that way,... but, maybe a cleaner way would be to use `CWalletTx::mapValue` (a flexible kv store) which also would not require a db-scheme update.",
      "commit_id" : "d11fc1695c0453ef22a633e516726f82717dd1d9",
      "created_at" : "2016-01-07T20:14:45Z",
      "diff_hunk" : "@@ -48,6 +48,8 @@ bool fSendFreeTransactions = DEFAULT_SEND_FREE_TRANSACTIONS;\n  */\n CFeeRate CWallet::minTxFee = CFeeRate(DEFAULT_TRANSACTION_MINFEE);\n \n+const uint256 CMerkleTx::abandonHash(uint256S(\"0000000000000000000000000000000000000000000000000000000000000001\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49120293",
      "id" : 49120293,
      "original_commit_id" : "9726a520ee2e11d567bbc63901bf1cdde328d658",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T13:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49120293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Concept ACK.\r\nI agree it late for 0.12,... but I don't take a position on this (if it's saver to go with or without a such feature).\r\n\r\nWould be nice to see some tests (especially when we tag this for 0.12).",
      "created_at" : "2016-01-07T20:17:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-169793688",
      "id" : 169793688,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-07T20:17:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/169793688",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49126953"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49126953"
         }
      },
      "body" : "sure can fix",
      "commit_id" : "d11fc1695c0453ef22a633e516726f82717dd1d9",
      "created_at" : "2016-01-07T21:17:09Z",
      "diff_hunk" : "@@ -455,8 +457,10 @@ bool CWallet::IsSpent(const uint256& hash, unsigned int n) const\n     {\n         const uint256& wtxid = it->second;\n         std::map<uint256, CWalletTx>::const_iterator mit = mapWallet.find(wtxid);\n-        if (mit != mapWallet.end() && mit->second.GetDepthInMainChain() >= 0)\n-            return true; // Spent\n+        if (mit != mapWallet.end()) {\n+            if (mit->second.GetDepthInMainChain() > 0  || (mit->second.GetDepthInMainChain() == 0 && !mit->second.isAbandoned()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49126953",
      "id" : 49126953,
      "original_commit_id" : "9726a520ee2e11d567bbc63901bf1cdde328d658",
      "original_position" : 16,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T13:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49126953",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49129512"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49129512"
         }
      },
      "body" : "I debated doing that and maybe it would have been better, but I liked the way updating the hashBlock automatically made the transaction no longer abandoned with this approach.",
      "commit_id" : "d11fc1695c0453ef22a633e516726f82717dd1d9",
      "created_at" : "2016-01-07T21:38:53Z",
      "diff_hunk" : "@@ -48,6 +48,8 @@ bool fSendFreeTransactions = DEFAULT_SEND_FREE_TRANSACTIONS;\n  */\n CFeeRate CWallet::minTxFee = CFeeRate(DEFAULT_TRANSACTION_MINFEE);\n \n+const uint256 CMerkleTx::abandonHash(uint256S(\"0000000000000000000000000000000000000000000000000000000000000001\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49129512",
      "id" : 49129512,
      "original_commit_id" : "9726a520ee2e11d567bbc63901bf1cdde328d658",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T13:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49129512",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "Addressed @jonasschnelli's comment (thanks for quick review!) and reordered commits for simpler reading.",
      "created_at" : "2016-01-07T21:42:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-169814431",
      "id" : 169814431,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-07T21:42:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/169814431",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "oops, i didn't mean to push that RPC test yet, it was still in progress, but might as well leave it there for now...",
      "created_at" : "2016-01-08T03:47:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-169885072",
      "id" : 169885072,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-08T03:47:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/169885072",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49165361"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49165361"
         }
      },
      "body" : "> I debated doing that and maybe it would have been better, but I liked the way updating the hashBlock automatically made the transaction no longer abandoned with this approach.\r\n\r\nfair enough.",
      "commit_id" : "d11fc1695c0453ef22a633e516726f82717dd1d9",
      "created_at" : "2016-01-08T08:04:11Z",
      "diff_hunk" : "@@ -48,6 +48,8 @@ bool fSendFreeTransactions = DEFAULT_SEND_FREE_TRANSACTIONS;\n  */\n CFeeRate CWallet::minTxFee = CFeeRate(DEFAULT_TRANSACTION_MINFEE);\n \n+const uint256 CMerkleTx::abandonHash(uint256S(\"0000000000000000000000000000000000000000000000000000000000000001\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49165361",
      "id" : 49165361,
      "original_commit_id" : "9726a520ee2e11d567bbc63901bf1cdde328d658",
      "original_position" : 4,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T13:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49165361",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49185451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49185451"
         }
      },
      "body" : "consistency nit: all the other fHelp messages use \"transaction\" and \"transactions\" instead of \"tx\" and \"txs\".",
      "commit_id" : "d11fc1695c0453ef22a633e516726f82717dd1d9",
      "created_at" : "2016-01-08T12:58:15Z",
      "diff_hunk" : "@@ -1764,6 +1764,40 @@ UniValue gettransaction(const UniValue& params, bool fHelp)\n     return entry;\n }\n \n+UniValue abandontransaction(const UniValue& params, bool fHelp)\n+{\n+    if (!EnsureWalletIsAvailable(fHelp))\n+        return NullUniValue;\n+\n+    if (fHelp || params.size() != 1)\n+        throw runtime_error(\n+            \"abandontransaction \\\"txid\\\"\\n\"\n+            \"\\nMark in-wallet transaction <txid> as abandoned\\n\"\n+            \"This will mark this tx and all its in-wallet descendants as abandoned which will allow\\n\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49185451",
      "id" : 49185451,
      "original_commit_id" : "6d74a63154cca756d698d6022c694b21e7f43ac5",
      "original_position" : 13,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T13:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49185451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/101238?v=3",
         "events_url" : "https://api.github.com/users/kanzure/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kanzure/followers",
         "following_url" : "https://api.github.com/users/kanzure/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kanzure/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kanzure",
         "id" : 101238,
         "login" : "kanzure",
         "organizations_url" : "https://api.github.com/users/kanzure/orgs",
         "received_events_url" : "https://api.github.com/users/kanzure/received_events",
         "repos_url" : "https://api.github.com/users/kanzure/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kanzure/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kanzure/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kanzure"
      }
   },
   {
      "body" : "I think a name like \"abandonlocaltransaction\" or \"abandonunconfirmedtransaction\" could help to minimize ambiguity.  But I would consider this a very low priority suggestion, because this RPC call is only available when the wallet is enabled.",
      "created_at" : "2016-01-08T13:01:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-169995500",
      "id" : 169995500,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-08T13:01:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/169995500",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/101238?v=3",
         "events_url" : "https://api.github.com/users/kanzure/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kanzure/followers",
         "following_url" : "https://api.github.com/users/kanzure/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kanzure/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kanzure",
         "id" : 101238,
         "login" : "kanzure",
         "organizations_url" : "https://api.github.com/users/kanzure/orgs",
         "received_events_url" : "https://api.github.com/users/kanzure/received_events",
         "repos_url" : "https://api.github.com/users/kanzure/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kanzure/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kanzure/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kanzure"
      }
   },
   {
      "body" : "> abandonunconfirmedtransaction\r\n\r\nHow would you type that without any typos? I'd rather make the rpc short (\"abandontx\") and the documentation/GUI verbose.",
      "created_at" : "2016-01-08T13:05:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-169996224",
      "id" : 169996224,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-08T13:05:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/169996224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Concept ACK  6d74a63154cca756d698d6022c694b21e7f43ac5",
      "created_at" : "2016-01-08T13:06:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-169996403",
      "id" : 169996403,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-08T13:06:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/169996403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Thanks for the review. \r\nAddressed nits in RPC help and finalized the RPC test\r\n",
      "created_at" : "2016-01-08T16:46:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-170052012",
      "id" : 170052012,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-08T16:46:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/170052012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49211705"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49211705"
         }
      },
      "body" : "abandonconflicts.py: No such file or directory\r\n",
      "commit_id" : "d11fc1695c0453ef22a633e516726f82717dd1d9",
      "created_at" : "2016-01-08T17:09:18Z",
      "diff_hunk" : "@@ -105,6 +105,7 @@\n     'prioritise_transaction.py',\n     'invalidblockrequest.py',\n     'invalidtxrequest.py',\n+    'abandonconflicts.py',",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49211705",
      "id" : 49211705,
      "original_commit_id" : "21702ff8cde6680eac4744f2b34ce36e8f5a8133",
      "original_position" : 4,
      "path" : "qa/pull-tester/rpc-tests.py",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T13:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49211705",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49211783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49211783"
         }
      },
      "body" : "Nit: Is the `\"-debug\",\"-logtimemicros\"` part required?\r\n\r\nAlso the `binary=\"bitcoind\"` part?",
      "commit_id" : "d11fc1695c0453ef22a633e516726f82717dd1d9",
      "created_at" : "2016-01-08T17:10:02Z",
      "diff_hunk" : "@@ -0,0 +1,153 @@\n+#!/usr/bin/env python2\n+# Copyright (c) 2014-2015 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+try:\n+    import urllib.parse as urlparse\n+except ImportError:\n+    import urlparse\n+\n+class AbandonConflictTest(BitcoinTestFramework):\n+\n+    def setup_network(self):\n+        self.nodes = []\n+        self.nodes.append(start_node(0, self.options.tmpdir, [\"-debug\",\"-logtimemicros\",\"-minrelaytxfee=0.00001\"], binary=\"bitcoind\"))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49211783",
      "id" : 49211783,
      "original_commit_id" : "21702ff8cde6680eac4744f2b34ce36e8f5a8133",
      "original_position" : 18,
      "path" : "qa/rpc-tests/abandonconflict.py",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T13:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49211783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49212351"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49212351"
         }
      },
      "body" : "Nit: `Decimal(\"0.00003\")` should be enough, even though we are not testing fee code here.",
      "commit_id" : "21702ff8cde6680eac4744f2b34ce36e8f5a8133",
      "created_at" : "2016-01-08T17:15:05Z",
      "diff_hunk" : "@@ -0,0 +1,153 @@\n+#!/usr/bin/env python2\n+# Copyright (c) 2014-2015 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+try:\n+    import urllib.parse as urlparse\n+except ImportError:\n+    import urlparse\n+\n+class AbandonConflictTest(BitcoinTestFramework):\n+\n+    def setup_network(self):\n+        self.nodes = []\n+        self.nodes.append(start_node(0, self.options.tmpdir, [\"-debug\",\"-logtimemicros\",\"-minrelaytxfee=0.00001\"], binary=\"bitcoind\"))\n+        self.nodes.append(start_node(1, self.options.tmpdir, [\"-debug\",\"-logtimemicros\"]))\n+        connect_nodes(self.nodes[0], 1)\n+\n+    def run_test(self):\n+        self.nodes[1].generate(100)\n+        sync_blocks(self.nodes)\n+        balance = self.nodes[0].getbalance()\n+        txA = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txB = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txC = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        sync_mempools(self.nodes)\n+        self.nodes[1].generate(1)\n+\n+        sync_blocks(self.nodes)\n+        newbalance = self.nodes[0].getbalance()\n+        assert(balance - newbalance < Decimal(\"0.001\")) #no more than fees lost",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49212351",
      "id" : 49212351,
      "original_commit_id" : "21702ff8cde6680eac4744f2b34ce36e8f5a8133",
      "original_position" : 34,
      "path" : "qa/rpc-tests/abandonconflict.py",
      "position" : 34,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-08T17:33:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49212351",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49213180"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49213180"
         }
      },
      "body" : "I think we should drop the `binary=\"bitcoind\"` part -- by default `start_node` can pick up the binary from the BITCOIND environment variable which is preferred when set.",
      "commit_id" : "d11fc1695c0453ef22a633e516726f82717dd1d9",
      "created_at" : "2016-01-08T17:22:16Z",
      "diff_hunk" : "@@ -0,0 +1,153 @@\n+#!/usr/bin/env python2\n+# Copyright (c) 2014-2015 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+try:\n+    import urllib.parse as urlparse\n+except ImportError:\n+    import urlparse\n+\n+class AbandonConflictTest(BitcoinTestFramework):\n+\n+    def setup_network(self):\n+        self.nodes = []\n+        self.nodes.append(start_node(0, self.options.tmpdir, [\"-debug\",\"-logtimemicros\",\"-minrelaytxfee=0.00001\"], binary=\"bitcoind\"))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49213180",
      "id" : 49213180,
      "original_commit_id" : "21702ff8cde6680eac4744f2b34ce36e8f5a8133",
      "original_position" : 18,
      "path" : "qa/rpc-tests/abandonconflict.py",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T13:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49213180",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "Reviewed-tests ACK 21702ff\r\n\r\n@morcos Please fix the travis issue (file not found)",
      "created_at" : "2016-01-08T17:52:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-170073408",
      "id" : 170073408,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-08T18:33:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/170073408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "oops sorry.\r\nfixed typo and removed bitcoind argument from rpc test.\r\n\r\n",
      "created_at" : "2016-01-08T19:05:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-170094366",
      "id" : 170094366,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-08T19:05:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/170094366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49229186"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49229186"
         }
      },
      "body" : "Shouldn't `resendwallettransactions` do the same? I get the empty array on `resendwallettransactions`.",
      "commit_id" : "d11fc1695c0453ef22a633e516726f82717dd1d9",
      "created_at" : "2016-01-08T19:43:11Z",
      "diff_hunk" : "@@ -0,0 +1,153 @@\n+#!/usr/bin/env python2\n+# Copyright (c) 2014-2015 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+try:\n+    import urllib.parse as urlparse\n+except ImportError:\n+    import urlparse\n+\n+class AbandonConflictTest(BitcoinTestFramework):\n+\n+    def setup_network(self):\n+        self.nodes = []\n+        self.nodes.append(start_node(0, self.options.tmpdir, [\"-debug\",\"-logtimemicros\",\"-minrelaytxfee=0.00001\"]))\n+        self.nodes.append(start_node(1, self.options.tmpdir, [\"-debug\",\"-logtimemicros\"]))\n+        connect_nodes(self.nodes[0], 1)\n+\n+    def run_test(self):\n+        self.nodes[1].generate(100)\n+        sync_blocks(self.nodes)\n+        balance = self.nodes[0].getbalance()\n+        txA = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txB = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txC = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        sync_mempools(self.nodes)\n+        self.nodes[1].generate(1)\n+\n+        sync_blocks(self.nodes)\n+        newbalance = self.nodes[0].getbalance()\n+        assert(balance - newbalance < Decimal(\"0.001\")) #no more than fees lost\n+        balance = newbalance\n+\n+        url = urlparse.urlparse(self.nodes[1].url)\n+        self.nodes[0].disconnectnode(url.hostname+\":\"+str(p2p_port(1)))\n+\n+        # Identify the 10btc outputs\n+        nA = next(i for i, vout in enumerate(self.nodes[0].getrawtransaction(txA, 1)[\"vout\"]) if vout[\"value\"] == Decimal(\"10\"))\n+        nB = next(i for i, vout in enumerate(self.nodes[0].getrawtransaction(txB, 1)[\"vout\"]) if vout[\"value\"] == Decimal(\"10\"))\n+        nC = next(i for i, vout in enumerate(self.nodes[0].getrawtransaction(txC, 1)[\"vout\"]) if vout[\"value\"] == Decimal(\"10\"))\n+\n+        inputs =[]\n+        # spend 10btc outputs from txA and txB\n+        inputs.append({\"txid\":txA, \"vout\":nA})\n+        inputs.append({\"txid\":txB, \"vout\":nB})\n+        outputs = {}\n+\n+        outputs[self.nodes[0].getnewaddress()] = Decimal(\"14.99998\")\n+        outputs[self.nodes[1].getnewaddress()] = Decimal(\"5\")\n+        signed = self.nodes[0].signrawtransaction(self.nodes[0].createrawtransaction(inputs, outputs))\n+        txAB1 = self.nodes[0].sendrawtransaction(signed[\"hex\"])\n+\n+        # Identify the 14.99998btc output\n+        nAB = next(i for i, vout in enumerate(self.nodes[0].getrawtransaction(txAB1, 1)[\"vout\"]) if vout[\"value\"] == Decimal(\"14.99998\"))\n+\n+        #Create a child tx spending AB1 and C\n+        inputs = []\n+        inputs.append({\"txid\":txAB1, \"vout\":nAB})\n+        inputs.append({\"txid\":txC, \"vout\":nC})\n+        outputs = {}\n+        outputs[self.nodes[0].getnewaddress()] = Decimal(\"24.9996\")\n+        signed2 = self.nodes[0].signrawtransaction(self.nodes[0].createrawtransaction(inputs, outputs))\n+        txABC2 = self.nodes[0].sendrawtransaction(signed2[\"hex\"])\n+\n+        # In mempool txs from self should increase balance from change\n+        newbalance = self.nodes[0].getbalance()\n+        assert(newbalance == balance - Decimal(\"30\") + Decimal(\"24.9996\"))\n+        balance = newbalance\n+\n+        # Restart the node with a higher min relay fee so the parent tx is no longer in mempool\n+        # TODO: redo with eviction\n+        # Note had to make sure tx did not have AllowFree priority\n+        stop_node(self.nodes[0],0)\n+        self.nodes[0]=start_node(0, self.options.tmpdir, [\"-debug\",\"-logtimemicros\",\"-minrelaytxfee=0.0001\"])\n+\n+        # Verify txs no longer in mempool\n+        assert(len(self.nodes[0].getrawmempool()) == 0)\n+\n+        # Not in mempool txs from self should only reduce balance\n+        # inputs are still spent, but change not received\n+        newbalance = self.nodes[0].getbalance()\n+        assert(newbalance == balance - Decimal(\"24.9996\"))\n+        balance = newbalance\n+\n+        # Abandon original transaction and verify inputs are available again\n+        # including that the child tx was also abandoned\n+        self.nodes[0].abandontransaction(txAB1)\n+        newbalance = self.nodes[0].getbalance()\n+        assert(newbalance == balance + Decimal(\"30\"))\n+        balance = newbalance\n+\n+        # Verify that even with a low min relay fee, the tx is not reaccepted from wallet on startup once abandoned\n+        stop_node(self.nodes[0],0)\n+        self.nodes[0]=start_node(0, self.options.tmpdir, [\"-debug\",\"-logtimemicros\",\"-minrelaytxfee=0.00001\"])\n+        assert(len(self.nodes[0].getrawmempool()) == 0)\n+        assert(self.nodes[0].getbalance() == balance)\n+\n+        # But if its received again then it is unabandoned\n+        # And since now in mempool, the change is available\n+        # But its child tx remains abandoned\n+        self.nodes[0].sendrawtransaction(signed[\"hex\"])\n+        newbalance = self.nodes[0].getbalance()\n+        assert(newbalance == balance - Decimal(\"20\") + Decimal(\"14.99998\"))\n+        balance = newbalance\n+\n+        # Send child tx again so its unabandoned\n+        self.nodes[0].sendrawtransaction(signed2[\"hex\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49229186",
      "id" : 49229186,
      "original_commit_id" : "d7168667b37da8051deca3bf13d967e813d7423b",
      "original_position" : 110,
      "path" : "qa/rpc-tests/abandonconflict.py",
      "position" : 110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T13:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49229186",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "QT-tested ACK d716866\r\n\r\n![screenshot from 2016-01-08 20-41-15](https://cloud.githubusercontent.com/assets/6399679/12207715/839120a8-b648-11e5-9ee4-a74eb4ebdfe8.png)\r\nNit: Qt balance != getwalletinfo",
      "created_at" : "2016-01-08T19:44:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-170104433",
      "id" : 170104433,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-08T19:44:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/170104433",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49303648"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49303648"
         }
      },
      "body" : "I think here we also need a `NotifyTransactionChanged(this, wtx.GetHash(), CT_UPDATED);` Otherwise the signal listeners (UI) can't recalculate the balance.",
      "commit_id" : "d11fc1695c0453ef22a633e516726f82717dd1d9",
      "created_at" : "2016-01-11T09:54:55Z",
      "diff_hunk" : "@@ -768,6 +779,63 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransaction& tx, const CBlock* pbl\n     return false;\n }\n \n+bool CWallet::AbandonTransaction(const uint256& hashTx)\n+{\n+    LOCK2(cs_main, cs_wallet);\n+\n+    // Do not flush the wallet here for performance reasons\n+    CWalletDB walletdb(strWalletFile, \"r+\", false);\n+\n+    std::set<uint256> todo;\n+    std::set<uint256> done;\n+\n+    // Can't mark abandoned if confirmed or in mempool\n+    assert(mapWallet.count(hashTx));\n+    CWalletTx& origtx = mapWallet[hashTx];\n+    if (origtx.GetDepthInMainChain() > 0 || origtx.InMempool()) {\n+        return false;\n+    }\n+\n+    todo.insert(hashTx);\n+\n+    while (!todo.empty()) {\n+        uint256 now = *todo.begin();\n+        todo.erase(now);\n+        done.insert(now);\n+        assert(mapWallet.count(now));\n+        CWalletTx& wtx = mapWallet[now];\n+        int currentconfirm = wtx.GetDepthInMainChain();\n+        // If the orig tx was not in block, none of its spends can be\n+        assert(currentconfirm <= 0);\n+        // if (currentconfirm < 0) {Tx and spends are already conflicted, no need to abandon}\n+        if (currentconfirm == 0 && !wtx.isAbandoned()) {\n+            // If the orig tx was not in block/mempool, none of its spends can be in mempool\n+            assert(!wtx.InMempool());\n+            wtx.nIndex = -1;\n+            wtx.setAbandoned();\n+            wtx.MarkDirty();\n+            wtx.WriteToDisk(&walletdb);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49303648",
      "id" : 49303648,
      "original_commit_id" : "d7168667b37da8051deca3bf13d967e813d7423b",
      "original_position" : 95,
      "path" : "src/wallet/wallet.cpp",
      "position" : 95,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T13:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49303648",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49303690"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49303690"
         }
      },
      "body" : "~~Probably also here:\r\n`NotifyTransactionChanged(this, txin.prevout.hash, CT_UPDATED);`~~",
      "commit_id" : "d11fc1695c0453ef22a633e516726f82717dd1d9",
      "created_at" : "2016-01-11T09:55:27Z",
      "diff_hunk" : "@@ -768,6 +779,63 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransaction& tx, const CBlock* pbl\n     return false;\n }\n \n+bool CWallet::AbandonTransaction(const uint256& hashTx)\n+{\n+    LOCK2(cs_main, cs_wallet);\n+\n+    // Do not flush the wallet here for performance reasons\n+    CWalletDB walletdb(strWalletFile, \"r+\", false);\n+\n+    std::set<uint256> todo;\n+    std::set<uint256> done;\n+\n+    // Can't mark abandoned if confirmed or in mempool\n+    assert(mapWallet.count(hashTx));\n+    CWalletTx& origtx = mapWallet[hashTx];\n+    if (origtx.GetDepthInMainChain() > 0 || origtx.InMempool()) {\n+        return false;\n+    }\n+\n+    todo.insert(hashTx);\n+\n+    while (!todo.empty()) {\n+        uint256 now = *todo.begin();\n+        todo.erase(now);\n+        done.insert(now);\n+        assert(mapWallet.count(now));\n+        CWalletTx& wtx = mapWallet[now];\n+        int currentconfirm = wtx.GetDepthInMainChain();\n+        // If the orig tx was not in block, none of its spends can be\n+        assert(currentconfirm <= 0);\n+        // if (currentconfirm < 0) {Tx and spends are already conflicted, no need to abandon}\n+        if (currentconfirm == 0 && !wtx.isAbandoned()) {\n+            // If the orig tx was not in block/mempool, none of its spends can be in mempool\n+            assert(!wtx.InMempool());\n+            wtx.nIndex = -1;\n+            wtx.setAbandoned();\n+            wtx.MarkDirty();\n+            wtx.WriteToDisk(&walletdb);\n+            // Iterate over all its outputs, and mark transactions in the wallet that spend them abandoned too\n+            TxSpends::const_iterator iter = mapTxSpends.lower_bound(COutPoint(hashTx, 0));\n+            while (iter != mapTxSpends.end() && iter->first.hash == now) {\n+                if (!done.count(iter->second)) {\n+                    todo.insert(iter->second);\n+                }\n+                iter++;\n+            }\n+            // If a transaction changes 'conflicted' state, that changes the balance\n+            // available of the outputs it spends. So force those to be recomputed\n+            BOOST_FOREACH(const CTxIn& txin, wtx.vin)\n+            {\n+                if (mapWallet.count(txin.prevout.hash))\n+                    mapWallet[txin.prevout.hash].MarkDirty();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49303690",
      "id" : 49303690,
      "original_commit_id" : "d7168667b37da8051deca3bf13d967e813d7423b",
      "original_position" : 109,
      "path" : "src/wallet/wallet.cpp",
      "position" : 110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T13:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49303690",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Tested ACK (also ack on a 0.12 bp, because it's a wallet only change)\r\nNits:\r\n* missing update signal (see above)\r\n* missing flag in `listtransactions`.",
      "created_at" : "2016-01-11T10:02:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-170494961",
      "id" : 170494961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-11T10:02:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/170494961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Addressed the nits and a cosmetic change for GUI in: https://github.com/morcos/bitcoin/pull/6",
      "created_at" : "2016-01-11T10:21:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-170500230",
      "id" : 170500230,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-11T10:21:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/170500230",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli , thanks!  I added your notify commit.  I left the other changes for a separate pull.\r\n",
      "created_at" : "2016-01-11T19:27:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-170662587",
      "id" : 170662587,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-11T19:27:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/170662587",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "Ok updated after speaking to @jonasschnelli \r\nI think this is good now",
      "created_at" : "2016-01-11T21:47:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-170701107",
      "id" : 170701107,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-11T21:47:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/170701107",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "Does https://github.com/bitcoin/bitcoin/blob/master/contrib/bitcoind.bash-completion need to get updated with this change?",
      "created_at" : "2016-01-12T04:39:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-170787339",
      "id" : 170787339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-12T04:39:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/170787339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/429961?v=3",
         "events_url" : "https://api.github.com/users/PRabahy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/PRabahy/followers",
         "following_url" : "https://api.github.com/users/PRabahy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/PRabahy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/PRabahy",
         "id" : 429961,
         "login" : "PRabahy",
         "organizations_url" : "https://api.github.com/users/PRabahy/orgs",
         "received_events_url" : "https://api.github.com/users/PRabahy/received_events",
         "repos_url" : "https://api.github.com/users/PRabahy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/PRabahy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/PRabahy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/PRabahy"
      }
   },
   {
      "body" : "@PRabahy sure, but I don't think this is part of this pull.",
      "created_at" : "2016-01-12T07:29:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-170823816",
      "id" : 170823816,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-12T07:29:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/170823816",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49580813"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49580813"
         }
      },
      "body" : "Can you explain why this static field on CMerkleTx is necessary? (and add a comment) What is it used for, what coordinates/synchronizes access to it?\r\n(e.g. why is there only one \"abandoned transaction hash\"? why is it not passed in some other way?)",
      "commit_id" : "799862530ae32728457c53f61e0fc12a9f22d6c6",
      "created_at" : "2016-01-13T11:48:23Z",
      "diff_hunk" : "@@ -155,6 +155,9 @@ struct COutputEntry\n /** A transaction with a merkle branch linking it to the block chain. */\n class CMerkleTx : public CTransaction\n {\n+private:\n+    static const uint256 abandonHash;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49580813",
      "id" : 49580813,
      "original_commit_id" : "799862530ae32728457c53f61e0fc12a9f22d6c6",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : 5,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T11:48:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49580813",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49590752"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49590752"
         }
      },
      "body" : "I thought it made sense that abandoned transactions would not be automatically resent.\r\nThat way when you restart a bitcoind with transactions that you've tried to abandon, it wouldn't automatically try to send them all again",
      "commit_id" : "d11fc1695c0453ef22a633e516726f82717dd1d9",
      "created_at" : "2016-01-13T13:44:22Z",
      "diff_hunk" : "@@ -0,0 +1,153 @@\n+#!/usr/bin/env python2\n+# Copyright (c) 2014-2015 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+try:\n+    import urllib.parse as urlparse\n+except ImportError:\n+    import urlparse\n+\n+class AbandonConflictTest(BitcoinTestFramework):\n+\n+    def setup_network(self):\n+        self.nodes = []\n+        self.nodes.append(start_node(0, self.options.tmpdir, [\"-debug\",\"-logtimemicros\",\"-minrelaytxfee=0.00001\"]))\n+        self.nodes.append(start_node(1, self.options.tmpdir, [\"-debug\",\"-logtimemicros\"]))\n+        connect_nodes(self.nodes[0], 1)\n+\n+    def run_test(self):\n+        self.nodes[1].generate(100)\n+        sync_blocks(self.nodes)\n+        balance = self.nodes[0].getbalance()\n+        txA = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txB = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txC = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        sync_mempools(self.nodes)\n+        self.nodes[1].generate(1)\n+\n+        sync_blocks(self.nodes)\n+        newbalance = self.nodes[0].getbalance()\n+        assert(balance - newbalance < Decimal(\"0.001\")) #no more than fees lost\n+        balance = newbalance\n+\n+        url = urlparse.urlparse(self.nodes[1].url)\n+        self.nodes[0].disconnectnode(url.hostname+\":\"+str(p2p_port(1)))\n+\n+        # Identify the 10btc outputs\n+        nA = next(i for i, vout in enumerate(self.nodes[0].getrawtransaction(txA, 1)[\"vout\"]) if vout[\"value\"] == Decimal(\"10\"))\n+        nB = next(i for i, vout in enumerate(self.nodes[0].getrawtransaction(txB, 1)[\"vout\"]) if vout[\"value\"] == Decimal(\"10\"))\n+        nC = next(i for i, vout in enumerate(self.nodes[0].getrawtransaction(txC, 1)[\"vout\"]) if vout[\"value\"] == Decimal(\"10\"))\n+\n+        inputs =[]\n+        # spend 10btc outputs from txA and txB\n+        inputs.append({\"txid\":txA, \"vout\":nA})\n+        inputs.append({\"txid\":txB, \"vout\":nB})\n+        outputs = {}\n+\n+        outputs[self.nodes[0].getnewaddress()] = Decimal(\"14.99998\")\n+        outputs[self.nodes[1].getnewaddress()] = Decimal(\"5\")\n+        signed = self.nodes[0].signrawtransaction(self.nodes[0].createrawtransaction(inputs, outputs))\n+        txAB1 = self.nodes[0].sendrawtransaction(signed[\"hex\"])\n+\n+        # Identify the 14.99998btc output\n+        nAB = next(i for i, vout in enumerate(self.nodes[0].getrawtransaction(txAB1, 1)[\"vout\"]) if vout[\"value\"] == Decimal(\"14.99998\"))\n+\n+        #Create a child tx spending AB1 and C\n+        inputs = []\n+        inputs.append({\"txid\":txAB1, \"vout\":nAB})\n+        inputs.append({\"txid\":txC, \"vout\":nC})\n+        outputs = {}\n+        outputs[self.nodes[0].getnewaddress()] = Decimal(\"24.9996\")\n+        signed2 = self.nodes[0].signrawtransaction(self.nodes[0].createrawtransaction(inputs, outputs))\n+        txABC2 = self.nodes[0].sendrawtransaction(signed2[\"hex\"])\n+\n+        # In mempool txs from self should increase balance from change\n+        newbalance = self.nodes[0].getbalance()\n+        assert(newbalance == balance - Decimal(\"30\") + Decimal(\"24.9996\"))\n+        balance = newbalance\n+\n+        # Restart the node with a higher min relay fee so the parent tx is no longer in mempool\n+        # TODO: redo with eviction\n+        # Note had to make sure tx did not have AllowFree priority\n+        stop_node(self.nodes[0],0)\n+        self.nodes[0]=start_node(0, self.options.tmpdir, [\"-debug\",\"-logtimemicros\",\"-minrelaytxfee=0.0001\"])\n+\n+        # Verify txs no longer in mempool\n+        assert(len(self.nodes[0].getrawmempool()) == 0)\n+\n+        # Not in mempool txs from self should only reduce balance\n+        # inputs are still spent, but change not received\n+        newbalance = self.nodes[0].getbalance()\n+        assert(newbalance == balance - Decimal(\"24.9996\"))\n+        balance = newbalance\n+\n+        # Abandon original transaction and verify inputs are available again\n+        # including that the child tx was also abandoned\n+        self.nodes[0].abandontransaction(txAB1)\n+        newbalance = self.nodes[0].getbalance()\n+        assert(newbalance == balance + Decimal(\"30\"))\n+        balance = newbalance\n+\n+        # Verify that even with a low min relay fee, the tx is not reaccepted from wallet on startup once abandoned\n+        stop_node(self.nodes[0],0)\n+        self.nodes[0]=start_node(0, self.options.tmpdir, [\"-debug\",\"-logtimemicros\",\"-minrelaytxfee=0.00001\"])\n+        assert(len(self.nodes[0].getrawmempool()) == 0)\n+        assert(self.nodes[0].getbalance() == balance)\n+\n+        # But if its received again then it is unabandoned\n+        # And since now in mempool, the change is available\n+        # But its child tx remains abandoned\n+        self.nodes[0].sendrawtransaction(signed[\"hex\"])\n+        newbalance = self.nodes[0].getbalance()\n+        assert(newbalance == balance - Decimal(\"20\") + Decimal(\"14.99998\"))\n+        balance = newbalance\n+\n+        # Send child tx again so its unabandoned\n+        self.nodes[0].sendrawtransaction(signed2[\"hex\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#discussion_r49590752",
      "id" : 49590752,
      "original_commit_id" : "d7168667b37da8051deca3bf13d967e813d7423b",
      "original_position" : 110,
      "path" : "qa/rpc-tests/abandonconflict.py",
      "position" : 110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7312",
      "updated_at" : "2016-01-13T13:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/49590752",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "Addressed @laanwj's concern about clearly identifying constant",
      "created_at" : "2016-01-13T13:46:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7312#issuecomment-171295091",
      "id" : 171295091,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7312",
      "updated_at" : "2016-01-13T13:46:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/171295091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   }
]
