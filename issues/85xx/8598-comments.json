[
   {
      "body" : "Would you mind adding some unit tests for this? There are already some `ScriptToAsmStr()` in `script_tests.cpp`?",
      "created_at" : "2016-08-26T07:36:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8598#issuecomment-242652858",
      "id" : 242652858,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8598",
      "updated_at" : "2016-08-26T07:36:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242652858",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Sure, I'll give it a go.",
      "created_at" : "2016-08-26T07:37:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8598#issuecomment-242653176",
      "id" : 242653176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8598",
      "updated_at" : "2016-08-26T07:37:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242653176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5624963?v=3",
         "events_url" : "https://api.github.com/users/fivepiece/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fivepiece/followers",
         "following_url" : "https://api.github.com/users/fivepiece/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fivepiece/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fivepiece",
         "id" : 5624963,
         "login" : "fivepiece",
         "organizations_url" : "https://api.github.com/users/fivepiece/orgs",
         "received_events_url" : "https://api.github.com/users/fivepiece/received_events",
         "repos_url" : "https://api.github.com/users/fivepiece/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fivepiece/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fivepiece/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fivepiece"
      }
   },
   {
      "body" : "```\r\nhex script: 0181                   hex script: 0181\r\n  \"asm\": \"[error]\",                     \"asm\": \"-1\",\r\nhex script: 0101                   hex script: 0101\r\n  \"asm\": \"[error]\",                     \"asm\": \"1\",\r\n```\r\n\r\nAm I missing something? Why are these errors? Shouldn't they be valid non-minimally-encoded numbers to display as hex?\r\n\r\nAlso, it seems this creates ambiguity between number and hex literals in asm? \"10\" asm could be either \"5a\" or \"0110\" now, right?",
      "created_at" : "2016-08-27T03:17:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8598#issuecomment-242892399",
      "id" : 242892399,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8598",
      "updated_at" : "2016-08-27T03:17:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242892399",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Thanks for the feedback!\r\n\r\nAs I understand it, \"wasteful\" data pushes are themselves invalid.  It's fine to push a non-minimally encoded number and then not do math operations on it, but pushing a value with an a \"larger\" opcode would fail.  So in the case of `0x81` and `[0x01,0x10]`, not using `1NEGATE` or `OP_1`-`OP_16` would cause the script to fail :\r\n\r\n```\r\n$ bitcoin-cli decodescript 51A8204BF5122F344554C53BDE2EBB8CD2B7E3D1600AD631C385A5D7CCE23C7785459A87 | grep asm\r\n\r\n  \"asm\": \"1 OP_SHA256 4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a OP_EQUAL\",\r\n\r\n$ bitcoin-cli signrawtransaction \\\r\n0100000001aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa00000000252451a8204bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a87ffffffff0100000000000000001976a914bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb88ac00000000 \\\r\n'[{\"txid\":\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\",\"vout\":0,\"scriptPubKey\":\"A91405FCBC74F0D5EAE9229CDED69AF137CAD27834F587\",\"redeemScript\":\"51A8204BF5122F344554C53BDE2EBB8CD2B7E3D1600AD631C385A5D7CCE23C7785459A87\",\"amount\":0}]'\r\n\r\n...\r\n  \"complete\": true\r\n```\r\n\r\nvs\r\n\r\n```\r\n$ bitcoin-cli decodescript 0101A8204BF5122F344554C53BDE2EBB8CD2B7E3D1600AD631C385A5D7CCE23C7785459A87 | grep asm\r\n\r\n  \"asm\": \"1 OP_SHA256 4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a OP_EQUAL\",\r\n\r\n$ bitcoin-cli signrawtransaction \\\r\n0100000001aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa0000000026250101a8204bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a87ffffffff0100000000000000001976a914bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb88ac00000000 \\\r\n'[{\"txid\":\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\",\"vout\":0,\"scriptPubKey\":\"A914120FD81D49579E40E968EEDD5215E92644BBD48A87\",\"redeemScript\":\"0101A8204BF5122F344554C53BDE2EBB8CD2B7E3D1600AD631C385A5D7CCE23C7785459A87\",\"amount\":0}]'\r\n\r\n{\r\n  \"hex\": \"0100000001aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa0000000026250101a8204bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a87ffffffff0100000000000000001976a914bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb88ac00000000\",\r\n  \"complete\": false,\r\n  \"errors\": [\r\n    {\r\n      \"txid\": \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",\r\n      \"vout\": 0,\r\n      \"scriptSig\": \"250101a8204bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a87\",\r\n      \"sequence\": 4294967295,\r\n      \"error\": \"Data push larger than necessary\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nAs for the ambiguity, specifically wrt `10` in asm, after this change, the only case where you'd see a `10` is if you executed `5a`.  Currently you will see `10` either by using `5a` or `010a` (though this is not a valid push).  To actually push the byte `0x10` you would have to use `OP_16`, `60`.\r\n\r\nI do agree that numbers in base 10 and short hex are ambigous in asm (like the example in OP with `52`), but that is already the case.  This change only helps in the sense that values that would not pass as numbers, are not displayed as such.\r\n\r\nYou have given me more food for thought, what about larger invalid push operations?  Those still do not appear as errors after this change.\r\nFor example this script would also fail;\r\n`4C0175A8200BFE935E70C321C7CA3AFC75CE0D0CA2F98B5422E008BB31C00C6D7F1F1C0AD687`\r\n\r\nIf I'm wrong and these \"larger than necessary\" are not invalid, then you are correct that the '[error]'s should be removed and the original functionality restored.",
      "created_at" : "2016-08-27T05:47:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8598#issuecomment-242898263",
      "id" : 242898263,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8598",
      "updated_at" : "2016-08-27T05:47:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242898263",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5624963?v=3",
         "events_url" : "https://api.github.com/users/fivepiece/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fivepiece/followers",
         "following_url" : "https://api.github.com/users/fivepiece/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fivepiece/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fivepiece",
         "id" : 5624963,
         "login" : "fivepiece",
         "organizations_url" : "https://api.github.com/users/fivepiece/orgs",
         "received_events_url" : "https://api.github.com/users/fivepiece/received_events",
         "repos_url" : "https://api.github.com/users/fivepiece/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fivepiece/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fivepiece/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fivepiece"
      }
   },
   {
      "body" : "I've added a check that happens if the push opcode is `PUSHDATA1` - `PUSHDATA4`.\r\nA temporary script is created that only pushes the data, then we compare our own push op with the one the script has.\r\nI'm guessing this does cost some to execute, but I think it's better to eventually return an \"[error]\" instead of some wasteful push that will produce errors on actual script evaluation.\r\n\r\nThoughts?",
      "created_at" : "2016-08-28T11:23:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8598#issuecomment-242969499",
      "id" : 242969499,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8598",
      "updated_at" : "2016-08-28T11:26:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242969499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5624963?v=3",
         "events_url" : "https://api.github.com/users/fivepiece/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fivepiece/followers",
         "following_url" : "https://api.github.com/users/fivepiece/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fivepiece/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fivepiece",
         "id" : 5624963,
         "login" : "fivepiece",
         "organizations_url" : "https://api.github.com/users/fivepiece/orgs",
         "received_events_url" : "https://api.github.com/users/fivepiece/received_events",
         "repos_url" : "https://api.github.com/users/fivepiece/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fivepiece/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fivepiece/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fivepiece"
      }
   },
   {
      "body" : "MINIMALDATA is not a consensus rule, and transactions that use non-minimal pushes or non-minimally encoded numbers are perfectly valid in blocks. I don't think we should fail to decode them. I don't really have good advice here, as I'm fine with somehow marking these as different, but they shouldn't fail to decode.",
      "created_at" : "2016-09-04T20:37:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8598#issuecomment-244627257",
      "id" : 244627257,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8598",
      "updated_at" : "2016-09-04T20:37:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/244627257",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Seems like I was fixing a problem that did not exist in the first place.  I will be closing this PR for the sake of resubmitting another one which should reflect non-standard use of Script in a warning fasion rather than error and terminate.\r\n\r\nBoth non-minimally encoded numbers /and/ wasteful pushes are valid in blocks.  Thanks @sipa for clarifying.",
      "created_at" : "2016-09-04T21:00:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8598#issuecomment-244628423",
      "id" : 244628423,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8598",
      "updated_at" : "2016-09-04T21:00:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/244628423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5624963?v=3",
         "events_url" : "https://api.github.com/users/fivepiece/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fivepiece/followers",
         "following_url" : "https://api.github.com/users/fivepiece/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fivepiece/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fivepiece",
         "id" : 5624963,
         "login" : "fivepiece",
         "organizations_url" : "https://api.github.com/users/fivepiece/orgs",
         "received_events_url" : "https://api.github.com/users/fivepiece/received_events",
         "repos_url" : "https://api.github.com/users/fivepiece/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fivepiece/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fivepiece/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fivepiece"
      }
   }
]
