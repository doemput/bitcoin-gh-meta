{
   "assignee" : null,
   "assignees" : [],
   "body" : "This looks somewhat awkward as-is, but it's a part of the CConnman refactor. I've broken it out and PR'd separately because it's a change of behavior that requires some scrutiny. As part of #8085, the height will be passed into CConnman instead. For reference, it will end up looking more like this: https://github.com/bitcoin/bitcoin/pull/8085/commits/148163c9b1ce04ec9fa9c8ff9a4289520bd92127.\r\n\r\nEven without that, though, I think this is an improvement, as it eliminates a dependency on main from net.\r\n\r\nPush block height changes from main into net, and pass the current height into CNode at creation time, rather than pulling from main each time (and locking cs_main). Now CNode has no dependency on main for height.\r\n\r\nNote that It may also be handy to know later what our original height was for a given node.\r\n\r\nThis also helps to prevent identity leakage a tiny bit. Before this change, an\r\nattacker could theoretically make 2 connections on different interfaces. They\r\nwould connect fully on one, and only establish the initial connection on the\r\nother. Once they receive a new block, they would relay it to your first\r\nconnection, and immediately commence the version handshake on the second. Since\r\nthe new block height was reflected immediately, they could attempt to learn\r\nwhether the two connections were correlated.\r\n\r\nThis is, of course, incredibly unlikely to work due to the small timings\r\ninvolved and receipt from other senders. But it doesn't hurt to lock-in\r\nnBestHeight at the time of connection, rather than letting the remote choose\r\nthe time.",
   "closed_at" : "2016-08-31T18:19:18Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
      "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
      "followers_url" : "https://api.github.com/users/theuni/followers",
      "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/theuni",
      "id" : 417043,
      "login" : "theuni",
      "organizations_url" : "https://api.github.com/users/theuni/orgs",
      "received_events_url" : "https://api.github.com/users/theuni/received_events",
      "repos_url" : "https://api.github.com/users/theuni/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/theuni"
   },
   "comments" : 3,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8542/comments",
   "created_at" : "2016-08-18T23:00:35Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8542/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/8542",
   "id" : 172020354,
   "labels" : [
      {
         "color" : "006b75",
         "name" : "P2P",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8542/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 8542,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/8542.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8542",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/8542.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8542"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "RFC: net: Pass best block known height into net",
   "updated_at" : "2016-08-31T18:19:18Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8542",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
      "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
      "followers_url" : "https://api.github.com/users/theuni/followers",
      "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/theuni",
      "id" : 417043,
      "login" : "theuni",
      "organizations_url" : "https://api.github.com/users/theuni/orgs",
      "received_events_url" : "https://api.github.com/users/theuni/received_events",
      "repos_url" : "https://api.github.com/users/theuni/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/theuni"
   }
}
