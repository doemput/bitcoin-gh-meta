[
   {
      "body" : "What is the reason of \"Rewinding blocks\" in the debug.log at height=894055 date=2016-07-03 13:51:13? I don't understand how blocks with missing data could end up in the active chain...\r\n\r\nEdit: Oh, nevemind. It will appear always in the log, even if no actual rewinding is done.",
      "created_at" : "2016-08-16T16:40:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240161206",
      "id" : 240161206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-16T17:05:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240161206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "@MarcoFalke that happens when you progress past the segwit forkpoint with a pre-segwit client, and then upgrade to a post-segwit one.",
      "created_at" : "2016-08-16T16:46:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240162834",
      "id" : 240162834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-16T16:46:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240162834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Ah, yes.",
      "created_at" : "2016-08-16T17:16:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240172013",
      "id" : 240172013,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-16T17:16:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240172013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "My guess: it looks to me like the stalling logic doesn't make sense if you have non-witness, NODE_NETWORK peers:\r\n\r\n```\r\n        //\r\n        // Message: getdata (blocks)\r\n        //\r\n        vector<CInv> vGetData;\r\n        if (!pto->fDisconnect && !pto->fClient && (fFetch || !IsInitialBlockDownload()) && state.nBlocksInFlight < MAX_BLOCKS_IN_TRANSIT_PER_PEER) {\r\n            vector<CBlockIndex*> vToDownload;\r\n            NodeId staller = -1;\r\n            FindNextBlocksToDownload(pto->GetId(), MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.nBlocksInFlight, vToDownload, staller);\r\n            BOOST_FOREACH(CBlockIndex *pindex, vToDownload) {\r\n                if (State(pto->GetId())->fHaveWitness || !IsWitnessEnabled(pindex->pprev, consensusParams)) {\r\n                    uint32_t nFetchFlags = GetFetchFlags(pto, pindex->pprev, consensusParams);\r\n                    vGetData.push_back(CInv(MSG_BLOCK | nFetchFlags, pindex->GetBlockHash()));\r\n                    MarkBlockAsInFlight(pto->GetId(), pindex->GetBlockHash(), consensusParams, pindex);\r\n                    LogPrint(\"net\", \"Requesting block %s (%d) peer=%d\\n\", pindex->GetBlockHash().ToString(),\r\n                        pindex->nHeight, pto->id);\r\n                }\r\n            }\r\n            if (state.nBlocksInFlight == 0 && staller != -1) {\r\n                if (State(staller)->nStallingSince == 0) {\r\n                    State(staller)->nStallingSince = nNow;\r\n                    LogPrint(\"net\", \"Stall started peer=%d\\n\", staller);\r\n                }\r\n            }\r\n        }\r\n```\r\nLooks to me like when we call FindNextBlocksToDownload for an old, non-segwit peer, you'll end up setting some segwit peer as a staller, and then potentially disconnecting it, even though doing so doesn't allow you to download more blocks (as the peers found later may be non-segwit peers, as happened to @marcofalke, based on his debug log).\r\n\r\nIf this is right, then this is really just a segwit p2p issue.  A quick fix would be to not set nStallingSince for the staller if you're looking at a non-witness peer.  I can try to put together a quick patch for you to test.\r\n\r\n",
      "created_at" : "2016-08-18T19:51:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240836252",
      "id" : 240836252,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-18T19:51:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240836252",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "@MarcoFalke I think there's a one-liner that should work for you, can you change https://github.com/bitcoin/bitcoin/blob/6e6ab2c3238264b34c0c83ebf703502f5ec72848/src/main.cpp#L6712 to read:\r\n\r\n```\r\n            if (state.nBlocksInFlight == 0 && staller != -1 && State(pto->GetId())->fHaveWitness) {\r\n```\r\n\r\nI think we'd want a slightly more subtle fix for master, but I think that should prevent you from disconnecting all your segwit peers. ",
      "created_at" : "2016-08-18T20:02:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240839285",
      "id" : 240839285,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-18T20:02:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240839285",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "@sdaftuar seems plausible. I'm interested in knowing if that fixes it for marco. He should backup his state before trying it. (so if we come up with a different fix we could test that one too)",
      "created_at" : "2016-08-18T20:06:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240840308",
      "id" : 240840308,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-18T20:06:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240840308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@MarcoFalke It would also be helpful to see a debug log with -debug=net, while you're able to reproduce the problem, so we can more fully see what's happening.",
      "created_at" : "2016-08-18T20:20:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240844286",
      "id" : 240844286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-18T20:20:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240844286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "Thanks @gmaxwell @sdaftuar !\r\n\r\nI will try the patch and post results as well as a debug.log.\r\n\r\n\r\nI just noticed I was on a different network (rural area) so if anyone tries to reproduce, make sure to limit the bandwidth available to a few hundred kB/s",
      "created_at" : "2016-08-18T20:34:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240848136",
      "id" : 240848136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-18T20:34:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240848136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "> debug log with -debug=net\r\n\r\nDone: [debug.log.txt](https://github.com/bitcoin/bitcoin/files/425849/debug.log.txt)\r\n",
      "created_at" : "2016-08-18T20:40:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240849589",
      "id" : 240849589,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-18T20:40:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240849589",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Apparently the patch from above\r\n\r\n```diff\r\ndiff --git a/src/main.cpp b/src/main.cpp\r\nindex 75f991d..44eefc7 100644\r\n--- a/src/main.cpp\r\n+++ b/src/main.cpp\r\n@@ -6715,7 +6715,7 @@ bool SendMessages(CNode* pto)\r\n                         pindex->nHeight, pto->id);\r\n                 }\r\n             }\r\n-            if (state.nBlocksInFlight == 0 && staller != -1) {\r\n+            if (state.nBlocksInFlight == 0 && staller != -1 && State(pto->GetId())->fHaveWitness) {\r\n                 if (State(staller)->nStallingSince == 0) {\r\n                     State(staller)->nStallingSince = nNow;\r\n                     LogPrint(\"net\", \"Stall started peer=%d\\n\", staller);\r\n```\r\n\r\nimproves the situation and sync appears to work. Though, I can still see disconnects due to stall in the log...",
      "created_at" : "2016-08-18T20:52:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240852889",
      "id" : 240852889,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-18T20:52:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240852889",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "@MarcoFalke Ok great!\r\n\r\nI would still expect to see disconnects due to \"stalling\" if you're on a low bandwidth connection, during IBD.  I would guess that you'd see that on mainnet as well (just without getting stuck).\r\n\r\nAs I understand the stalling code (maybe @sipa will correct me), we will pretty aggressively  disconnect our slowest peers during IBD, especially if you're on a low-bandwidth connection.  Pre-segwit, I think this is not such a big deal, because it's helpful to try to download the most blocks from your fastest peers, and you'll only disconnect if you have some other peer to try using, and you'll typically be able to easily replace the ones you disconnect with other acceptable peers.",
      "created_at" : "2016-08-18T20:57:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240854204",
      "id" : 240854204,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-18T20:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240854204",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "I ran some more tests each time resetting the datadir to the \"corrupt\" state and I can confirm the patch by @sdaftuar indeed fixes the \"Unable to sync\"-problem.",
      "created_at" : "2016-08-18T21:08:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240857498",
      "id" : 240857498,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-18T21:08:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240857498",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Great to hear. I believe this means we can treat this as a non-blocker for\n0.13.0.\n",
      "created_at" : "2016-08-18T21:11:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240858131",
      "id" : 240858131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-18T21:11:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240858131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Agree, @laanwj could tag 0.13.0 tomorrow, so we can use the weekend to produce gitian results.",
      "created_at" : "2016-08-18T21:28:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240862812",
      "id" : 240862812,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-18T21:28:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240862812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "I agree that this issue is not a blocker for 0.13.",
      "created_at" : "2016-08-19T00:25:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-240896065",
      "id" : 240896065,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-19T00:25:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240896065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "    2016-08-25 21:43:02.365982 Peer=3151 is stalling block download, disconnecting\r\n    2016-08-25 21:43:54.759148 Peer=3152 is stalling block download, disconnecting\r\n    2016-08-25 21:45:13.561092 Peer=3153 is stalling block download, disconnecting\r\n    2016-08-25 21:45:33.461048 Peer=3154 is stalling block download, disconnecting\r\n    2016-08-25 21:46:40.283416 Peer=3155 is stalling block download, disconnecting\r\n    2016-08-25 21:46:52.484168 Peer=3156 is stalling block download, disconnecting\r\n    2016-08-25 21:47:57.365459 Peer=3157 is stalling block download, disconnecting\r\n    2016-08-25 21:49:15.097728 Peer=3158 is stalling block download, disconnecting\r\n    2016-08-25 21:49:19.248249 Peer=3159 is stalling block download, disconnecting\r\n    2016-08-25 21:49:42.205163 Peer=3160 is stalling block download, disconnecting\r\n    2016-08-25 21:50:33.362082 Peer=3161 is stalling block download, disconnecting\r\n    2016-08-25 21:51:43.281139 Peer=3162 is stalling block download, disconnecting\r\n    2016-08-25 21:52:11.135347 Peer=3163 is stalling block download, disconnecting\r\n    2016-08-25 21:52:52.918473 Peer=3164 is stalling block download, disconnecting\r\n    2016-08-25 21:53:03.191162 Peer=3165 is stalling block download, disconnecting\r\n    2016-08-25 21:53:56.103521 Peer=3166 is stalling block download, disconnecting\r\n    2016-08-25 21:55:14.881598 Peer=3167 is stalling block download, disconnecting\r\n\r\nI hit this on testnet, building the patch. ",
      "created_at" : "2016-08-25T22:05:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-242557812",
      "id" : 242557812,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-25T22:08:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242557812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18669252?v=3",
         "events_url" : "https://api.github.com/users/ntpd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ntpd/followers",
         "following_url" : "https://api.github.com/users/ntpd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ntpd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ntpd",
         "id" : 18669252,
         "login" : "ntpd",
         "organizations_url" : "https://api.github.com/users/ntpd/orgs",
         "received_events_url" : "https://api.github.com/users/ntpd/received_events",
         "repos_url" : "https://api.github.com/users/ntpd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ntpd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ntpd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ntpd"
      }
   },
   {
      "body" : "`best=0000000000000086c72142840f295185d472afb5697788b20c01724bd163298f height=918040 version=0x20000000 log2_work=67.888601 tx=10810312 date='2016-07-31 18:33:26' progress=0.999302 cache=47.4MiB(126718tx)`\r\nBack to syncing with peers using Marco's patch.",
      "created_at" : "2016-08-25T22:22:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-242562501",
      "id" : 242562501,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-25T22:23:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242562501",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/18669252?v=3",
         "events_url" : "https://api.github.com/users/ntpd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ntpd/followers",
         "following_url" : "https://api.github.com/users/ntpd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ntpd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ntpd",
         "id" : 18669252,
         "login" : "ntpd",
         "organizations_url" : "https://api.github.com/users/ntpd/orgs",
         "received_events_url" : "https://api.github.com/users/ntpd/received_events",
         "repos_url" : "https://api.github.com/users/ntpd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ntpd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ntpd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ntpd"
      }
   },
   {
      "body" : "I appear to have hit this as well on testnet. Patch got me unstuck.\r\n\r\n(I disdain +1 posts on github, but am offering this as evidence that this isn't a rare or isolated case.)",
      "created_at" : "2016-08-25T22:44:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-242568020",
      "id" : 242568020,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-25T22:44:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242568020",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69154?v=3",
         "events_url" : "https://api.github.com/users/maaku/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maaku/followers",
         "following_url" : "https://api.github.com/users/maaku/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maaku/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maaku",
         "id" : 69154,
         "login" : "maaku",
         "organizations_url" : "https://api.github.com/users/maaku/orgs",
         "received_events_url" : "https://api.github.com/users/maaku/received_events",
         "repos_url" : "https://api.github.com/users/maaku/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maaku/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maaku/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maaku"
      }
   },
   {
      "body" : "@MarcoFalke Could you try https://github.com/sipa/bitcoin/commits/fixwitban ?",
      "created_at" : "2016-08-26T19:45:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-242833028",
      "id" : 242833028,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2016-08-26T19:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242833028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@MarcoFalke @sdaftuar re. this patch:\r\n\r\n    -            if (state.nBlocksInFlight == 0 && staller != -1) {\r\n    +            if (state.nBlocksInFlight == 0 && staller != -1 && State(pto->GetId())->fHaveWitness) {\r\n\r\n> I think that should prevent you from disconnecting all your segwit peers.\r\n\r\nDon't you mean all my non-segwit peers? fHaveWitness is true for all my segwit peers and so adding that as a condition is a no-op for them.\r\n\r\nThe patch made no different for me anyway. But putting a `!` before the `State()` call stopped it disconnecting my peers, and I did eventually get sent a couple of blocks I hadn't seen before.\r\n\r\nI'm thinking I need to disconnect stalling peers, but give them more than 2 seconds to start sending blocks.",
      "created_at" : "2017-08-12T23:13:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8518#issuecomment-322011583",
      "id" : 322011583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8518",
      "updated_at" : "2017-08-12T23:13:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/322011583",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/573356?v=4",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   }
]
