{
   "assignee" : null,
   "assignees" : [],
   "body" : "[My block database became corrupt](https://github.com/bitcoin/bitcoin/issues/8522):\n\n![image](https://cloud.githubusercontent.com/assets/12032350/17698822/8c237694-63bd-11e6-910a-ae53a0ae9640.png)\n\nAfter clicking OK I get:\n\n![image](https://cloud.githubusercontent.com/assets/12032350/17699378/b084109a-63c0-11e6-9c52-20a62ab94576.png)\n\nWhich appears to be a bug. When I now click OK Bitcoin Core crashes:\n\n![image](https://cloud.githubusercontent.com/assets/12032350/17699419/db2c461e-63c0-11e6-9f8e-d4601b973906.png)\n\nAfter restarting it I get:\n\n![image](https://cloud.githubusercontent.com/assets/12032350/17699436/effaace8-63c0-11e6-81ce-c5e8e61458f0.png)\n\nAt this point nothing changes when I restart again.\n\nThe log says:\n\n2016-08-16 12:52:42 Bitcoin version v0.12.1 (2016-04-11 13:01:43 +0200)\n2016-08-16 12:52:42 InitParameterInteraction: parameter interaction: -whitelistforcerelay=1 -> setting -whitelistrelay=1\n2016-08-16 12:52:43 GUI: \"registerShutdownBlockReason: Successfully registered: Bitcoin Core didn't yet exit safely...\"\n2016-08-16 12:52:44 Using BerkeleyDB version Berkeley DB 4.8.30: (April  9, 2010)\n2016-08-16 12:52:44 Default data directory C:\\Users\\x\\AppData\\Roaming\\Bitcoin\n2016-08-16 12:52:44 Using data directory C:\\Users\\x\\AppData\\Roaming\\Bitcoin\n2016-08-16 12:52:44 Using config file C:\\Users\\x\\AppData\\Roaming\\Bitcoin\\bitcoin.conf\n2016-08-16 12:52:44 Using at most 125 connections (2048 file descriptors available)\n2016-08-16 12:52:44 Using 8 threads for script verification\n2016-08-16 12:52:44 scheduler thread start\n2016-08-16 12:52:44 HTTP: creating work queue of depth 16\n2016-08-16 12:52:44 Config options rpcuser and rpcpassword will soon be deprecated. Locally-run instances may remove rpcuser to use cookie-based auth, or may be replaced with rpcauth. Please see share/rpcuser for rpcauth auth generation.\n2016-08-16 12:52:44 HTTP: starting 4 worker threads\n2016-08-16 12:52:44 Using wallet wallet.dat\n2016-08-16 12:52:44 init message: Verifying wallet...\n2016-08-16 12:52:44 CDBEnv::Open: LogDir=C:\\Users\\x\\AppData\\Roaming\\Bitcoin\\database ErrorFile=C:\\Users\\x\\AppData\\Roaming\\Bitcoin\\db.log\n2016-08-16 12:52:44 Cache configuration:\n2016-08-16 12:52:44 \\* Using 128.0MiB for block index database\n2016-08-16 12:52:44 \\* Using 232.0MiB for chain state database\n2016-08-16 12:52:44 \\* Using 664.0MiB for in-memory UTXO set\n2016-08-16 12:52:44 init message: Loading block index...\n2016-08-16 12:52:44 Opening LevelDB in C:\\Users\\x\\AppData\\Roaming\\Bitcoin\\blocks\\index\n2016-08-16 12:52:44 Opened LevelDB successfully\n2016-08-16 12:52:44 Using obfuscation key for C:\\Users\\x\\AppData\\Roaming\\Bitcoin\\blocks\\index: 0000000000000000\n2016-08-16 12:52:44 Opening LevelDB in C:\\Users\\x\\AppData\\Roaming\\Bitcoin\\chainstate\n2016-08-16 12:52:44 Opened LevelDB successfully\n2016-08-16 12:52:44 Using obfuscation key for C:\\Users\\x\\AppData\\Roaming\\Bitcoin\\chainstate: ceb7ff593b2a09a4\n2016-08-16 12:52:44 LoadBlockIndexDB: last block file = 0\n2016-08-16 12:52:44 LoadBlockIndexDB: last block file info: CBlockFileInfo(blocks=0, size=0, heights=0...0, time=1970-01-01...1970-01-01)\n2016-08-16 12:52:44 Checking all blk files are present...\n2016-08-16 12:52:44 LoadBlockIndexDB: transaction index enabled\n2016-08-16 12:52:44 Initializing databases...\n2016-08-16 12:52:44 Pre-allocating up to position 0x1000000 in blk00000.dat\n\nHope this helps find the problem.\n\nI now delete `chainstate` and `database` and `db.log`. The app can now start and syncs with the network. For some reason it does not find the blocks that are still on disk (I did not touch the blocks folder when deleting files). Something about them must have gotten corrupted previously (bug?). I would have liked if I was warned that the existing blocks could not be used instead of silently ignoring them (potential improvement).\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 6,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8523/comments",
   "created_at" : "2016-08-16T12:57:04Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8523/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/8523",
   "id" : 171401540,
   "labels" : [
      {
         "color" : "000000",
         "default" : false,
         "id" : 219890555,
         "name" : "Block storage",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Block%20storage"
      },
      {
         "color" : "884400",
         "default" : false,
         "id" : 234877,
         "name" : "Windows",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Windows"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8523/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 8523,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Rebuilding block database after corruption behaves strangely",
   "updated_at" : "2017-02-06T11:46:40Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8523",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/12032350?v=3",
      "events_url" : "https://api.github.com/users/GSPP/events{/privacy}",
      "followers_url" : "https://api.github.com/users/GSPP/followers",
      "following_url" : "https://api.github.com/users/GSPP/following{/other_user}",
      "gists_url" : "https://api.github.com/users/GSPP/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/GSPP",
      "id" : 12032350,
      "login" : "GSPP",
      "organizations_url" : "https://api.github.com/users/GSPP/orgs",
      "received_events_url" : "https://api.github.com/users/GSPP/received_events",
      "repos_url" : "https://api.github.com/users/GSPP/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/GSPP/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/GSPP/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/GSPP"
   }
}
