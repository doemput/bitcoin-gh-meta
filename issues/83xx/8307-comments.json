[
   {
      "body" : "Miners *can* put it in the very last output as the only data. BIP 145 requires this for GBT. Surely that is good enough?",
      "created_at" : "2016-07-06T17:32:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8307#issuecomment-230846019",
      "id" : 230846019,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8307",
      "updated_at" : "2016-07-06T17:32:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/230846019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "It cannot be _required_ to be in the last output without making some existing hardware unable to mine.",
      "created_at" : "2016-07-06T17:37:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8307#issuecomment-230847619",
      "id" : 230847619,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8307",
      "updated_at" : "2016-07-06T17:37:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/230847619",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@luke-jr No, the consensus rule needs to be that it is the very last data of the last output, otherwise there's no way to know (without seeing the full transaction) that one is not inside of a pushdata that looks like an output. This means that a miner could make the last output [realCommitment ... padding ... fakeCommitment] and then after midstate compression all the validator of the proof sees is [padding ... fakeCommitment].\r\n\r\nTo make it concrete and real, let's say that namecoin changes to using the segwit nonce to contain their aux header for merged mining. A single miner could commit to two blocks in this way.\r\n\r\nEDIT: The reason the end-of-last-output trick works is that the validator then checks that all that follows is the 4-byte locktime, which is information it does have.",
      "created_at" : "2016-07-06T17:38:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8307#issuecomment-230847887",
      "id" : 230847887,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8307",
      "updated_at" : "2016-07-06T17:40:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/230847887",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69154?v=3",
         "events_url" : "https://api.github.com/users/maaku/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maaku/followers",
         "following_url" : "https://api.github.com/users/maaku/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maaku/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maaku",
         "id" : 69154,
         "login" : "maaku",
         "organizations_url" : "https://api.github.com/users/maaku/orgs",
         "received_events_url" : "https://api.github.com/users/maaku/received_events",
         "repos_url" : "https://api.github.com/users/maaku/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maaku/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maaku/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maaku"
      }
   },
   {
      "body" : "Namecoin should not use the segwit nonce at all. It is reserved for future\nconsensus-critical extensions.\n\nIf they (or anyone else creating a non-consensus critical commitment) need\na guarantee that the commitment is unique, they should pick a place that\nhas that property. Including adding their own last-position coinbase output.\n",
      "created_at" : "2016-07-06T18:10:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8307#issuecomment-230857133",
      "id" : 230857133,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8307",
      "updated_at" : "2016-07-06T18:10:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/230857133",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Pick any other example, focusing on namecoin is a red herring.\r\n\r\nTXO commitments. You could commit to two different TXO structures.",
      "created_at" : "2016-07-06T18:16:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8307#issuecomment-230858913",
      "id" : 230858913,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8307",
      "updated_at" : "2016-07-06T18:16:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/230858913",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69154?v=3",
         "events_url" : "https://api.github.com/users/maaku/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maaku/followers",
         "following_url" : "https://api.github.com/users/maaku/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maaku/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maaku",
         "id" : 69154,
         "login" : "maaku",
         "organizations_url" : "https://api.github.com/users/maaku/orgs",
         "received_events_url" : "https://api.github.com/users/maaku/received_events",
         "repos_url" : "https://api.github.com/users/maaku/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maaku/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maaku/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maaku"
      }
   },
   {
      "body" : "In addition to @gmaxwell's point, p2pool also makes use of midstate-compressed witnesses, so we'd have to change p2pool if we also made use of it.\r\n\r\nGiven that SPV can't make use of witness data right now, I have no qualms about the current design; at worst proving a witness commitment requires 1MB worth of additional data, which isn't a disaster, and average case would be just a few KB; full nodes of course already have the relevant data as @sipa mentions. In the future we'll probably eventually have a hard-fork that moves the commitment right next to the block header anyway.",
      "created_at" : "2016-07-06T19:23:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8307#issuecomment-230878742",
      "id" : 230878742,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8307",
      "updated_at" : "2016-07-06T19:23:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/230878742",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "@sipa The last commitment _which starts an output_. In a midstate utilizing proof one cannot be certain if the proof given is at the start of an output or inside a push statement later in that output. Full validators need the whole coinbase, yes, but proof validators may not. They might only be interested in the the commitment itself, in which case it is a huge drag to include the whole coinbase and its kilobytes of coinbase payouts, the data for which might be larger than the rest of the proof. To illustrate, it would also be acceptable if it was made a consensus rule that after the actual commitment that is the last one to start an output, there is no instance in the serialization of the sequence of bytes which indicate a commitment. Then the proof checker just does a linear scan of the remaining bytes for the segwit commitment marker and fails if it sees two. But this is layer violating to the extreme and a pain to enforce.\r\n\r\n@gmaxwell It is important to consider which hardware is broken. The only hardware I can think of that is affected by this change is one that bakes in coinbase construction logic so as to force the owner of the hardware to pay a share to the manufacturer, while the manufacturer recouped costs on sale and isn't paying any portion of the electricity. This is firmware-enforced rent collection, and I'm very surprised if bricking hardware with that 'feature' is something we'd feel badly about. Are there other devices that would be broken by this change?\r\n\r\n@petertodd I have lost track of how many times (8? 9?) p2pool has hardforked its share chain. That's really not a roadblock.",
      "created_at" : "2016-07-07T08:00:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8307#issuecomment-231009636",
      "id" : 231009636,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8307",
      "updated_at" : "2016-07-07T08:02:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/231009636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69154?v=3",
         "events_url" : "https://api.github.com/users/maaku/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maaku/followers",
         "following_url" : "https://api.github.com/users/maaku/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maaku/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maaku",
         "id" : 69154,
         "login" : "maaku",
         "organizations_url" : "https://api.github.com/users/maaku/orgs",
         "received_events_url" : "https://api.github.com/users/maaku/received_events",
         "repos_url" : "https://api.github.com/users/maaku/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maaku/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maaku/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maaku"
      }
   },
   {
      "body" : "Actually, worth noting that we aren't breaking any hardware if we continue to allow non-segwit-containing blocks to leave off the commitment... however that leads to subtle issues around peers withholding commitments. Probably not an issue in the current way we use the commitment, but could be in the future.\r\n\r\nAnyway, what specific use cases do you think a 1MB worst case, and few KB average case, proof size hold back in the next year or two?",
      "created_at" : "2016-07-07T14:36:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8307#issuecomment-231096882",
      "id" : 231096882,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8307",
      "updated_at" : "2016-07-07T14:36:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/231096882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "It is also possible to add an additional commitment location for the same data in a future softfork that is more proof-compatible, if wanted.",
      "created_at" : "2016-07-07T14:51:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8307#issuecomment-231101553",
      "id" : 231101553,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8307",
      "updated_at" : "2016-07-07T14:51:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/231101553",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Quite true, and we need to eventually fix the design of the commitments anyway to fix the upgrade data propagation problem properly.",
      "created_at" : "2016-07-07T15:25:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8307#issuecomment-231112619",
      "id" : 231112619,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8307",
      "updated_at" : "2016-07-07T15:25:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/231112619",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   }
]
