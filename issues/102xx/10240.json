{
   "assignee" : null,
   "assignees" : [],
   "body" : "This PR ensures that we always check the keypool during SyncTransaction and, that the lookup window for HD restore is large enough (currently +20 keys).\r\nOnce the keypool size falls below the min gap limit (currently 20 keys) and the keypool can't be extended (locked wallet), the wallet then temporary pauses synchronisation.\r\n\r\n### unencrypted wallets\r\nFor unencrypted wallets, the key pool will always be topped up. During sync (SyncTransaction), we check for used keypool keys and mark all keys up to the matched key as used. Additionally we topup the keypool to ensure we not fall below the gap limit (20 keys).\r\n\r\n### encrypted wallets in non pruning mode\r\nSame as above, but, If we hit the gap limit with an encrypted wallet, we can't topup the keypool. In that case, we just pause the sync (not the node, only the wallet).\r\nOnce the user unlocks the wallet over `walletpassphrase`, we rescan down to the point where we have stopped previously to ensure we don't miss possible funds.\r\n\r\n### encrypted wallets in pruned mode\r\nSame as above, but, we also stop requesting and connecting blocks. The full node will \"pause\" in this case until the user did unlock his wallet (== topup, rescan, etc.).\r\n\r\nThis has a little bit of complexity and requires careful reviews.",
   "closed_at" : "2017-07-14T21:22:53Z",
   "closed_by" : {
      "avatar_url" : "https://avatars7.githubusercontent.com/u/178464?v=4",
      "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
      "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jonasschnelli",
      "id" : 178464,
      "login" : "jonasschnelli",
      "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
      "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
      "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jonasschnelli"
   },
   "comments" : 9,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10240/comments",
   "created_at" : "2017-04-20T15:30:35Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10240/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/10240",
   "id" : 223107547,
   "labels" : [
      {
         "color" : "02d7e1",
         "default" : false,
         "id" : 149424,
         "name" : "Wallet",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10240/labels{/name}",
   "locked" : false,
   "milestone" : {
      "closed_at" : null,
      "closed_issues" : 35,
      "created_at" : "2016-12-04T13:31:14Z",
      "creator" : {
         "avatar_url" : "https://avatars4.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      },
      "description" : "",
      "due_on" : null,
      "html_url" : "https://github.com/bitcoin/bitcoin/milestone/25",
      "id" : 2174061,
      "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/25/labels",
      "number" : 25,
      "open_issues" : 25,
      "state" : "open",
      "title" : "0.15.0",
      "updated_at" : "2017-07-14T21:22:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/25"
   },
   "number" : 10240,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/10240.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10240",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/10240.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Add HD wallet auto-restore functionality",
   "updated_at" : "2017-07-14T21:22:54Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10240",
   "user" : {
      "avatar_url" : "https://avatars7.githubusercontent.com/u/178464?v=4",
      "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
      "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jonasschnelli",
      "id" : 178464,
      "login" : "jonasschnelli",
      "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
      "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
      "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jonasschnelli"
   }
}
