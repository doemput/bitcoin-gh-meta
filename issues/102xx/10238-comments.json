[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114159298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114159298"
         }
      },
      "body" : "I think it would be more straightforward to replace setKeyPool with a `std::map<int64_t, CKeyID>` instead of taking this approach which basically emulates a map using set entries with a custom `<` operator.",
      "commit_id" : "af1c4ec53af138afdd841a1893a8fb84e5ccbf21",
      "created_at" : "2017-05-01T17:24:52Z",
      "diff_hunk" : "@@ -700,7 +700,16 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n \n     bool fFileBacked;\n \n-    std::set<int64_t> setKeyPool;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114159298",
      "id" : 114159298,
      "original_commit_id" : "a4ed0d712bf023d7b5d00c25b19789281517ac69",
      "original_position" : 4,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 35603280,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238",
      "updated_at" : "2017-05-04T13:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114159298",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114161735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114161735"
         }
      },
      "body" : "Note: `keyId` member is not actually used anywhere in this PR. (Fine, just pointing out to help review).",
      "commit_id" : "af1c4ec53af138afdd841a1893a8fb84e5ccbf21",
      "created_at" : "2017-05-01T17:37:29Z",
      "diff_hunk" : "@@ -700,7 +700,16 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n \n     bool fFileBacked;\n \n-    std::set<int64_t> setKeyPool;\n+    // class for holding a keypool-key-entry in memory\n+    class KeypoolCache {\n+    public:\n+        int64_t nIndex;\n+        CKeyID keyId;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114161735",
      "id" : 114161735,
      "original_commit_id" : "a4ed0d712bf023d7b5d00c25b19789281517ac69",
      "original_position" : 9,
      "path" : "src/wallet/wallet.h",
      "position" : 10,
      "pull_request_review_id" : 35603280,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238",
      "updated_at" : "2017-05-04T13:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114161735",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Rebase needed.",
      "created_at" : "2017-05-04T06:35:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#issuecomment-299106814",
      "id" : 299106814,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10238",
      "updated_at" : "2017-05-04T06:35:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299106814",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114761278"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114761278"
         }
      },
      "body" : "Yes. This is true, though, the keyId is relatively important for future performance improvements. We could add it later,.. but I guess it doesn't hurt to already have it there in this PR.",
      "commit_id" : "af1c4ec53af138afdd841a1893a8fb84e5ccbf21",
      "created_at" : "2017-05-04T12:35:37Z",
      "diff_hunk" : "@@ -700,7 +700,16 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n \n     bool fFileBacked;\n \n-    std::set<int64_t> setKeyPool;\n+    // class for holding a keypool-key-entry in memory\n+    class KeypoolCache {\n+    public:\n+        int64_t nIndex;\n+        CKeyID keyId;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114761278",
      "id" : 114761278,
      "original_commit_id" : "a4ed0d712bf023d7b5d00c25b19789281517ac69",
      "original_position" : 9,
      "path" : "src/wallet/wallet.h",
      "position" : 10,
      "pull_request_review_id" : 36254522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238",
      "updated_at" : "2017-05-04T13:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114761278",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114762459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114762459"
         }
      },
      "body" : "Yes. But IMO holding a flexible data-structure (`KeypoolCache`) allows us to be more flexible in future. Though no strong opinion.",
      "commit_id" : "af1c4ec53af138afdd841a1893a8fb84e5ccbf21",
      "created_at" : "2017-05-04T12:42:18Z",
      "diff_hunk" : "@@ -700,7 +700,16 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n \n     bool fFileBacked;\n \n-    std::set<int64_t> setKeyPool;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114762459",
      "id" : 114762459,
      "original_commit_id" : "a4ed0d712bf023d7b5d00c25b19789281517ac69",
      "original_position" : 4,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 36255941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238",
      "updated_at" : "2017-05-04T13:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114762459",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Rebased.",
      "created_at" : "2017-05-04T12:42:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#issuecomment-299173989",
      "id" : 299173989,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10238",
      "updated_at" : "2017-05-04T12:42:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299173989",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114767005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114767005"
         }
      },
      "body" : "why is it added ? where is it used ?",
      "commit_id" : "af1c4ec53af138afdd841a1893a8fb84e5ccbf21",
      "created_at" : "2017-05-04T13:04:20Z",
      "diff_hunk" : "@@ -696,7 +696,18 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     /* HD derive new child key (on internal or external chain) */\n     void DeriveNewChildKey(CKeyMetadata& metadata, CKey& secret, bool internal = false);\n \n-    std::set<int64_t> setKeyPool;\n+    bool fFileBacked;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114767005",
      "id" : 114767005,
      "original_commit_id" : "2e614359d58345e33518d2fd48d7422fd9796e4d",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 36261144,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238",
      "updated_at" : "2017-05-04T13:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114767005",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114767279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114767279"
         }
      },
      "body" : "I am wondering if it is not better (minimum diff) to just change `ReadPool` signature to take KeyPoolCache instead of index.",
      "commit_id" : "af1c4ec53af138afdd841a1893a8fb84e5ccbf21",
      "created_at" : "2017-05-04T13:05:40Z",
      "diff_hunk" : "@@ -3324,10 +3325,10 @@ void CWallet::GetAllReserveKeys(std::set<CKeyID>& setAddress) const\n     CWalletDB walletdb(*dbw);\n \n     LOCK2(cs_main, cs_wallet);\n-    BOOST_FOREACH(const int64_t& id, setKeyPool)\n+    for (const KeypoolCache &poolPair : setKeyPool)\n     {\n         CKeyPool keypool;\n-        if (!walletdb.ReadPool(id, keypool))\n+        if (!walletdb.ReadPool(poolPair.nIndex, keypool))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114767279",
      "id" : 114767279,
      "original_commit_id" : "2e614359d58345e33518d2fd48d7422fd9796e4d",
      "original_position" : 119,
      "path" : "src/wallet/wallet.cpp",
      "position" : 119,
      "pull_request_review_id" : 36261439,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238",
      "updated_at" : "2017-05-04T13:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114767279",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114767473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114767473"
         }
      },
      "body" : "why not just take `KeypoolCache` ?",
      "commit_id" : "af1c4ec53af138afdd841a1893a8fb84e5ccbf21",
      "created_at" : "2017-05-04T13:06:35Z",
      "diff_hunk" : "@@ -957,7 +968,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     bool TopUpKeyPool(unsigned int kpSize = 0);\n     void ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& keypool, bool internal);\n     void KeepKey(int64_t nIndex);\n-    void ReturnKey(int64_t nIndex);\n+    void ReturnKey(int64_t nIndex, const CKeyID &keyid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114767473",
      "id" : 114767473,
      "original_commit_id" : "2e614359d58345e33518d2fd48d7422fd9796e4d",
      "original_position" : 40,
      "path" : "src/wallet/wallet.h",
      "position" : 39,
      "pull_request_review_id" : 36261645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238",
      "updated_at" : "2017-05-04T13:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114767473",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114767978"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114767978"
         }
      },
      "body" : "Oh. That's a rebase issue. `fFileBackand` was removed in the meantime, Will remove it here.",
      "commit_id" : "af1c4ec53af138afdd841a1893a8fb84e5ccbf21",
      "created_at" : "2017-05-04T13:09:07Z",
      "diff_hunk" : "@@ -696,7 +696,18 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     /* HD derive new child key (on internal or external chain) */\n     void DeriveNewChildKey(CKeyMetadata& metadata, CKey& secret, bool internal = false);\n \n-    std::set<int64_t> setKeyPool;\n+    bool fFileBacked;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114767978",
      "id" : 114767978,
      "original_commit_id" : "2e614359d58345e33518d2fd48d7422fd9796e4d",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 36262230,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238",
      "updated_at" : "2017-05-04T13:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114767978",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114768072"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114768072"
         }
      },
      "body" : "Hmm.. then CReserveKey::Return key would have to create a `KeypoolCache()`?",
      "commit_id" : "af1c4ec53af138afdd841a1893a8fb84e5ccbf21",
      "created_at" : "2017-05-04T13:09:39Z",
      "diff_hunk" : "@@ -957,7 +968,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     bool TopUpKeyPool(unsigned int kpSize = 0);\n     void ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& keypool, bool internal);\n     void KeepKey(int64_t nIndex);\n-    void ReturnKey(int64_t nIndex);\n+    void ReturnKey(int64_t nIndex, const CKeyID &keyid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114768072",
      "id" : 114768072,
      "original_commit_id" : "2e614359d58345e33518d2fd48d7422fd9796e4d",
      "original_position" : 40,
      "path" : "src/wallet/wallet.h",
      "position" : 39,
      "pull_request_review_id" : 36262340,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238",
      "updated_at" : "2017-05-04T13:12:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114768072",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114768747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114768747"
         }
      },
      "body" : "Removed.",
      "commit_id" : "af1c4ec53af138afdd841a1893a8fb84e5ccbf21",
      "created_at" : "2017-05-04T13:13:06Z",
      "diff_hunk" : "@@ -696,7 +696,18 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     /* HD derive new child key (on internal or external chain) */\n     void DeriveNewChildKey(CKeyMetadata& metadata, CKey& secret, bool internal = false);\n \n-    std::set<int64_t> setKeyPool;\n+    bool fFileBacked;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114768747",
      "id" : 114768747,
      "original_commit_id" : "2e614359d58345e33518d2fd48d7422fd9796e4d",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 36263155,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238",
      "updated_at" : "2017-05-04T13:13:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114768747",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114770582"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114770582"
         }
      },
      "body" : "why ? I mean KeypoolCache is (int, KeyId) anyway. It is just strange to pass them as two distinct parameters here.\r\n",
      "commit_id" : "af1c4ec53af138afdd841a1893a8fb84e5ccbf21",
      "created_at" : "2017-05-04T13:21:30Z",
      "diff_hunk" : "@@ -957,7 +968,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     bool TopUpKeyPool(unsigned int kpSize = 0);\n     void ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& keypool, bool internal);\n     void KeepKey(int64_t nIndex);\n-    void ReturnKey(int64_t nIndex);\n+    void ReturnKey(int64_t nIndex, const CKeyID &keyid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114770582",
      "id" : 114770582,
      "original_commit_id" : "2e614359d58345e33518d2fd48d7422fd9796e4d",
      "original_position" : 40,
      "path" : "src/wallet/wallet.h",
      "position" : 39,
      "pull_request_review_id" : 36265323,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238",
      "updated_at" : "2017-05-04T13:21:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114770582",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114867245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114867245"
         }
      },
      "body" : "> holding a flexible data-structure (KeypoolCache) allows us to be more flexible in future\r\n\r\nI don't have any problem with keeping `KeypoolCache` if it will be useful later.\r\n\r\nWhat seems bad to me is using `std::set` with a custom comparison function to emulate a map. Would suggest removing `nIndex` and `operator<` from KeypoolCache and using `std::map<int64_t, KeypoolCache>`",
      "commit_id" : "af1c4ec53af138afdd841a1893a8fb84e5ccbf21",
      "created_at" : "2017-05-04T19:28:01Z",
      "diff_hunk" : "@@ -700,7 +700,16 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n \n     bool fFileBacked;\n \n-    std::set<int64_t> setKeyPool;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114867245",
      "id" : 114867245,
      "original_commit_id" : "a4ed0d712bf023d7b5d00c25b19789281517ac69",
      "original_position" : 4,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 36364539,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238",
      "updated_at" : "2017-05-04T19:28:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114867245",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114868956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114868956"
         }
      },
      "body" : "Fair point. The question is should we do it in this PR or later. But since we significant change the  set's content, It should be changed now (which I will do soon).",
      "commit_id" : "af1c4ec53af138afdd841a1893a8fb84e5ccbf21",
      "created_at" : "2017-05-04T19:37:12Z",
      "diff_hunk" : "@@ -700,7 +700,16 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n \n     bool fFileBacked;\n \n-    std::set<int64_t> setKeyPool;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#discussion_r114868956",
      "id" : 114868956,
      "original_commit_id" : "a4ed0d712bf023d7b5d00c25b19789281517ac69",
      "original_position" : 4,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 36366523,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10238",
      "updated_at" : "2017-05-04T19:37:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114868956",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "In #10882 it seems like looking up keypool index using key id is more useful than looking up key id using key index, so I'm not sure if there is a direct use for this PR and maybe it should be reconsidered.\r\n\r\nIf the goal is to avoid reading all the unused keys from disk each time an IsMine transaction is encountered, I think there are three ways it could be done:\r\n\r\n1. Easiest way is probably just to just cache the result of `GetAllReserveKeys` during the rescan so it doesn't get called multiple times in the same scan.\r\n2. Another way could be update this PR so GetAllReserveKeys() could work from memory without touching the database. This optimization is not exclusive with (1) above and both could be done together.\r\n3. Another way could be to update this PR to store a bidirectional mapping from key id <-> key index instead of just forward mapping so GetAllReserveKeys() wouldn't have to do any work and could just return a reference to the reverse map. This could be done with boost multindex or just two plain maps.\r\n",
      "created_at" : "2017-07-25T17:55:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#issuecomment-317817700",
      "id" : 317817700,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10238",
      "updated_at" : "2017-07-25T18:27:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/317817700",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "No longer really useful, closing for now.",
      "created_at" : "2017-10-05T03:37:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10238#issuecomment-334349951",
      "id" : 334349951,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10238",
      "updated_at" : "2017-10-05T03:37:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334349951",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   }
]
