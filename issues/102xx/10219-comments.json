[
   {
      "body" : "@jimmysong thanks for opening this. I like the concept, but I wonder whether the approach is over-fitted:\r\n\r\n- it's difficult to benchmark what the 'expected time' is for these tests. They're dependent on a lot of factors, including i/o, what else is happening on the system, and so on. If someone writes a new test, how do they know how to set the time?\r\n- if someone updates/modifies a test case, they'll probably forget to update the time, so these will gradually get out-of-date.\r\n- if there's a PR that speeds up all test cases (eg #10220 or the parallel stop/start part of #10082), does the PR need to update all of these times?\r\n\r\nLuckily, I don't think we really need to optimize this so drastically. We just need to make sure the long-running extended tests stay at the top of the list when they're merged. I have a much simpler changeset that does that here: https://github.com/jnewbery/bitcoin/tree/mergelistsintelligently but I haven't PR'ed it because I didn't get round to testing/benchmarking it. I'm very happy for you to pick that up and PR it if you think it's useful.\r\n\r\nACK the README update. That's useful advice.\r\n\r\nI'm neutral on changing the names from _SCRIPTS to _TESTS. Any specific reason you want to do that?",
      "created_at" : "2017-04-17T21:28:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10219#issuecomment-294598621",
      "id" : 294598621,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10219",
      "updated_at" : "2017-04-17T21:28:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294598621",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "@jnewbery \r\n\r\n* My thought on the benchmark was that people can see roughly what percentage of the expected time they take for a given test roughly in the same range on their own machine and divide by that amount. It does seem that developers currently have the same burden since they have to place their test roughly in the right place on the respective lists.\r\n* Good point on the updates/modifications. Another option is to update the times based on some generic system and not burden developers with finding the right value. In this case, we would need to read the approximate times from a file that can be updated, say, once per release. Probably too complicated, though.\r\n* Glad to take a much simpler approach. If minimal code disruption is the goal, I think your approach is much better.\r\n* I changed from _SCRIPTS to _TESTS because the code calls them tests later. I thought this would be a good time to rename them since after this PR, it would be a script name and an approximate duration and not just a script name.\r\n\r\nGlad to proceed on one approach or the other, should I wait for more comments or proceed on a simpler, minimally disruptive approach?",
      "created_at" : "2017-04-17T21:47:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10219#issuecomment-294604027",
      "id" : 294604027,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10219",
      "updated_at" : "2017-04-17T21:47:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294604027",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/524761?v=3",
         "events_url" : "https://api.github.com/users/jimmysong/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimmysong/followers",
         "following_url" : "https://api.github.com/users/jimmysong/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimmysong/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimmysong",
         "id" : 524761,
         "login" : "jimmysong",
         "organizations_url" : "https://api.github.com/users/jimmysong/orgs",
         "received_events_url" : "https://api.github.com/users/jimmysong/received_events",
         "repos_url" : "https://api.github.com/users/jimmysong/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimmysong/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimmysong"
      }
   },
   {
      "body" : "Indeed, the requirement is only that the longest test don't come last in the list. For all the quick tests it is not really important. I think the current approach/ordering is sufficient.",
      "created_at" : "2017-04-17T21:55:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10219#issuecomment-294605681",
      "id" : 294605681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10219",
      "updated_at" : "2017-04-17T21:55:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294605681",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "@jimmysong I'd go for zipping the lists together rather than concatenating them. When running extended tests, the fact that pruning isn't started immediately is a a big loss. If we can fix that with a one-line change, let's go ahead and do it.\r\n\r\nLet's stick to the _SCRIPTS naming convention.",
      "created_at" : "2017-04-17T22:08:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10219#issuecomment-294608383",
      "id" : 294608383,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10219",
      "updated_at" : "2017-04-17T22:08:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294608383",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "@jnewbery @MarcoFalke \r\n\r\nI wanted to do the minimal change to get what we wanted and I just placed the EXTENDED_SCRIPTS first. Just wanting your thoughts on this. If you don't like it, I'll change this to zipping them per @jnewbery's branch.",
      "created_at" : "2017-04-17T22:24:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10219#issuecomment-294612796",
      "id" : 294612796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10219",
      "updated_at" : "2017-04-17T22:24:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294612796",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/524761?v=3",
         "events_url" : "https://api.github.com/users/jimmysong/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimmysong/followers",
         "following_url" : "https://api.github.com/users/jimmysong/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimmysong/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimmysong",
         "id" : 524761,
         "login" : "jimmysong",
         "organizations_url" : "https://api.github.com/users/jimmysong/orgs",
         "received_events_url" : "https://api.github.com/users/jimmysong/received_events",
         "repos_url" : "https://api.github.com/users/jimmysong/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimmysong/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimmysong"
      }
   },
   {
      "body" : "Have you tested and benchmarked? What are the elapsed runtimes before and after this PR? How about with zipping the two lists together?\r\n\r\nutACK 637706dc9ea9244954252a4fd7d8786bf93e3b67. It seems like this should be faster to execute than the current ordering.",
      "created_at" : "2017-04-17T22:55:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10219#issuecomment-294619083",
      "id" : 294619083,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10219",
      "updated_at" : "2017-04-17T22:55:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294619083",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "@jnewbery tested (--extended) and got 1671s runtime with this patch vs 1882s runtime without. A savings of roughly 3-4 minutes.",
      "created_at" : "2017-04-18T00:22:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10219#issuecomment-294634197",
      "id" : 294634197,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10219",
      "updated_at" : "2017-04-18T00:22:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294634197",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/524761?v=3",
         "events_url" : "https://api.github.com/users/jimmysong/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimmysong/followers",
         "following_url" : "https://api.github.com/users/jimmysong/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimmysong/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimmysong",
         "id" : 524761,
         "login" : "jimmysong",
         "organizations_url" : "https://api.github.com/users/jimmysong/orgs",
         "received_events_url" : "https://api.github.com/users/jimmysong/received_events",
         "repos_url" : "https://api.github.com/users/jimmysong/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimmysong/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimmysong/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimmysong"
      }
   }
]
