[
   {
      "body" : "please tag wallet.",
      "created_at" : "2016-02-10T01:48:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7494#issuecomment-182163839",
      "id" : 182163839,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7494",
      "updated_at" : "2016-02-10T01:48:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/182163839",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Haven't looked at the wallet and debug.log yet, but at first glance it appears that when it is blasting though large number of blocks (e.g. during initial sync, or when catching up) it is possible for the wallet (at least the state synced to disk, even on a clean shutdown) to lag behind more than the amount of blocks that is retained.",
      "created_at" : "2016-02-10T11:21:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7494#issuecomment-182322835",
      "id" : 182322835,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7494",
      "updated_at" : "2016-02-10T11:30:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/182322835",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "From that wallet.dat:\r\n```\r\nbestblock 0000000000000000006b500f79750a2c5a48da5ad2a13fed6cdaffade6cada25 ...\r\n```\r\nSo block 373499. According to the debug.log the chain was way ahead of that before shutting down for the last time:\r\n\r\n    2016-02-10 00:11:27 UpdateTip: new best=000000000000000004fd3098365fb488f31f013ee41d0de63bdb7b4b0aa1dcb2  height=373816  log2_work=83.32589  tx=83020932  date=2015-09-10 04:35:03 progress=0.854354  cache=20.6MiB(12251tx)\r\n\r\n(373816 -373499)=317 blocks to be exact.\r\n",
      "created_at" : "2016-02-10T13:34:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7494#issuecomment-182377080",
      "id" : 182377080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7494",
      "updated_at" : "2016-02-10T13:36:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/182377080",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "It seems that the bestblock descriptor in the wallet is not updated when flushing occurs for pruning, which is a bug. It could explain the issue here, but only in the case of an unclean shutdown (as the bestblock descriptor is always updated on clean shutdown).",
      "created_at" : "2016-02-10T13:52:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7494#issuecomment-182385005",
      "id" : 182385005,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7494",
      "updated_at" : "2016-02-10T13:52:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/182385005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "As the debug.log does show a clean shutdown, I hope this doesn't mean that there are problems with clean shutdown not being as clean as we think. But updating the bestblock descriptor when flushing for pruning would probably solve the immediate issue.",
      "created_at" : "2016-02-10T14:03:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7494#issuecomment-182388474",
      "id" : 182388474,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7494",
      "updated_at" : "2016-02-10T14:03:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/182388474",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj It looks to me like a clean shutdown still doesn't update the bestblock descriptor if it has been less than an hour.  So I think this problem could happen with clean shutdowns but will be fixed properly by #7502.",
      "created_at" : "2016-02-10T17:08:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7494#issuecomment-182484684",
      "id" : 182484684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7494",
      "updated_at" : "2016-02-10T17:08:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/182484684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "@morcos Nice catch. I think that explains it.\n",
      "created_at" : "2016-02-10T17:21:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7494#issuecomment-182489932",
      "id" : 182489932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7494",
      "updated_at" : "2016-02-10T17:21:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/182489932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "> @laanwj It looks to me like a clean shutdown still doesn't update the bestblock descriptor if it has been less than an hour\r\n\r\nYes that must be the problem then :(\r\n\r\nSolved by #7502 (which is in rc5)",
      "created_at" : "2016-02-11T07:58:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7494#issuecomment-182755272",
      "id" : 182755272,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7494",
      "updated_at" : "2016-02-11T07:58:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/182755272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
