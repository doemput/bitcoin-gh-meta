{
   "assignee" : null,
   "assignees" : [],
   "body" : "These changes implement countermeasures 3 (feeler connections) suggested in our paper: \"Eclipse Attacks on BitcoinÃ¢ÂÂs Peer-to-Peer Network\".\r\n\r\nDesign:\r\n=========\r\nWe observe that a node's resistance to eclipse attacks grows as the number of online addresses in the tried table grows. To increase the number of online addresses in the tried table the following logic is implemented in net.cpp's ThreadOpenConnections:\r\n\r\n1. Every 2 minutes a short lived *feeler connection* is made to a randomly selected address in new.\r\n2. If the tested address is online and running bitcoind, this address is moved to the tried table.\r\n3. The feeler connection to the tested address is closed.\r\n\r\nOnly one feeler connection is attempted at any one time and feeler connections are only attempted after all outgoing connections slots of filled.\r\n\r\nAdvantages:\r\n=========\r\n\r\n* In our paper we sample several peer lists. We found that a large percentage of addresses in tried tables are stale IP addresses (the lowest was 72 percent stale, the highest was 95 percent stale). This large number of stale IP addresses increases the risk of eclipse attacks. This change remedies this by ensuring that the tried table grows quickly and contains many recently online addresses.\r\n\r\n* Not only do feeler connections provide a direct benefit to the node doing the testing but the tested node, if online, learns about our node and adds it to its tried table (conferring herd immunity even under partial deployment).\r\n\r\n* Countermeasure 3 (test-before-evict) builds on the feeler connections introduced in this change. This is the first step to deploying countermeasure 3.\r\n\r\nRisk mitigation:\r\n========\r\n\r\n* To limit the network impact of the feeler connections we only make one new connection every 2 minutes. Compared with other networking tasks that bitcoind performs the bandwidth increase is very slight.\r\n\r\n* To avoid issues of synchronization we introduce a random sleep of between 0 and 1000 milliseconds prior to making a feeler connection.\r\n\r\n* To avoid threading issues the feeler connections are made in the same thread as non-feeler connections.\r\n\r\nTest plan:\r\n=========\r\n1. I'm currently running two EC2 nodes with public IP addresses. One is running this pull request and the other is running standard bitcoind. Both are running with arg -debug=1. At the end of the week I will post results from the logs looking at differences in the size of the tried table and examining the logs for any errors. I will also use the peer.dat files generated from this test to evaluate each nodes resistance to eclipse attacks.\r\n\r\n2. I will also use packet captures to ensure behavior and bandwidth behaves as expected.\r\n\r\n3. I invite anyone would like to help to run standard and feeler connection nodes and email me (Ethan.R.Heilman@gmail.com) the pcaps, logs and peers.dat files. I will post the results of this analysis here.\r\n\r\nThis change was suggested as Countermeasure 4 in\r\n[Eclipse Attacks on BitcoinÃ¢ÂÂs Peer-to-Peer Network](https://eprint.iacr.org/2015/263.pdf),\r\nEthan Heilman, Alison Kendler, Aviv Zohar, Sharon Goldberg.\r\nePrint Archive Report 2015/263. March 2015.",
   "closed_at" : "2016-08-25T08:49:03Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 23,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282/comments",
   "created_at" : "2016-06-28T17:19:43Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282",
   "id" : 162739771,
   "labels" : [
      {
         "color" : "006b75",
         "name" : "P2P",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282/labels{/name}",
   "locked" : false,
   "milestone" : {
      "closed_at" : null,
      "closed_issues" : 31,
      "created_at" : "2016-08-10T17:30:01Z",
      "creator" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      },
      "description" : null,
      "due_on" : null,
      "html_url" : "https://github.com/bitcoin/bitcoin/milestones/0.13.1",
      "id" : 1935226,
      "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/22/labels",
      "number" : 22,
      "open_issues" : 8,
      "state" : "open",
      "title" : "0.13.1",
      "updated_at" : "2016-09-16T09:25:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/22"
   },
   "number" : 8282,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/8282.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/8282.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "net: Feeler connections to increase online addrs in the tried table.",
   "updated_at" : "2016-09-09T10:17:50Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
      "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
      "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
      "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
      "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/EthanHeilman",
      "id" : 274814,
      "login" : "EthanHeilman",
      "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
      "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
      "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/EthanHeilman"
   }
}
