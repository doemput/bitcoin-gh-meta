[
   {
      "body" : "The BIP specifies you should encode transactions exactly as they would be in \"tx\" messages, so this does not really fix the issue - ultimately we need to inform the compact block stuff whether to include the witnesses (though its probably easier/better to just change the spec to require witness-inclusion).",
      "created_at" : "2016-06-27T20:39:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228868075",
      "id" : 228868075,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8271",
      "updated_at" : "2016-06-27T20:39:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228868075",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "I'm working on a spec for making witness + compactblocks work (using\nsendcmpct version 2 to indicate that blocktxn, cmpctblock should include\nwitnesses, and that short ids should be based on wtxids), which seems to\nwork quite well.\n\nThis is just a minimal change to prevent things from breaking when witness\nnodes start talking to older compactblocks-aware nodes.\n",
      "created_at" : "2016-06-27T23:38:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228908022",
      "id" : 228908022,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8271",
      "updated_at" : "2016-06-27T23:38:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228908022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Correct me if I'm wrong, but transaction encoding/hash with witness for a non-witness transaction and transaction encoding/hash without witness are the same, no? I'd think no one would ship code with compact blocks before we fix the witness/compact combination, so might as well just remove the code for non-witness compact with version 1...it'll only break current master nodes after segwit activates, so I'm not too worried.",
      "created_at" : "2016-06-27T23:44:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228908932",
      "id" : 228908932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8271",
      "updated_at" : "2016-06-27T23:44:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228908932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "0.13.0 will ship with compact blocks, but very likely without segwit\nactivation. A potential future 0.13.1 with segwit activation can't send\nwitnesses to 0.13.0 nodes, as they would consider those blocks invalid\nand/or the shorttixds would mismatch.\n\nYou need to negotiate which parts of transactions are relevant unless you\nwant relay between old and new nodes to be severely impacted any time a new\npiece of data is defined in transactions.\n\nThe code is quite small, see my segwitcb branch.\n",
      "created_at" : "2016-06-27T23:49:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228909846",
      "id" : 228909846,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8271",
      "updated_at" : "2016-06-27T23:49:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228909846",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I mean you can still define version 1 to include witnesses, it doesnt effect the current protocol for non-witness transactions and continues to work fine, no?",
      "created_at" : "2016-06-28T02:13:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228929689",
      "id" : 228929689,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8271",
      "updated_at" : "2016-06-28T02:13:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228929689",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Yes, you could. But it would mean 0.13.1 can't send to 0.13.0 nodes.\n",
      "created_at" : "2016-06-28T06:39:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228962572",
      "id" : 228962572,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8271",
      "updated_at" : "2016-06-28T06:39:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228962572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Sure they could! 0.13.0 will know how to deserialize with witnesses,\neven if the block-processing-with-witnesses is not enabled. I think you\nmeant to say 0.13.0 wont be able to send to 0.13.1, because it would\ndrop the witnesses from processing, which I'd think is true?\n\nOn 06/28/16 06:39, Pieter Wuille wrote:\n> Yes, you could. But it would mean 0.13.1 can't send to 0.13.0 nodes.\n> \n> Ã¢ÂÂ\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228962572>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe/AAnoHqS1W2YWU0XIBATMqAzGSoiBp9geks5qQMGZgaJpZM4I-m8y>.\n> \n",
      "created_at" : "2016-06-28T06:48:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228964898",
      "id" : 228964898,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8271",
      "updated_at" : "2016-06-28T06:48:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228964898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "To 0.13.0 nodes these blocks should not have witnesses, as there has not been a softfork to define them. Sure it could strip them off before processing when received from a 0.13.1 node, but that is inefficient (especially for a protocol that tries to minimize bandwidth) and does not solve the problem for other potential future data extensions to the serialization.\r\n\r\n0.13.1 will never request from 0.13.0 after segwit activation, as blocks are only downloaded from other peers that can provide witnesses.",
      "created_at" : "2016-06-28T08:37:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-228987080",
      "id" : 228987080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8271",
      "updated_at" : "2016-06-28T09:40:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228987080",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "The discussion above should probably happen elsewhere.\r\n\r\nThe PR here is a pure bugfix, though one that would only occur on testnet, and if there is ever a client on the network which does support BIP152 but not segwit.",
      "created_at" : "2016-07-08T13:15:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-231356101",
      "id" : 231356101,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8271",
      "updated_at" : "2016-07-08T13:15:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/231356101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "utACK.  We should merge this for 0.13.0.",
      "created_at" : "2016-07-08T17:10:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-231416970",
      "id" : 231416970,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8271",
      "updated_at" : "2016-07-08T17:10:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/231416970",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "utACK 252675e\r\n",
      "created_at" : "2016-07-14T06:17:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8271#issuecomment-232566421",
      "id" : 232566421,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8271",
      "updated_at" : "2016-07-14T06:17:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/232566421",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
