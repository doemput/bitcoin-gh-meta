[
   {
      "body" : "This pull request implements the feeler functionality in #6355. ",
      "created_at" : "2016-06-28T20:26:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-229171996",
      "id" : 229171996,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-06-28T20:26:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/229171996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "tests need some love...",
      "created_at" : "2016-06-30T12:28:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-229643654",
      "id" : 229643654,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-06-30T12:28:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/229643654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "@paveljanik I am currently working on fixes these days, however I am running into issues with the rpc-tests. When I run rpc-tests locally both with this pull request and against bitcoin/master I get intermittent failures. \r\n\r\nI run against bitcoin/master\r\n```\r\npython3 qa/pull-tester/rpc-tests.py\r\n```\r\n\r\ntests fail\r\n```\r\nTEST                           | PASSED | DURATION\r\nbip68-112-113-p2p.py           | True   | 52 s\r\nlisttransactions.py            | True   | 177 s\r\nwallet.py                      | True   | 287 s\r\nmempool_resurrect_test.py      | True   | 20 s\r\nreceivedby.py                  | True   | 93 s\r\ntxn_doublespend.py --mineblock | True   | 50 s\r\ntxn_clone.py                   | True   | 40 s\r\ngetchaintips.py                | True   | 43 s\r\np2p-fullblocktest.py           | False  | 447 s\r\nrawtransactions.py             | True   | 83 s\r\nmempool_spendcoinbase.py       | True   | 10 s\r\nmempool_reorg.py               | True   | 22 s\r\nrest.py                        | True   | 71 s\r\nmulti_rpc.py                   | True   | 5 s\r\nhttpbasics.py                  | True   | 11 s\r\nmempool_limit.py               | True   | 24 s\r\nproxy_test.py                  | True   | 15 s\r\nmerkle_blocks.py               | True   | 41 s\r\nsignrawtransactions.py         | True   | 5 s\r\nzapwallettxes.py               | True   | 49 s\r\nnodehandling.py                | True   | 24 s\r\ndecodescript.py                | True   | 5 s\r\nreindex.py                     | True   | 31 s\r\nblockchain.py                  | True   | 6 s\r\ndisablewallet.py               | True   | 5 s\r\nkeypool.py                     | True   | 18 s\r\nprioritise_transaction.py      | True   | 25 s\r\ninvalidblockrequest.py         | True   | 11 s\r\nsendheaders.py                 | True   | 60 s\r\ninvalidtxrequest.py            | True   | 12 s\r\nwalletbackup.py                | True   | 647 s\r\np2p-versionbits-warning.py     | True   | 24 s\r\nabandonconflict.py             | True   | 39 s\r\nfundrawtransaction.py          | False  | 201 s\r\nimportprunedfunds.py           | True   | 37 s\r\nsignmessages.py                | True   | 6 s\r\nsegwit.py                      | True   | 51 s\r\nzmq_test.py                    | True   | 17 s\r\np2p-segwit.py                  | True   | 88 s\r\nALL                            | False  | 2852 s (accumulated)\r\n```\r\nI rerun it and sometimes different tests fail\r\n```\r\nTEST                           | PASSED | DURATION\r\n\r\np2p-fullblocktest.py           | False  | 33 s\r\nbip68-112-113-p2p.py           | True   | 52 s\r\nlisttransactions.py            | True   | 64 s\r\nreceivedby.py                  | True   | 46 s\r\nwalletbackup.py                | False  | 107 s\r\nmempool_resurrect_test.py      | True   | 21 s\r\ntxn_clone.py                   | True   | 58 s\r\ntxn_doublespend.py --mineblock | True   | 67 s\r\ngetchaintips.py                | True   | 71 s\r\nwallet.py                      | True   | 193 s\r\nmempool_spendcoinbase.py       | True   | 8 s\r\nmempool_reorg.py               | True   | 18 s\r\nmempool_limit.py               | True   | 20 s\r\nhttpbasics.py                  | True   | 12 s\r\nrest.py                        | True   | 57 s\r\nmulti_rpc.py                   | True   | 6 s\r\nrawtransactions.py             | True   | 67 s\r\nproxy_test.py                  | True   | 16 s\r\nsignrawtransactions.py         | True   | 7 s\r\nmerkle_blocks.py               | True   | 32 s\r\nzapwallettxes.py               | True   | 46 s\r\nnodehandling.py                | True   | 23 s\r\ndecodescript.py                | True   | 7 s\r\nblockchain.py                  | True   | 7 s\r\ndisablewallet.py               | True   | 4 s\r\nreindex.py                     | True   | 25 s\r\nkeypool.py                     | True   | 18 s\r\nprioritise_transaction.py      | True   | 28 s\r\ninvalidblockrequest.py         | True   | 13 s\r\ninvalidtxrequest.py            | True   | 10 s\r\nsendheaders.py                 | True   | 62 s\r\np2p-versionbits-warning.py     | True   | 26 s\r\nabandonconflict.py             | True   | 38 s\r\nimportprunedfunds.py           | True   | 27 s\r\nsignmessages.py                | True   | 5 s\r\nsegwit.py                      | True   | 43 s\r\nzmq_test.py                    | True   | 24 s\r\nfundrawtransaction.py          | True   | 184 s\r\np2p-segwit.py                  | True   | 90 s\r\n\r\nALL                            | False  | 1635 s (accumulated)\r\n```\r\n\r\nAlso sometimes it just crashes.\r\n```\r\n...........................................Traceback (most recent call last):\r\n  File \"qa/pull-tester/rpc-tests.py\", line 340, in <module>\r\n    runtests()\r\n  File \"qa/pull-tester/rpc-tests.py\", line 209, in runtests\r\n    (name, stdout, stderr, passed, duration) = job_queue.get_next()\r\n  File \"qa/pull-tester/rpc-tests.py\", line 264, in get_next\r\n    (stdout, stderr) = proc.communicate(timeout=3)\r\n  File \"/usr/lib/python3.4/subprocess.py\", line 960, in communicate\r\n    stdout, stderr = self._communicate(input, endtime, timeout)\r\n  File \"/usr/lib/python3.4/subprocess.py\", line 1618, in _communicate\r\n    self._check_timeout(endtime, orig_timeout)\r\n  File \"/usr/lib/python3.4/subprocess.py\", line 986, in _check_timeout\r\n    raise TimeoutExpired(self.args, orig_timeout)\r\nsubprocess.TimeoutExpired: Command '['/home/e0/work/bitcoin-standard/qa/rpc-tests/walletbackup.py', '--srcdir=/home/e0/work/bitcoin-standard/src', '--portseed=37']' timed out after 3 seconds\r\n```",
      "created_at" : "2016-06-30T16:39:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-229715503",
      "id" : 229715503,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-06-30T16:39:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/229715503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "If you get a timeout, you may try to run the test directly `qa/rpc-tests/test.py` and see if it still fails. Also, you may want to check if there are any zombie bitcoin processes which you want to kill. And finally, the test_framework will no longer clean up after a failure, so you need to clean your temp dir manually in case it has limited space available.\r\n\r\nUsually none of this should be a problem on travis, as a fresh vm is used every time, so you may want to look into the failure on travis.",
      "created_at" : "2016-06-30T16:46:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-229717533",
      "id" : 229717533,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-06-30T16:46:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/229717533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "You should assert that nodes in the existing tests are not marked a feel connection and thus get disconnected.",
      "created_at" : "2016-06-30T16:53:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-229719568",
      "id" : 229719568,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-06-30T16:53:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/229719568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "From my first glance at a failing travis test, it seems that perhaps `pnode->fFeeler` can be set to true on an incoming connection, causing an immediate disconnect?  That would result in intermittent test failures for sure.",
      "created_at" : "2016-06-30T16:55:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-229720172",
      "id" : 229720172,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-06-30T16:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/229720172",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "I just restarted my test node with the fixed code.",
      "created_at" : "2016-06-30T23:28:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-229816883",
      "id" : 229816883,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-06-30T23:28:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/229816883",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "@sdaftuar  @MarcoFalke I'm working on a simple unittest to make sure that fFeelers is false by default and never happens when fIncoming = true. Should be pushed by EOD.",
      "created_at" : "2016-07-01T19:45:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-230032676",
      "id" : 230032676,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-07-01T19:45:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/230032676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "I added a simple test and an assert to ensure that that fFeelers are set false by default and don't get assigned to incoming connection.",
      "created_at" : "2016-07-01T21:08:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-230047759",
      "id" : 230047759,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-07-01T21:08:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/230047759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "**Summary:** To test feeler connections I ran two nodes on EC2 for ~one month. One node ran this pull request, the second node ran default Bitcoin.  According to this test feeler connections (this pull request) increase the size of the tried table by about an order of magnitude and consequently increase the eclipse resistance of a node by an order of magnitude. I also measured the impact of a future pull request *test-before-evict* where IPs are not evicted from the tried table if they are online.\r\n\r\nTried Table\r\n========\r\n![Comparing the size of the tried table over time](https://cloud.githubusercontent.com/assets/274814/17309873/0ce8192a-580f-11e6-9119-a2150ef8c3df.png)\r\n\r\nOne node ran this pull request for 32 days (July 1st to August 1st), the second node ran default Bitcoin for 35 Days (June 28 to August 1st).\r\n\r\nOn August 1st I disconnected the nodes and graphed the results. I tested which nodes in the tried table were online on August 1st.\r\n* The Feeler connections node had **1309 IPs** in the tried table of which 38.8% or 590 IPs were online.\r\n* The default Bitcoin node had **195 IPs** in the tried table of which 28.2% or 55 IPs were online.\r\n\r\nSecurity Benefit\r\n========\r\n\r\nTo determine the security benefit of these larger numbers of IPs in the tried table I modeled the attack presented in [Eclipse Attacks on BitcoinÃ¢ÂÂs Peer-to-Peer Network](https://eprint.iacr.org/2015/263). Full  details on how this was carried out are given at bottom of this comment. \r\n\r\n![attackergraph40000-10-1000short-line](https://cloud.githubusercontent.com/assets/274814/17366828/372af458-595b-11e6-81e5-2c9f97282305.png)\r\n\r\n**Default node:** 595 attacker IPs for ~50% attack success.\r\n**Default node + test-before-evict:** 620 attacker IPs for ~50% attack success.\r\n**Feeler node:** 5540 attacker IPs for ~50% attack success.\r\n**Feeler node + test-before-evict:** 8600 attacker IPs for ~50% attack success.\r\n\r\nThe node running feeler connections has 10 times as many online IP addresses in its tried table making an attack 10 times harder (i.e. requiring the an attacker require 10 times as many IP addresses in different /16s). Adding test-before-evict increases resistance of the node by an additional 3000 attacker IP addresses. \r\n\r\nBelow I graph the attack over even greater attacker resources (i.e. more attacker controled IP addresses). Note that test-before-evict maintains some security far longer even against an attacker with 50,000 IPs. If this node had a larger tried table test-before-evict could greatly boost a nodes resistance to eclipse attacks.\r\n\r\n![attacker graph long view](https://cloud.githubusercontent.com/assets/274814/17367108/96f46d64-595c-11e6-91cd-edba160598e7.png)\r\n\r\nModeling an Eclipse Attack\r\n==========\r\nUsing the peers.dat file from the default node and the feeler connections node I reconstructed their tried tables (I ignore the new table in our attacks as it is trivial to fill it with trash IP addresses). The attack test was run as follows:\r\n\r\n1. Attempt to insert X attacker IP addresses each from distinct \\16s into a model of a node's tried table.\r\n2. Select nodes from each nodes tried table based on the logic in net.cpp (each outgoing connection must be from a different \\16, only connect to online nodes).\r\n3. If the attacker's IPs are selected for all 8 outgoing connections the attacker wins as the attacker has partitioned the node from the rest of the network otherwise the attacker loses. For realism I only allowed the node to connect to other nodes which were online.\r\n\r\nFor each value X of number of attacker IPs I ran the attack 1000 times. For each of these 1000 runs I calculated the attack success probability by performing the selection of 8 outgoing connections 10 times. I used the peers.dat file from the feelers connection node and the default node to build the model of the tried table for the attack. I simulated the impact of enabling test-before-evict would have if turned on just prior to the attack (this should not be different than if the node has been running test-before-evict all along) by preventing the attacker from evicting an IP in the tried table if that node was online.",
      "created_at" : "2016-08-03T14:36:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-237255215",
      "id" : 237255215,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-03T14:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237255215",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73384975"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73384975"
         }
      },
      "body" : "No need to call GetTime() again.",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-03T17:53:28Z",
      "diff_hunk" : "@@ -1609,6 +1614,7 @@ void ThreadOpenConnections()\n \n     // Initiate network connections\n     int64_t nStart = GetTime();\n+    int64_t nLastFeeler = GetTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73384975",
      "id" : 73384975,
      "original_commit_id" : "6ded2298035ae5a586ca3d7ae78e17ac55227af6",
      "original_position" : 32,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73384975",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73385847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73385847"
         }
      },
      "body" : "Would it make sense to use PoissonNextSend here, resulting in maximally unpredictable times?\r\n\r\nEDIT: This comment was meant to appy to FEELER_INTERVAL instead.",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-03T17:57:57Z",
      "diff_hunk" : "@@ -1688,8 +1722,17 @@ void ThreadOpenConnections()\n             break;\n         }\n \n-        if (addrConnect.IsValid())\n-            OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant);\n+        if (addrConnect.IsValid()) {\n+\n+            if (fFeeler) {\n+                // Add small amount of random noise before connection to avoid syncronization.\n+                int randsleep = GetRandInt(FEELER_SLEEP_WINDOW * 1000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73385847",
      "id" : 73385847,
      "original_commit_id" : "6ded2298035ae5a586ca3d7ae78e17ac55227af6",
      "original_position" : 90,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73385847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73386342"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73386342"
         }
      },
      "body" : "GetTime() is relatively expensive; I think you can introduce an nTime = GetTime() above and then reuse that value 4 times. It probably doesn't matter, but gettimeofday calls appear so many times in traces already :)",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-03T18:00:30Z",
      "diff_hunk" : "@@ -1646,13 +1652,41 @@ void ThreadOpenConnections()\n                 }\n             }\n         }\n+        assert(nOutbound <= (MAX_OUTBOUND_CONNECTIONS + MAX_FEELER_CONNECTIONS));\n \n-        int64_t nANow = GetAdjustedTime();\n+        // Feeler Connections\n+        //\n+        // Design goals:\n+        //  * Increase the number of connectable addresses in the tried table.\n+        //\n+        // Method:\n+        //  * Choose a random address from new and attempt to connect to it if we can connect \n+        //    successfully it is added to tried.\n+        //  * Start attempting feeler connections only after node finishes making outbound \n+        //    connections.\n+        //  * Only make a feeler connection once every few minutes.\n+        //\n+        bool fFeeler = false;\n+        if (nOutbound >= MAX_OUTBOUND_CONNECTIONS){\n+            if (GetTime() - nLastFeeler > FEELER_INTERVAL) {\n+                nLastFeeler = GetTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73386342",
      "id" : 73386342,
      "original_commit_id" : "6ded2298035ae5a586ca3d7ae78e17ac55227af6",
      "original_position" : 58,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73386342",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73413819"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73413819"
         }
      },
      "body" : "Can't this be simply changed to\r\n```c++\r\nCAddrInfo addr = addrman.Select(fFeeler);\r\n```",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-03T20:26:00Z",
      "diff_hunk" : "@@ -1646,13 +1652,41 @@ void ThreadOpenConnections()\n                 }\n             }\n         }\n+        assert(nOutbound <= (MAX_OUTBOUND_CONNECTIONS + MAX_FEELER_CONNECTIONS));\n \n-        int64_t nANow = GetAdjustedTime();\n+        // Feeler Connections\n+        //\n+        // Design goals:\n+        //  * Increase the number of connectable addresses in the tried table.\n+        //\n+        // Method:\n+        //  * Choose a random address from new and attempt to connect to it if we can connect \n+        //    successfully it is added to tried.\n+        //  * Start attempting feeler connections only after node finishes making outbound \n+        //    connections.\n+        //  * Only make a feeler connection once every few minutes.\n+        //\n+        bool fFeeler = false;\n+        if (nOutbound >= MAX_OUTBOUND_CONNECTIONS){\n+            if (GetTime() - nLastFeeler > FEELER_INTERVAL) {\n+                nLastFeeler = GetTime();\n+                fFeeler = true;                \n+            } else {\n+                continue;\n+            }\n+        }\n+        LogPrint(\"net\", \"Feeler = %d, nOutbound = %d, nLastFeeler = %d \\n\",fFeeler, nOutbound, nLastFeeler);\n \n+        int64_t nANow = GetAdjustedTime();\n         int nTries = 0;\n         while (true)\n         {\n-            CAddrInfo addr = addrman.Select();\n+            CAddrInfo addr;\n+            if (fFeeler) {\n+                addr = addrman.Select(true);\n+            } else {\n+                addr = addrman.Select();\n+            }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73413819",
      "id" : 73413819,
      "original_commit_id" : "6ded2298035ae5a586ca3d7ae78e17ac55227af6",
      "original_position" : 76,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73413819",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73414196"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73414196"
         }
      },
      "body" : "syncronization -> synchronization",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-03T20:27:59Z",
      "diff_hunk" : "@@ -1688,8 +1722,17 @@ void ThreadOpenConnections()\n             break;\n         }\n \n-        if (addrConnect.IsValid())\n-            OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant);\n+        if (addrConnect.IsValid()) {\n+\n+            if (fFeeler) {\n+                // Add small amount of random noise before connection to avoid syncronization.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73414196",
      "id" : 73414196,
      "original_commit_id" : "6ded2298035ae5a586ca3d7ae78e17ac55227af6",
      "original_position" : 89,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73414196",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Thanks a lot for the thorough analysis! Concept ACK with a few nits. I'm surprised by how little code was needed.",
      "created_at" : "2016-08-03T20:36:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-237364633",
      "id" : 237364633,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-03T20:36:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237364633",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "How will feeler endpoints view us when we disconnect just after their `version` message?",
      "created_at" : "2016-08-03T20:41:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-237366223",
      "id" : 237366223,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-03T20:41:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237366223",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "@paveljanik Similar to oneshot connections that are used for DNS seeding over tor.",
      "created_at" : "2016-08-03T20:42:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-237366599",
      "id" : 237366599,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-03T20:42:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237366599",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73417272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73417272"
         }
      },
      "body" : "space after `,` please.",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-03T20:45:19Z",
      "diff_hunk" : "@@ -1688,8 +1722,17 @@ void ThreadOpenConnections()\n             break;\n         }\n \n-        if (addrConnect.IsValid())\n-            OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant);\n+        if (addrConnect.IsValid()) {\n+\n+            if (fFeeler) {\n+                // Add small amount of random noise before connection to avoid syncronization.\n+                int randsleep = GetRandInt(FEELER_SLEEP_WINDOW * 1000);\n+                MilliSleep(randsleep);\n+                LogPrint(\"net\", \"Making feeler connection to %s\\n\",addrConnect.ToString());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73417272",
      "id" : 73417272,
      "original_commit_id" : "6ded2298035ae5a586ca3d7ae78e17ac55227af6",
      "original_position" : 92,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73417272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Concept ACK. Nice work and interesting reading!",
      "created_at" : "2016-08-04T11:32:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-237527745",
      "id" : 237527745,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-04T11:32:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/237527745",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73507011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73507011"
         }
      },
      "body" : "New compile warning here:\r\n\r\n```\r\n+test/net_tests.cpp:154:31: warning: variable 'hSocket' is uninitialized when used here [-Wuninitialized]\r\n+    CNode* pnode1 = new CNode(hSocket, addr, pszDest, fInboundIn);\r\n+                              ^~~~~~~\r\n+test/net_tests.cpp:148:19: note: initialize the variable 'hSocket' to silence this warning\r\n+    SOCKET hSocket;\r\n+                  ^\r\n+                   = 0\r\n```\r\n",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-04T11:43:18Z",
      "diff_hunk" : "@@ -142,4 +142,23 @@ BOOST_AUTO_TEST_CASE(caddrdb_read_corrupted)\n     BOOST_CHECK(addrman2.size() == 0);\n }\n \n+BOOST_AUTO_TEST_CASE(cnode_simple_test)\n+{\n+\n+    SOCKET hSocket;\n+    CAddress addr = CAddress(CService(\"252.1.1.1\", 7777), NODE_NETWORK);\n+    std::string pszDest = \"\";\n+    bool fInboundIn = false;\n+\n+    // Test that fFeeler is false by default.\n+    CNode* pnode1 = new CNode(hSocket, addr, pszDest, fInboundIn);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73507011",
      "id" : 73507011,
      "original_commit_id" : "6ded2298035ae5a586ca3d7ae78e17ac55227af6",
      "original_position" : 13,
      "path" : "src/test/net_tests.cpp",
      "position" : 16,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73507011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73593862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73593862"
         }
      },
      "body" : "Oh, I didn't know about PoissonNextSend, very cool. I moved FEELER_INTERVAL to use PoissonNextSend.",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-04T20:11:45Z",
      "diff_hunk" : "@@ -1688,8 +1722,17 @@ void ThreadOpenConnections()\n             break;\n         }\n \n-        if (addrConnect.IsValid())\n-            OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant);\n+        if (addrConnect.IsValid()) {\n+\n+            if (fFeeler) {\n+                // Add small amount of random noise before connection to avoid syncronization.\n+                int randsleep = GetRandInt(FEELER_SLEEP_WINDOW * 1000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73593862",
      "id" : 73593862,
      "original_commit_id" : "6ded2298035ae5a586ca3d7ae78e17ac55227af6",
      "original_position" : 90,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73593862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73595634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73595634"
         }
      },
      "body" : "I managed to get rid of one call to GetTime(). PoissonNextSend uses GetTimeMicros() so replacing additional GetTime() calls would require nNow*(1000*1000) which looks a little ugly. \r\n\r\nIn a local branch I have some non-ugly changes which can reduce the number of GetTime() and GetTimeMicros() calls in ThreadOpenConnections but it touches code which is out of scope for this pull request. Would it be worthwhile to create a separate pull request for this?",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-04T20:23:43Z",
      "diff_hunk" : "@@ -1646,13 +1652,41 @@ void ThreadOpenConnections()\n                 }\n             }\n         }\n+        assert(nOutbound <= (MAX_OUTBOUND_CONNECTIONS + MAX_FEELER_CONNECTIONS));\n \n-        int64_t nANow = GetAdjustedTime();\n+        // Feeler Connections\n+        //\n+        // Design goals:\n+        //  * Increase the number of connectable addresses in the tried table.\n+        //\n+        // Method:\n+        //  * Choose a random address from new and attempt to connect to it if we can connect \n+        //    successfully it is added to tried.\n+        //  * Start attempting feeler connections only after node finishes making outbound \n+        //    connections.\n+        //  * Only make a feeler connection once every few minutes.\n+        //\n+        bool fFeeler = false;\n+        if (nOutbound >= MAX_OUTBOUND_CONNECTIONS){\n+            if (GetTime() - nLastFeeler > FEELER_INTERVAL) {\n+                nLastFeeler = GetTime();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73595634",
      "id" : 73595634,
      "original_commit_id" : "6ded2298035ae5a586ca3d7ae78e17ac55227af6",
      "original_position" : 58,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73595634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73597677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73597677"
         }
      },
      "body" : "Is this still needed with interval randomization?",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-04T20:35:39Z",
      "diff_hunk" : "@@ -1688,8 +1719,17 @@ void ThreadOpenConnections()\n             break;\n         }\n \n-        if (addrConnect.IsValid())\n-            OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant);\n+        if (addrConnect.IsValid()) {\n+\n+            if (fFeeler) {\n+                // Add small amount of random noise before connection to avoid synchronization.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73597677",
      "id" : 73597677,
      "original_commit_id" : "4b4517ce0340c813553f17d1e7710129542d58bd",
      "original_position" : 86,
      "path" : "src/net.cpp",
      "position" : 86,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73597677",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73604140"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73604140"
         }
      },
      "body" : "Yes. If we remove the random sleep synchronization becomes possible. \r\n\r\nConsider a network event which freezes ThreadOpenConnections for 120+ seconds. When that event unfreezes the thread all nodes will connect to an address in the new table all at once.\r\n\r\nThis anti-synchronization mechanism becomes more important when test-before-evict is added. Under test-before-evict a connection to a node can trigger the connected-to node to make another connection. My thinking is to get this protection in earlier rather than later since it does provide a small benefit to feeler connections.\r\n\r\n",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-04T21:15:20Z",
      "diff_hunk" : "@@ -1688,8 +1719,17 @@ void ThreadOpenConnections()\n             break;\n         }\n \n-        if (addrConnect.IsValid())\n-            OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant);\n+        if (addrConnect.IsValid()) {\n+\n+            if (fFeeler) {\n+                // Add small amount of random noise before connection to avoid synchronization.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73604140",
      "id" : 73604140,
      "original_commit_id" : "4b4517ce0340c813553f17d1e7710129542d58bd",
      "original_position" : 86,
      "path" : "src/net.cpp",
      "position" : 86,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73604140",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73788134"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73788134"
         }
      },
      "body" : "This constant seems not to be used other than to effectively increase MAX_OUTBOUND_CONNECTIONS.",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-06T16:08:23Z",
      "diff_hunk" : "@@ -60,6 +63,7 @@\n \n namespace {\n     const int MAX_OUTBOUND_CONNECTIONS = 8;\n+    const int MAX_FEELER_CONNECTIONS = 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73788134",
      "id" : 73788134,
      "original_commit_id" : "4b4517ce0340c813553f17d1e7710129542d58bd",
      "original_position" : 14,
      "path" : "src/net.cpp",
      "position" : 14,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73788134",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73788240"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73788240"
         }
      },
      "body" : "It is used indirectly in https://github.com/bitcoin/bitcoin/pull/8282/files/4b4517ce0340c813553f17d1e7710129542d58bd#diff-9a82240fe7dfe86564178691cc57f2f1R1672",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-06T16:17:32Z",
      "diff_hunk" : "@@ -60,6 +63,7 @@\n \n namespace {\n     const int MAX_OUTBOUND_CONNECTIONS = 8;\n+    const int MAX_FEELER_CONNECTIONS = 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73788240",
      "id" : 73788240,
      "original_commit_id" : "4b4517ce0340c813553f17d1e7710129542d58bd",
      "original_position" : 14,
      "path" : "src/net.cpp",
      "position" : 14,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73788240",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73794616"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73794616"
         }
      },
      "body" : "I'm perhaps reading the code incorrectly, but it seems that it will only ever make one feeler connection at a time, regardless of the value of this constant. I.e., increasing this value does not cause it to make concurrent feeler connections.",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-07T02:06:03Z",
      "diff_hunk" : "@@ -60,6 +63,7 @@\n \n namespace {\n     const int MAX_OUTBOUND_CONNECTIONS = 8;\n+    const int MAX_FEELER_CONNECTIONS = 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73794616",
      "id" : 73794616,
      "original_commit_id" : "4b4517ce0340c813553f17d1e7710129542d58bd",
      "original_position" : 14,
      "path" : "src/net.cpp",
      "position" : 14,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73794616",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "One potential niggle with feeler connections is that they cause the node_id to go up rather quickly. I think for feeler connections it might be worthwhile not incrementing the node_id since the connection is so short-lived. Perhaps the feeler connections can have a node_id of zero, or something like this?",
      "created_at" : "2016-08-07T04:01:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-238062134",
      "id" : 238062134,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-07T04:01:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/238062134",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73795490"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73795490"
         }
      },
      "body" : "Why is this in net.h rather than in net.cpp? net.cpp would cause less impact on compile times.",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-07T04:13:25Z",
      "diff_hunk" : "@@ -41,6 +41,8 @@ namespace boost {\n static const int PING_INTERVAL = 2 * 60;\n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n+/** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n+static const int FEELER_INTERVAL = 120;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73795490",
      "id" : 73795490,
      "original_commit_id" : "4b4517ce0340c813553f17d1e7710129542d58bd",
      "original_position" : 5,
      "path" : "src/net.h",
      "position" : 5,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73795490",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73795535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73795535"
         }
      },
      "body" : "Why not make the feeler interval random also, so instead of 120 seconds fixed, it will occur anytime between 0 and 240 seconds? (thereby 120seconds on average).",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-07T04:20:57Z",
      "diff_hunk" : "@@ -1688,8 +1719,17 @@ void ThreadOpenConnections()\n             break;\n         }\n \n-        if (addrConnect.IsValid())\n-            OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant);\n+        if (addrConnect.IsValid()) {\n+\n+            if (fFeeler) {\n+                // Add small amount of random noise before connection to avoid synchronization.\n+                int randsleep = GetRandInt(FEELER_SLEEP_WINDOW * 1000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73795535",
      "id" : 73795535,
      "original_commit_id" : "4b4517ce0340c813553f17d1e7710129542d58bd",
      "original_position" : 87,
      "path" : "src/net.cpp",
      "position" : 87,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73795535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73883722"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73883722"
         }
      },
      "body" : "Randomizing the interval was suggested by @sipa and it is an excellent idea!  This pull request already does exactly what you describe using PoissonNextSend.",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-08T14:24:09Z",
      "diff_hunk" : "@@ -1688,8 +1719,17 @@ void ThreadOpenConnections()\n             break;\n         }\n \n-        if (addrConnect.IsValid())\n-            OpenNetworkConnection(addrConnect, (int)setConnected.size() >= std::min(nMaxConnections - 1, 2), &grant);\n+        if (addrConnect.IsValid()) {\n+\n+            if (fFeeler) {\n+                // Add small amount of random noise before connection to avoid synchronization.\n+                int randsleep = GetRandInt(FEELER_SLEEP_WINDOW * 1000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73883722",
      "id" : 73883722,
      "original_commit_id" : "4b4517ce0340c813553f17d1e7710129542d58bd",
      "original_position" : 87,
      "path" : "src/net.cpp",
      "position" : 87,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73883722",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73885208"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73885208"
         }
      },
      "body" : "I put FEELER_INTERVAL in net.h since that is where all the other net.* timing intervals static const variables are and because putting static const variables in *.h appears to be the convention in the Bitcoind networking code.",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-08T14:31:23Z",
      "diff_hunk" : "@@ -41,6 +41,8 @@ namespace boost {\n static const int PING_INTERVAL = 2 * 60;\n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n+/** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n+static const int FEELER_INTERVAL = 120;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73885208",
      "id" : 73885208,
      "original_commit_id" : "4b4517ce0340c813553f17d1e7710129542d58bd",
      "original_position" : 5,
      "path" : "src/net.h",
      "position" : 5,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73885208",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73928973"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73928973"
         }
      },
      "body" : "I reread the pull request and my understanding is still that MAX_FEELER_CONNECTIONS > 1 allows concurrent feeler connections. I have run tests in response to your comment which appear to show multiple concurrent feeler connections.\r\n\r\nWould you be willing to write out your thought process which led you to the conclusion above in case there is something I am missing?",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-08T18:33:57Z",
      "diff_hunk" : "@@ -60,6 +63,7 @@\n \n namespace {\n     const int MAX_OUTBOUND_CONNECTIONS = 8;\n+    const int MAX_FEELER_CONNECTIONS = 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73928973",
      "id" : 73928973,
      "original_commit_id" : "4b4517ce0340c813553f17d1e7710129542d58bd",
      "original_position" : 14,
      "path" : "src/net.cpp",
      "position" : 14,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73928973",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73929131"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73929131"
         }
      },
      "body" : "This compile warning has been fixed.",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-08T18:34:45Z",
      "diff_hunk" : "@@ -142,4 +142,23 @@ BOOST_AUTO_TEST_CASE(caddrdb_read_corrupted)\n     BOOST_CHECK(addrman2.size() == 0);\n }\n \n+BOOST_AUTO_TEST_CASE(cnode_simple_test)\n+{\n+\n+    SOCKET hSocket;\n+    CAddress addr = CAddress(CService(\"252.1.1.1\", 7777), NODE_NETWORK);\n+    std::string pszDest = \"\";\n+    bool fInboundIn = false;\n+\n+    // Test that fFeeler is false by default.\n+    CNode* pnode1 = new CNode(hSocket, addr, pszDest, fInboundIn);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r73929131",
      "id" : 73929131,
      "original_commit_id" : "6ded2298035ae5a586ca3d7ae78e17ac55227af6",
      "original_position" : 13,
      "path" : "src/test/net_tests.cpp",
      "position" : 16,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/73929131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "Bitcoin's code review process has consistently been the most thoughtful and thorough code review process I've encountered. I want to thank all the reviewers for spending their time to read my code and help improve Bitcoin.  My pull requests are better for it. \r\n\r\nI realize reviewers might want to take more time to read it over carefully, but in terms of allocating my time for this week is there any particular issue that I should resolve in the next few days?",
      "created_at" : "2016-08-15T13:32:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-239802440",
      "id" : 239802440,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-15T13:32:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/239802440",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "utACK 4b4517ce0340c813553f17d1e7710129542d58bd",
      "created_at" : "2016-08-15T19:55:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-239909985",
      "id" : 239909985,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-15T19:55:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/239909985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "@EthanHeilman Can you please rebase to the current master with https://github.com/bitcoin/bitcoin/pull/8128 in? See https://github.com/bitcoin/bitcoin/pull/8128#issuecomment-239522023 for more information...\r\n\r\nIf I do so manually locally:\r\n\r\n```\r\n/Applications/Xcode.app/Contents/Developer/usr/bin/make -C .. bitcoin_test\r\n  CXX      test/test_test_bitcoin-net_tests.o\r\ntest/net_tests.cpp:157:30: error: no matching constructor for initialization of 'CService'\r\n    CAddress addr = CAddress(CService(\"252.1.1.1\", 7777), NODE_NETWORK);\r\n                             ^        ~~~~~~~~~~~~~~~~~\r\n```\r\n",
      "created_at" : "2016-08-15T20:10:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-239914182",
      "id" : 239914182,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-15T20:10:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/239914182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r74835669"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/74835669"
         }
      },
      "body" : "Perhaps include a link to the Eclipse Attacks paper here? Always good to know that the design behind some code has extensive analysis backing it.",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-15T21:10:01Z",
      "diff_hunk" : "@@ -1646,13 +1654,36 @@ void ThreadOpenConnections()\n                 }\n             }\n         }\n+        assert(nOutbound <= (MAX_OUTBOUND_CONNECTIONS + MAX_FEELER_CONNECTIONS));\n \n-        int64_t nANow = GetAdjustedTime();\n+        // Feeler Connections\n+        //\n+        // Design goals:\n+        //  * Increase the number of connectable addresses in the tried table.\n+        //\n+        // Method:\n+        //  * Choose a random address from new and attempt to connect to it if we can connect \n+        //    successfully it is added to tried.\n+        //  * Start attempting feeler connections only after node finishes making outbound \n+        //    connections.\n+        //  * Only make a feeler connection once every few minutes.\n+        //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r74835669",
      "id" : 74835669,
      "original_commit_id" : "4b4517ce0340c813553f17d1e7710129542d58bd",
      "original_position" : 56,
      "path" : "src/net.cpp",
      "position" : 56,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-23T20:26:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/74835669",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Testing this on bitcoin.sipa.be (together with #8223 #8453 #8452 #8393 #8515).",
      "created_at" : "2016-08-15T22:09:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-239944775",
      "id" : 239944775,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-15T22:09:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/239944775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Can confirm that 4b4517ce0340c813553f17d1e7710129542d58bd improves the problems raised in #8470",
      "created_at" : "2016-08-18T17:14:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-240792007",
      "id" : 240792007,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-18T17:14:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240792007",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "I think we should move forward with this.\r\n\r\n@EthanHeilman Can you try to rebase this (there is a silent merge conflict) and fix any issues as they arise?",
      "created_at" : "2016-08-18T17:28:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-240795920",
      "id" : 240795920,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-18T17:28:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240795920",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "@MarcoFalke \r\nhttps://github.com/bitcoin/bitcoin/commit/4b4517ce0340c813553f17d1e7710129542d58bd was not designed to fix #8470 but it should have help for three reasons:\r\n\r\n1. By moving reachable addresses from the new table to the tried table it protects those reachable addresses from being evicted by unreachable addresses.\r\n\r\n2. By testing addresses in the new table via feeler connections and marking those addresses in the new table which are offline as failed it should help to slowly remove unreachable nodes from the new table increasing the percentage of reachable nodes in the new table.\r\n\r\n3. By making feeler connections a node helps advertise itself increasing the number of reachable nodes in other nodes tried table.\r\n\r\nThese changes will increase the health of the tried and new table and should by extension increase the reachable nodes in address advertisements.\r\n\r\nI have rebased.\r\n",
      "created_at" : "2016-08-19T01:25:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-240903736",
      "id" : 240903736,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-19T01:27:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240903736",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "I'm going to be away from my computer for a few days. I will fix the newly broken tests when I get back.",
      "created_at" : "2016-08-19T01:28:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-240904222",
      "id" : 240904222,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-19T01:28:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/240904222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r75980255"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/75980255"
         }
      },
      "body" : "This would be better after the LogPrint to display version message I think, as otherwise the debug.log shows the disconnect and then after, the version message received, which is potentially confusing.",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-24T01:09:39Z",
      "diff_hunk" : "@@ -4903,6 +4903,12 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n \n     if (strCommand == NetMsgType::VERSION)\n     {\n+        // Feeler connections exist only to verify if address is online.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r75980255",
      "id" : 75980255,
      "original_commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "original_position" : 4,
      "path" : "src/main.cpp",
      "position" : 4,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-24T01:09:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/75980255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r75980395"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/75980395"
         }
      },
      "body" : "Why add this assert here?",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-24T01:11:39Z",
      "diff_hunk" : "@@ -1017,7 +1021,8 @@ static void AcceptConnection(const ListenSocket& hListenSocket) {\n     SOCKET hSocket = accept(hListenSocket.socket, (struct sockaddr*)&sockaddr, &len);\n     CAddress addr;\n     int nInbound = 0;\n-    int nMaxInbound = nMaxConnections - MAX_OUTBOUND_CONNECTIONS;\n+    int nMaxInbound = nMaxConnections - (MAX_OUTBOUND_CONNECTIONS + MAX_FEELER_CONNECTIONS);\n+    assert(nMaxInbound > 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r75980395",
      "id" : 75980395,
      "original_commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "original_position" : 24,
      "path" : "src/net.cpp",
      "position" : 24,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-24T01:11:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/75980395",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r76029766"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76029766"
         }
      },
      "body" : "@sipa @laanwj Given this current apparent convention causes a waste of CPU compiling code that doesn't need compiling, can we move some of the net.h code to net.cpp (or other applicable) places in a future pull request?",
      "commit_id" : "dbb1f640e67da25f0a41b9d2e696b789d2fd4e0d",
      "created_at" : "2016-08-24T10:09:10Z",
      "diff_hunk" : "@@ -41,6 +41,8 @@ namespace boost {\n static const int PING_INTERVAL = 2 * 60;\n /** Time after which to disconnect, after waiting for a ping response (or inactivity). */\n static const int TIMEOUT_INTERVAL = 20 * 60;\n+/** Run the feeler connection loop once every 2 minutes or 120 seconds. **/\n+static const int FEELER_INTERVAL = 120;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#discussion_r76029766",
      "id" : 76029766,
      "original_commit_id" : "4b4517ce0340c813553f17d1e7710129542d58bd",
      "original_position" : 5,
      "path" : "src/net.h",
      "position" : 5,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8282",
      "updated_at" : "2016-08-24T10:09:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76029766",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "code review ACK dbb1f64",
      "created_at" : "2016-08-25T08:47:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8282#issuecomment-242319960",
      "id" : 242319960,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8282",
      "updated_at" : "2016-08-25T08:47:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242319960",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
