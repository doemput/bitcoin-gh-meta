{
   "assignee" : null,
   "body" : "Wallet pruning can be used to speed up and shrink large wallets.\r\n\r\nTransactions will only be removed, if this for sure does not affect your balance.\r\n\r\nRPC prunewallet(n) removes transactions older than n days (n >= 1). Or adding prunewallet=n to bitcoin.conf prunes on startup. Note that the latter is required to prevent rescan from readding the transactions.\r\n\r\nA transaction is pruned, if the following conditions are met\r\n- at least 100 confirmations\r\n- older than n days according to block-timestamp (n >= 1)\r\n- our outputs must be completely spent and also the spending transaction must\r\n  have at least 100 confirmations\r\n- the inputs we spent are also pruned/prunable transactions, so that they dont require us as a spent-flag anymore\r\n\r\nA new class STXO has been introduced, which loops over the last 100 blocks and builds a temporary recently-spent-outputs index.\r\nIts only used on rescan, if wallet pruning is enabled. This is necessary to answer the question\r\n\"has the spending transaction at least 100 confirmations?\".\r\nBecause if not, a rescan wants to always add the transaction to the wallet, and not skip.\r\nThis is because, when we rescan, we dont have the spending transaction anymore in the wallet, to check how many confirmations it has.\r\nAlso a rescan checks if spent or not in our coins-utxo, because the wallet does not know if spent or not while rescaning.\r\n\r\nNote that the feature is disabled if someone uses the account-feature. I could add support for this, but I am not bothering if our plan is to remove the account-feature. Because pruning as is, would destroy account-balances.",
   "closed_at" : "2015-02-18T19:52:23Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/2814559?v=3",
      "events_url" : "https://api.github.com/users/cozz/events{/privacy}",
      "followers_url" : "https://api.github.com/users/cozz/followers",
      "following_url" : "https://api.github.com/users/cozz/following{/other_user}",
      "gists_url" : "https://api.github.com/users/cozz/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/cozz",
      "id" : 2814559,
      "login" : "cozz",
      "organizations_url" : "https://api.github.com/users/cozz/orgs",
      "received_events_url" : "https://api.github.com/users/cozz/received_events",
      "repos_url" : "https://api.github.com/users/cozz/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/cozz/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/cozz/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/cozz"
   },
   "comments" : 28,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5389/comments",
   "created_at" : "2014-11-28T14:25:02Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5389/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/5389",
   "id" : 50378921,
   "labels" : [
      {
         "color" : "02d7e1",
         "name" : "Wallet",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5389/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 5389,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/5389.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/5389",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/5389.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/5389"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "[Wallet] Wallet-pruning",
   "updated_at" : "2015-02-22T09:47:03Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5389",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/2814559?v=3",
      "events_url" : "https://api.github.com/users/cozz/events{/privacy}",
      "followers_url" : "https://api.github.com/users/cozz/followers",
      "following_url" : "https://api.github.com/users/cozz/following{/other_user}",
      "gists_url" : "https://api.github.com/users/cozz/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/cozz",
      "id" : 2814559,
      "login" : "cozz",
      "organizations_url" : "https://api.github.com/users/cozz/orgs",
      "received_events_url" : "https://api.github.com/users/cozz/received_events",
      "repos_url" : "https://api.github.com/users/cozz/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/cozz/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/cozz/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/cozz"
   }
}
