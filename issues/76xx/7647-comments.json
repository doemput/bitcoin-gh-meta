[
   {
      "body" : "I can't reproduce...\r\n\r\nIndeed, moving the wallet file to another destination while Bitcoin Core *is running* will cause\r\n\r\n```\r\n2016-03-06 15:07:22 Shutdown: In progress...\r\n2016-03-06 15:07:22 StopNode()\r\n2016-03-06 15:07:22 *** System error while flushing: CDB: Error 2, can't open database \r\n2016-03-06 15:07:27 CDBEnv::EnvShutdown: Error 2 shutting down database environment: No such file or directory\r\n2016-03-06 15:07:27 Shutdown: done\r\n```\r\n\r\nin the debug log on shutdown. Though, I fail to see how someone could lose the wallet file by this: The wallet file should still be at the location you moved it to. (Even though it might be slightly corrupt)",
      "created_at" : "2016-03-06T15:23:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7647#issuecomment-192913721",
      "id" : 192913721,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7647",
      "updated_at" : "2016-03-06T15:23:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192913721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "@subSTRATA Please provide *exact* steps to reproduce, preferably from the command line. Something like \r\n\r\n```\r\n>bitcoin-qt.exe -regtest -datadir=New_folder\r\n>move \"New_folder\\regtest\\wallet.dat\" New_folder\\regtest\\wallet.dat_bak\r\n        1 file(s) moved.",
      "created_at" : "2016-03-06T15:24:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7647#issuecomment-192913827",
      "id" : 192913827,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7647",
      "updated_at" : "2016-03-06T15:24:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192913827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Read https://bitcointalk.org/index.php?topic=1389123.msg14114474#msg14114474 very carefuly, it is not about moving wallet.dat file while Bitcoin Core is running.",
      "created_at" : "2016-03-06T15:28:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7647#issuecomment-192914100",
      "id" : 192914100,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7647",
      "updated_at" : "2016-03-06T15:30:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192914100",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2906757?v=3",
         "events_url" : "https://api.github.com/users/subSTRATA/events{/privacy}",
         "followers_url" : "https://api.github.com/users/subSTRATA/followers",
         "following_url" : "https://api.github.com/users/subSTRATA/following{/other_user}",
         "gists_url" : "https://api.github.com/users/subSTRATA/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/subSTRATA",
         "id" : 2906757,
         "login" : "subSTRATA",
         "organizations_url" : "https://api.github.com/users/subSTRATA/orgs",
         "received_events_url" : "https://api.github.com/users/subSTRATA/received_events",
         "repos_url" : "https://api.github.com/users/subSTRATA/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/subSTRATA/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/subSTRATA/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/subSTRATA"
      }
   },
   {
      "body" : "Issue occurs ONLY if newly created wallet.dat file was renamed within the same session. If Bitcoin Core was restarted between creation of a new wallet.dat file and renaming of it then no problems occur, see step 2b. and consequently different outcome at step 5.\r\n\r\n```\r\n1. Shutdown Bitcoin Core then move existing wallet.dat to some other directory.\r\n2. Start Bitcoin Core, it will create a new wallet.dat file.\r\n2b. Restart Bitcoin Core.\r\n3. While Bitcoin Core is running, rename newly created wallet.dat to whatever else.\r\n4. Shutdown Bitcoin Core, it will throw an error and exit.\r\n5. Rename file back to wallet.dat and start Bitcoin Core again, no problems whatsoever.\r\n```",
      "created_at" : "2016-03-06T15:55:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7647#issuecomment-192919715",
      "id" : 192919715,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7647",
      "updated_at" : "2016-03-06T16:40:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192919715",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2906757?v=3",
         "events_url" : "https://api.github.com/users/subSTRATA/events{/privacy}",
         "followers_url" : "https://api.github.com/users/subSTRATA/followers",
         "following_url" : "https://api.github.com/users/subSTRATA/following{/other_user}",
         "gists_url" : "https://api.github.com/users/subSTRATA/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/subSTRATA",
         "id" : 2906757,
         "login" : "subSTRATA",
         "organizations_url" : "https://api.github.com/users/subSTRATA/orgs",
         "received_events_url" : "https://api.github.com/users/subSTRATA/received_events",
         "repos_url" : "https://api.github.com/users/subSTRATA/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/subSTRATA/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/subSTRATA/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/subSTRATA"
      }
   },
   {
      "body" : "I see; This is not reproducible always. Pretty much you rename a corrupt `wallet.(timestamp).bak` file to `wallet.dat` until you get a `__db*` file, which will be deleted on the next start. I could reproduce once but I forgot to save the `wallet.(ts).bak` file. Would you mind uploading one? (Make sure it is for testnet/regnet or does not contain any relevant keys)",
      "created_at" : "2016-03-06T16:45:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7647#issuecomment-192928818",
      "id" : 192928818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7647",
      "updated_at" : "2016-03-06T16:45:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192928818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "I can reproduce it always, just follow procedure exactly. Just in case it realy does not work for you every time, here is .bak file which Bitcoin Core just created, mainnet private keys but no worries, wallet.dat was created just for this test.\r\n\r\n[https://mega.nz/#!yAZzSQbZ!mZK0q43dm1BIXvIQAx2ZiuCXZRk3_o9shiv2pTcTmrk](https://mega.nz/#!yAZzSQbZ!mZK0q43dm1BIXvIQAx2ZiuCXZRk3_o9shiv2pTcTmrk)\r\n\r\nOnce you download it:\r\n\r\n```\r\n6. Rename wallet.(timestamp).bak back to wallet.dat and start Bitcoin Core again.\r\n7. Bitcoin Core will delete wallet.dat file and create __db.80000002.2d624f7d file (size is 512 bytes) then afterwards create a new wallet.dat file. Or wallet.dat file was not deleted but nulled (innitialized) and renamed to __db.80000002.2d624f7d can't realy tell.\r\n8. Upon the next Bitcoin Core shutdown __db.80000002.2d624f7d file will be deleted.\r\n```",
      "created_at" : "2016-03-06T16:58:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7647#issuecomment-192933057",
      "id" : 192933057,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7647",
      "updated_at" : "2016-03-06T17:07:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/192933057",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2906757?v=3",
         "events_url" : "https://api.github.com/users/subSTRATA/events{/privacy}",
         "followers_url" : "https://api.github.com/users/subSTRATA/followers",
         "following_url" : "https://api.github.com/users/subSTRATA/following{/other_user}",
         "gists_url" : "https://api.github.com/users/subSTRATA/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/subSTRATA",
         "id" : 2906757,
         "login" : "subSTRATA",
         "organizations_url" : "https://api.github.com/users/subSTRATA/orgs",
         "received_events_url" : "https://api.github.com/users/subSTRATA/received_events",
         "repos_url" : "https://api.github.com/users/subSTRATA/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/subSTRATA/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/subSTRATA/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/subSTRATA"
      }
   }
]
