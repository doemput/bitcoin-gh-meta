[
   {
      "body" : "I guess it would be very tricky to track a log entry back to a RPC call because of the current thread/process model. But I agree, it would be useful.",
      "created_at" : "2015-12-12T12:55:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7199#issuecomment-164147623",
      "id" : 164147623,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7199",
      "updated_at" : "2015-12-12T12:55:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/164147623",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "I don't think it'd be very difficult.\r\n\r\nJust make the log messages in rpc*.cpp go to a different log. We already have a 'rpc' debug category.\r\n\r\nNote that substantial effort is underway to reduce log noise, e.g. #7075 #6519 so this may not turn out to be needed. In general, the debug.log is supposed to only log (by default) problems that are either caused by local use or critical local or network-wide issues.\r\n",
      "created_at" : "2015-12-14T11:10:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7199#issuecomment-164411254",
      "id" : 164411254,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7199",
      "updated_at" : "2015-12-14T11:10:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/164411254",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Right. Most commands would work without problems. But everything that dispatch a signal/thread, or lets say, works \"async\", would lead to follow up log entries in the \"traditional log\". Lets say you call `generate`. I guess the follow up wallet log log entries are difficult to relate to the \"generate\" command. But maybe that is the only point where async dispatching is involved.",
      "created_at" : "2015-12-14T11:23:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7199#issuecomment-164413854",
      "id" : 164413854,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7199",
      "updated_at" : "2015-12-14T11:23:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/164413854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Oh yes I completely agree that in general 'total attribution' of log messages is a hard problem, this would either require passing down a token down the call chain, a thread-local context, or something ugly like that. Or saner/long term, removing all logging in lower-level code and pass up and log problems upstream (like in #6519).\r\n\r\nBut I think what most people mean that request RPC logging is more like an 'audit log', that logs RPC interaction and usage, wallet changes, etc for debugging applications not bitcoin core itself, so if it lacks bitcoin-internal-detail stuff that's not a problem.\r\n",
      "created_at" : "2015-12-14T11:37:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7199#issuecomment-164416095",
      "id" : 164416095,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7199",
      "updated_at" : "2015-12-14T11:37:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/164416095",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj I have some code for rpc audit logging using the passing-down-token method as a follow-up for #7044 .  \r\n\r\nI created an CRPCArguments class and am passing things like username, the \"params\" argument, and thinking of wrapping the fHelp boolean in it as well.  \r\n\r\nThere's unfortunately a lot of wiggle room on what exactly should be logged(which calls, and what info per call), which will probably make this hard to upstream. ",
      "created_at" : "2015-12-14T13:28:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7199#issuecomment-164436264",
      "id" : 164436264,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7199",
      "updated_at" : "2015-12-14T13:28:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/164436264",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "```But I think what most people mean that request RPC logging is more like an 'audit log', that logs RPC interaction and usage, wallet changes, etc for debugging applications not bitcoin core itself, so if it lacks bitcoin-internal-detail stuff that's not a problem.```\r\n\r\n^ correct. I'm speaking explicitly on the log events for what the node does because it was commanded to do so via a JSON-RPC connection, and not through its normal course of operating. This request already assumes a properly functioning core node that is behaving as expected if left alone. It is entirely for investigating just what happens when a user-made application interacts with the core node.\r\n\r\nBasically, if the node does \"something\" because an RPC command told it to do so, I'd like those events (whatever they may be, ideally as verbose as possible) in a separate log file.  \r\n\r\nSometimes, when using RPC commands very frequently, there may be a timeout or error on a call that is not easy to reproduce, and any extra information/help when diagnosing these issues will help immensely...",
      "created_at" : "2015-12-14T15:44:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7199#issuecomment-164471387",
      "id" : 164471387,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7199",
      "updated_at" : "2015-12-14T15:44:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/164471387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6174154?v=3",
         "events_url" : "https://api.github.com/users/actioncrypto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/actioncrypto/followers",
         "following_url" : "https://api.github.com/users/actioncrypto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/actioncrypto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/actioncrypto",
         "id" : 6174154,
         "login" : "actioncrypto",
         "organizations_url" : "https://api.github.com/users/actioncrypto/orgs",
         "received_events_url" : "https://api.github.com/users/actioncrypto/received_events",
         "repos_url" : "https://api.github.com/users/actioncrypto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/actioncrypto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/actioncrypto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/actioncrypto"
      }
   },
   {
      "body" : "So, I was looking at this and have a question.\r\n\r\nIt's not entirely clear to me what is desired here - putting the basic rpc \"top-level\" logging into a separate file, versus drilling down deeper and associating lower-level log messages with the RPC call.\r\n\r\nIt was mentioned that some of the cruft in the log files is being cleaned up by other pulls.\r\n\r\nA thought I had is that we could give the RPC user a debug option like 'rpcfull' - what this would do is switch on all debugging as soon as the node is servicing an rpc call, and as soon as it's done it would turn it off.  This wouldn't explicitly associate the low level logging with the rpc call, but it should be a decent approximation and the log file would grow more slowly as it would only be logging during the life of the rpc call.\r\n\r\nI looked into it and making it thread-specific would, I think, require a pretty ugly hack to LogAcceptCategory.  But logging all threads for that short little period of time would be easy with an extra flag, \"fDebugAllTemporarily\". \r\n\r\nIf that sounds useful, let me know and I'll submit a pull. \r\n\r\n\r\n\r\n",
      "created_at" : "2016-03-31T18:04:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/7199#issuecomment-204058176",
      "id" : 204058176,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7199",
      "updated_at" : "2016-03-31T18:04:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/204058176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7504522?v=3",
         "events_url" : "https://api.github.com/users/mrbandrews/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrbandrews/followers",
         "following_url" : "https://api.github.com/users/mrbandrews/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrbandrews/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrbandrews",
         "id" : 7504522,
         "login" : "mrbandrews",
         "organizations_url" : "https://api.github.com/users/mrbandrews/orgs",
         "received_events_url" : "https://api.github.com/users/mrbandrews/received_events",
         "repos_url" : "https://api.github.com/users/mrbandrews/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrbandrews/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrbandrews/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrbandrews"
      }
   }
]
