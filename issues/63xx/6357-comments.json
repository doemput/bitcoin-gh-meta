[
   {
      "body" : "FWIW a decent chunk of the hashing power has disabled the priority space, and more are likely to follow. Further priority work is probably a wasted effort.",
      "created_at" : "2015-06-30T21:37:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-117352788",
      "id" : 117352788,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-06-30T21:37:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/117352788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "@petertodd Majority still accepts free transactions (at least BitFury, Antpool and BTCChina). But I agree this will change soon (reaching 1mb cap).",
      "created_at" : "2015-07-01T00:09:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-117376192",
      "id" : 117376192,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-07-01T00:09:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/117376192",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9091633?v=3",
         "events_url" : "https://api.github.com/users/coinx-ltc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/coinx-ltc/followers",
         "following_url" : "https://api.github.com/users/coinx-ltc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/coinx-ltc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/coinx-ltc",
         "id" : 9091633,
         "login" : "coinx-ltc",
         "organizations_url" : "https://api.github.com/users/coinx-ltc/orgs",
         "received_events_url" : "https://api.github.com/users/coinx-ltc/received_events",
         "repos_url" : "https://api.github.com/users/coinx-ltc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/coinx-ltc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/coinx-ltc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/coinx-ltc"
      }
   },
   {
      "body" : "(pushed and squashed a bug fix)\r\n\r\n@petertodd I completely agree.  However I would really like to see #6331 merged, and I don't want that to be held up debating whether priority should be removed, so in the meantime, if we want priority to be calculated correctly, I think this does it.",
      "created_at" : "2015-07-01T20:06:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-117810296",
      "id" : 117810296,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-07-01T20:06:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/117810296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6357#discussion_r34272784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34272784"
         }
      },
      "body" : "If a block contains transactions that depend on other transactions in the same block, won't this cause recalcPriority to be called multiple times for them?\r\n",
      "commit_id" : "6bfccf743a44040637e364304893adca852e6acc",
      "created_at" : "2015-07-09T16:17:01Z",
      "diff_hunk" : "@@ -212,6 +244,7 @@ void CTxMemPool::removeForBlock(const std::vector<CTransaction>& vtx, unsigned i\n     BOOST_FOREACH(const CTransaction& tx, vtx)\n     {\n         std::list<CTransaction> dummy;\n+        updateDependentPriorities(tx, nBlockHeight, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#discussion_r34272784",
      "id" : 34272784,
      "original_commit_id" : "13d22c66c389f315bd1256c84b3a2828fdeddce4",
      "original_position" : 85,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6357",
      "updated_at" : "2015-11-03T02:23:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34272784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6357#discussion_r34272849"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34272849"
         }
      },
      "body" : "I think you need to pass in a queue of transactions to update, and call this function once for the whole block.",
      "commit_id" : "6bfccf743a44040637e364304893adca852e6acc",
      "created_at" : "2015-07-09T16:17:42Z",
      "diff_hunk" : "@@ -212,6 +244,7 @@ void CTxMemPool::removeForBlock(const std::vector<CTransaction>& vtx, unsigned i\n     BOOST_FOREACH(const CTransaction& tx, vtx)\n     {\n         std::list<CTransaction> dummy;\n+        updateDependentPriorities(tx, nBlockHeight, true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#discussion_r34272849",
      "id" : 34272849,
      "original_commit_id" : "13d22c66c389f315bd1256c84b3a2828fdeddce4",
      "original_position" : 85,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6357",
      "updated_at" : "2015-11-03T02:23:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/34272849",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Can you add a consistency check for verifying that the (re)computed priorities match freshly computed ones, in CTxMempool::check()?",
      "created_at" : "2015-07-09T16:18:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-120055691",
      "id" : 120055691,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-07-09T16:18:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120055691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Thanks for the review @sipa.  I commented on IRC, but I think the updateDependentPriorities is correct, I don't think its doing any redundant work.  \r\nHowever in trying to implement your consistency check I definitely uncovered several bugs.  Will push a fix hopefully tomorrow.\r\n",
      "created_at" : "2015-07-09T21:41:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-120151366",
      "id" : 120151366,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-07-09T21:41:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120151366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "OK, fixed some bugs brought out by the consistency check and added said check.\r\n",
      "created_at" : "2015-07-10T16:14:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-120448782",
      "id" : 120448782,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-07-10T16:14:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120448782",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "So, let's assume that all blocks contain 30KB of priority txs. At 1cent/KB we'd be looking at $16k/year of tx fees avoided due to priority.\r\n\r\nMeanwhile, if we screw this we just need to lose 2.2 blocks to wipe out all these savings, which comes out of miners' pockets anyway.\r\n\r\nI'm with @jgarzik here: better to remove priority and simplify the codebase, particularly when other than Bitcoin Core nearly no wallets use it anyway. (Electrum is apparently an exception)\r\n\r\nIt's also notable how this patch will make \"priority camping\" easier: broadcast a broadcast a lowish priority tx, and wait until it gets confirmed, over and over again to waste priority on useless txs. I've seen people do this before when we had that bug where the same tx would be included multiple times; I don't doubt it'll happen again.",
      "created_at" : "2015-07-11T13:34:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-120618330",
      "id" : 120618330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-07-11T13:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/120618330",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "This has been rebased.  \r\nIt's important to have a quick priority calculation for running CreateNewBlock.\r\nIf we want to use the current definition of priority, then I think logic like that in this pull is important to make calculating priority on the fly not require looking up inputs.",
      "created_at" : "2015-11-03T02:25:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-153219655",
      "id" : 153219655,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-11-03T02:25:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/153219655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "An alternative to this pull would be to redefine priority to only consist of coins that were in-chain at the time a tx was received in the mempool.  That's basically just a subset of this pull without the UpdateDependentPriorities and UpdateCachedPriority functionality.",
      "created_at" : "2015-11-05T20:09:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-154176129",
      "id" : 154176129,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-11-05T20:09:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154176129",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "@morcos could you please elaborate on:\r\n\r\n> But this should fix the CTxMemPoolEntry::GetPriority calculation",
      "created_at" : "2015-11-05T22:19:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-154213333",
      "id" : 154213333,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-11-05T22:19:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/154213333",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6357#discussion_r44546370"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44546370"
         }
      },
      "body" : "Style nit: https://github.com/bitcoin/bitcoin/blob/master/src/.clang-format#L41",
      "commit_id" : "6bfccf743a44040637e364304893adca852e6acc",
      "created_at" : "2015-11-11T15:44:40Z",
      "diff_hunk" : "@@ -229,8 +229,9 @@ bool CCoinsViewCache::HaveInputs(const CTransaction& tx) const\n     return true;\n }\n \n-double CCoinsViewCache::GetPriority(const CTransaction &tx, int nHeight) const\n+double CCoinsViewCache::GetPriority(const CTransaction &tx, int nHeight, CAmount &inChainInputValue) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#discussion_r44546370",
      "id" : 44546370,
      "original_commit_id" : "6bfccf743a44040637e364304893adca852e6acc",
      "original_position" : 5,
      "path" : "src/coins.cpp",
      "position" : 5,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6357",
      "updated_at" : "2015-11-11T15:44:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44546370",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "Concept ACK, although I agree it would be much simpler to just remove the reserved space and all its logic. I believe that would simplify many mempool limiting, RBF or policy-encapsulation related patches. If a competitor PR that removes the reserved space is created, I will try to utACK that.",
      "created_at" : "2015-11-11T16:09:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-155829381",
      "id" : 155829381,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-11-11T16:09:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155829381",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@dcousens See #6292.  The existing calculation in CTxMemPoolEntry is broken.  It assumes all coins the tx is spending are aging, even unconfirmed ones.",
      "created_at" : "2015-11-12T20:35:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-156226431",
      "id" : 156226431,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-11-12T20:35:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156226431",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "@morcos I was working on a patch to CNB that appears to be very similar to this one except written for BitcoinXT, and consequently without all of the new mempool refactoring stuff that you guys have been done (which is great (except for the eviction policy), and which I intended to sort through and pull eventually). I haven't had a chance to review this in detail, but I have a few comments which are based on what I've seen in the old code and not based on what you've done. It looks like you're quite a bit ahead of me, though, so I apologize if my suggestions seem outdated.\r\n\r\nTestBlockValidity on the block template is mostly redundant. Blocks should be validated after having been returned from the miner/poolserver in the submitblock rpc because there is no assurance that the poolserver has not modified the blocks (like p2pool does) and accidentally broken something. My strategy (which I didn't finish implementing) was to take a timestamp the first time CNB is run, and to execute TestBlockValidity synchronously in CNB for 1 hour after that timestamp. After that, exec TBV in a background thread after sending the temple to the miner. If TBV fails once, then return to executing it synchronously before sending the template to the miner. This method runs the risk of allowing the miner to send out an invalid block under very rare circumstances, which I think is fine. Even sending out an invalid block under semi-common circumstances shouldn't be a problem. Yes, SPV mining blah blah, but even SPV miners should be verifying the chain they're working on in the background, and I think/hope the BIP66 soft fork fiasco taught them that they will lose money if they don't. I'll leave it to the rest of you to decide if this approach is safe enough.\r\n\r\nYou probably know this, but CheckInputs() is really slow, but only because it does ECDSA verifications. If you set it to not verify signatures (setting one of the arguments to false), it's 100x faster, but then you have to watch out for a corner case with reorgs that end up with locktimes.\r\n\r\nYou can keep dPriority and fees both if you create a means of interconverting between the two. My preferred method for doing this is by assigning weighting to the different metrics based on their normalized score. For example, if the average transaction feerate is 1 and the average transaction priority is 5000, and you want your transactions to be ordered 95% according to fee, then you could sort them according to (feerate/(1*0.95) + dPriority/(5000*0.05)). Then if a miner wants to change their policy, all they change is that weighting. It's also a more efficient an algorithm in terms of the total priority and total fees in the block; on average, this algorithm will produce higher average block fees and priority than an algorithm that evaluates each transaction on only one criteria per pass through the mempool and makes two passes.\r\n\r\nThe first CNB call after a new block is found is much slower than all subsequent CNB calls for that block. This is due to the CCoinsViewCache objects being cold, especially pcoinsTip. Performance is much improved if you set dbcache=2500 or something else large enough for the UTXO to fit in RAM. The algorithm for choosing the amount of RAM allocated to UTXO based on the total dbcache setting could probably use some tweaking, as I think it does not give enough to UTXO. It may also be a good idea to make a call to GBT bypass or change the dbcache setting, possibly by adding another command-line option like miningutxocache which would increase the available utxo cache if the node is mining.\r\n\r\nSome relevant threads from the bitcoinxt list:\r\n\r\nhttps://groups.google.com/forum/#!topic/bitcoin-xt/e2SbLuMyw8s\r\n\r\nhttps://groups.google.com/forum/#!topic/bitcoin-xt/9Y1kUrqW1rk\r\n\r\nhttps://groups.google.com/forum/#!topic/bitcoin-xt/NRre7ZbG66U\r\n\r\n",
      "created_at" : "2015-11-12T22:46:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-156261324",
      "id" : 156261324,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-11-12T22:50:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156261324",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11898859?v=3",
         "events_url" : "https://api.github.com/users/jtoomim/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtoomim/followers",
         "following_url" : "https://api.github.com/users/jtoomim/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtoomim/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtoomim",
         "id" : 11898859,
         "login" : "jtoomim",
         "organizations_url" : "https://api.github.com/users/jtoomim/orgs",
         "received_events_url" : "https://api.github.com/users/jtoomim/received_events",
         "repos_url" : "https://api.github.com/users/jtoomim/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtoomim/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtoomim/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtoomim"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6357#discussion_r44728833"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6357"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44728833"
         }
      },
      "body" : "Style nit :)",
      "commit_id" : "6bfccf743a44040637e364304893adca852e6acc",
      "created_at" : "2015-11-12T23:05:42Z",
      "diff_hunk" : "@@ -127,6 +141,20 @@ struct set_dirty\n         { e.SetDirty(); }\n };\n \n+struct update_priority\n+{\n+    update_priority(unsigned int _height, CAmount _value) :\n+        height(_height), value(_value)\n+    {}\n+\n+    void operator() (CTxMemPoolEntry &e)\n+    { e.UpdateCachedPriority(height, value); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#discussion_r44728833",
      "id" : 44728833,
      "original_commit_id" : "6bfccf743a44040637e364304893adca852e6acc",
      "original_position" : 55,
      "path" : "src/txmempool.h",
      "position" : 55,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6357",
      "updated_at" : "2015-11-12T23:05:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44728833",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Rebased this off of #7008 so it is easier to make decisions on them independently.",
      "created_at" : "2015-11-14T19:02:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6357#issuecomment-156734245",
      "id" : 156734245,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6357",
      "updated_at" : "2015-11-14T19:02:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156734245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   }
]
