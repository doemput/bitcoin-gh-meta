[
   {
      "body" : "Here is a categorized list of the commits:\r\n* P2P/node/consensus (https://github.com/sipa/bitcoin/compare/4182520...7080d47)\r\n  * 8199125 BIP144: Serialization, hashes, relay (sender side)\r\n  * 04dd13a BIP141: Witness program\r\n  * 1fff664 BIP141: Commitment structure and deployment\r\n  * 902c279 BIP144: Handshake and relay (receiver side)\r\n  * 113b3e5 Refactor script validation to observe amounts\r\n  * 1f5bb93 BIP143: Verification logic\r\n  * 87252e9 [RPC] Return witness data in blockchain RPCs\r\n  * 94c2abb BIP141: Other consensus critical limits, and BIP145\r\n  * f0b33a5 [libconsensus] Script verification API with amounts\r\n  * 76cb63b Add rewind logic to deal with post-fork software updates\r\n* wallet (https://github.com/sipa/bitcoin/compare/7080d47...8a5665a)\r\n  * b344e52 BIP143: Signing logic\r\n  * ddb6682 [RPC] Add wallet support for witness transactions (using P2SH)\r\n  * 0c57081 [RPC] signrawtransaction can sign P2WSH\r\n* tests (https://github.com/sipa/bitcoin/compare/8a5665a...37916d3)\r\n  * f7d6e0a [qa] Witness version 0 signing unit tests\r\n  * 2cbf540 [qa] Add transaction tests for segwit\r\n  * 29344db [qa] Add segwit support to script_tests\r\n  * ec00dc9 [qa] Autogeneration support for witness in script_tests\r\n  * e711429 [qa] Add rpc test for segwit\r\n  * 7d828f1 [qa] p2p segwit tests\r\n  * 0612ad6 [qa] script_tests: witness tests can specify tx amount\r\n  * 89179b0 [qa] Add GetTransactionSigOpCost unit tests\r\n* deployment (https://github.com/sipa/bitcoin/compare/37916d3...74300b9a5ed24e9f7d80ecc39d4e19690732ccbe)\r\n  * 74300b9 BIP9 parameters for testnet\r\n",
      "created_at" : "2016-06-06T13:06:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#issuecomment-223953094",
      "id" : 223953094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8149",
      "updated_at" : "2016-06-16T18:34:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223953094",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r65914300"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/65914300"
         }
      },
      "body" : "This `ret` looks like unused.",
      "commit_id" : "17389dc466f2acf8bfa64ce0416f3b5281445a5c",
      "created_at" : "2016-06-06T15:43:02Z",
      "diff_hunk" : "@@ -64,4 +65,179 @@ BOOST_AUTO_TEST_CASE(GetSigOpCount)\n     BOOST_CHECK_EQUAL(p2sh.GetSigOpCount(scriptSig2), 3U);\n }\n \n+/**\n+ * Verifies script execution of the zeroth scriptPubKey of tx output and\n+ * zeroth scriptSig and witness of tx input.\n+ */\n+ScriptError VerifyWithFlag(const CTransaction& output, const CMutableTransaction& input, int flags)\n+{\n+    ScriptError error;\n+    CTransaction inputi(input);\n+    bool ret = VerifyScript(inputi.vin[0].scriptSig, output.vout[0].scriptPubKey, inputi.wit.vtxinwit.size() > 0 ? &inputi.wit.vtxinwit[0].scriptWitness : NULL, flags, TransactionSignatureChecker(&inputi, 0, output.vout[0].nValue), &error);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r65914300",
      "id" : 65914300,
      "original_commit_id" : "17389dc466f2acf8bfa64ce0416f3b5281445a5c",
      "original_position" : 20,
      "path" : "src/test/sigopcount_tests.cpp",
      "position" : 20,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149",
      "updated_at" : "2016-06-06T15:43:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/65914300",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r66020110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66020110"
         }
      },
      "body" : "Please comment in #7910.",
      "commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "created_at" : "2016-06-07T07:14:49Z",
      "diff_hunk" : "@@ -64,4 +65,179 @@ BOOST_AUTO_TEST_CASE(GetSigOpCount)\n     BOOST_CHECK_EQUAL(p2sh.GetSigOpCount(scriptSig2), 3U);\n }\n \n+/**\n+ * Verifies script execution of the zeroth scriptPubKey of tx output and\n+ * zeroth scriptSig and witness of tx input.\n+ */\n+ScriptError VerifyWithFlag(const CTransaction& output, const CMutableTransaction& input, int flags)\n+{\n+    ScriptError error;\n+    CTransaction inputi(input);\n+    bool ret = VerifyScript(inputi.vin[0].scriptSig, output.vout[0].scriptPubKey, inputi.wit.vtxinwit.size() > 0 ? &inputi.wit.vtxinwit[0].scriptWitness : NULL, flags, TransactionSignatureChecker(&inputi, 0, output.vout[0].nValue), &error);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r66020110",
      "id" : 66020110,
      "original_commit_id" : "17389dc466f2acf8bfa64ce0416f3b5281445a5c",
      "original_position" : 20,
      "path" : "src/test/sigopcount_tests.cpp",
      "position" : 20,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149",
      "updated_at" : "2016-06-22T14:02:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66020110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Updated with a rebased/squashed version of the changes in #7910. The resulting tree should still be identical.",
      "created_at" : "2016-06-12T20:32:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#issuecomment-225458658",
      "id" : 225458658,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8149",
      "updated_at" : "2016-06-12T20:32:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/225458658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Updated again.",
      "created_at" : "2016-06-13T20:33:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#issuecomment-225699737",
      "id" : 225699737,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8149",
      "updated_at" : "2016-06-13T20:33:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/225699737",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "ACK 74300b9a5ed24e9f7d80ecc39d4e19690732ccbe",
      "created_at" : "2016-06-17T05:05:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#issuecomment-226681446",
      "id" : 226681446,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8149",
      "updated_at" : "2016-06-17T05:05:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/226681446",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "ACK 74300b9a5ed24e9f7d80ecc39d4e19690732ccbe (focused more on the scripting side, and tx signature v2, lightly reviewed the rest)",
      "created_at" : "2016-06-17T10:27:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#issuecomment-226735778",
      "id" : 226735778,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8149",
      "updated_at" : "2016-06-17T10:29:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/226735778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "Rebased on top of #8068 and #8179.\r\n\r\nNote that since there is currently no written-down specification for how segwit should interact with compact blocks, I've taken the conservative approach of disabling compact blocks whenever the segwit softfork is defined (in practice this means that compact blocks won't be used on testnet, but will be on mainnet).\r\n\r\nDefining how segwit + compact blocks work together should be trivial, but it shouldn't burden this PR and testing thereof.",
      "created_at" : "2016-06-22T14:08:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#issuecomment-227755007",
      "id" : 227755007,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8149",
      "updated_at" : "2016-06-22T15:55:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/227755007",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "will run #8149 node! finally!",
      "created_at" : "2016-06-24T09:36:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#issuecomment-228302453",
      "id" : 228302453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8149",
      "updated_at" : "2016-06-24T09:36:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228302453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4107993?v=3",
         "events_url" : "https://api.github.com/users/sneurlax/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sneurlax/followers",
         "following_url" : "https://api.github.com/users/sneurlax/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sneurlax/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sneurlax",
         "id" : 4107993,
         "login" : "sneurlax",
         "organizations_url" : "https://api.github.com/users/sneurlax/orgs",
         "received_events_url" : "https://api.github.com/users/sneurlax/received_events",
         "repos_url" : "https://api.github.com/users/sneurlax/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sneurlax/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sneurlax/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sneurlax"
      }
   },
   {
      "body" : "ACK f852813",
      "created_at" : "2016-06-24T14:33:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#issuecomment-228362360",
      "id" : 228362360,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8149",
      "updated_at" : "2016-06-24T14:33:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228362360",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Exciting release! Great job :)",
      "created_at" : "2016-06-24T20:16:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#issuecomment-228451450",
      "id" : 228451450,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8149",
      "updated_at" : "2016-06-24T20:16:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228451450",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/169619?v=3",
         "events_url" : "https://api.github.com/users/skaag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/skaag/followers",
         "following_url" : "https://api.github.com/users/skaag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/skaag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/skaag",
         "id" : 169619,
         "login" : "skaag",
         "organizations_url" : "https://api.github.com/users/skaag/orgs",
         "received_events_url" : "https://api.github.com/users/skaag/received_events",
         "repos_url" : "https://api.github.com/users/skaag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/skaag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/skaag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/skaag"
      }
   },
   {
      "body" : "utACK 070dbc4 (w/ non-intensive testing done)\r\n",
      "created_at" : "2016-06-26T14:03:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#issuecomment-228602955",
      "id" : 228602955,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8149",
      "updated_at" : "2016-06-26T14:03:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/228602955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "utACK consensus critical parts, https://github.com/bitcoin/bitcoin/pull/8149/commits/070dbc48a9338375fd7ce0a86ee05b476cf487a4\r\n\r\nI wrote up an in-depth review here: https://petertodd.org/2016/segwit-consensus-critical-code-review\r\n\r\nNote that I think we may have an issue with the P2P code with the (non-consensus) handling of transactions; see the last part of my writeup: https://petertodd.org/2016/segwit-consensus-critical-code-review#peer-to-peer-networking",
      "created_at" : "2016-06-28T13:41:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#issuecomment-229052191",
      "id" : 229052191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8149",
      "updated_at" : "2016-06-28T13:41:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/229052191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76172305"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76172305"
         }
      },
      "body" : "How does SegWit impact on the usefulness of Compact Blocks?",
      "commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "created_at" : "2016-08-25T02:35:48Z",
      "diff_hunk" : "@@ -470,6 +473,10 @@ void UpdateBlockAvailability(NodeId nodeid, const uint256 &hash) {\n }\n \n void MaybeSetPeerAsAnnouncingHeaderAndIDs(const CNodeState* nodestate, CNode* pfrom) {\n+    if (nLocalServices & NODE_WITNESS) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76172305",
      "id" : 76172305,
      "original_commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "original_position" : 21,
      "path" : "src/main.cpp",
      "position" : 21,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149",
      "updated_at" : "2016-08-25T02:35:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76172305",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76187086"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76187086"
         }
      },
      "body" : "@rebroad Read BIP 141, 143, 144.\n\nYes, segregated witness full nodes only download from other witness nodes.\nThere is no way around that: they require the witness data to be able to\nverify blocks, and non-witness nodes cannot provide that.\n\nSee #8393 for how to make compact blocks support segregated witness.\n",
      "commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "created_at" : "2016-08-25T06:32:22Z",
      "diff_hunk" : "@@ -470,6 +473,10 @@ void UpdateBlockAvailability(NodeId nodeid, const uint256 &hash) {\n }\n \n void MaybeSetPeerAsAnnouncingHeaderAndIDs(const CNodeState* nodestate, CNode* pfrom) {\n+    if (nLocalServices & NODE_WITNESS) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76187086",
      "id" : 76187086,
      "original_commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "original_position" : 21,
      "path" : "src/main.cpp",
      "position" : 21,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149",
      "updated_at" : "2016-08-25T06:32:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76187086",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76216046"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76216046"
         }
      },
      "body" : "Ok, I have to ask (as I've been wondering about this for a while), but what is the purpose of this GetId() function? Why use it instead of the variable id?",
      "commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "created_at" : "2016-08-25T10:10:41Z",
      "diff_hunk" : "@@ -4684,6 +4940,14 @@ void static ProcessGetData(CNode* pfrom, const Consensus::Params& consensusParam\n     }\n }\n \n+uint32_t GetFetchFlags(CNode* pfrom, CBlockIndex* pprev, const Consensus::Params& chainparams) {\n+    uint32_t nFetchFlags = 0;\n+    if (IsWitnessEnabled(pprev, chainparams) && State(pfrom->GetId())->fHaveWitness) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76216046",
      "id" : 76216046,
      "original_commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "original_position" : 644,
      "path" : "src/main.cpp",
      "position" : 644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149",
      "updated_at" : "2016-08-25T10:10:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76216046",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76216704"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76216704"
         }
      },
      "body" : "http://stackoverflow.com/questions/1568091/why-use-getters-and-setters\r\n",
      "commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "created_at" : "2016-08-25T10:13:27Z",
      "diff_hunk" : "@@ -4684,6 +4940,14 @@ void static ProcessGetData(CNode* pfrom, const Consensus::Params& consensusParam\n     }\n }\n \n+uint32_t GetFetchFlags(CNode* pfrom, CBlockIndex* pprev, const Consensus::Params& chainparams) {\n+    uint32_t nFetchFlags = 0;\n+    if (IsWitnessEnabled(pprev, chainparams) && State(pfrom->GetId())->fHaveWitness) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76216704",
      "id" : 76216704,
      "original_commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "original_position" : 644,
      "path" : "src/main.cpp",
      "position" : 644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149",
      "updated_at" : "2016-08-25T10:13:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76216704",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76397641"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76397641"
         }
      },
      "body" : "How is this useful? `(pfrom->nServices & NODE_WITNESS)` is 33 characters, `State(pfrom->GetId())->fHaveWitness` is 35 characters. It's easier and quicker and uses up less memory to type the thing this variable returns.",
      "commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "created_at" : "2016-08-26T10:24:02Z",
      "diff_hunk" : "@@ -4790,6 +5054,12 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n \n         pfrom->fClient = !(pfrom->nServices & NODE_NETWORK);\n \n+        if((pfrom->nServices & NODE_WITNESS))\n+        {\n+            LOCK(cs_main);\n+            State(pfrom->GetId())->fHaveWitness = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76397641",
      "id" : 76397641,
      "original_commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "original_position" : 660,
      "path" : "src/main.cpp",
      "position" : 660,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149",
      "updated_at" : "2016-08-26T10:25:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76397641",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76398254"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76398254"
         }
      },
      "body" : "Maybe I'm misreading the code, but once SegWit activates then where is the code that downloads blocks upon receiving a block inv? Block invs are no longer responded to?",
      "commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "created_at" : "2016-08-26T10:30:13Z",
      "diff_hunk" : "@@ -5016,8 +5292,10 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n                     pfrom->PushMessage(NetMsgType::GETHEADERS, chainActive.GetLocator(pindexBestHeader), inv.hash);\n                     CNodeState *nodestate = State(pfrom->GetId());\n                     if (CanDirectFetch(chainparams.GetConsensus()) &&\n-                        nodestate->nBlocksInFlight < MAX_BLOCKS_IN_TRANSIT_PER_PEER) {\n-                        if (nodestate->fProvidesHeaderAndIDs)\n+                        nodestate->nBlocksInFlight < MAX_BLOCKS_IN_TRANSIT_PER_PEER &&\n+                        (!IsWitnessEnabled(chainActive.Tip(), chainparams.GetConsensus()) || State(pfrom->GetId())->fHaveWitness)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76398254",
      "id" : 76398254,
      "original_commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "original_position" : 698,
      "path" : "src/main.cpp",
      "position" : 698,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149",
      "updated_at" : "2016-08-26T10:30:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76398254",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76398705"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76398705"
         }
      },
      "body" : "Read the part of the line after `||`.",
      "commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "created_at" : "2016-08-26T10:34:35Z",
      "diff_hunk" : "@@ -5016,8 +5292,10 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n                     pfrom->PushMessage(NetMsgType::GETHEADERS, chainActive.GetLocator(pindexBestHeader), inv.hash);\n                     CNodeState *nodestate = State(pfrom->GetId());\n                     if (CanDirectFetch(chainparams.GetConsensus()) &&\n-                        nodestate->nBlocksInFlight < MAX_BLOCKS_IN_TRANSIT_PER_PEER) {\n-                        if (nodestate->fProvidesHeaderAndIDs)\n+                        nodestate->nBlocksInFlight < MAX_BLOCKS_IN_TRANSIT_PER_PEER &&\n+                        (!IsWitnessEnabled(chainActive.Tip(), chainparams.GetConsensus()) || State(pfrom->GetId())->fHaveWitness)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76398705",
      "id" : 76398705,
      "original_commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "original_position" : 698,
      "path" : "src/main.cpp",
      "position" : 698,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149",
      "updated_at" : "2016-08-26T10:34:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76398705",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76400290"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76400290"
         }
      },
      "body" : "Sorry, it's taking me a while to get my head around this - I keep making the assumption that most nodes won't be running SegWit for some reason!!",
      "commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "created_at" : "2016-08-26T10:51:44Z",
      "diff_hunk" : "@@ -5016,8 +5292,10 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n                     pfrom->PushMessage(NetMsgType::GETHEADERS, chainActive.GetLocator(pindexBestHeader), inv.hash);\n                     CNodeState *nodestate = State(pfrom->GetId());\n                     if (CanDirectFetch(chainparams.GetConsensus()) &&\n-                        nodestate->nBlocksInFlight < MAX_BLOCKS_IN_TRANSIT_PER_PEER) {\n-                        if (nodestate->fProvidesHeaderAndIDs)\n+                        nodestate->nBlocksInFlight < MAX_BLOCKS_IN_TRANSIT_PER_PEER &&\n+                        (!IsWitnessEnabled(chainActive.Tip(), chainparams.GetConsensus()) || State(pfrom->GetId())->fHaveWitness)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r76400290",
      "id" : 76400290,
      "original_commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "original_position" : 698,
      "path" : "src/main.cpp",
      "position" : 698,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149",
      "updated_at" : "2016-08-26T10:51:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76400290",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r79103769"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/79103769"
         }
      },
      "body" : "So witness nodes won't make outbound connections to non-witness nodes? This puts a reliance on witness nodes that can receive inbound connections as these will be the only witness nodes talking to the non-witness nodes.",
      "commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "created_at" : "2016-09-16T04:05:51Z",
      "diff_hunk" : "@@ -1377,6 +1386,18 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n         }\n     }\n \n+    if (Params().GetConsensus().vDeployments[Consensus::DEPLOYMENT_SEGWIT].nTimeout != 0) {\n+        // Only advertize witness capabilities if they have a reasonable start time.\n+        // This allows us to have the code merged without a defined softfork, by setting its\n+        // end time to 0.\n+        // Note that setting NODE_WITNESS is never required: the only downside from not\n+        // doing so is that after activation, no upgraded nodes will fetch from you.\n+        nLocalServices = ServiceFlags(nLocalServices | NODE_WITNESS);\n+        // Only care about others providing witness capabilities if there is a softfork\n+        // defined.\n+        nRelevantServices = ServiceFlags(nRelevantServices | NODE_WITNESS);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r79103769",
      "id" : 79103769,
      "original_commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "original_position" : 36,
      "path" : "src/init.cpp",
      "position" : 36,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149",
      "updated_at" : "2016-09-16T04:05:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/79103769",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r86138998"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86138998"
         }
      },
      "body" : "I understand this as: if we have a block hash that the caller sent us in our `mapBlockIndex` that is not in the main chain, but is a descendant of our best block, then send our best block. Is there a case where our `mapBlockIndex` knows about a block that is higher than the tip of our chain? Are these data structures not kept in sync so that all the blocks in `mapBlockIndex` are also in `chain`?",
      "commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "created_at" : "2016-11-02T13:23:26Z",
      "diff_hunk" : "@@ -655,6 +662,9 @@ CBlockIndex* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& loc\n             CBlockIndex* pindex = (*mi).second;\n             if (chain.Contains(pindex))\n                 return pindex;\n+            if (pindex->GetAncestor(chain.Height()) == chain.Tip()) {\n+                return chain.Tip();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#discussion_r86138998",
      "id" : 86138998,
      "original_commit_id" : "f8528134fc188abc5c7175a19680206964a8fade",
      "original_position" : 33,
      "path" : "src/main.cpp",
      "position" : 33,
      "pull_request_review_id" : 6810968,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8149",
      "updated_at" : "2016-11-02T13:23:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86138998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/904557?v=3",
         "events_url" : "https://api.github.com/users/xenog/events{/privacy}",
         "followers_url" : "https://api.github.com/users/xenog/followers",
         "following_url" : "https://api.github.com/users/xenog/following{/other_user}",
         "gists_url" : "https://api.github.com/users/xenog/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/xenog",
         "id" : 904557,
         "login" : "xenog",
         "organizations_url" : "https://api.github.com/users/xenog/orgs",
         "received_events_url" : "https://api.github.com/users/xenog/received_events",
         "repos_url" : "https://api.github.com/users/xenog/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/xenog/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/xenog/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/xenog"
      }
   },
   {
      "body" : "Since headers first sync (v0.10.0) we very regularly have blocks in\nmapBlockIndex that are not yet in the main chain. We first receive them as\nheaders, validate them and add them to mapBlockIndex. Then we use this\ninformation to determine which full blocks to download from which peers,\nand when we have them, they become candidates to be added to the main chain.\n",
      "created_at" : "2016-11-02T16:29:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#issuecomment-257919334",
      "id" : 257919334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8149",
      "updated_at" : "2016-11-02T16:29:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257919334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa @xenog: FYI the specific change to FindForkInGlobalIndex() was precipitated by the introduction of RewindBlockIndex(), which causes nodes that upgrade after segwit activation to disconnect blocks back to the activation point, so that the witness-version of those blocks could then be redownloaded and reconnected.  During that window, mapBlockIndex will be (far) ahead of chainActive.Tip().\r\n\r\nIf I remember correctly, the wallet rescan logic uses FindForkInGlobalIndex, and prior to this change, it might return a block older than was necessary (which could be a problem for pruning nodes).",
      "created_at" : "2016-11-02T17:45:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8149#issuecomment-257943026",
      "id" : 257943026,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8149",
      "updated_at" : "2016-11-02T17:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257943026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   }
]
