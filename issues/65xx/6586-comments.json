[
   {
      "body" : "This would still require some user configuration. Tor control ports can be unsecured (any local process can connect and issue commands), password protected, or protected with a cookie file (any process that can read the cookie file can connect and issue commands).\r\n\r\nI'm going to try to implement the simplest case, connecting to an unsecured control port running on the default port. After that it'll just be a matter of adding flags to handle more complicated configurations. (Non-default ports, password/cookie file protection, etc.)",
      "created_at" : "2015-08-25T21:10:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6586#issuecomment-134742890",
      "id" : 134742890,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6586",
      "updated_at" : "2015-08-25T21:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/134742890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1945?v=3",
         "events_url" : "https://api.github.com/users/casey/events{/privacy}",
         "followers_url" : "https://api.github.com/users/casey/followers",
         "following_url" : "https://api.github.com/users/casey/following{/other_user}",
         "gists_url" : "https://api.github.com/users/casey/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/casey",
         "id" : 1945,
         "login" : "casey",
         "organizations_url" : "https://api.github.com/users/casey/orgs",
         "received_events_url" : "https://api.github.com/users/casey/received_events",
         "repos_url" : "https://api.github.com/users/casey/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/casey/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/casey/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/casey"
      }
   },
   {
      "body" : "I notice that `boost::asio` is only used in bitcoin-cli and the rpc server. Is this a conscious choice, meaning that I should avoid boost::asio for code which is destined for bitcoind?",
      "created_at" : "2015-08-26T04:52:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6586#issuecomment-134831396",
      "id" : 134831396,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6586",
      "updated_at" : "2015-08-26T04:52:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/134831396",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1945?v=3",
         "events_url" : "https://api.github.com/users/casey/events{/privacy}",
         "followers_url" : "https://api.github.com/users/casey/followers",
         "following_url" : "https://api.github.com/users/casey/following{/other_user}",
         "gists_url" : "https://api.github.com/users/casey/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/casey",
         "id" : 1945,
         "login" : "casey",
         "organizations_url" : "https://api.github.com/users/casey/orgs",
         "received_events_url" : "https://api.github.com/users/casey/received_events",
         "repos_url" : "https://api.github.com/users/casey/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/casey/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/casey/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/casey"
      }
   },
   {
      "body" : "@casey not necessarily. If you know the control port, generally 127.0.0.1:9051, you can send a \"PROTOCOLINFO\" command to find out what auth is expected and what cookie file. Tor Browser Bundle is set up using coookie authentication by default. Though I'd say the user does have at least to give an 'OK' to do this.\r\n\r\nOnly in the case of HashedPassword, credentials have to be manually configured.\r\n\r\nI have a base implementation based on libevent (from #5677) here: https://github.com/laanwj/bitcoin/blob/2015_08_tor_hs/src/torcontrol.cpp\r\nIt authenticates and requests the hidden service, ~~but does not actually integrate into bitcoin yet ;)~~",
      "created_at" : "2015-08-26T06:28:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6586#issuecomment-134855671",
      "id" : 134855671,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6586",
      "updated_at" : "2015-08-26T07:28:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/134855671",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Ahh, okay, I guess you've got it covered then. I'm assuming that the best thing to do in that case is to just wait until #5677 lands and then merge in your version.",
      "created_at" : "2015-08-26T20:09:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6586#issuecomment-135156774",
      "id" : 135156774,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6586",
      "updated_at" : "2015-08-26T20:09:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/135156774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1945?v=3",
         "events_url" : "https://api.github.com/users/casey/events{/privacy}",
         "followers_url" : "https://api.github.com/users/casey/followers",
         "following_url" : "https://api.github.com/users/casey/following{/other_user}",
         "gists_url" : "https://api.github.com/users/casey/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/casey",
         "id" : 1945,
         "login" : "casey",
         "organizations_url" : "https://api.github.com/users/casey/orgs",
         "received_events_url" : "https://api.github.com/users/casey/received_events",
         "repos_url" : "https://api.github.com/users/casey/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/casey/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/casey/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/casey"
      }
   },
   {
      "body" : "See https://github.com/laanwj/bitcoin/tree/2015_08_tor_hs . Going to PR this soon, but I first want #5677 in due to libevent.\r\n\r\nBTW @petertodd @isislovecruft any recommendations to check `COOKIEFILE` from `PROTOCOLINFO`? would it make sense to check that the cookie filename ends with `control_auth_cookie`? I'm mostly afraid of \"hello, I'm listening on the control port and pretend to be Tor, hand me your wallet\" kind of attacks.\r\n",
      "created_at" : "2015-08-31T11:02:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6586#issuecomment-136335740",
      "id" : 136335740,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6586",
      "updated_at" : "2015-08-31T11:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/136335740",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj HmmÃ¢ÂÂ¦ checking the filename might be a little klugey, since I would assume some locally installed malware that's pretending to be Tor could might be capable of doing some workaround, e.g. symlinking `evil_control_auth_cookie` to `wallet.dat`, and then asking you to read it. You could use `SAFECOOKIE` authentication, and then you'd have the guarantee that whatever is listening is also able to read the contents of the cookie file. (The protocol for using `SAFECOOKIE` is described [here](https://gitweb.torproject.org/torspec.git/tree/control-spec.txt?id=09ff9e20#n1211).)",
      "created_at" : "2015-08-31T22:43:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6586#issuecomment-136520077",
      "id" : 136520077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6586",
      "updated_at" : "2015-08-31T22:51:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/136520077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/907241?v=3",
         "events_url" : "https://api.github.com/users/isislovecruft/events{/privacy}",
         "followers_url" : "https://api.github.com/users/isislovecruft/followers",
         "following_url" : "https://api.github.com/users/isislovecruft/following{/other_user}",
         "gists_url" : "https://api.github.com/users/isislovecruft/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/isislovecruft",
         "id" : 907241,
         "login" : "isislovecruft",
         "organizations_url" : "https://api.github.com/users/isislovecruft/orgs",
         "received_events_url" : "https://api.github.com/users/isislovecruft/received_events",
         "repos_url" : "https://api.github.com/users/isislovecruft/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/isislovecruft/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/isislovecruft/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/isislovecruft"
      }
   },
   {
      "body" : "Ah yes, I hadn't thought about symlinks yet. Good point.\r\n\r\nI'll take a look at SAFECOOKIE.",
      "created_at" : "2015-09-04T14:09:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6586#issuecomment-137746862",
      "id" : 137746862,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6586",
      "updated_at" : "2015-09-04T14:09:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137746862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I had also missed this in my last read of the spec:\r\n```\r\n  All authentication cookies are 32 bytes long.  Controllers MUST NOT\r\n  use the contents of a non-32-byte-long file as an authentication\r\n  cookie.\r\n```\r\nRestricting the cookie files to 32 byte files at least avoids passing the wallet. Sure, there may still be other 32 byte files worth pilfering, SAFECOOKIE is better.",
      "created_at" : "2015-09-04T16:41:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6586#issuecomment-137787073",
      "id" : 137787073,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6586",
      "updated_at" : "2015-09-04T16:41:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/137787073",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Solved by #6639",
      "created_at" : "2015-11-16T15:23:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6586#issuecomment-157065430",
      "id" : 157065430,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6586",
      "updated_at" : "2015-11-16T15:23:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/157065430",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
