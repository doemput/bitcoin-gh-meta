[
   {
      "body" : "What version of Boost and operating system?",
      "created_at" : "2015-08-10T17:25:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-129537184",
      "id" : 129537184,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-08-10T17:25:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/129537184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "Can you \"info threads\" and \"bt\" from more than just the one thread?",
      "created_at" : "2015-08-13T11:18:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-130625501",
      "id" : 130625501,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-08-13T11:18:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/130625501",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Oh, and can you reproduce with -DDEBUG_LOCKORDER?",
      "created_at" : "2015-08-13T11:19:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-130626383",
      "id" : 130626383,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-08-13T11:19:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/130626383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@posita: I think I observed this/a related issue some weeks ago, too: https://github.com/bitcoin/bitcoin/pull/6278#issuecomment-112802113\r\n\r\nBack then I didn't strip the files.",
      "created_at" : "2015-08-14T02:17:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-130926347",
      "id" : 130926347,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-08-14T02:53:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/130926347",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5836089?v=3",
         "events_url" : "https://api.github.com/users/dexX7/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dexX7/followers",
         "following_url" : "https://api.github.com/users/dexX7/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dexX7/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dexX7",
         "id" : 5836089,
         "login" : "dexX7",
         "organizations_url" : "https://api.github.com/users/dexX7/orgs",
         "received_events_url" : "https://api.github.com/users/dexX7/received_events",
         "repos_url" : "https://api.github.com/users/dexX7/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dexX7/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dexX7/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dexX7"
      }
   },
   {
      "body" : "> What version of Boost and operating system?\r\n\r\nDebian stable (\"jessie\") w/ Boost 1.55.0.2:\r\n\r\n```\r\nroot@f7c305516d72:/# uname -a\r\nLinux f7c305516d72 4.0.7-boot2docker #1 SMP Wed Jul 15 00:01:41 UTC 2015 x86_64 GNU/Linux\r\nroot@f7c305516d72:/# cat /etc/debian_version\r\n8.1\r\nroot@f7c305516d72:/# dpkg -l libboost-all-dev\r\nDesired=Unknown/Install/Remove/Purge/Hold\r\n| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\r\n|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)\r\n||/ Name                             Version               Architecture          Description\r\n+++-================================-=====================-=====================-=====================================================================\r\nii  libboost-all-dev                 1.55.0.2              amd64                 Boost C++ Libraries development files (ALL) (default version)\r\n```",
      "created_at" : "2015-08-14T04:02:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-130959029",
      "id" : 130959029,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-08-14T04:11:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/130959029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/222581?v=3",
         "events_url" : "https://api.github.com/users/posita/events{/privacy}",
         "followers_url" : "https://api.github.com/users/posita/followers",
         "following_url" : "https://api.github.com/users/posita/following{/other_user}",
         "gists_url" : "https://api.github.com/users/posita/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/posita",
         "id" : 222581,
         "login" : "posita",
         "organizations_url" : "https://api.github.com/users/posita/orgs",
         "received_events_url" : "https://api.github.com/users/posita/received_events",
         "repos_url" : "https://api.github.com/users/posita/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/posita/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/posita/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/posita"
      }
   },
   {
      "body" : "> Can you \"info threads\" and \"bt\" from more than just the one thread?\r\n\r\n```\r\nroot@f7c305516d72:/# gdb -s .../bin/test_bitcoin.debug .../bin/test_bitcoin <PID>\r\n...\r\n(gdb) info threads\r\n  Id   Target Id         Frame\r\n  4    Thread 0x7f6084889700 (LWP 85) \"test_bitcoin\" 0x00007f608905308f in pthread_cond_wait@@GLIBC_2.3.2 ()\r\n   from /lib/x86_64-linux-gnu/libpthread.so.0\r\n  3    Thread 0x7f6077fff700 (LWP 86) \"test_bitcoin\" 0x00007f608905308f in pthread_cond_wait@@GLIBC_2.3.2 ()\r\n   from /lib/x86_64-linux-gnu/libpthread.so.0\r\n  2    Thread 0x7f60777fe700 (LWP 87) \"test_bitcoin\" 0x00007f608905308f in pthread_cond_wait@@GLIBC_2.3.2 ()\r\n   from /lib/x86_64-linux-gnu/libpthread.so.0\r\n* 1    Thread 0x7f608bbf0740 (LWP 30) \"test_bitcoin\" 0x00007f608905308f in pthread_cond_wait@@GLIBC_2.3.2 ()\r\n   from /lib/x86_64-linux-gnu/libpthread.so.0\r\n(gdb) thread apply all bt\r\n\r\nThread 4 (Thread 0x7f6084889700 (LWP 85)):\r\n#0  0x00007f608905308f in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/x86_64-linux-gnu/libpthread.so.0\r\n#1  0x00007f608b568a9b in boost::condition_variable::wait (this=0x7ffe01924da0, m=...) at /usr/include/boost/thread/pthread/condition_variable.hpp:73\r\n#2  0x00007f608b733976 in CScheduler::serviceQueue (this=0x7ffe01924d70) at scheduler.cpp:40\r\n#3  0x00007f608a9b4aea in ?? () from /usr/lib/x86_64-linux-gnu/libboost_thread.so.1.55.0\r\n#4  0x00007f608904f0a4 in start_thread () from /lib/x86_64-linux-gnu/libpthread.so.0\r\n#5  0x00007f6088d8404d in clone () from /lib/x86_64-linux-gnu/libc.so.6\r\n\r\nThread 3 (Thread 0x7f6077fff700 (LWP 86)):\r\n#0  0x00007f608905308f in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/x86_64-linux-gnu/libpthread.so.0\r\n#1  0x00007f608b568a9b in boost::condition_variable::wait (this=0x7ffe01924da0, m=...) at /usr/include/boost/thread/pthread/condition_variable.hpp:73\r\n#2  0x00007f608b733976 in CScheduler::serviceQueue (this=0x7ffe01924d70) at scheduler.cpp:40\r\n#3  0x00007f608a9b4aea in ?? () from /usr/lib/x86_64-linux-gnu/libboost_thread.so.1.55.0\r\n#4  0x00007f608904f0a4 in start_thread () from /lib/x86_64-linux-gnu/libpthread.so.0\r\n#5  0x00007f6088d8404d in clone () from /lib/x86_64-linux-gnu/libc.so.6\r\n\r\nThread 2 (Thread 0x7f60777fe700 (LWP 87)):\r\n#0  0x00007f608905308f in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/x86_64-linux-gnu/libpthread.so.0\r\n#1  0x00007f608b568a9b in boost::condition_variable::wait (this=0x7ffe01924da0, m=...) at /usr/include/boost/thread/pthread/condition_variable.hpp:73\r\n#2  0x00007f608b733976 in CScheduler::serviceQueue (this=0x7ffe01924d70) at scheduler.cpp:40\r\n#3  0x00007f608a9b4aea in ?? () from /usr/lib/x86_64-linux-gnu/libboost_thread.so.1.55.0\r\n#4  0x00007f608904f0a4 in start_thread () from /lib/x86_64-linux-gnu/libpthread.so.0\r\n#5  0x00007f6088d8404d in clone () from /lib/x86_64-linux-gnu/libc.so.6\r\n\r\nThread 1 (Thread 0x7f608bbf0740 (LWP 30)):\r\n#0  0x00007f608905308f in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/x86_64-linux-gnu/libpthread.so.0\r\n#1  0x00007f608b568a9b in boost::condition_variable::wait (this=0x7f608dc2e4e8, m=...) at /usr/include/boost/thread/pthread/condition_variable.hpp:73\r\n#2  0x00007f608a9b55ac in boost::thread::join_noexcept() () from /usr/lib/x86_64-linux-gnu/libboost_thread.so.1.55.0\r\n#3  0x00007f608b5693e6 in join (this=0x7f608dbcc170) at /usr/include/boost/thread/detail/thread.hpp:756\r\n#4  boost::thread_group::join_all (this=this@entry=0x7ffe01924e30) at /usr/include/boost/thread/detail/thread_group.hpp:118\r\n#5  0x00007f608b566c7e in scheduler_tests::manythreads::test_method (this=this@entry=0x7ffe01925b27) at test/scheduler_tests.cpp:109\r\n#6  0x00007f608b5670ce in scheduler_tests::manythreads_invoker () at test/scheduler_tests.cpp:43\r\n#7  0x00007f608b4e0bf7 in invoke<void (*)()> (this=<optimized out>, f=<optimized out>) at /usr/include/boost/test/utils/callback.hpp:56\r\n#8  boost::unit_test::ut_detail::callback0_impl_t<boost::unit_test::ut_detail::unused, void (*)()>::invoke (this=<optimized out>)\r\n    at /usr/include/boost/test/utils/callback.hpp:89\r\n#9  0x00007f608a55d8f1 in ?? () from /usr/lib/x86_64-linux-gnu/libboost_unit_test_framework.so.1.55.0\r\n#10 0x00007f608a5346de in boost::execution_monitor::catch_signals(boost::unit_test::callback0<int> const&) ()\r\n   from /usr/lib/x86_64-linux-gnu/libboost_unit_test_framework.so.1.55.0\r\n#11 0x00007f608a534f33 in boost::execution_monitor::execute(boost::unit_test::callback0<int> const&) ()\r\n   from /usr/lib/x86_64-linux-gnu/libboost_unit_test_framework.so.1.55.0\r\n#12 0x00007f608a55da05 in boost::unit_test::unit_test_monitor_t::execute_and_translate(boost::unit_test::test_case const&) ()\r\n   from /usr/lib/x86_64-linux-gnu/libboost_unit_test_framework.so.1.55.0\r\n#13 0x00007f608a5444af in boost::unit_test::framework_impl::visit(boost::unit_test::test_case const&) ()\r\n   from /usr/lib/x86_64-linux-gnu/libboost_unit_test_framework.so.1.55.0\r\n#14 0x00007f608a578a33 in boost::unit_test::traverse_test_tree(boost::unit_test::test_suite const&, boost::unit_test::test_tree_visitor&) ()\r\n   from /usr/lib/x86_64-linux-gnu/libboost_unit_test_framework.so.1.55.0\r\n#15 0x00007f608a578a33 in boost::unit_test::traverse_test_tree(boost::unit_test::test_suite const&, boost::unit_test::test_tree_visitor&) ()\r\n   from /usr/lib/x86_64-linux-gnu/libboost_unit_test_framework.so.1.55.0\r\n#16 0x00007f608a53f9fa in boost::unit_test::framework::run(unsigned long, bool) ()\r\n   from /usr/lib/x86_64-linux-gnu/libboost_unit_test_framework.so.1.55.0\r\n#17 0x00007f608a55b697 in boost::unit_test::unit_test_main(bool (*)(), int, char**) ()\r\n   from /usr/lib/x86_64-linux-gnu/libboost_unit_test_framework.so.1.55.0\r\n#18 0x00007f6088cbfb45 in __libc_start_main () from /lib/x86_64-linux-gnu/libc.so.6\r\n#19 0x00007f608b4c7b7e in _start ()\r\n...\r\n```\r\n\r\nSo it looks like [scheduler.cpp#L40](https://github.com/bitcoin/bitcoin/blob/v0.11.0/src/scheduler.cpp#L40)?",
      "created_at" : "2015-08-14T04:03:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-130959080",
      "id" : 130959080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-08-14T14:36:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/130959080",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/222581?v=3",
         "events_url" : "https://api.github.com/users/posita/events{/privacy}",
         "followers_url" : "https://api.github.com/users/posita/followers",
         "following_url" : "https://api.github.com/users/posita/following{/other_user}",
         "gists_url" : "https://api.github.com/users/posita/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/posita",
         "id" : 222581,
         "login" : "posita",
         "organizations_url" : "https://api.github.com/users/posita/orgs",
         "received_events_url" : "https://api.github.com/users/posita/received_events",
         "repos_url" : "https://api.github.com/users/posita/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/posita/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/posita/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/posita"
      }
   },
   {
      "body" : "> Can you \"info threads\" and \"bt\" from more than just the one thread?\r\n> Oh, and can you reproduce with -DDEBUG_LOCKORDER -g?\r\n\r\nYes, but `test_bitcoin` did not produce any extra output (if it was supposed to). Below are the stack traces, and how I got them. The core file is [here](https://s3.amazonaws.com/uploads.hipchat.com/126832/920830/vWzvgcVAPwlbrjl/core.30886.gz). It looks like [scheduler.cpp#L40](https://github.com/bitcoin/bitcoin/blob/v0.11.0/src/scheduler.cpp#L40) is where the other threads are blocked, perhaps on each other?\r\n\r\n### Prep\r\n\r\n```\r\nroot@e282d4a2b356:/# cd .../bitcoin\r\nroot@e282d4a2b356:.../bitcoin# git clean -Xdf\r\n...\r\nroot@e282d4a2b356:.../bitcoin# git clean -df\r\n...\r\nroot@e282d4a2b356:.../bitcoin# git checkout v0.11.0\r\n...\r\nroot@e282d4a2b356:.../bitcoin# git branch\r\n* (detached from v0.11.0)\r\n  master\r\nroot@e282d4a2b356:.../bitcoin# git status --ignored\r\nHEAD detached at v0.11.0\r\nnothing to commit, working directory clean\r\nroot@e282d4a2b356:.../bitcoin# ./autogen.sh\r\n...\r\nroot@e282d4a2b356:.../bitcoin# CFLAGS='-DDEBUG_LOCKORDER -g' CXXFLAGS='-DDEBUG_LOCKORDER -g' CPPFLAGS='-DDEBUG_LOCKORDER -g' ./configure --disable-wallet\r\n...\r\nroot@e282d4a2b356:.../bitcoin# CFLAGS='-DDEBUG_LOCKORDER -g' CXXFLAGS='-DDEBUG_LOCKORDER -g' CPPFLAGS='-DDEBUG_LOCKORDER -g' make\r\n...\r\nroot@e282d4a2b356:.../bitcoin# CFLAGS='-DDEBUG_LOCKORDER -g' CXXFLAGS='-DDEBUG_LOCKORDER -g' CPPFLAGS='-DDEBUG_LOCKORDER -g' make check\r\n...\r\nroot@e282d4a2b356:.../bitcoin# CFLAGS='-DDEBUG_LOCKORDER -g' CXXFLAGS='-DDEBUG_LOCKORDER -g' CPPFLAGS='-DDEBUG_LOCKORDER -g' make install\r\n...\r\nroot@e282d4a2b356:.../bitcoin# cd /usr/local/bin\r\nroot@e282d4a2b356:/usr/local/bin# ls -al test_bitcoin*\r\n-rwxr-xr-x 1 root staff 61087584 Aug 14 18:57 test_bitcoin\r\nroot@e282d4a2b356:/usr/local/bin# eu-strip -f test_bitcoin.debug test_bitcoin\r\nroot@e282d4a2b356:/usr/local/bin# ls -al test_bitcoin*\r\n-rwxr-xr-x 1 root staff  9776504 Aug 14 18:57 test_bitcoin\r\n-rwxr-xr-x 1 root staff 51314088 Aug 14 18:57 test_bitcoin.debug\r\nroot@e282d4a2b356:/usr/local/bin# which test_bitcoin\r\n/usr/local/bin/test_bitcoin\r\nroot@e282d4a2b356:/usr/local/bin# pgrep test_bitcoin\r\nroot@e282d4a2b356:/usr/local/bin# ( while true ; do test_bitcoin ; done ) &\r\n... [around 25 iterations]\r\nRunning 151 test cases...\r\n[hung, CPU back to idle]\r\nroot@e282d4a2b356:/usr/local/bin# pgrep test_bitcoin\r\n30886\r\n```\r\n\r\n### Debug Info\r\n\r\n```\r\nroot@e282d4a2b356:/usr/local/bin# gdb -s ./test_bitcoin.debug ./test_bitcoin \"$( pgrep test_bitcoin )\"\r\n...\r\nReading symbols from ./test_bitcoin...Reading symbols from /usr/local/bin/test_bitcoin.debug...done.\r\ndone.\r\nAttaching to program: /usr/local/bin/test_bitcoin, process 30886\r\n...\r\n(gdb) info threads\r\n(gdb) info threads\r\n  Id   Target Id         Frame\r\n  3    Thread 0x7f5b767fc700 (LWP 30939) \"test_bitcoin\" 0x00007f5b7d7d908f in pthread_cond_wait@@GLIBC_2.3.2 ()\r\n   from /lib/x86_64-linux-gnu/libpthread.so.0\r\n  2    Thread 0x7f5b63fff700 (LWP 30943) \"test_bitcoin\" 0x00007f5b7d7d908f in pthread_cond_wait@@GLIBC_2.3.2 ()\r\n   from /lib/x86_64-linux-gnu/libpthread.so.0\r\n* 1    Thread 0x7f5b80729740 (LWP 30886) \"test_bitcoin\" 0x00007f5b7d7d908f in pthread_cond_wait@@GLIBC_2.3.2 ()\r\n   from /lib/x86_64-linux-gnu/libpthread.so.0\r\n(gdb) thread apply all bt\r\n\r\nThread 3 (Thread 0x7f5b767fc700 (LWP 30939)):\r\n#0  0x00007f5b7d7d908f in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/x86_64-linux-gnu/libpthread.so.0\r\n#1  0x00007f5b7fd9dc00 in boost::condition_variable::wait (this=0x7ffc92ba4ce0, m=...) at /usr/include/boost/thread/pthread/condition_variable.hpp:73\r\n#2  0x00007f5b8010b163 in CScheduler::serviceQueue (this=0x7ffc92ba4cb0) at scheduler.cpp:40\r\n#3  0x00007f5b7fda6728 in boost::_mfi::mf0<void, CScheduler>::operator() (this=0x7f5b8132c008, p=0x7ffc92ba4cb0)\r\n    at /usr/include/boost/bind/mem_fn_template.hpp:49\r\n#4  0x00007f5b7fda661e in boost::_bi::list1<boost::_bi::value<CScheduler*> >::operator()<boost::_mfi::mf0<void, CScheduler>, boost::_bi::list0> (\r\n    this=0x7f5b8132c018, f=..., a=...) at /usr/include/boost/bind/bind.hpp:253\r\n#5  0x00007f5b7fda64ac in boost::_bi::bind_t<void, boost::_mfi::mf0<void, CScheduler>, boost::_bi::list1<boost::_bi::value<CScheduler*> > >::operator()\r\n    (this=0x7f5b8132c008) at /usr/include/boost/bind/bind_template.hpp:20\r\n#6  0x00007f5b7fda6331 in boost::detail::thread_data<boost::_bi::bind_t<void, boost::_mfi::mf0<void, CScheduler>, boost::_bi::list1<boost::_bi::value<CScheduler*> > > >::run (this=0x7f5b8132be50) at /usr/include/boost/thread/detail/thread.hpp:117\r\n#7  0x00007f5b7f13aaea in boost::(anonymous namespace)::thread_proxy (param=<optimized out>) at libs/thread/src/pthread/thread.cpp:164\r\n#8  0x00007f5b7d7d50a4 in start_thread () from /lib/x86_64-linux-gnu/libpthread.so.0\r\n#9  0x00007f5b7d50a04d in clone () from /lib/x86_64-linux-gnu/libc.so.6\r\n\r\nThread 2 (Thread 0x7f5b63fff700 (LWP 30943)):\r\n#0  0x00007f5b7d7d908f in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/x86_64-linux-gnu/libpthread.so.0\r\n#1  0x00007f5b7fd9dc00 in boost::condition_variable::wait (this=0x7ffc92ba4ce0, m=...) at /usr/include/boost/thread/pthread/condition_variable.hpp:73\r\n#2  0x00007f5b8010b163 in CScheduler::serviceQueue (this=0x7ffc92ba4cb0) at scheduler.cpp:40\r\n#3  0x00007f5b7fda6728 in boost::_mfi::mf0<void, CScheduler>::operator() (this=0x7f5b81346948, p=0x7ffc92ba4cb0)\r\n    at /usr/include/boost/bind/mem_fn_template.hpp:49\r\n#4  0x00007f5b7fda661e in boost::_bi::list1<boost::_bi::value<CScheduler*> >::operator()<boost::_mfi::mf0<void, CScheduler>, boost::_bi::list0> (\r\n    this=0x7f5b81346958, f=..., a=...) at /usr/include/boost/bind/bind.hpp:253\r\n#5  0x00007f5b7fda64ac in boost::_bi::bind_t<void, boost::_mfi::mf0<void, CScheduler>, boost::_bi::list1<boost::_bi::value<CScheduler*> > >::operator()\r\n    (this=0x7f5b81346948) at /usr/include/boost/bind/bind_template.hpp:20\r\n#6  0x00007f5b7fda6331 in boost::detail::thread_data<boost::_bi::bind_t<void, boost::_mfi::mf0<void, CScheduler>, boost::_bi::list1<boost::_bi::value<CScheduler*> > > >::run (this=0x7f5b81346790) at /usr/include/boost/thread/detail/thread.hpp:117\r\n#7  0x00007f5b7f13aaea in boost::(anonymous namespace)::thread_proxy (param=<optimized out>) at libs/thread/src/pthread/thread.cpp:164\r\n#8  0x00007f5b7d7d50a4 in start_thread () from /lib/x86_64-linux-gnu/libpthread.so.0\r\n#9  0x00007f5b7d50a04d in clone () from /lib/x86_64-linux-gnu/libc.so.6\r\n\r\nThread 1 (Thread 0x7f5b80729740 (LWP 30886)):\r\n#0  0x00007f5b7d7d908f in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/x86_64-linux-gnu/libpthread.so.0\r\n#1  0x00007f5b7fd9dc00 in boost::condition_variable::wait (this=0x7f5b8132bea8, m=...) at /usr/include/boost/thread/pthread/condition_variable.hpp:73\r\n#2  0x00007f5b7f13b5ac in boost::thread::join_noexcept (this=0x7f5b812e40e0) at libs/thread/src/pthread/thread.cpp:312\r\n#3  0x00007f5b7fd9db50 in boost::thread::join (this=0x7f5b812e40e0) at /usr/include/boost/thread/detail/thread.hpp:756\r\n#4  0x00007f5b7fd9e80d in boost::thread_group::join_all (this=0x7ffc92ba4d70) at /usr/include/boost/thread/detail/thread_group.hpp:118\r\n#5  0x00007f5b7fd9c642 in scheduler_tests::manythreads::test_method (this=0x7ffc92ba5a67) at test/scheduler_tests.cpp:109\r\n#6  0x00007f5b7fd9b980 in scheduler_tests::manythreads_invoker () at test/scheduler_tests.cpp:43\r\n#7  0x00007f5b7fc5e563 in boost::unit_test::ut_detail::invoker<boost::unit_test::ut_detail::unused>::invoke<void (*)()> (this=0x7ffc92ba5ad7,\r\n    f=@0x7f5b81274348: 0x7f5b7fd9b95d <scheduler_tests::manythreads_invoker()>) at /usr/include/boost/test/utils/callback.hpp:56\r\n#8  0x00007f5b7fc5dfd7 in boost::unit_test::ut_detail::callback0_impl_t<boost::unit_test::ut_detail::unused, void (*)()>::invoke (this=0x7f5b81274340)\r\n    at /usr/include/boost/test/utils/callback.hpp:89\r\n#9  0x00007f5b7ece38f1 in operator() (this=<optimized out>) at ./boost/test/utils/callback.hpp:118\r\n#10 operator() (this=<optimized out>) at ./boost/test/impl/unit_test_monitor.ipp:41\r\n#11 invoke<boost::unit_test::(anonymous namespace)::zero_return_wrapper_t<boost::unit_test::callback0<> > > (this=<optimized out>, f=...)\r\n    at ./boost/test/utils/callback.hpp:42\r\n#12 boost::unit_test::ut_detail::callback0_impl_t<int, boost::unit_test::(anonymous namespace)::zero_return_wrapper_t<boost::unit_test::callback0<boost::unit_test::ut_detail::unused> > >::invoke (this=<optimized out>) at ./boost/test/utils/callback.hpp:89\r\n#13 0x00007f5b7ecba6de in operator() (this=0x7ffc92ba6610) at ./boost/test/utils/callback.hpp:118\r\n#14 do_invoke<boost::scoped_ptr<boost::detail::translate_exception_base>, boost::unit_test::callback0<int> > (F=..., tr=...)\r\n    at ./boost/test/impl/execution_monitor.ipp:281\r\n#15 boost::execution_monitor::catch_signals (\r\n    this=this@entry=0x7f5b7ef239a0 <boost::unit_test::singleton<boost::unit_test::unit_test_monitor_t>::instance()::the_inst>, F=...)\r\n    at ./boost/test/impl/execution_monitor.ipp:885\r\n#16 0x00007f5b7ecbaf33 in boost::execution_monitor::execute (\r\n    this=this@entry=0x7f5b7ef239a0 <boost::unit_test::singleton<boost::unit_test::unit_test_monitor_t>::instance()::the_inst>, F=...)\r\n    at ./boost/test/impl/execution_monitor.ipp:1211\r\n#17 0x00007f5b7ece3a05 in boost::unit_test::unit_test_monitor_t::execute_and_translate (\r\n    this=0x7f5b7ef239a0 <boost::unit_test::singleton<boost::unit_test::unit_test_monitor_t>::instance()::the_inst>, tc=...)\r\n    at ./boost/test/impl/unit_test_monitor.ipp:69\r\n#18 0x00007f5b7ecca4af in boost::unit_test::framework_impl::visit (\r\n    this=0x7f5b7ef238c0 <boost::unit_test::(anonymous namespace)::s_frk_impl()::the_inst>, tc=...) at ./boost/test/impl/framework.ipp:156\r\n#19 0x00007f5b7ecfea33 in boost::unit_test::traverse_test_tree (suite=..., V=...) at ./boost/test/impl/unit_test_suite.ipp:207\r\n#20 0x00007f5b7ecfea33 in boost::unit_test::traverse_test_tree (suite=..., V=...) at ./boost/test/impl/unit_test_suite.ipp:207\r\n#21 0x00007f5b7ecc59fa in boost::unit_test::framework::run (id=1, id@entry=4294967295, continue_test=continue_test@entry=true)\r\n    at ./boost/test/impl/framework.ipp:442\r\n#22 0x00007f5b7ece1697 in boost::unit_test::unit_test_main (init_func=<optimized out>, argc=<optimized out>, argv=<optimized out>)\r\n    at ./boost/test/impl/unit_test_main.ipp:185\r\n#23 0x00007f5b7fdf3788 in main (argc=1, argv=0x7ffc92ba6948) at /usr/include/boost/test/unit_test.hpp:59\r\n(gdb) generate-core-file\r\nwarning: Memory read failed for corefile section, 8192 bytes at 0x7ffc92bf9000.\r\nSaved corefile core.30886\r\n...\r\n```",
      "created_at" : "2015-08-14T19:20:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-131213615",
      "id" : 131213615,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-08-14T19:28:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/131213615",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/222581?v=3",
         "events_url" : "https://api.github.com/users/posita/events{/privacy}",
         "followers_url" : "https://api.github.com/users/posita/followers",
         "following_url" : "https://api.github.com/users/posita/following{/other_user}",
         "gists_url" : "https://api.github.com/users/posita/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/posita",
         "id" : 222581,
         "login" : "posita",
         "organizations_url" : "https://api.github.com/users/posita/orgs",
         "received_events_url" : "https://api.github.com/users/posita/received_events",
         "repos_url" : "https://api.github.com/users/posita/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/posita/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/posita/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/posita"
      }
   },
   {
      "body" : "If someone wants to track down this issue further, you don't have to run all test.\r\n\r\n    src/test/test_bitcoin --log_level=ALL --run_test=scheduler_tests\r\n\r\nis enough.",
      "created_at" : "2015-09-23T09:55:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-142549565",
      "id" : 142549565,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-09-23T09:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/142549565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "This happens to me about 1 out of every 4 times I run test_bitcoin.  I'm not doing anything special like stripping debugging symbols.",
      "created_at" : "2015-10-28T02:56:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-151706821",
      "id" : 151706821,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-10-28T02:56:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/151706821",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "If this is a common issue (I've never noticed it locally and I run test_bitcoin 10's of times per day) Maybe better to disable the scheduler tests until they're fixed?\r\n",
      "created_at" : "2015-12-01T12:31:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-160954644",
      "id" : 160954644,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-12-01T12:31:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/160954644",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj Happens 4% of the time:\r\n```\r\nfor i in {1..10000}; do timeout 1 src/test/test_bitcoin --log_level=ALL --run_test=scheduler_tests &> /dev/null ;echo $? >> /tmp/result100 ;done;cat /tmp/result100|sort|uniq -c\r\n   9638 0\r\n    462 124\r\n",
      "created_at" : "2015-12-01T13:30:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-160968874",
      "id" : 160968874,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-12-01T13:30:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/160968874",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "See #7144 ",
      "created_at" : "2015-12-01T13:57:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-160976890",
      "id" : 160976890,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-12-01T13:57:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/160976890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "For what it's worth: I have never seen this bug, OSX and boost 1.59.\r\n\r\nLooking through Boost release notes, I see a fix in boost 1.56 that might be the culprit:\r\n\r\n```1.56 :   Simplified, refactored and unified (timed_)lock code based on try_lock(). There were several bugs when handling timeout expirations.```\r\n\r\n@MarcoFalke @morcos : are you using boost version < 1.56 ?\r\n",
      "created_at" : "2015-12-01T20:39:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-161088660",
      "id" : 161088660,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-12-01T20:39:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/161088660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
         "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gavinandresen/followers",
         "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gavinandresen",
         "id" : 331997,
         "login" : "gavinandresen",
         "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
         "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
         "repos_url" : "https://api.github.com/users/gavinandresen/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gavinandresen"
      }
   },
   {
      "body" : "Running 1.58 (the same? as travis is running, which also locks)",
      "created_at" : "2015-12-01T21:43:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-161105108",
      "id" : 161105108,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-12-01T21:43:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/161105108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "hmm if i was paying closer attention i could have helped debug this better, because it was happening fairly consistently for me, and now it never happens anymore.\r\n\r\n",
      "created_at" : "2015-12-01T22:03:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-161109876",
      "id" : 161109876,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-12-01T22:03:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/161109876",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "FWIW, I don't recall being able to reproduce this in OS X (using Boost 1.58 or 1.59). I was able to reliably reproduce it using Debian Jessie<sup>1</sup> (but the system packages for Boost are at [1.55](https://packages.debian.org/jessie/libboost-dev)). @MarcoFalke, what platform (`uname -a`) are you experiencing locks with 1.58? Can you do a linking sanity check (e.g., `ldd -v .../path/to/test_bitcoin` on Linux, `otool -Lv ...` on Darwin)?\r\n\r\n--\r\n\r\n<sup>1</sup> *Technically*, it was inside a Docker container based on `debian:stable` which was running via boot2docker inside a Parallels VM running on OS X, but I'm pretty sure that doesn't count as OS X. :stuck_out_tongue_winking_eye: ",
      "created_at" : "2015-12-01T23:34:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-161131707",
      "id" : 161131707,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-12-02T04:45:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/161131707",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/222581?v=3",
         "events_url" : "https://api.github.com/users/posita/events{/privacy}",
         "followers_url" : "https://api.github.com/users/posita/followers",
         "following_url" : "https://api.github.com/users/posita/following{/other_user}",
         "gists_url" : "https://api.github.com/users/posita/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/posita",
         "id" : 222581,
         "login" : "posita",
         "organizations_url" : "https://api.github.com/users/posita/orgs",
         "received_events_url" : "https://api.github.com/users/posita/received_events",
         "repos_url" : "https://api.github.com/users/posita/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/posita/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/posita/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/posita"
      }
   },
   {
      "body" : "I am unable to reproduce on OS X with Boost 1.59:\r\n\r\n```sh\r\n% uname -a\r\nDarwin ... 13.4.0 Darwin Kernel Version 13.4.0: Wed Mar 18 16:20:14 PDT 2015; root:xnu-2422.115.14~1/RELEASE_X86_64 x86_64\r\n% src/bitcoin-cli --version\r\nBitcoin Core RPC client version v0.11.2\r\n% otool -Lv src/bitcoin-cli\r\nsrc/bitcoin-cli:\r\n        .../lib/libboost_system-mt.dylib (compatibility version 0.0.0, current version 0.0.0)\r\n        time stamp 2 Wed Dec 31 16:00:02 1969\r\n        .../lib/libboost_filesystem-mt.dylib (compatibility version 0.0.0, current version 0.0.0)\r\n        time stamp 2 Wed Dec 31 16:00:02 1969\r\n        .../lib/libboost_program_options-mt.dylib (compatibility version 0.0.0, current version 0.0.0)\r\n        time stamp 2 Wed Dec 31 16:00:02 1969\r\n        .../lib/libboost_thread-mt.dylib (compatibility version 0.0.0, current version 0.0.0)\r\n        time stamp 2 Wed Dec 31 16:00:02 1969\r\n        .../lib/libboost_chrono-mt.dylib (compatibility version 0.0.0, current version 0.0.0)\r\n        time stamp 2 Wed Dec 31 16:00:02 1969\r\n        .../lib/libssl.1.0.0.dylib (compatibility version 1.0.0, current version 1.0.0)\r\n        time stamp 2 Wed Dec 31 16:00:02 1969\r\n        .../lib/libcrypto.1.0.0.dylib (compatibility version 1.0.0, current version 1.0.0)\r\n        time stamp 2 Wed Dec 31 16:00:02 1969\r\n        /usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 120.0.0)\r\n        time stamp 2 Wed Dec 31 16:00:02 1969\r\n        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1197.1.1)\r\n        time stamp 2 Wed Dec 31 16:00:02 1969\r\n% grep BOOST_LIB_VERSION .../include/boost/version.hpp\r\n//  BOOST_LIB_VERSION must be defined to be the same as BOOST_VERSION\r\n#define BOOST_LIB_VERSION \"1_59\"\r\n% for i in {1..10000} ; do gtimeout 2 src/test/test_bitcoin --log_level=ALL --run_test=scheduler_tests &>/dev/null ; echo $? >>/tmp/result100 ; done ; sort /tmp/result100 | uniq -c\r\n10000 0\r\n```",
      "created_at" : "2015-12-02T05:59:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-161189237",
      "id" : 161189237,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-12-02T07:00:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/161189237",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/222581?v=3",
         "events_url" : "https://api.github.com/users/posita/events{/privacy}",
         "followers_url" : "https://api.github.com/users/posita/followers",
         "following_url" : "https://api.github.com/users/posita/following{/other_user}",
         "gists_url" : "https://api.github.com/users/posita/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/posita",
         "id" : 222581,
         "login" : "posita",
         "organizations_url" : "https://api.github.com/users/posita/orgs",
         "received_events_url" : "https://api.github.com/users/posita/received_events",
         "repos_url" : "https://api.github.com/users/posita/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/posita/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/posita/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/posita"
      }
   },
   {
      "body" : "With `BOOST_LIB_VERSION=1_58`\r\n```\r\n$ uname -a\r\nLinux localhost.localdomain 4.2.6-301.fc23.x86_64 #1 SMP Fri Nov 20 22:22:41 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\r\n$ ldd -v ./src/test/test_bitcoin|grep boost\r\n\tlibboost_system.so.1.58.0 => /lib64/libboost_system.so.1.58.0 (0x00007f5e84548000)\r\n\tlibboost_filesystem.so.1.58.0 => /lib64/libboost_filesystem.so.1.58.0 (0x00007f5e84332000)\r\n\tlibboost_program_options.so.1.58.0 => /lib64/libboost_program_options.so.1.58.0 (0x00007f5e840bc000)\r\n\tlibboost_thread.so.1.58.0 => /lib64/libboost_thread.so.1.58.0 (0x00007f5e83e96000)\r\n\tlibboost_chrono.so.1.58.0 => /lib64/libboost_chrono.so.1.58.0 (0x00007f5e83c8e000)\r\n\tlibboost_unit_test_framework.so.1.58.0 => /lib64/libboost_unit_test_framework.so.1.58.0 (0x00007f5e839eb000)\r\n\t/lib64/libboost_system.so.1.58.0:\r\n\t/lib64/libboost_filesystem.so.1.58.0:\r\n\t/lib64/libboost_program_options.so.1.58.0:\r\n\t/lib64/libboost_thread.so.1.58.0:\r\n\t/lib64/libboost_chrono.so.1.58.0:\r\n\t/lib64/libboost_unit_test_framework.so.1.58.0:\r\n\r\n",
      "created_at" : "2015-12-02T07:08:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-161203758",
      "id" : 161203758,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-12-02T07:08:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/161203758",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "> I am unable to reproduce on OS X with Boost 1.59 ...\r\n\r\nHowever, I *can* reproduce it on Debian Sid (running in Docker) with Boost 1.58:\r\n\r\n```sh\r\nroot@c74c16a6aee2:~/bitcoin# uname -a\r\nLinux c74c16a6aee2 4.1.13-boot2docker #1 SMP Fri Nov 20 19:05:50 UTC 2015 x86_64 GNU/Linux\r\nroot@c74c16a6aee2:~/bitcoin# src/bitcoin-cli --version\r\nBitcoin Core RPC client version v0.11.99.0-4077ad2\r\nroot@c74c16a6aee2:~/bitcoin# ldd -v src/bitcoin-cli | grep boost\r\n        libboost_system.so.1.58.0 => /usr/lib/x86_64-linux-gnu/libboost_system.so.1.58.0 (0x00007fc1a24f2000)\r\n        libboost_filesystem.so.1.58.0 => /usr/lib/x86_64-linux-gnu/libboost_filesystem.so.1.58.0 (0x00007fc1a22d9000)\r\n        libboost_program_options.so.1.58.0 => /usr/lib/x86_64-linux-gnu/libboost_program_options.so.1.58.0 (0x00007fc1a2057000)\r\n        libboost_thread.so.1.58.0 => /usr/lib/x86_64-linux-gnu/libboost_thread.so.1.58.0 (0x00007fc1a1e30000)\r\n        libboost_chrono.so.1.58.0 => /usr/lib/x86_64-linux-gnu/libboost_chrono.so.1.58.0 (0x00007fc1a1c28000)\r\n        /usr/lib/x86_64-linux-gnu/libboost_system.so.1.58.0:\r\n        /usr/lib/x86_64-linux-gnu/libboost_filesystem.so.1.58.0:\r\n        /usr/lib/x86_64-linux-gnu/libboost_program_options.so.1.58.0:\r\n        /usr/lib/x86_64-linux-gnu/libboost_thread.so.1.58.0:\r\n        /usr/lib/x86_64-linux-gnu/libboost_chrono.so.1.58.0:\r\nroot@c74c16a6aee2:~/bitcoin# grep BOOST_LIB_VERSION /usr/include/boost/version.hpp\r\n//  BOOST_LIB_VERSION must be defined to be the same as BOOST_VERSION\r\n#define BOOST_LIB_VERSION \"1_58\"\r\nroot@c74c16a6aee2:~/bitcoin# for i in {1..2000} ; do timeout 2 src/test/test_bitcoin --log_level=ALL --run_test=scheduler_tests &>/dev/null ; echo $? >>/tmp/result100 ; done ; sort /tmp/result100 | uniq -c\r\n   1695 0\r\n    305 124\r\n```\r\n\r\nCaveats:\r\n\r\n* I inadvertently built from `master` instead of `v0.11.2` as I did with OS X. I can re-run if desired.\r\n* The above was built and run from the following stack:\r\n  * [`debian:unstable`](https://hub.docker.com/r/library/debian/) Docker image\r\n  * [Docker 1.9.1](https://github.com/docker/docker/tree/v1.9.1)\r\n  * [Boot2Docker 1.9.1](https://github.com/boot2docker/boot2docker/tree/v1.9.1)\r\n  * Parallels Desktop Pro 11.1.0-32202\r\n  * [Docker Machine Parallels Driver 1.0.1](https://github.com/Parallels/docker-machine-parallels/tree/v1.0.1)\r\n  * [`docker-machine` 0.5.0](https://github.com/docker/machine/tree/v0.5.0)\r\n  * OS X 10.9.5",
      "created_at" : "2015-12-02T07:20:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-161205152",
      "id" : 161205152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-12-02T07:32:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/161205152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/222581?v=3",
         "events_url" : "https://api.github.com/users/posita/events{/privacy}",
         "followers_url" : "https://api.github.com/users/posita/followers",
         "following_url" : "https://api.github.com/users/posita/following{/other_user}",
         "gists_url" : "https://api.github.com/users/posita/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/posita",
         "id" : 222581,
         "login" : "posita",
         "organizations_url" : "https://api.github.com/users/posita/orgs",
         "received_events_url" : "https://api.github.com/users/posita/received_events",
         "repos_url" : "https://api.github.com/users/posita/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/posita/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/posita/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/posita"
      }
   },
   {
      "body" : "FWIW, I used [these](https://gist.github.com/posita/8b082f3930ee1efaa6f9) with the stack mentioned in my previous comment to reproduce this on Debian (wheezy, jessie, sid) and Ubuntu (trusty, vivid, wily):\r\n\r\n```sh\r\n% for i in Dockerfile-*-*-automake ; do read -k 1 \"?Any key to continue with ${i} ... \" ; echo ; docker build -f \"${i}\" . ; done\r\nAny key to continue with Dockerfile-debian-jessie-automake ... .\r\n...\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\n\r\n*** No errors detected\r\nRunning 1 test case...\r\nPlatform: linux\r\nCompiler: GNU C++ version 4.9.1\r\nSTL     : GNU libstdc++ version 20140912\r\nBoost   : 1.55.0\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\nBitcoin Core RPC client version v0.11.2\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\nLinux 11aafb97cfeb 4.1.13-boot2docker #1 SMP Fri Nov 20 19:05:50 UTC 2015 x86_64 GNU/Linux\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\n    871 0\r\n    129 124\r\n...\r\nAny key to continue with Dockerfile-debian-sid-automake ... .\r\n...\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\n\r\n*** No errors detected\r\nRunning 1 test case...\r\nPlatform: linux\r\nCompiler: GNU C++ version 5.2.1 20151129\r\nSTL     : GNU libstdc++ version 20151129\r\nBoost   : 1.58.0\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\nBitcoin Core RPC client version v0.11.2\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\nLinux 5cf97854c2bc 4.1.13-boot2docker #1 SMP Fri Nov 20 19:05:50 UTC 2015 x86_64 GNU/Linux\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\n    881 0\r\n    119 124\r\n...\r\nAny key to continue with Dockerfile-debian-wheezy-automake ... .\r\n...\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\n\r\n*** No errors detected\r\nRunning 1 test case...\r\nPlatform: linux\r\nCompiler: GNU C++ version 4.7.2\r\nSTL     : GNU libstdc++ version 20120920\r\nBoost   : 1.49.0\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\nBitcoin Core RPC client version v0.11.2\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\nLinux c98f3c4629d3 4.1.13-boot2docker #1 SMP Fri Nov 20 19:05:50 UTC 2015 x86_64 GNU/Linux\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\n    909 0\r\n     91 124\r\n ...\r\nAny key to continue with Dockerfile-ubuntu-trusty-automake ... .\r\n...\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\n\r\n*** No errors detected\r\nRunning 1 test case...\r\nPlatform: linux\r\nCompiler: GNU C++ version 4.8.2\r\nSTL     : GNU libstdc++ version 20140404\r\nBoost   : 1.54.0\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\nBitcoin Core RPC client version v0.11.2\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\nLinux a52c17016130 4.1.13-boot2docker #1 SMP Fri Nov 20 19:05:50 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\n    887 0\r\n    113 124\r\n...\r\nAny key to continue with Dockerfile-ubuntu-vivid-automake ... .\r\n...\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\n\r\n*** No errors detected\r\nRunning 1 test case...\r\nPlatform: linux\r\nCompiler: GNU C++ version 4.9.2\r\nSTL     : GNU libstdc++ version 20150305\r\nBoost   : 1.55.0\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\nBitcoin Core RPC client version v0.11.2\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\nLinux 19d74fa25b3a 4.1.13-boot2docker #1 SMP Fri Nov 20 19:05:50 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\n    897 0\r\n    103 124\r\n...\r\nAny key to continue with Dockerfile-ubuntu-wily-automake ... .\r\n...\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\n\r\n*** No errors detected\r\nRunning 1 test case...\r\nPlatform: linux\r\nCompiler: GNU C++ version 5.2.1 20151010\r\nSTL     : GNU libstdc++ version 20151010\r\nBoost   : 1.58.0\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\nBitcoin Core RPC client version v0.11.2\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\nLinux a6af3de67df6 4.1.13-boot2docker #1 SMP Fri Nov 20 19:05:50 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\r\n= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\r\n    741 0\r\n    259 124\r\n```\r\n\r\nSo it appears to be happening pretty consistently under each of those environments, often more than 10% of the time with my setup (`124` exit code counts are the hung ones).\r\n\r\nWhile it's possible that virtualization amplifies opportunities to observe a race condition that more efficient environments hide, concurrent with that last test (for Ubuntu Wily), I ran the following on the OS X host and still got zero hangs:\r\n\r\n```sh\r\n% bitcoin-cli --version\r\nBitcoin Core RPC client version v0.11.2\r\n% test_bitcoin --build_info --run_test=scheduler_tests\r\nRunning 1 test case...\r\nPlatform: Mac OS\r\nCompiler: Clang version 6.0 (clang-600.0.57)\r\nSTL     : libc++ version 1101\r\nBoost   : 1.59.0\r\n\r\n*** No errors detected\r\n% python -c 'import decimal ; print((decimal.Decimal(\"10\" * 16384 * 8192) + decimal.Decimal(\"4321\" * 16384 * 8192)) * decimal.Decimal(\"9\" * 32768 * 4096))' & \\\r\n> python -c 'import decimal ; print((decimal.Decimal(\"10\" * 16384 * 8192) + decimal.Decimal(\"4321\" * 16384 * 8192)) * decimal.Decimal(\"9\" * 32768 * 4096))' & \\\r\n> python -c 'import decimal ; print((decimal.Decimal(\"10\" * 16384 * 8192) + decimal.Decimal(\"4321\" * 16384 * 8192)) * decimal.Decimal(\"9\" * 32768 * 4096))' & \\\r\n> python -c 'import decimal ; print((decimal.Decimal(\"10\" * 16384 * 8192) + decimal.Decimal(\"4321\" * 16384 * 8192)) * decimal.Decimal(\"9\" * 32768 * 4096))' & \\\r\n> time ( for i in {1..10000} ; do gtimeout 2 test_bitcoin --log_level=ALL --run_test=scheduler_tests &>/dev/null ; echo \"${?}\" ; done ) | sort | uniq -c ; \\\r\n> kill %1 %2 %3 %4\r\n[1] 20843\r\n[2] 20844\r\n[3] 20845\r\n[4] 20846\r\n10000 0\r\n( for i in {1..10000}; do; gtimeout 2 test_bitcoin --log_level=ALL  &> ; echo)  565.09s user 252.40s system 23% cpu 56:46.88 total\r\n[4]  + terminated  python -c\r\n[3]  + terminated  python -c\r\n[2]  - terminated  python -c\r\n[1]  - terminated  python -c\r\n```",
      "created_at" : "2015-12-03T16:31:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-161707146",
      "id" : 161707146,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2015-12-04T03:12:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/161707146",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/222581?v=3",
         "events_url" : "https://api.github.com/users/posita/events{/privacy}",
         "followers_url" : "https://api.github.com/users/posita/followers",
         "following_url" : "https://api.github.com/users/posita/following{/other_user}",
         "gists_url" : "https://api.github.com/users/posita/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/posita",
         "id" : 222581,
         "login" : "posita",
         "organizations_url" : "https://api.github.com/users/posita/orgs",
         "received_events_url" : "https://api.github.com/users/posita/received_events",
         "repos_url" : "https://api.github.com/users/posita/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/posita/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/posita/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/posita"
      }
   },
   {
      "body" : "FWIW: OS X physical test machine with 10.10, current master and boosts from 1.54.0 to 1.58.0: no hangs at all. I can't reproduce the test problem here locally :-(",
      "created_at" : "2016-05-05T07:07:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-217090655",
      "id" : 217090655,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2016-05-05T07:07:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217090655",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "openSUSE 13.2 64bit, no hang in 10000 runs with boost 1.54.0.\r\n```\r\nRunning 1 test case...\r\nPlatform: linux\r\nCompiler: GNU C++ version 4.8.3 20140627 [gcc-4_8-branch revision 212064]\r\nSTL     : GNU libstdc++ version 20140627\r\nBoost   : 1.54.0\r\n\r\n*** No errors detected\r\n```\r\n",
      "created_at" : "2016-05-05T09:52:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-217115121",
      "id" : 217115121,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2016-05-05T09:52:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217115121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "How to reproduce this so I can look at it?",
      "created_at" : "2016-05-05T10:22:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-217119394",
      "id" : 217119394,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2016-05-05T10:22:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217119394",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "I could reproduce it at the time, but haven't tried for a while. It was a pretty rare issue, which made it non-trivial to fix.\r\nCongrats on getting a backtrace at least. You should probably have dumped one for all threads to get a fuller picture.\r\n(waiting in pthread_cond_wait@@GLIBC_2.3.2 is perfectly normal, it's bound to be a combination of threads which puts it into a deadlock)",
      "created_at" : "2016-05-05T13:58:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-217161797",
      "id" : 217161797,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2016-05-05T14:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217161797",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "```\r\n(gdb) thread apply all bt\r\n\r\nThread 4 (Thread 0x7f3c0c330700 (LWP 26007)):\r\n#0  0x00007f3c0ce0705f in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0\r\n#1  0x00007f3c0f5046e3 in boost::condition_variable::wait (this=0x7ffc1eccc250, m=...) at /tmp/BOOST/1.58.0/include/boost/thread/pthread/condition_variable.hpp:73\r\n#2  0x00007f3c0f6db830 in CScheduler::serviceQueue (this=0x7ffc1eccc220) at scheduler.cpp:42\r\n#3  0x00007f3c0e927fef in thread_proxy () from /tmp/BOOST/1.58.0/lib/libboost_thread.so.1.58.0\r\n#4  0x00007f3c0ce030a4 in start_thread () from /lib64/libpthread.so.0\r\n#5  0x00007f3c0cb3908d in clone () from /lib64/libc.so.6\r\n\r\nThread 3 (Thread 0x7f3c0b32e700 (LWP 26009)):\r\n#0  0x00007f3c0ce0705f in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0\r\n#1  0x00007f3c0f5046e3 in boost::condition_variable::wait (this=0x7ffc1eccc250, m=...) at /tmp/BOOST/1.58.0/include/boost/thread/pthread/condition_variable.hpp:73\r\n#2  0x00007f3c0f6db830 in CScheduler::serviceQueue (this=0x7ffc1eccc220) at scheduler.cpp:42\r\n#3  0x00007f3c0e927fef in thread_proxy () from /tmp/BOOST/1.58.0/lib/libboost_thread.so.1.58.0\r\n#4  0x00007f3c0ce030a4 in start_thread () from /lib64/libpthread.so.0\r\n#5  0x00007f3c0cb3908d in clone () from /lib64/libc.so.6\r\n\r\nThread 2 (Thread 0x7f3c0a32c700 (LWP 26011)):\r\n#0  0x00007f3c0ce0705f in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0\r\n#1  0x00007f3c0f5046e3 in boost::condition_variable::wait (this=0x7ffc1eccc250, m=...) at /tmp/BOOST/1.58.0/include/boost/thread/pthread/condition_variable.hpp:73\r\n#2  0x00007f3c0f6db830 in CScheduler::serviceQueue (this=0x7ffc1eccc220) at scheduler.cpp:42\r\n#3  0x00007f3c0e927fef in thread_proxy () from /tmp/BOOST/1.58.0/lib/libboost_thread.so.1.58.0\r\n#4  0x00007f3c0ce030a4 in start_thread () from /lib64/libpthread.so.0\r\n#5  0x00007f3c0cb3908d in clone () from /lib64/libc.so.6\r\n\r\nThread 1 (Thread 0x7f3c0f3d4740 (LWP 25800)):\r\n#0  0x00007f3c0ce0705f in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0\r\n#1  0x00007f3c0f5046e3 in boost::condition_variable::wait (this=0x7f3c11c15d18, m=...) at /tmp/BOOST/1.58.0/include/boost/thread/pthread/condition_variable.hpp:73\r\n#2  0x00007f3c0e92883c in boost::thread::join_noexcept() () from /tmp/BOOST/1.58.0/lib/libboost_thread.so.1.58.0\r\n#3  0x00007f3c0f504996 in join (this=0x7f3c11c11f20) at /tmp/BOOST/1.58.0/include/boost/thread/detail/thread.hpp:767\r\n#4  boost::thread_group::join_all (this=this@entry=0x7ffc1eccc2e0) at /tmp/BOOST/1.58.0/include/boost/thread/detail/thread_group.hpp:118\r\n#5  0x00007f3c0f502b2a in scheduler_tests::manythreads::test_method (this=this@entry=0x7ffc1ecccfd7) at test/scheduler_tests.cpp:110\r\n#6  0x00007f3c0f502fbe in scheduler_tests::manythreads_invoker () at test/scheduler_tests.cpp:44\r\n#7  0x00007f3c0f454f27 in invoke<void (*)()> (this=<optimized out>, f=<optimized out>) at /tmp/BOOST/1.58.0/include/boost/test/utils/callback.hpp:56\r\n#8  boost::unit_test::ut_detail::callback0_impl_t<boost::unit_test::ut_detail::unused, void (*)()>::invoke (this=<optimized out>) at /tmp/BOOST/1.58.0/include/boost/test/utils/callback.hpp:89\r\n#9  0x00007f3c0e4d22b1 in boost::unit_test::ut_detail::callback0_impl_t<int, boost::unit_test::(anonymous namespace)::zero_return_wrapper_t<boost::unit_test::callback0<boost::unit_test::ut_detail::unused> > >::invoke() ()\r\n   from /tmp/BOOST/1.58.0/lib/libboost_unit_test_framework.so.1.58.0\r\n#10 0x00007f3c0e4b4946 in boost::execution_monitor::catch_signals(boost::unit_test::callback0<int> const&) () from /tmp/BOOST/1.58.0/lib/libboost_unit_test_framework.so.1.58.0\r\n#11 0x00007f3c0e4b5173 in boost::execution_monitor::execute(boost::unit_test::callback0<int> const&) () from /tmp/BOOST/1.58.0/lib/libboost_unit_test_framework.so.1.58.0\r\n#12 0x00007f3c0e4d23b2 in boost::unit_test::unit_test_monitor_t::execute_and_translate(boost::unit_test::test_case const&) () from /tmp/BOOST/1.58.0/lib/libboost_unit_test_framework.so.1.58.0\r\n#13 0x00007f3c0e4bbf14 in boost::unit_test::framework_impl::visit(boost::unit_test::test_case const&) () from /tmp/BOOST/1.58.0/lib/libboost_unit_test_framework.so.1.58.0\r\n#14 0x00007f3c0e4eb053 in boost::unit_test::traverse_test_tree(boost::unit_test::test_suite const&, boost::unit_test::test_tree_visitor&) () from /tmp/BOOST/1.58.0/lib/libboost_unit_test_framework.so.1.58.0\r\n#15 0x00007f3c0e4eb053 in boost::unit_test::traverse_test_tree(boost::unit_test::test_suite const&, boost::unit_test::test_tree_visitor&) () from /tmp/BOOST/1.58.0/lib/libboost_unit_test_framework.so.1.58.0\r\n#16 0x00007f3c0e4b743a in boost::unit_test::framework::run(unsigned long, bool) () from /tmp/BOOST/1.58.0/lib/libboost_unit_test_framework.so.1.58.0\r\n#17 0x00007f3c0e4cff94 in boost::unit_test::unit_test_main(bool (*)(), int, char**) () from /tmp/BOOST/1.58.0/lib/libboost_unit_test_framework.so.1.58.0\r\n#18 0x00007f3c0ca75b05 in __libc_start_main () from /lib64/libc.so.6\r\n#19 0x00007f3c0f43cdcc in _start () at ../sysdeps/x86_64/start.S:112\r\n(gdb) \r\n```\r\n",
      "created_at" : "2016-05-05T14:22:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-217167587",
      "id" : 217167587,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2016-05-05T14:22:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217167587",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "```\r\n(gdb) thread 4\r\n[Switching to thread 4 (Thread 0x7f3c0c330700 (LWP 26007))]\r\n#0  0x00007f3c0ce0705f in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0\r\n(gdb) up\r\n#1  0x00007f3c0f5046e3 in boost::condition_variable::wait (this=0x7ffc1eccc250, m=...) at /tmp/BOOST/1.58.0/include/boost/thread/pthread/condition_variable.hpp:73\r\n73\t              res = pthread_cond_wait(&cond,&internal_mutex);\r\n(gdb) up\r\n#2  0x00007f3c0f6db830 in CScheduler::serviceQueue (this=0x7ffc1eccc220) at scheduler.cpp:42\r\n42\t                newTaskScheduled.wait(lock);\r\n(gdb) list\r\n37\t    // is called.\r\n38\t    while (!shouldStop()) {\r\n39\t        try {\r\n40\t            while (!shouldStop() && taskQueue.empty()) {\r\n41\t                // Wait until there is something to do.\r\n42\t                newTaskScheduled.wait(lock);\r\n43\t            }\r\n44\t\r\n```",
      "created_at" : "2016-05-05T14:27:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-217168785",
      "id" : 217168785,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2016-05-05T14:27:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217168785",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Self notice: Do I really need to repeat how I *love* debugging multiple threads servicing one queue of tasks repeatedly adding other tasks to the same queue?\r\n\r\nThe solution to the deadlock is to call `notify_one()` at the end of `::serviceQueue()`, because this could wake up other threads running `::serviceQueues()` in such a deadlock case. Without this, there could remain some servicing threads waiting for the task which doesn't come in (because we are finished)!\r\n\r\nOr directly call `notify_all()` but I prefer `_one()`.\r\n\r\nWhat do you think?\r\n\r\n```\r\ndiff --git a/src/scheduler.cpp b/src/scheduler.cpp\r\nindex 184ddc2..0a431b2 100644\r\n--- a/src/scheduler.cpp\r\n+++ b/src/scheduler.cpp\r\n@@ -79,6 +81,7 @@ void CScheduler::serviceQueue()\r\n         }\r\n     }\r\n     --nThreadsServicingQueue;\r\n+    newTaskScheduled.notify_one();\r\n }\r\n \r\n void CScheduler::stop(bool drain)\r\n\r\n```",
      "created_at" : "2016-05-05T21:30:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6540#issuecomment-217285897",
      "id" : 217285897,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6540",
      "updated_at" : "2016-05-05T21:30:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217285897",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   }
]
