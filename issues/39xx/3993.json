{
   "assignee" : null,
   "body" : "As usual I had Bitcoin-Qt (v0.9, Win 7 x64) running in the background and sent a transaction via RPC, about 10 minutes later an exception was thrown, ultimately leading to a corrupted wallet.dat file. At that very moment no action was performed and to my best knowledge no other program than bitcoin-qt.exe had access to the wallet.dat. The event logs don't show any incident besides this one during that time.\r\n\r\nScreenshots:\r\n\r\n![excep](https://cloud.githubusercontent.com/assets/5836089/2586783/e3108e24-ba0a-11e3-8bc1-c69e6b0298a8.png)\r\n\r\ndebug.log:\r\n```\r\n2014-04-01 23:02:46 AddToWallet 763f6e7d66a4b44bd1c6f7c566a98c8fe9465e00e2a048e046f38566f2fbe9fd  new\r\n2014-04-01 23:02:46 AddToWallet 763f6e7d66a4b44bd1c6f7c566a98c8fe9465e00e2a048e046f38566f2fbe9fd  \r\n...\r\n2014-04-01 23:11:54 socket recv error 10054\r\n2014-04-01 23:12:38 UpdateTip: new best=000000000000000090b4ce53f41be9c3af7d2b9220a6585926b8fcab59e78457  height=293646  log2_work=77.684919  tx=36044176  date=2014-04-01 23:11:43 progress=0.999997\r\n2014-04-01 23:12:38 ProcessBlock: ACCEPTED\r\n2014-04-01 23:12:40 AddToWallet 763f6e7d66a4b44bd1c6f7c566a98c8fe9465e00e2a048e046f38566f2fbe9fd  update\r\n2014-04-01 23:12:40 *** System error: CDB() : can't open database file wallet.dat, error 2\r\n2014-04-01 23:12:44 ERROR: ProcessBlock() : AcceptBlock FAILED\r\n2014-04-01 23:12:44 Requesting shutdown\r\n2014-04-01 23:12:44 Running Shutdown in thread\r\n2014-04-01 23:12:44 opencon thread interrupt\r\n2014-04-01 23:12:44 dumpaddr thread stop\r\n2014-04-01 23:12:44 msghand thread interrupt\r\n2014-04-01 23:12:44 addcon thread interrupt\r\n2014-04-01 23:12:44 net thread interrupt\r\n2014-04-01 23:12:44 Shutdown : In progress...\r\n2014-04-01 23:12:44 StopNode()\r\n2014-04-01 23:12:45 UPNP_DeletePortMapping() returned : 0\r\n2014-04-01 23:12:45 upnp thread interrupt\r\n2014-04-01 23:12:45 \r\n\r\n************************\r\nEXCEPTION: St13runtime_error       \r\nCDB() : can't open database file wallet.dat, error 2       \r\nE:\\Bitcoin-0.9.0\\bitcoin-qt.exe in Runaway exception       \r\n\r\nRequesting initialize\r\nRunning AppInit2 in thread\r\n2014-04-01 23:15:37 \r\n\r\n....\r\n\r\n2014-04-01 23:17:22 Bitcoin version v0.9.0.0-g92d25e4-beta (Sun, 16 Mar 2014 11:05:28 +0100)\r\n2014-04-01 23:17:22 Using OpenSSL version OpenSSL 1.0.1e 11 Feb 2013\r\n2014-04-01 23:17:22 Default data directory C:\\Users\\uname\\AppData\\Roaming\\Bitcoin\r\n2014-04-01 23:17:22 Using data directory E:\\Bitcoin-0.9.0\\Data\r\n2014-04-01 23:17:22 Using at most 125 connections (2048 file descriptors available)\r\n2014-04-01 23:17:22 Using 4 threads for script verification\r\n2014-04-01 23:17:22 Using wallet wallet.dat\r\n2014-04-01 23:17:22 init message: Verifying wallet...\r\n2014-04-01 23:17:22 dbenv.open LogDir=E:\\Bitcoin-0.9.0\\Data\\database ErrorFile=E:\\Bitcoin-0.9.0\\Data\\db.log\r\n2014-04-01 23:17:23 Renamed wallet.dat to wallet.1396394242.bak\r\n2014-04-01 23:17:23 Error: Salvage found errors, all data may not be recoverable.\r\n2014-04-01 23:17:23 Salvage(aggressive) found no records in wallet.1396394242.bak.\r\n2014-04-01 23:20:15 Initialization result: 0\r\n2014-04-01 23:20:15 Requesting shutdown\r\n2014-04-01 23:20:15 Running Shutdown in thread\r\n2014-04-01 23:20:15 Shutdown : In progress...\r\n2014-04-01 23:20:15 StopNode()\r\n2014-04-01 23:20:15 Shutdown : done\r\n2014-04-01 23:20:15 Shutdown finished\r\n2014-04-01 23:20:15 Shutdown result: 1\r\n2014-04-01 23:20:15 Stopping thread\r\n2014-04-01 23:20:15 Stopped thread\r\nRequesting initialize\r\nRunning AppInit2 in thread\r\n2014-04-01 23:31:51 \r\n```\r\n\r\ndb.log:\r\n```\r\nwallet.dat: unable to flush: No such file or directory\r\ntxn_checkpoint: failed to flush the buffer cache: No such file or directory\r\nwallet.dat: No such file or directory\r\nwallet.dat: No such file or directory\r\nfile unknown has LSN 1/59393, past end of log at 1/28\r\nCommonly caused by moving a database from one database environment\r\nto another without clearing the database LSNs, or by removing all of\r\nthe log files from a database environment\r\nPage 0: metadata page corrupted\r\nPage 0: could not check metadata page\r\nwallet.dat: DB_VERIFY_BAD: Database verification failed\r\nfile unknown has LSN 1/59393, past end of log at 1/1076\r\nCommonly caused by moving a database from one database environment\r\nto another without clearing the database LSNs, or by removing all of\r\nthe log files from a database environment\r\nwallet.1396394242.bak: DB_VERIFY_BAD: Database verification failed\r\nfile unknown has LSN 1/59393, past end of log at 1/1076\r\nCommonly caused by moving a database from one database environment\r\nto another without clearing the database LSNs, or by removing all of\r\nthe log files from a database environment\r\nfile unknown has LSN 1/59393, past end of log at 1/1076\r\nCommonly caused by moving a database from one database environment\r\nto another without clearing the database LSNs, or by removing all of\r\nthe log files from a database environment\r\nfile unknown has LSN 1/59393, past end of log at 1/1076\r\nCommonly caused by moving a database from one database environment\r\nto another without clearing the database LSNs, or by removing all of\r\nthe log files from a database environment\r\nfile unknown has LSN 1/59393, past end of log at 1/1076\r\nCommonly caused by moving a database from one database environment\r\nto another without clearing the database LSNs, or by removing all of\r\nthe log files from a database environment\r\n```\r\n\r\nSystem events:\r\n```xml\r\n<Event xmlns=\"http://schemas.microsoft.com/win/2004/08/events/event\">\r\n  <System>\r\n    <Provider Name=\"Application Error\" /> \r\n    <EventID Qualifiers=\"0\">1000</EventID> \r\n    <Level>2</Level> \r\n    <Task>100</Task> \r\n    <Keywords>0x80000000000000</Keywords> \r\n    <TimeCreated SystemTime=\"2014-04-01T23:13:53.000000000Z\" /> \r\n    <EventRecordID>126257</EventRecordID> \r\n    <Channel>Application</Channel> \r\n    <Computer>uname</Computer> \r\n    <Security /> \r\n  </System>\r\n  <EventData>\r\n    <Data>bitcoin-qt.exe</Data> \r\n    <Data>0.9.0.0</Data> \r\n    <Data>51a93980</Data> \r\n    <Data>bitcoin-qt.exe</Data> \r\n    <Data>0.9.0.0</Data> \r\n    <Data>51a93980</Data> \r\n    <Data>c0000005</Data> \r\n    <Data>0000000000a28884</Data> \r\n    <Data>1374</Data> \r\n    <Data>01cf4df2e8d7d14e</Data> \r\n    <Data>E:\\Bitcoin-0.9.0\\bitcoin-qt.exe</Data> \r\n    <Data>E:\\Bitcoin-0.9.0\\bitcoin-qt.exe</Data> \r\n    <Data>4a2d0955-b9f3-11e3-bb66-002522d18708</Data> \r\n  </EventData>\r\n</Event>\r\n\r\n<Event xmlns=\"http://schemas.microsoft.com/win/2004/08/events/event\">\r\n  <System>\r\n    <Provider Name=\"Windows Error Reporting\" /> \r\n    <EventID Qualifiers=\"0\">1001</EventID> \r\n    <Level>4</Level> \r\n    <Task>0</Task> \r\n    <Keywords>0x80000000000000</Keywords> \r\n    <TimeCreated SystemTime=\"2014-04-01T23:14:24.000000000Z\" /> \r\n    <EventRecordID>126258</EventRecordID> \r\n    <Channel>Application</Channel> \r\n    <Computer>uname</Computer> \r\n    <Security /> \r\n  </System>\r\n  <EventData>\r\n    <Data>15393675</Data> \r\n    <Data>20</Data> \r\n    <Data>APPCRASH</Data> \r\n    <Data>Nicht verfÃÂ¼gbar</Data> \r\n    <Data>0</Data> \r\n    <Data>bitcoin-qt.exe</Data> \r\n    <Data>0.9.0.0</Data> \r\n    <Data>51a93980</Data> \r\n    <Data>bitcoin-qt.exe</Data> \r\n    <Data>0.9.0.0</Data> \r\n    <Data>51a93980</Data> \r\n    <Data>c0000005</Data> \r\n    <Data>0000000000a28884</Data> \r\n    <Data /> \r\n    <Data /> \r\n    <Data>C:\\Users\\uname\\AppData\\Local\\Temp\\WERFD28.tmp.WERInternalMetadata.xml</Data> \r\n    <Data>C:\\Users\\uname\\AppData\\Local\\Microsoft\\Windows\\WER\\ReportArchive\\AppCrash_bitcoin-qt.exe_5418e4c31125a14228975943264c24c5ae049d_771274c7</Data> \r\n    <Data /> \r\n    <Data>0</Data> \r\n    <Data>4a2d0955-b9f3-11e3-bb66-002522d18708</Data> \r\n    <Data>0</Data> \r\n  </EventData>\r\n</Event>\r\n```\r\n\r\nWindows error report:\r\n```\r\nVersion=1\r\nEventType=APPCRASH\r\nEventTime=130408676335983948\r\nReportType=2\r\nConsent=1\r\nUploadTime=130408676337754049\r\nReportIdentifier=4a2d0956-b9f3-11e3-bb66-002522d18708\r\nIntegratorReportIdentifier=4a2d0955-b9f3-11e3-bb66-002522d18708\r\nResponse.BucketId=15393675\r\nResponse.BucketTable=20\r\nResponse.type=4\r\nSig[0].Name=Anwendungsname\r\nSig[0].Value=bitcoin-qt.exe\r\nSig[1].Name=Anwendungsversion\r\nSig[1].Value=0.9.0.0\r\nSig[2].Name=Anwendungszeitstempel\r\nSig[2].Value=51a93980\r\nSig[3].Name=Fehlermodulname\r\nSig[3].Value=bitcoin-qt.exe\r\nSig[4].Name=Fehlermodulversion\r\nSig[4].Value=0.9.0.0\r\nSig[5].Name=Fehlermodulzeitstempel\r\nSig[5].Value=51a93980\r\nSig[6].Name=Ausnahmecode\r\nSig[6].Value=c0000005\r\nSig[7].Name=Ausnahmeoffset\r\nSig[7].Value=0000000000a28884\r\nDynamicSig[1].Name=Betriebsystemversion\r\nDynamicSig[1].Value=6.1.7601.2.1.0.256.48\r\nDynamicSig[2].Name=Gebietsschema-ID\r\nDynamicSig[2].Value=1031\r\nDynamicSig[22].Name=Zusatzinformation 1\r\nDynamicSig[22].Value=2424\r\nDynamicSig[23].Name=Zusatzinformation 2\r\nDynamicSig[23].Value=2424212a5196a04dd7c8ce2b9d9782d7\r\nDynamicSig[24].Name=Zusatzinformation 3\r\nDynamicSig[24].Value=3a7e\r\nDynamicSig[25].Name=Zusatzinformation 4\r\nDynamicSig[25].Value=3a7e278a7e89fc74f9d32b4b23228af3\r\nUI[2]=E:\\Bitcoin-0.9.0\\bitcoin-qt.exe\r\nUI[3]=bitcoin-qt.exe funktioniert nicht mehr\r\nUI[4]=Windows kann online nach einer LÃÂ¶sung fÃÂ¼r das Problem suchen.\r\nUI[5]=Online nach einer LÃÂ¶sung suchen und das Programm schlieÃÂen\r\nUI[6]=SpÃÂ¤ter online nach einer LÃÂ¶sung suchen und das Programm schlieÃÂen\r\nUI[7]=Programm schlieÃÂen\r\nLoadedModule[0]=E:\\Bitcoin-0.9.0\\bitcoin-qt.exe\r\nLoadedModule[1]=C:\\Windows\\SYSTEM32\\ntdll.dll\r\nLoadedModule[2]=C:\\Windows\\system32\\kernel32.dll\r\nLoadedModule[3]=C:\\Windows\\system32\\KERNELBASE.dll\r\nLoadedModule[4]=C:\\Windows\\system32\\ADVAPI32.dll\r\nLoadedModule[5]=C:\\Windows\\system32\\msvcrt.dll\r\nLoadedModule[6]=C:\\Windows\\SYSTEM32\\sechost.dll\r\nLoadedModule[7]=C:\\Windows\\system32\\RPCRT4.dll\r\nLoadedModule[8]=C:\\Windows\\system32\\CRYPT32.dll\r\nLoadedModule[9]=C:\\Windows\\system32\\MSASN1.dll\r\nLoadedModule[10]=C:\\Windows\\system32\\GDI32.dll\r\nLoadedModule[11]=C:\\Windows\\system32\\USER32.dll\r\nLoadedModule[12]=C:\\Windows\\system32\\LPK.dll\r\nLoadedModule[13]=C:\\Windows\\system32\\USP10.dll\r\nLoadedModule[14]=C:\\Windows\\system32\\IMM32.dll\r\nLoadedModule[15]=C:\\Windows\\system32\\MSCTF.dll\r\nLoadedModule[16]=C:\\Windows\\system32\\IPHLPAPI.DLL\r\nLoadedModule[17]=C:\\Windows\\system32\\NSI.dll\r\nLoadedModule[18]=C:\\Windows\\system32\\WINNSI.DLL\r\nLoadedModule[19]=C:\\Windows\\system32\\MSWSOCK.dll\r\nLoadedModule[20]=C:\\Windows\\system32\\WS2_32.dll\r\nLoadedModule[21]=C:\\Windows\\system32\\ole32.dll\r\nLoadedModule[22]=C:\\Windows\\system32\\OLEAUT32.dll\r\nLoadedModule[23]=C:\\Windows\\system32\\SHELL32.dll\r\nLoadedModule[24]=C:\\Windows\\system32\\SHLWAPI.dll\r\nLoadedModule[25]=C:\\Windows\\system32\\WINMM.dll\r\nLoadedModule[26]=C:\\Windows\\system32\\CRYPTSP.dll\r\nLoadedModule[27]=C:\\Windows\\system32\\rsaenh.dll\r\nLoadedModule[28]=C:\\Windows\\system32\\CRYPTBASE.dll\r\nLoadedModule[29]=C:\\Windows\\system32\\uxtheme.dll\r\nLoadedModule[30]=C:\\Windows\\system32\\dwmapi.dll\r\nLoadedModule[31]=C:\\Windows\\system32\\profapi.dll\r\nLoadedModule[32]=C:\\Windows\\System32\\wship6.dll\r\nLoadedModule[33]=C:\\Windows\\System32\\wshtcpip.dll\r\nLoadedModule[34]=C:\\Windows\\system32\\ntmarta.dll\r\nLoadedModule[35]=C:\\Windows\\system32\\WLDAP32.dll\r\nLoadedModule[36]=C:\\Windows\\system32\\pcwum.dll\r\nLoadedModule[37]=C:\\Windows\\system32\\mscoree.dll\r\nLoadedModule[38]=C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscoreei.dll\r\nLoadedModule[39]=C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\perfcounter.dll\r\nLoadedModule[40]=C:\\Windows\\system32\\pdh.dll\r\nLoadedModule[41]=C:\\Windows\\system32\\MSVCR110_CLR0400.dll\r\nLoadedModule[42]=C:\\Windows\\system32\\aspnet_counters.dll\r\nLoadedModule[43]=C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\aspnet_perf.dll\r\nLoadedModule[44]=C:\\Windows\\system32\\MSVCR100.dll\r\nLoadedModule[45]=C:\\Windows\\WinSxS\\amd64_microsoft.vc80.crt_1fc8b3b9a1e18e3b_8.0.50727.6195_none_88e41e092fab0294\\MSVCR80.dll\r\nLoadedModule[46]=C:\\Program Files\\Microsoft SQL Server\\100\\Shared\\instapi10.dll\r\nLoadedModule[47]=C:\\Program Files\\Microsoft SQL Server\\110\\Shared\\instapi110.dll\r\nLoadedModule[48]=C:\\Windows\\system32\\CFGMGR32.dll\r\nLoadedModule[49]=C:\\Windows\\system32\\NLAapi.dll\r\nLoadedModule[50]=C:\\Windows\\system32\\napinsp.dll\r\nLoadedModule[51]=C:\\Windows\\system32\\pnrpnsp.dll\r\nLoadedModule[52]=C:\\Windows\\system32\\DNSAPI.dll\r\nLoadedModule[53]=C:\\Windows\\System32\\winrnr.dll\r\nLoadedModule[54]=C:\\Windows\\system32\\rasadhlp.dll\r\nLoadedModule[55]=C:\\Windows\\System32\\fwpuclnt.dll\r\nLoadedModule[56]=C:\\Windows\\system32\\dhcpcsvc6.DLL\r\nLoadedModule[57]=C:\\Windows\\system32\\dhcpcsvc.DLL\r\nLoadedModule[58]=C:\\Windows\\system32\\RpcRtRemote.dll\r\nLoadedModule[59]=C:\\Windows\\system32\\CLBCatQ.DLL\r\nState[0].Key=Transport.DoneStage1\r\nState[0].Value=1\r\nState[1].Key=DataRequest\r\nState[1].Value=Bucket=15393675/nBucketTable=20/nResponse=1/n\r\nFriendlyEventName=Nicht mehr funktionsfÃÂ¤hig\r\nConsentKey=APPCRASH\r\nAppName=bitcoin-qt.exe\r\nAppPath=E:\\Bitcoin-0.9.0\\bitcoin-qt.exe\r\n```",
   "closed_at" : "2014-07-31T08:02:26Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 3,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3993/comments",
   "created_at" : "2014-04-02T02:11:29Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3993/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/3993",
   "id" : 30654451,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3993/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 3993,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Unhandled exception: st13runtime_error, file corruption (?)",
   "updated_at" : "2014-07-31T08:02:32Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3993",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/5836089?v=3",
      "events_url" : "https://api.github.com/users/dexX7/events{/privacy}",
      "followers_url" : "https://api.github.com/users/dexX7/followers",
      "following_url" : "https://api.github.com/users/dexX7/following{/other_user}",
      "gists_url" : "https://api.github.com/users/dexX7/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/dexX7",
      "id" : 5836089,
      "login" : "dexX7",
      "organizations_url" : "https://api.github.com/users/dexX7/orgs",
      "received_events_url" : "https://api.github.com/users/dexX7/received_events",
      "repos_url" : "https://api.github.com/users/dexX7/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/dexX7/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/dexX7/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/dexX7"
   }
}
