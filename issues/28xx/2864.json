{
   "assignee" : null,
   "body" : "This patch enables one to configure a whitelist of RPC commands that can be called for each allowed client IP.\r\n\r\nLet's look at the motivating use case for this feature.   Consider a website that accepts bitcoin payments using the bitcoind API directly.  The webserver and bitcoind are on separate servers.  It is desirable that the webserver be able to call getnewaddress() and gettransaction (or listtransactions).  It is highly undesirable (security risk) that the webserver be able to call any of the send* commands or stop command, or probably others, especially because the public-facing webserver is the most likely target to be attacked and possibly compromised.\r\n\r\nAt this point, let's not get distracted with a discussion about using hot wallets vs cold storage vs 3rd party API.  Instead suffice to say that the website has a need to do this, but desires to be as secure about it as possible.\r\n\r\nIt is also possible to envision more complex scenarios with various client IPs, each with differering requirements / permissions, or all the same, as in a pool of frontend webservers.\r\n\r\nOkay, so -rpcipcmds to the rescue.  Now the site administrator can configure bitcoind to only allow desired RPC calls from the webserver IP.  Any other command results in \"Method not allowed for client IP.\" json-rpc error.\r\n\r\n./bitcoind --help | grep rpcip\r\n  -rpcipcmds=<ip>,<cmd>  Allow only specific commands from specified IP address. <ip>,<cmd1>,<cmd2>,<cmd3>...\r\n\r\nExample bitcoin.conf usage:\r\n\r\nrpcallowip=192.168.2.200\r\nrpcipcmds=192.168.2.200,getnewaddress\r\nrpcipcmds=127.0.0.1,getnewaddress,sendtoaddress,getinfo,stop,help\r\n\r\nImplementation Notes:\r\n\r\n1) If an IP is allowed with rpcallowip but does not have an rpcipcmds entry then all commands can be used.\r\n\r\n2) WildCards in IP are accepted.\r\n\r\n3) Works with single command invocation and also batch invocation.  \r\n\r\n4) For batch invocation, all commands are checked before any command is called.  So all or nothing.\r\n\r\n5) Some might find the syntax a little funky.  I considered using &lt;ip&gt;:&lt;cmd&gt; format, one per line, but rejected it because it requires specifying the same IP over and over.  The CSV format enables &lt;ip&gt;,&lt;cmd&gt;,&lt;cmd&gt;,&lt;cmd&gt;... per line and is easy to read/grok and to parse.  So that was my thought process.\r\n\r\n6) This is my first bitcoind modification effort, and my first ever github pull request.  Also, I am not a networking expert, and my C++ is very rusty.  It is likely something could have been done better, code or pull request does not meet standards, etc.  If so, my apologies in advance.  The patch meets my needs so far, and I felt I should contribute it in case it can benefit others.  Feel free to re-work, re-write etc as necessary.\r\n\r\n7) -rpcipcmds is kind of hard to read.  I originally called it rpcallowipmethods.  But that didn't format nicely with the other commands in the help.  This does.  \r\n\r\nTesting:\r\n\r\n*  Has been briefly tested with both single and batch invocation from localhost as well as a remote IP.  Tested with IPv4 addresses only.\r\n\r\n* I did not create a unit test for it.  Maybe could test with localhost.... remote IP seems hard.\r\n",
   "closed_at" : "2013-08-15T05:13:07Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/331997?v=3",
      "events_url" : "https://api.github.com/users/gavinandresen/events{/privacy}",
      "followers_url" : "https://api.github.com/users/gavinandresen/followers",
      "following_url" : "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url" : "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/gavinandresen",
      "id" : 331997,
      "login" : "gavinandresen",
      "organizations_url" : "https://api.github.com/users/gavinandresen/orgs",
      "received_events_url" : "https://api.github.com/users/gavinandresen/received_events",
      "repos_url" : "https://api.github.com/users/gavinandresen/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/gavinandresen/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/gavinandresen"
   },
   "comments" : 4,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2864/comments",
   "created_at" : "2013-07-29T07:17:39Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2864/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/2864",
   "id" : 17326300,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2864/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 2864,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/2864.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2864",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/2864.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2864"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Security. Adds config option -rpcipcmds to enable filtering which RPC commands can be called per client IP.",
   "updated_at" : "2014-07-12T14:03:43Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2864",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/5110592?v=3",
      "events_url" : "https://api.github.com/users/dan-da/events{/privacy}",
      "followers_url" : "https://api.github.com/users/dan-da/followers",
      "following_url" : "https://api.github.com/users/dan-da/following{/other_user}",
      "gists_url" : "https://api.github.com/users/dan-da/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/dan-da",
      "id" : 5110592,
      "login" : "dan-da",
      "organizations_url" : "https://api.github.com/users/dan-da/orgs",
      "received_events_url" : "https://api.github.com/users/dan-da/received_events",
      "repos_url" : "https://api.github.com/users/dan-da/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/dan-da/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/dan-da/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/dan-da"
   }
}
