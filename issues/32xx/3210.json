{
   "assignee" : null,
   "body" : "Usability issue: `bitcoind` gives an incorrect error message when one tries to `dumppriv` a key while the wallet is still locked. Unlike the other commands I've tried which immediately point to the lock as the reason for the failure, `dumppriv` emits a frightening message that the private key does not exist (implying one has completely lost the funds at that address). The relevant code should do the same check for lock as the other commands.\r\n\r\nInstalled version (Debian testing):\r\n\r\n    $ apt-cache show bitcoind\r\n    Package: bitcoind\r\n    Status: install ok installed\r\n    Priority: optional\r\n    Section: utils\r\n    Installed-Size: 2648\r\n    Maintainer: Debian Bitcoin Packaging Team <pkg-bitcoin-devel@lists.alioth.debian.org>\r\n    Architecture: amd64\r\n    Source: bitcoin\r\n    Version: 0.8.3-1\r\n    Depends: libboost-filesystem1.49.0 (>= 1.49.0-1), libboost-program-options1.49.0 (>= 1.49.0-1), libboost-system1.49.0 (>= 1.49.0-1), libboost-thread1.49.0 (>= 1.49.0-1), libc6 (>= 2.15), libdb5.1++, libgcc1 (>= 1:4.1.1), libleveldb1, libminiupnpc5, libssl1.0.0 (>= 1.0.0), libstdc++6 (>= 4.6), zlib1g (>= 1:1.1.4)\r\n    Suggests: db-util, db4.8-util\r\n    ...\r\n\r\nThe problem:\r\n\r\n    $ # normal, helpful, meaningful error message with a locked wallet:\r\n    $ bitcoind sendfrom 1AZvaBEJMiK8AJ5GvfvLWgHjWgL59TRPGy 1BWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW 1\r\n    error: {\"code\":-13,\"message\":\"Error: Please enter the wallet passphrase with walletpassphrase first.\"}\r\n    \r\n    $ # problematic error message with dumpprivkey:\r\n    $ bitcoind dumpprivkey 1AZvaBEJMiK8AJ5GvfvLWgHjWgL59TRPGy\r\n    error: {\"code\":-4,\"message\":\"Private key for address 1AZvaBEJMiK8AJ5GvfvLWgHjWgL59TRPGy is not known\"}\r\n    \r\n    $ # don't give me a heart attack like that - the private key *is* known! we just need to unlock the wallet:\r\n    $   bitcoind walletpassphrase XXXXXXXXXXXXXXXXXXXX 60\r\n    $ bitcoind dumpprivkey 1AZvaBEJMiK8AJ5GvfvLWgHjWgL59TRPGy\r\n    KwpYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY",
   "closed_at" : "2013-11-06T01:41:23Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
      "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sipa/followers",
      "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sipa",
      "id" : 548488,
      "login" : "sipa",
      "organizations_url" : "https://api.github.com/users/sipa/orgs",
      "received_events_url" : "https://api.github.com/users/sipa/received_events",
      "repos_url" : "https://api.github.com/users/sipa/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sipa"
   },
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3210/comments",
   "created_at" : "2013-11-05T23:49:54Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3210/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/3210",
   "id" : 22161251,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3210/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 3210,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Misleading error on dumppriv while wallet is locked",
   "updated_at" : "2013-11-06T01:42:50Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3210",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/352559?v=3",
      "events_url" : "https://api.github.com/users/gwern/events{/privacy}",
      "followers_url" : "https://api.github.com/users/gwern/followers",
      "following_url" : "https://api.github.com/users/gwern/following{/other_user}",
      "gists_url" : "https://api.github.com/users/gwern/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/gwern",
      "id" : 352559,
      "login" : "gwern",
      "organizations_url" : "https://api.github.com/users/gwern/orgs",
      "received_events_url" : "https://api.github.com/users/gwern/received_events",
      "repos_url" : "https://api.github.com/users/gwern/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/gwern/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/gwern/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/gwern"
   }
}
