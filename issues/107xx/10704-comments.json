[
   {
      "body" : "Looks like this test is acting up: \r\nhttps://travis-ci.org/bitcoin/bitcoin/jobs/248398016\r\nhttps://travis-ci.org/bitcoin/bitcoin/jobs/248398018\r\nMight need a similar change to #10659.",
      "created_at" : "2017-06-29T15:39:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#issuecomment-312005841",
      "id" : 312005841,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10704",
      "updated_at" : "2017-06-29T15:39:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/312005841",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r124844368"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124844368"
         }
      },
      "body" : "I don't feel strongly, but the reason I put this in was that I didn't think that changes to the default test framework should cause tests to break -- since this test relies on a particular configuration, I felt it was best to define that locally.",
      "commit_id" : "b394a00f6c34e20e5ff555c8a07c6558e319a34a",
      "created_at" : "2017-06-29T16:07:43Z",
      "diff_hunk" : "@@ -37,45 +23,47 @@\n        * submit block to node\n        * if node crashed on/after submitting:\n          - restart until recovery succeeds\n-         - check that utxo matches node3 using gettxoutsetinfo\n-'''\n+         - check that utxo matches node3 using gettxoutsetinfo\"\"\"\n \n-class ChainstateWriteCrashTest(BitcoinTestFramework):\n+import errno\n+import http.client\n+import random\n+import time\n+\n+from test_framework.mininode import *\n+from test_framework.script import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n \n+class ChainstateWriteCrashTest(BitcoinTestFramework):\n     def __init__(self):\n         super().__init__()\n-        self.num_nodes = 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r124844368",
      "id" : 124844368,
      "original_commit_id" : "b7870b7949e614d90b2f831b42065afc0ab694f2",
      "original_position" : 45,
      "path" : "test/functional/dbcrash.py",
      "position" : null,
      "pull_request_review_id" : 47174299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704",
      "updated_at" : "2017-06-30T15:31:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124844368",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r124845800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124845800"
         }
      },
      "body" : "Also, can you set a custom timewait for the RPC connections in this test to resolve the travis issues that have come up so far:\r\nhttps://travis-ci.org/bitcoin/bitcoin/jobs/248398018#L2153",
      "commit_id" : "b394a00f6c34e20e5ff555c8a07c6558e319a34a",
      "created_at" : "2017-06-29T16:13:28Z",
      "diff_hunk" : "@@ -37,45 +23,47 @@\n        * submit block to node\n        * if node crashed on/after submitting:\n          - restart until recovery succeeds\n-         - check that utxo matches node3 using gettxoutsetinfo\n-'''\n+         - check that utxo matches node3 using gettxoutsetinfo\"\"\"\n \n-class ChainstateWriteCrashTest(BitcoinTestFramework):\n+import errno\n+import http.client\n+import random\n+import time\n+\n+from test_framework.mininode import *\n+from test_framework.script import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n \n+class ChainstateWriteCrashTest(BitcoinTestFramework):\n     def __init__(self):\n         super().__init__()\n-        self.num_nodes = 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r124845800",
      "id" : 124845800,
      "original_commit_id" : "b7870b7949e614d90b2f831b42065afc0ab694f2",
      "original_position" : 45,
      "path" : "test/functional/dbcrash.py",
      "position" : null,
      "pull_request_review_id" : 47174299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704",
      "updated_at" : "2017-06-30T15:31:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124845800",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r124846671"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124846671"
         }
      },
      "body" : "I think this RemoteDisconnected exception may not exist pre-3.5, which would explain this travis failure:\r\nhttps://travis-ci.org/bitcoin/bitcoin/jobs/248398016#L3321\r\n\r\nI'm not sure what the best way to handle that is...",
      "commit_id" : "b394a00f6c34e20e5ff555c8a07c6558e319a34a",
      "created_at" : "2017-06-29T16:17:10Z",
      "diff_hunk" : "@@ -99,14 +87,16 @@ def restart_node(self, node_index, expected_tip):\n         # and make sure that recovery happens.\n         raise AssertionError(\"Unable to successfully restart node %d in allotted time\", node_index)\n \n-    # Try submitting a block to the given node.\n-    # Catch any exceptions that indicate the node has crashed.\n-    # Returns true if the block was submitted successfully; false otherwise.\n     def submit_block_catch_error(self, node_index, block):\n+        \"\"\"Try submitting a block to the given node.\n+\n+        Catch any exceptions that indicate the node has crashed.\n+        Returns true if the block was submitted successfully; false otherwise.\"\"\"\n+\n         try:\n             self.nodes[node_index].submitblock(block)\n             return True\n-        except (httplib.CannotSendRequest, httplib.RemoteDisconnected) as e:\n+        except (http.client.CannotSendRequest, http.client.RemoteDisconnected) as e:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r124846671",
      "id" : 124846671,
      "original_commit_id" : "b7870b7949e614d90b2f831b42065afc0ab694f2",
      "original_position" : 106,
      "path" : "test/functional/dbcrash.py",
      "position" : null,
      "pull_request_review_id" : 47174299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704",
      "updated_at" : "2017-06-30T15:31:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124846671",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r124847135"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124847135"
         }
      },
      "body" : "Feel free to address the TODO as well :)  I think you just do something like `relayfee = self.nodes[0].getnetworkinfo()['relayfee']`, and then convert to the right units.",
      "commit_id" : "b394a00f6c34e20e5ff555c8a07c6558e319a34a",
      "created_at" : "2017-06-29T16:19:17Z",
      "diff_hunk" : "@@ -175,9 +168,8 @@ def verify_utxo_hash(self):\n                 nodei_utxo_hash = self.restart_node(i, self.nodes[3].getbestblockhash())\n             assert_equal(nodei_utxo_hash, node3_utxo_hash)\n \n-\n     def generate_small_transactions(self, node, count, utxo_list):\n-        FEE = 1000 # TODO: replace this with node relay fee based calculation\n+        FEE = 1000  # TODO: replace this with node relay fee based calculation",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r124847135",
      "id" : 124847135,
      "original_commit_id" : "b7870b7949e614d90b2f831b42065afc0ab694f2",
      "original_position" : 148,
      "path" : "test/functional/dbcrash.py",
      "position" : 161,
      "pull_request_review_id" : 47174299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704",
      "updated_at" : "2017-06-30T15:31:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124847135",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r124889257"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124889257"
         }
      },
      "body" : "We might as well just get rid of the default value. There is nothing special about \"4\" that justifies to use it as default value.",
      "commit_id" : "b394a00f6c34e20e5ff555c8a07c6558e319a34a",
      "created_at" : "2017-06-29T19:15:44Z",
      "diff_hunk" : "@@ -37,45 +23,47 @@\n        * submit block to node\n        * if node crashed on/after submitting:\n          - restart until recovery succeeds\n-         - check that utxo matches node3 using gettxoutsetinfo\n-'''\n+         - check that utxo matches node3 using gettxoutsetinfo\"\"\"\n \n-class ChainstateWriteCrashTest(BitcoinTestFramework):\n+import errno\n+import http.client\n+import random\n+import time\n+\n+from test_framework.mininode import *\n+from test_framework.script import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n \n+class ChainstateWriteCrashTest(BitcoinTestFramework):\n     def __init__(self):\n         super().__init__()\n-        self.num_nodes = 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r124889257",
      "id" : 124889257,
      "original_commit_id" : "b7870b7949e614d90b2f831b42065afc0ab694f2",
      "original_position" : 45,
      "path" : "test/functional/dbcrash.py",
      "position" : null,
      "pull_request_review_id" : 47224592,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704",
      "updated_at" : "2017-06-30T15:31:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124889257",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r125046235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125046235"
         }
      },
      "body" : "ok, you've convinced me. I'll leave this in for now.\r\n\r\nWe can remove the default num_nodes in a future PR (and probably remove the default topology and premine while we're at it).",
      "commit_id" : "b394a00f6c34e20e5ff555c8a07c6558e319a34a",
      "created_at" : "2017-06-30T14:02:47Z",
      "diff_hunk" : "@@ -37,45 +23,47 @@\n        * submit block to node\n        * if node crashed on/after submitting:\n          - restart until recovery succeeds\n-         - check that utxo matches node3 using gettxoutsetinfo\n-'''\n+         - check that utxo matches node3 using gettxoutsetinfo\"\"\"\n \n-class ChainstateWriteCrashTest(BitcoinTestFramework):\n+import errno\n+import http.client\n+import random\n+import time\n+\n+from test_framework.mininode import *\n+from test_framework.script import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n \n+class ChainstateWriteCrashTest(BitcoinTestFramework):\n     def __init__(self):\n         super().__init__()\n-        self.num_nodes = 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r125046235",
      "id" : 125046235,
      "original_commit_id" : "b7870b7949e614d90b2f831b42065afc0ab694f2",
      "original_position" : 45,
      "path" : "test/functional/dbcrash.py",
      "position" : null,
      "pull_request_review_id" : 47399007,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704",
      "updated_at" : "2017-06-30T15:31:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125046235",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r125067559"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125067559"
         }
      },
      "body" : "I think I've fixed this in my fixup commit b394a00f6c34e20e5ff555c8a07c6558e319a34a. Just catch different errors depending on which version of Python is being run.\r\n\r\nI think later we should move this logic to a separate method named `send_rpc_may_fail()` or similar in TestNode to keep the test script code clean.",
      "commit_id" : "b394a00f6c34e20e5ff555c8a07c6558e319a34a",
      "created_at" : "2017-06-30T15:33:26Z",
      "diff_hunk" : "@@ -99,14 +87,16 @@ def restart_node(self, node_index, expected_tip):\n         # and make sure that recovery happens.\n         raise AssertionError(\"Unable to successfully restart node %d in allotted time\", node_index)\n \n-    # Try submitting a block to the given node.\n-    # Catch any exceptions that indicate the node has crashed.\n-    # Returns true if the block was submitted successfully; false otherwise.\n     def submit_block_catch_error(self, node_index, block):\n+        \"\"\"Try submitting a block to the given node.\n+\n+        Catch any exceptions that indicate the node has crashed.\n+        Returns true if the block was submitted successfully; false otherwise.\"\"\"\n+\n         try:\n             self.nodes[node_index].submitblock(block)\n             return True\n-        except (httplib.CannotSendRequest, httplib.RemoteDisconnected) as e:\n+        except (http.client.CannotSendRequest, http.client.RemoteDisconnected) as e:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r125067559",
      "id" : 125067559,
      "original_commit_id" : "b7870b7949e614d90b2f831b42065afc0ab694f2",
      "original_position" : 106,
      "path" : "test/functional/dbcrash.py",
      "position" : null,
      "pull_request_review_id" : 47423646,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704",
      "updated_at" : "2017-06-30T15:33:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125067559",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r125067666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125067666"
         }
      },
      "body" : "I haven't addressed this. What are the downsides to using a fixed fee?",
      "commit_id" : "b394a00f6c34e20e5ff555c8a07c6558e319a34a",
      "created_at" : "2017-06-30T15:33:54Z",
      "diff_hunk" : "@@ -175,9 +168,8 @@ def verify_utxo_hash(self):\n                 nodei_utxo_hash = self.restart_node(i, self.nodes[3].getbestblockhash())\n             assert_equal(nodei_utxo_hash, node3_utxo_hash)\n \n-\n     def generate_small_transactions(self, node, count, utxo_list):\n-        FEE = 1000 # TODO: replace this with node relay fee based calculation\n+        FEE = 1000  # TODO: replace this with node relay fee based calculation",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#discussion_r125067666",
      "id" : 125067666,
      "original_commit_id" : "b7870b7949e614d90b2f831b42065afc0ab694f2",
      "original_position" : 148,
      "path" : "test/functional/dbcrash.py",
      "position" : 161,
      "pull_request_review_id" : 47423782,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10704",
      "updated_at" : "2017-06-30T15:33:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/125067666",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "I think I've fixed the Travis issues, although it's difficult to tell for sure since Travis only runs extended tests in master.\r\n\r\nFor the first, I split the generate call in `create_confirmed_utxos()` into many smaller generate calls. For the second, I catch different errors depending on the Python version.\r\n\r\nBoth of these solutions should be moved into TestNode once that's merged (ie a `node_generate()` method which automatically breaks the generate call into smaller pieces, and a `send_rpc_may_fail()` method for RPCs that may or may not time out).\r\n\r\nI haven't addressed the fixed fee todo. I don't think that's too much of a problem, but let me know if you think it could cause issues.\r\n\r\nOne question: I'm confused about the randomness in re-org'ing. As far as I can see, the way this works:\r\n\r\n- pick a block at random between the start of the test and the current tip.\r\n- pick random x in [0,1]. If x < 1 / (depth of random block + 4), then re-org back to random block\r\n- build to current tip + 1\r\n(repeat x 40)\r\n\r\nThat throws up events with very low probabilities. For example, we'll re-org back 40 blocks in 1/40 * 1/44 = 1/1760 tests. For me, such indeterminateness is troubling. If there was a problem that caused large re-orgs to fail, then they'd only be caught very intermittently by this test, and it'd be difficult to debug.\r\n\r\nI prefer my tests to be more deterministic where possible. How would you feel about changing the re-orgs to a fixed schedule (ie make sure the test covers re-orgs of 1, 2, 4, 8, 16 and 32 blocks, or some similar schedule)?",
      "created_at" : "2017-06-30T15:46:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#issuecomment-312302860",
      "id" : 312302860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10704",
      "updated_at" : "2017-06-30T15:46:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/312302860",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "utACK b394a00f6c34e20e5ff555c8a07c6558e319a34a. Feel free to squash.",
      "created_at" : "2017-07-02T20:10:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#issuecomment-312514137",
      "id" : 312514137,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10704",
      "updated_at" : "2017-07-02T20:10:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/312514137",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "squashed",
      "created_at" : "2017-07-02T20:55:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#issuecomment-312516438",
      "id" : 312516438,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10704",
      "updated_at" : "2017-07-02T20:55:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/312516438",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "Going to merge this now, since it might fix the test failures we see on master right now. Further cleanup can always be completed in later commits.",
      "created_at" : "2017-07-03T07:37:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#issuecomment-312571773",
      "id" : 312571773,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10704",
      "updated_at" : "2017-07-03T07:37:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/312571773",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "> That throws up events with very low probabilities. For example, we'll re-org back 40 blocks in 1/40 * 1/44 = 1/1760 tests. For me, such indeterminateness is troubling. If there was a problem that caused large re-orgs to fail, then they'd only be caught very intermittently by this test, and it'd be difficult to debug.\r\n\r\n> I prefer my tests to be more deterministic where possible. How would you feel about changing the re-orgs to a fixed schedule (ie make sure the test covers re-orgs of 1, 2, 4, 8, 16 and 32 blocks, or some similar schedule)?\r\n\r\n@jnewbery I don't think the right way to think of this test is that we're testing reorgs.  Really, we're testing a more complex state (utxo cache + disk state) and trying to get as much coverage of various edge cases as we can.  Since it's hard for me to imagine all the possible states we could be in, I wanted to simulate as much normal looking bitcoin transaction volume as I reasonably could, and then randomly stress it with reorgs and crashes in the hopes that if an edge case had a bug, we'd eventually see it.\r\n\r\nIf I knew exactly how to enumerate all the edge cases, then I'd happily convert this to a deterministic set of tests, but lacking that I think the randomness here is an appropriate test strategy.",
      "created_at" : "2017-07-06T11:06:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#issuecomment-313366147",
      "id" : 313366147,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10704",
      "updated_at" : "2017-07-06T11:06:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/313366147",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "> I don't think the right way to think of this test ... , but lacking that I think the randomness here is an appropriate test strategy.\r\n\r\nACK",
      "created_at" : "2017-07-06T11:41:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10704#issuecomment-313372606",
      "id" : 313372606,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10704",
      "updated_at" : "2017-07-06T11:41:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/313372606",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   }
]
