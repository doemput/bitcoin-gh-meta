[
   {
      "body" : "> Currently pruneblockchain(0) will call StateFlushToDisk. This might not be required/wanted.\r\n\r\nIf it doesn't cause an error or corruption, I'd prefer not to add a special case for it. There is no reason for calling it with 0 so if there is a slight performance overhead when that's done, that's too bad.",
      "created_at" : "2017-01-12T11:06:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9524#issuecomment-272136312",
      "id" : 272136312,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9524",
      "updated_at" : "2017-01-12T11:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/272136312",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "The thing is that it clashes with the default value of FlushStateToDisk(nManualPruneHeight=0), which is used to indicate \"legacy\" pruning. It might cause unwanted bugs if someone refactors the code in the future.",
      "created_at" : "2017-01-12T11:12:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9524#issuecomment-272137391",
      "id" : 272137391,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9524",
      "updated_at" : "2017-01-12T11:12:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/272137391",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "> The thing is that it clashes with the default value of FlushStateToDisk(nManualPruneHeight=0), which is used to indicate \"legacy\" pruning. It might cause unwanted bugs if someone refactors the code in the future.\r\n\r\nIt seems that in that case there will also be automatic problems. On IRC yesterday there was a discussion about this, and there are more paths through which it will get into `FlushStateToDisk` with `nManualPruneHeight=0` when manual pruning is enabled. This change would cover only one of them.\r\n\r\nI wrongly assumed that `fCheckForPruning` would always be false when pruning manual. But it can be set, in which case `FlushStateToDisk` will be called from block processing.\r\n\r\nFor 0.15 or later it would be nice to refactor the pruning code. `fCheckForPruning` would be better as an argument of the appropriate functions instead of a global flag (to have a better grasp on when it's set and not set), and the pruning mode `OFF|MANUAL|AUTO` would be better represented as an enum.",
      "created_at" : "2017-02-17T08:18:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9524#issuecomment-280584502",
      "id" : 280584502,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9524",
      "updated_at" : "2017-02-17T08:18:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280584502",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Ok, I still stand by what I said above, the code in question should be refactored as there are various paths where this could theoretically go wrong, catching this at the RPC call site will only solve one entry point, and for the right might hide eventual problems further. \r\n\r\nE.g. let's say we added a test that calls pruneblockchain(0) and verifies that it does nothing would no longer test anything useful.",
      "created_at" : "2017-04-19T08:32:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9524#issuecomment-295163324",
      "id" : 295163324,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9524",
      "updated_at" : "2017-04-19T08:32:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/295163324",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
