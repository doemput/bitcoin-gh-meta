[
   {
      "body" : "Because our p2p protocol defines most messages as completely blocking (ie if you send a block message the remote peer must have processed it before processing any other messages from you), I dont think this is the right approach. I think we're gonna need something more along the lines of multiple ProcessMessages threads (as well as all the lock contention fixes that are going into 0.14).",
      "created_at" : "2017-01-20T15:52:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274105843",
      "id" : 274105843,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9599",
      "updated_at" : "2017-01-20T15:52:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/274105843",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt you are of course correct, given that the protocol is defined by the code, but was this designed intentionally? Is there any advantage in this blocking?\r\n\r\nUpon further thought, I don't think this is a concern, as this PR only affects during IBD and not when the chain is synced, so the behaviour is the same, but just means that ping times are not affected (as they are currently) and the block download no longer freezes during IBD.\r\n\r\nBut if during IBD you did want to re-inforce behaviour, you could simply postpone responding to getblocks and getheader requests while fActivateChain is true - what would be the benefit in doing this though?",
      "created_at" : "2017-01-21T01:56:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274224234",
      "id" : 274224234,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9599",
      "updated_at" : "2017-01-21T03:23:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/274224234",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Indeed, this fact developed by accident simply because that's how the\nimplementation worked. However, as time went on, other implementations\n(and even Bitcoin Core, though to a lesser extent) started relying on\nthis part of the protocol, so we can't do much to change it now.\n\nEven still, it isn't such a bad design, in the end, as it both\nsimplifies some stuff and bounds how much work a node can make us do -\none thread's worth.\n\nOn 01/21/17 01:56, R E Broadley wrote:\n> @TheBlueMatt <https://github.com/TheBlueMatt> you are of course correct,\n> given that the protocol is defined by the code, but was this designed\n> intentionally? Is there any advantage in this blocking?\n> \n> Ã¢ÂÂ\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274224234>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAnoHo9vXWweenIdUihdKoEJnZxflcNkks5rUWXIgaJpZM4LpHv->.\n> \n",
      "created_at" : "2017-01-21T04:30:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274234414",
      "id" : 274234414,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9599",
      "updated_at" : "2017-01-21T04:30:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/274234414",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt With this PR it's still only 1 thread that does the work. I'm not sure how the blocking simplifies stuff - it makes ping times fairly unreliable, and it also causes nodes to timeout and become unresponsive, thereby delaying IBD of all nodes, not just the blocking node. It makes it harder to detect misbehaving nodes also by the fact that the base-line behavior is more unreliable. I think overall, making validation have its own thread will in time make the whole network more reliable and make the network smoother (i.e. less latency fluctuations and timeouts).\r\n\r\nI'm not yet understanding any reasons for keeping the blocking behavior - which implementations rely on it please?",
      "created_at" : "2017-01-21T06:43:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274241951",
      "id" : 274241951,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9599",
      "updated_at" : "2017-01-21T06:43:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/274241951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Having latency go up when a node is overloaded provides useful information to its peers - anything where it's peers care about the latency to a node they probably care about whether it can respond quickly to messages.\n\nAt least Bitcoinj relies on it in a few places to, eg, send a getdata followed by ping to know whether the getdata will be responded to.\n\nOn January 21, 2017 1:43:46 AM EST, R E Broadley <notifications@github.com> wrote:\n>@TheBlueMatt With this PR it's still only 1 thread that does the work.\n>I'm not sure how the blocking simplifies stuff - it makes ping times\n>fairly unreliable, and it also causes nodes to timeout and become\n>unresponsive, thereby delaying IBD of all nodes, not just the blocking\n>node. It makes it harder to detect misbehaving nodes also by the fact\n>that the base-line behavior is more unreliable. I think overall, making\n>validation have its own thread will in time make the whole network more\n>reliable and make the network smoother (i.e. less latency fluctuations\n>and timeouts).\n>\n>I'm not yet understanding any reasons for keeping the blocking behavior\n>- which implementations rely on it please?\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274241951\n",
      "created_at" : "2017-01-21T15:25:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274268082",
      "id" : 274268082,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9599",
      "updated_at" : "2017-01-21T15:25:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/274268082",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt To try to use an analogy to your argument. Which would you rather have? The ebola virus AND useful information about it - or neither? The useful information about poor latency might be useful, but if we can remove the latency - are we really going to miss it because the useful information about it has gone also? Anyway, we'll still have the historical information about it - but I don't see how the argument of \"being able to observe it\" is sufficient reason to keep it. I must be missing something - can you elaborate perhaps?",
      "created_at" : "2017-01-23T01:19:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274376530",
      "id" : 274376530,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9599",
      "updated_at" : "2017-01-23T01:21:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/274376530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Even if we were to decide it was useless, we couldn't remove it. As noted, other clients rely on our serialization behavior pretty heavily (and I'm sure we do, to some extent, though I don't recall any specific places where right now).\n\nOn January 22, 2017 8:19:19 PM EST, R E Broadley <notifications@github.com> wrote:\n>@TheBlueMatt To try to use an analogy to your argument. Which would you\n>rather have? The ebola virus AND useful information about it - or\n>neither? The useful information about poor latency might be useful, but\n>if we can remove the latency - are we really going to miss it because\n>the useful information about it has gone also?\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274376530\n",
      "created_at" : "2017-01-23T13:40:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-274490088",
      "id" : 274490088,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9599",
      "updated_at" : "2017-01-23T13:40:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/274490088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "It is a bad design to handle protocol messages out of order for a single peer.",
      "created_at" : "2017-01-29T02:48:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-275890042",
      "id" : 275890042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9599",
      "updated_at" : "2017-01-29T02:48:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/275890042",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell I agree, but, I think the only place that this could happen with this PR is if a node serves a block and then immediately sends either a getblocks or a getheaders. I'm not aware any nodes are currently doing this, and if they are, I could modify this PR to delay responding to the getheaders or getblocks until the chain has been updated quite easily. If this functionality is so important, perhaps a test ought to be added to test for this?",
      "created_at" : "2017-01-29T13:43:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-275914524",
      "id" : 275914524,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9599",
      "updated_at" : "2017-01-29T13:43:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/275914524",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "This seems to break the P2P protocol, closing.",
      "created_at" : "2017-04-09T16:01:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9599#issuecomment-292794556",
      "id" : 292794556,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9599",
      "updated_at" : "2017-04-09T16:01:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/292794556",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
