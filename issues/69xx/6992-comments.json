[
   {
      "body" : "Concept ACK. ",
      "created_at" : "2015-11-11T21:09:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155911428",
      "id" : 155911428,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T21:09:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155911428",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6992#discussion_r44590588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6992"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44590588"
         }
      },
      "body" : "This algorithm is done several times, and is a cluster to read.  Could you extract it out at all to make review easier?",
      "commit_id" : "32520bfb9e450522cc507faf30bf2eadecdf349b",
      "created_at" : "2015-11-11T21:43:10Z",
      "diff_hunk" : "@@ -2316,8 +2326,13 @@ static bool ActivateBestChainStep(CValidationState &state, CBlockIndex *pindexMo\n     }\n     }\n \n-    if (fBlocksDisconnected)\n-        mempool.TrimToSize(GetArg(\"-maxmempool\", DEFAULT_MAX_MEMPOOL_SIZE) * 1000000);\n+    if (fBlocksDisconnected) {\n+        size_t mempoolLimit = GetArg(\"-maxmempool\", DEFAULT_MAX_MEMPOOL_SIZE) * 1000000;\n+        const double defaultPriorityLimit = (double) GetArg(\"-blockprioritysize\", DEFAULT_BLOCK_PRIORITY_SIZE) / (double) GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+        size_t priorityLimit = GetArg(\"-prioritylimit\", defaultPriorityLimit * mempoolLimit);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#discussion_r44590588",
      "id" : 44590588,
      "original_commit_id" : "32520bfb9e450522cc507faf30bf2eadecdf349b",
      "original_position" : 46,
      "path" : "src/main.cpp",
      "position" : 46,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6992",
      "updated_at" : "2015-11-11T21:43:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44590588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "I'm not sure we need a separate 'space' for the priority transactions.\r\nConceptually the entire mempool algorithm shouldn't be more complicated than:\r\n\r\n* Sort transactions by descending, comparing fees, then priority.\r\n* Fees less than `minRelayTxFee` should be considered `0`, allowing priority to take precedence\r\n* Drop transactions on the lower part of the spectrum until ideal memory usage is met.\r\n\r\nEven a simplistic 'fitness' function could be used which combines priority and fees in a way that is considered sane, and that function used rather than this mix-match combination of fee/priority comparisons everywhere.\r\n\r\n**edit**: And then there is that which @TheBlueMatt points out,  is priority even worth it?",
      "created_at" : "2015-11-11T21:48:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155920268",
      "id" : 155920268,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T21:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155920268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "NAK. I thought there was agreement that priority space is a bad idea in general. The amount of developer time that has gone into making priority space work properly is no where near the gains from having it.",
      "created_at" : "2015-11-11T21:52:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155921181",
      "id" : 155921181,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T21:52:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155921181",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "I am testing now it to see if it solves my problems.  It can't possibly be worse than the current version, which almost led to loss of coins for me due to transactions with negative confirmations reappearing as unconfirmed after a restart, and loss of trust from other people when my client double spent inputs instead of rebroadcasting high priority transactions.",
      "created_at" : "2015-11-11T22:18:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155927431",
      "id" : 155927431,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T22:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155927431",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15728135?v=3",
         "events_url" : "https://api.github.com/users/sturles/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sturles/followers",
         "following_url" : "https://api.github.com/users/sturles/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sturles/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sturles",
         "id" : 15728135,
         "login" : "sturles",
         "organizations_url" : "https://api.github.com/users/sturles/orgs",
         "received_events_url" : "https://api.github.com/users/sturles/received_events",
         "repos_url" : "https://api.github.com/users/sturles/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sturles/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sturles/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sturles"
      }
   },
   {
      "body" : "The solution, as mentioned by @morcos in #6972 is the last commit in #6134, not re-adding priority area when there is actual fee-paying traffic.",
      "created_at" : "2015-11-11T22:21:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155928029",
      "id" : 155928029,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T22:21:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155928029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "My idea was that we'd get rid of priority, and replace it with a small adjustment to the fee or size of a transaction.\r\n\r\nOne idea is to treat the total bitcoindays of the UTXO set as limited resource and treat it as currency, and that burning it should be treated like extra fee, with a small factor. Specifically:\r\n* for each transaction you compute the bitcoin-days-destroyed\r\n* divide it by the average UTXO entry age weighed by amount (around 800 days currently)\r\n* the result is a value in BTC; take some configurable fraction of it (0.5% for example)\r\n* treat the result as extra fee (which gets divided by the tx size to obtain the feerate).\r\n\r\nThis is simple (don't bother recalculating this equivalent fee on every mempool change; just infrequently in the background or even not at all and keep using the value from entry time), and using 0.5% as factor would give a 250-byte 1 BTC-day-destroyed transaction (the limit for high priority earlier) the equivalent of 2500 satoshi/kB feerate boost.\r\n\r\nThe downside is that it has no guarantees on how much a miner could lose by using this approach. For example, 100 BTC of 1 year old coins would be treated equal to a 1 BTC fee. We can cap the maximum amount of feerate replaced, but that may make the scheme pretty useless if the cap is easy to hit.",
      "created_at" : "2015-11-11T22:27:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155929352",
      "id" : 155929352,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T22:27:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155929352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sturles I believe that the wallet treating evicted transactions as spendable again is an outright bug, and a blocker we should fix before release (so thanks for reporting that). What the right solution is w.r.t. priority, I don't know - it's a hard problem that tries to balance the advantage of allowing a small amount of free transactions on the network (but only to the privileged few who have enough stashed coins...) and extra solftware complexity and incentive-incompatibility for mining...",
      "created_at" : "2015-11-11T22:31:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155930238",
      "id" : 155930238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T22:31:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155930238",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@TheBlueMatt The last commit in #6134 is a kludge to hide some symptoms.  It doesn't solve the bugs I just mentioned here.  It would just have added a fee to one of the transactions I mentioned.  The rest would still be treated the same.  If this patch works as advertised, it will solve all the problems I mentioned.  (Not guaranteed, in case a lot of extremely high priority transactions suddenly show up, but likewise the commit in #6134 is not guaranteed to fix the problem in case a lot of high fee transactions suddenly show up.)",
      "created_at" : "2015-11-11T22:37:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155931427",
      "id" : 155931427,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T22:37:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155931427",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15728135?v=3",
         "events_url" : "https://api.github.com/users/sturles/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sturles/followers",
         "following_url" : "https://api.github.com/users/sturles/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sturles/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sturles",
         "id" : 15728135,
         "login" : "sturles",
         "organizations_url" : "https://api.github.com/users/sturles/orgs",
         "received_events_url" : "https://api.github.com/users/sturles/received_events",
         "repos_url" : "https://api.github.com/users/sturles/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sturles/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sturles/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sturles"
      }
   },
   {
      "body" : "@sipa I'm not sure its worth the incentive-incompatibility for miners to do that. You could probably get away with it (with a cap) for some time yet, but we'll be back here in 6-12 months getting rid of priority at that point.",
      "created_at" : "2015-11-11T22:45:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155933122",
      "id" : 155933122,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T22:45:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155933122",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Agreed, NACK",
      "created_at" : "2015-11-11T23:51:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155947516",
      "id" : 155947516,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-11T23:51:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155947516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "To me the most important question is, is priority something that miners want to use?\r\n\r\nIf a non-negligible amount of hashpower intends to use it in their transaction selection, then I think it makes sense for nodes to use it too, because it's generally helpful to have your mempool predict the UTXO as much as possible, and for nodes to be able to have reasonable fee and priority estimates (which won't happen unless they track the priority transactions somehow -- I'm presuming that miners run with much bigger mempools than regular nodes).\r\n\r\nIf the answer is no, then that's fine and I don't see a reason to push in this direction.  I sort of assumed there was enough hashpower mining with priority, since last time I checked estimatepriority was still giving meaningful results for low-ish blockheights, but I haven't done any kind of real analysis.",
      "created_at" : "2015-11-12T01:37:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155969455",
      "id" : 155969455,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T01:37:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155969455",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "Concept ACK from me.\r\nAlthough it looks like a fair amount of code, its not a terribly invasive change.\r\n\r\nFundamentally I agree that supporting priority is probably more trouble than it's worth.  However I think we backed ourselves into a bit of a corner by not more clearly communicating and building consensus that priority based transactions were going away before now.   \r\n\r\nWe can of course still do that, but I don't like releasing a 0.12 which breaks priority before that has happened.  If we had no choice, then thats one thing, but if a few peoples time to review this code is all it takes to avoid that scenario, we should avoid it.   \r\n\r\nWe need to make an analogous decision with respect to #6357.  If we're ok making miners who are using priority space only care about the starting priority of the tx for filling that space (the same way this pull uses that for eviction), then we can skip #6357, but otherwise we have to have it in order to speed up CreateNewBlock.",
      "created_at" : "2015-11-12T02:47:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155981599",
      "id" : 155981599,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T02:47:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155981599",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "Strong NACK.\r\n\r\nFree transactions are a thing of the past.\r\n\r\nWe've made the mistake in the past of failing to signal that things are going away.\r\n\r\nLets not make that mistake again.",
      "created_at" : "2015-11-12T03:19:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155985199",
      "id" : 155985199,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T03:19:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155985199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "body" : "\"My idea was that we'd get rid of priority, and replace it with a small adjustment to the fee or size of a transaction.\"\r\n\r\nthat's pretty much exactly what my remove-priority PR did...\r\n\r\nRemoving priority vastly simplifies a lot of the code.  Fee deltas continue to exist...\r\n",
      "created_at" : "2015-11-12T03:33:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155986864",
      "id" : 155986864,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T03:33:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155986864",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "Fee deltas continue to exist as an RPC interface for manual control, sure, though I'm not sure I understand why we should be applying a \"default\" fee delta to all transactions.",
      "created_at" : "2015-11-12T03:35:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-155987074",
      "id" : 155987074,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T03:35:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155987074",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "I have been running this since yesterday evening, and made a few free transactions with varying priority to test.  This morning I checked if my transactions were still in my mempool.  They were not.  Even the lowest priority transactions I made were mined, not evicted.  From this I can conclude:\r\n1. The patch has worked so far, but the transactions were probably mined before my mempool was full.\r\n2. Free transactions certainly still get mined, disproving @pstratem and others who got think otherwise.\r\n\r\nAfter sending the transactions, I made this change to wallet/wallet.cpp to avoid making free transactions with too low priority when priorityestimate returns -1.  If people have the impression that free transactions aren't getting mined, the reason is probably because Bitcoin Core use this too low default priority when it lacks a useful estimate.  It usually does at very low txconfirmtarget:\r\n\r\ndiff --git a/src/wallet/wallet.cpp b/src/wallet/wallet.cpp\r\nindex d51b8dd..7f3385c 100644\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -2034,9 +2034,11 @@ bool CWallet::CreateTransaction(const vector<CRecipient>& vecSend, CWalletTx& wt\r\n                 {\r\n                     // Not enough fee: enough priority?\r\n                     double dPriorityNeeded = mempool.estimatePriority(nTxConfirmTarget);\r\n-                    // Not enough mempool history to estimate: use hard-coded AllowFree.\r\n-                    if (dPriorityNeeded <= 0 && AllowFree(dPriority))\r\n-                        break;\r\n+                    // Not enough mempool history to estimate: use first available estimate. \r\n+                   unsigned int i = nTxConfirmTarget;\r\n+                    while (i++ < 24 && dPriorityNeeded <= 0) {\r\n+                       dPriorityNeeded = mempool.estimatePriority(i);\r\n+                   } \r\n \r\n                     // Small enough, and priority high enough, to send for free\r\n                     if (dPriorityNeeded > 0 && dPriority >= dPriorityNeeded)\r\n\r\n",
      "created_at" : "2015-11-12T06:51:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156017520",
      "id" : 156017520,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T06:51:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156017520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15728135?v=3",
         "events_url" : "https://api.github.com/users/sturles/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sturles/followers",
         "following_url" : "https://api.github.com/users/sturles/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sturles/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sturles",
         "id" : 15728135,
         "login" : "sturles",
         "organizations_url" : "https://api.github.com/users/sturles/orgs",
         "received_events_url" : "https://api.github.com/users/sturles/received_events",
         "repos_url" : "https://api.github.com/users/sturles/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sturles/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sturles/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sturles"
      }
   },
   {
      "body" : "@sturles No one claimed free transactions would not be mined today. Most miners will absolutely mine free transactions since that is still the default policy in released versions of Bitcoin Core. The point was that a few miners have already turned this off, and more will in the future (it is the only incentive-compatible outcome...if they arent receiving enough in fees for them to strongly want to do this, Bitcoin has failed). Setting expectations that these will be mined in the medium term is crazy.",
      "created_at" : "2015-11-12T09:27:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156045580",
      "id" : 156045580,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T09:27:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156045580",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt I may be crazy, but at least I know I can't predict the future accurately.  Right now there is no difference in income between reserving half the block for high priority transactions or reserving nothing.  If you drop the rest of the anti spam measures, e.g. by accepting dust outputs and other non standard transactions, you can make a few satoshis more.  Introducing bugs by purpose to make free transactions harder is premature at best.  If you want to remove the priority system, you should do it properly without introducing bug, and remove all references to priority and priority calculations, using fees only, and make 0 fee transactions non-standard.\r\n\r\nI don't think anyone expect free transactions to be mined in the first block.  bitcoin-cli estimatepriority 1 agrees with that, returning -1.  Unfortunately, due to the problem I mentioned above, bitcoin will generate free transactions with *much* lower priority than needed if the estimate returns -1.  I can make a pull request for that fix.",
      "created_at" : "2015-11-12T10:00:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156055177",
      "id" : 156055177,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T10:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156055177",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15728135?v=3",
         "events_url" : "https://api.github.com/users/sturles/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sturles/followers",
         "following_url" : "https://api.github.com/users/sturles/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sturles/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sturles",
         "id" : 15728135,
         "login" : "sturles",
         "organizations_url" : "https://api.github.com/users/sturles/orgs",
         "received_events_url" : "https://api.github.com/users/sturles/received_events",
         "repos_url" : "https://api.github.com/users/sturles/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sturles/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sturles/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sturles"
      }
   },
   {
      "body" : "I didn't mean to even imply that the way things are now in master is acceptable. Indeed, it is not. And, yes, my preference would be to remove priority in its entirety.\n\nOn November 12, 2015 2:00:52 AM PST, sturles <notifications@github.com> wrote:\n>@TheBlueMatt I may be crazy, but at least I know I can't predict the\n>future accurately.  Right now there is no difference in income between\n>reserving half the block for high priority transactions or reserving\n>nothing.  If you drop the rest of the anti spam measures, e.g. by\n>accepting dust outputs and other non standard transactions, you can\n>make a few satoshis more.  Introducing bugs by purpose to make free\n>transactions harder is premature at best.  If you want to remove the\n>priority system, you should do it properly without introducing bug, and\n>remove all references to priority and priority calculations, using fees\n>only, and make 0 fee transactions non-standard.\n>\n>I don't think anyone expect free transactions to be mined in the first\n>block.  bitcoin-cli estimatepriority 1 agrees with that, returning -1. \n>Unfortunately, due to the problem I mentioned above, bitcoin will\n>generate free transactions with *much* lower priority than needed if\n>the estimate returns -1.  I can make a pull request for that fix.\n>\n>---\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156055177\n",
      "created_at" : "2015-11-12T10:04:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156056031",
      "id" : 156056031,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T10:04:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156056031",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "I like what @sipa proposed (translate priority into additional fee). This should simplify the code and make it easier to configure by just setting the conversion rate via parameters. Also, the default conversion rate could be adjusted based on how the future turns out. (Similar to minRelayTxFee)",
      "created_at" : "2015-11-12T10:44:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156068474",
      "id" : 156068474,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T10:44:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156068474",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "@sturles The problem you reference with with defaulting to too low a priority is fixed by the rest of #6134.  Obviously if this PR is merged, I'll modify #6134 to look at the appropriate minimum priority of the mempool instead if the mempool reject fee is non zero.\r\n\r\n@MarcoFalke I don't think its possible to accomplish the same goals by translating priority into fee.\r\n\r\n@TheBlueMatt Yes thats part of what I don't like about the current state of affairs, its so inconsistent. If we can build consensus to remove priority, then lets do that.  Until then, lets continue to support it.\r\n\r\nWhey don't we issue a release note saying supporting free priority based transactions is deprecated.\r\n",
      "created_at" : "2015-11-12T11:18:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156077605",
      "id" : 156077605,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T11:18:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156077605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "I think if we are deciding to stop supporting priority, then we need a reasonable plan for how to make that happen (something better than silently allowing performance degradation without adequate communication to users in advance).\r\n\r\nI propose that if the consensus here is to deprecate priority (which is okay with me in principle) that we do the following:\r\n\r\n * For 0.12, set the default block priority size to 0 and update the release notes explaining that bitcoin core is deprecating priority.\r\n * If we can get adequate review, consider something like this pull for 0.12 to improve the performance of limited mempools at matching up with miner policy.  (If we do set the default block priority size to 0, I'll need to update this pull to change its default behavior to include a priority space in the mempool anyway.)\r\n\r\nIn a future release (maybe 0.13), we can consider removing priority support from CreateNewBlock  (especially if indeed miners stop using priority after the defaults are changed) and from the mempool.",
      "created_at" : "2015-11-12T17:21:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156172737",
      "id" : 156172737,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T17:21:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156172737",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6992#discussion_r44692353"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6992"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44692353"
         }
      },
      "body" : "you don't need this `mempoolRejectFee > 0 && `",
      "commit_id" : "32520bfb9e450522cc507faf30bf2eadecdf349b",
      "created_at" : "2015-11-12T18:12:12Z",
      "diff_hunk" : "@@ -921,7 +930,8 @@ bool AcceptToMemoryPool(CTxMemPool& pool, CValidationState &state, const CTransa\n         // Continuously rate-limit free (really, very-low-fee) transactions\n         // This mitigates 'penny-flooding' -- sending thousands of free transactions just to\n         // be annoying or make others' transactions take longer to confirm.\n-        if (fLimitFree && nFees < ::minRelayTxFee.GetFee(nSize))\n+        if (fLimitFree && (nFees < ::minRelayTxFee.GetFee(nSize) ||\n+                    (mempoolRejectFee > 0 && nFees < mempoolRejectFee)))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#discussion_r44692353",
      "id" : 44692353,
      "original_commit_id" : "32520bfb9e450522cc507faf30bf2eadecdf349b",
      "original_position" : 24,
      "path" : "src/main.cpp",
      "position" : 24,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6992",
      "updated_at" : "2015-11-12T18:12:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44692353",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6992#discussion_r44694054"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6992"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44694054"
         }
      },
      "body" : "Too much debugging",
      "commit_id" : "32520bfb9e450522cc507faf30bf2eadecdf349b",
      "created_at" : "2015-11-12T18:24:15Z",
      "diff_hunk" : "@@ -904,11 +925,38 @@ void CTxMemPool::trackPackageRemoved(const CFeeRate& rate) {\n     }\n }\n \n-void CTxMemPool::TrimToSize(size_t sizelimit) {\n+void CTxMemPool::trackPriorityRemoved(double priority) {\n+    AssertLockHeld(cs);\n+    if (priority > rollingMinimumPriority) {\n+        rollingMinimumPriority = priority;\n+        blockSinceLastRollingPriorityBump = false;\n+    }\n+}\n+\n+void CTxMemPool::TrimToSize(size_t sizelimit, size_t priorityLimit) {\n     LOCK(cs);\n \n     unsigned nTxnRemoved = 0;\n     CFeeRate maxFeeRateRemoved(0);\n+    while (priorityUsage > priorityLimit) {\n+        // First move transactions from priority space to fee space\n+        indexed_transaction_set::nth_index<1>::type::iterator lastPriTx;\n+        lastPriTx = mapTx.get<1>().end();\n+        assert(lastPriTx != mapTx.get<1>().begin()); // must have something to evict!\n+        lastPriTx--;\n+        assert(lastPriTx->IsPriorityTx());\n+\n+        trackPriorityRemoved(lastPriTx->GetPriority());\n+        LogPrint(\"mempool\", \"TrimToSize: priority usage too high (%d > %d); moving tx %s (%lu bytes %f priority; rolling min priority=%f)\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#discussion_r44694054",
      "id" : 44694054,
      "original_commit_id" : "32520bfb9e450522cc507faf30bf2eadecdf349b",
      "original_position" : 108,
      "path" : "src/txmempool.cpp",
      "position" : 108,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6992",
      "updated_at" : "2015-11-12T18:24:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44694054",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/6992#discussion_r44694539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6992"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44694539"
         }
      },
      "body" : "sipa didn't let me do this.",
      "commit_id" : "32520bfb9e450522cc507faf30bf2eadecdf349b",
      "created_at" : "2015-11-12T18:28:06Z",
      "diff_hunk" : "@@ -127,6 +134,16 @@ struct set_dirty\n         { e.SetDirty(); }\n };\n \n+struct set_prioritytx\n+{\n+    set_prioritytx(bool flag) : fPriorityTx(flag) {}\n+\n+    void operator() (CTxMemPoolEntry &e)\n+        { e.SetPriorityTx(fPriorityTx); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#discussion_r44694539",
      "id" : 44694539,
      "original_commit_id" : "32520bfb9e450522cc507faf30bf2eadecdf349b",
      "original_position" : 38,
      "path" : "src/txmempool.h",
      "position" : 38,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6992",
      "updated_at" : "2015-11-12T18:28:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/44694539",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "@morcos Yes, last I checked there was consensus to remove priority (see #6405 and #6675)",
      "created_at" : "2015-11-12T18:29:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156193583",
      "id" : 156193583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T18:29:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156193583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Initial code review ACK.   I will do a more thorough review and testing when it's clear the fate of this.",
      "created_at" : "2015-11-12T18:35:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156195401",
      "id" : 156195401,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T18:35:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156195401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "ACK from me fwiw.  I have not been able to reproduce #6972 or #6959 using this patch. \r\n\r\nWhen comparing periodic output from getmempoolinfo on the node running this patch since yesterday, and a different node which run current git version as of two days ago, more transactions are removed from the mempool for each new block on the node running this patch.  Mempool size is the same.  The difference is usually between 50 and 200 transactions, but hardware differences may be a factor here as well.  Nevertheless it is an indication that this version keep more of the transactions most likely to be mined in mempool.  I will try this patch with a smaller mempool on the weaker hardware, and see if it still performs better.",
      "created_at" : "2015-11-12T19:10:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156204686",
      "id" : 156204686,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T19:10:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156204686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15728135?v=3",
         "events_url" : "https://api.github.com/users/sturles/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sturles/followers",
         "following_url" : "https://api.github.com/users/sturles/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sturles/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sturles",
         "id" : 15728135,
         "login" : "sturles",
         "organizations_url" : "https://api.github.com/users/sturles/orgs",
         "received_events_url" : "https://api.github.com/users/sturles/received_events",
         "repos_url" : "https://api.github.com/users/sturles/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sturles/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sturles/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sturles"
      }
   },
   {
      "body" : "Closing after discussion on IRC",
      "created_at" : "2015-11-12T19:34:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156210721",
      "id" : 156210721,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-12T19:34:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156210721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "@sdaftuar what was your conclusion for those of us who weren't there?",
      "created_at" : "2015-11-13T01:09:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156286578",
      "id" : 156286578,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-13T01:09:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156286578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "@dcousens Well most developers seemed to favor deprecating priority at a slightly faster pace than I proposed above.  @TheBlueMatt sent an email to the -dev list yesterday summarizing the discussion on priority (http://lists.linuxfoundation.org/pipermail/bitcoin-dev/2015-November/011713.html).\r\n\r\nAlong those lines, there was a general sentiment to not merge changes like this one or #6357 to improve the way priority is handled.\r\n\r\nIRC discussion is logged at http://bitcoinstats.com/irc/bitcoin-dev/logs/2015/11/12#l1447354922.0 if you want to read for yourself...",
      "created_at" : "2015-11-13T15:29:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156464023",
      "id" : 156464023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-13T15:29:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156464023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "In that case the current mempool limiting code must be removed and added later when priority transactions have been deprecated, to avoid bugs #6972 and #6959.  The current code is broken.",
      "created_at" : "2015-11-13T15:49:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156469454",
      "id" : 156469454,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-13T15:49:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156469454",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15728135?v=3",
         "events_url" : "https://api.github.com/users/sturles/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sturles/followers",
         "following_url" : "https://api.github.com/users/sturles/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sturles/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sturles",
         "id" : 15728135,
         "login" : "sturles",
         "organizations_url" : "https://api.github.com/users/sturles/orgs",
         "received_events_url" : "https://api.github.com/users/sturles/received_events",
         "repos_url" : "https://api.github.com/users/sturles/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sturles/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sturles/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sturles"
      }
   },
   {
      "body" : "From what I can see from the IRC discussion, only one person is in favor of removing support for priority in 0.12 (BlueMatt).  Most want to warn users first, starting in 0.12, before removing support later, or to replace priority with another mechanism.  One is against removing priority (Luke-Jr).\r\n\r\nAs long as priority is supported, this patch is wanted by at least me, as it fixes two bugs and works very well in my testing.  It is much better than the current mempool limiting code at keeping transactions which will go into the next block.",
      "created_at" : "2015-11-13T16:17:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6992#issuecomment-156477081",
      "id" : 156477081,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6992",
      "updated_at" : "2015-11-13T16:17:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/156477081",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15728135?v=3",
         "events_url" : "https://api.github.com/users/sturles/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sturles/followers",
         "following_url" : "https://api.github.com/users/sturles/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sturles/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sturles",
         "id" : 15728135,
         "login" : "sturles",
         "organizations_url" : "https://api.github.com/users/sturles/orgs",
         "received_events_url" : "https://api.github.com/users/sturles/received_events",
         "repos_url" : "https://api.github.com/users/sturles/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sturles/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sturles/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sturles"
      }
   }
]
