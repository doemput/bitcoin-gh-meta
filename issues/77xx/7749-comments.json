[
   {
      "body" : "Travis fail was unrelated (#7463), retriggering.",
      "created_at" : "2016-03-28T10:15:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-202332874",
      "id" : 202332874,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-03-28T10:15:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/202332874",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "utACK",
      "created_at" : "2016-03-30T12:30:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-203408169",
      "id" : 203408169,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-03-30T12:30:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/203408169",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "utACK d4b854dccfd6afef4a1daf056b15d4f3f0d52eaa",
      "created_at" : "2016-03-30T12:57:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-203419898",
      "id" : 203419898,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-03-30T12:57:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/203419898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "ACK https://github.com/bitcoin/bitcoin/pull/7749/commits/d4b854dccfd6afef4a1daf056b15d4f3f0d52eaa\r\n\r\n`btctest addnode 188.226.202.220 onetry` producing:\r\n\r\n```\r\n2016-03-30 13:17:37 trying connection 188.226.202.220 lastseen=0.0hrs\r\n2016-03-30 13:17:37 Added connection to 188.226.202.220 peer=12\r\n2016-03-30 13:17:37 send version message: version 70013, blocks=754598, us=0.0.0.0:18333, them=188.226.202.220:18333, peer=12\r\n2016-03-30 13:17:37 sending: version (103 bytes) peer=12\r\n2016-03-30 13:17:38 received: version (102 bytes) peer=12\r\n2016-03-30 13:17:38 peer=12 does not offer the expected services (00000004 offered, 00000001 expected); disconnecting\r\n2016-03-30 13:17:38 sending: reject (45 bytes) peer=12\r\n2016-03-30 13:17:38 sending: verack (0 bytes) peer=12\r\n2016-03-30 13:17:38 sending: getaddr (0 bytes) peer=12\r\n```\r\n\r\nMinor nit: remove 'the' before 'expected services' (I'm not native English speaker though)?\r\n",
      "created_at" : "2016-03-30T13:22:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-203429492",
      "id" : 203429492,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-03-30T13:22:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/203429492",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "utACK.   @paveljanik \"the\" is appropriate there.",
      "created_at" : "2016-03-30T16:17:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-203509837",
      "id" : 203509837,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-03-30T16:17:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/203509837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r59962426"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/59962426"
         }
      },
      "body" : "return here?",
      "commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "created_at" : "2016-04-16T04:42:46Z",
      "diff_hunk" : "@@ -4505,6 +4505,18 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         CAddress addrFrom;\n         uint64_t nNonce = 1;\n         vRecv >> pfrom->nVersion >> pfrom->nServices >> nTime >> addrMe;\n+        if (!pfrom->fInbound)\n+        {\n+            addrman.SetServices(pfrom->addr, pfrom->nServices);\n+        }\n+        if (pfrom->nServicesExpected & ~pfrom->nServices)\n+        {\n+            LogPrint(\"net\", \"peer=%d does not offer the expected services (%08x offered, %08x expected); disconnecting\\n\", pfrom->id, pfrom->nServices, pfrom->nServicesExpected);\n+            pfrom->PushMessage(NetMsgType::REJECT, strCommand, REJECT_NONSTANDARD,\n+                               strprintf(\"Expected to offer services %08x\", pfrom->nServicesExpected));\n+            pfrom->fDisconnect = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r59962426",
      "id" : 59962426,
      "original_commit_id" : "d4b854dccfd6afef4a1daf056b15d4f3f0d52eaa",
      "original_position" : 13,
      "path" : "src/main.cpp",
      "position" : 17,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749",
      "updated_at" : "2016-06-13T15:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/59962426",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "body" : "Is the behavior that @paveljanik observed with his test the intended behavior?  I would have guessed that we'd want `addnode` (or `connect`) to bypass the expected services requirement.",
      "created_at" : "2016-04-22T14:58:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-213463898",
      "id" : 213463898,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-04-22T14:58:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/213463898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "Mental note: we should do an exact assignment (rather than or'ing) when directly connected to a peer and it tells us its nVersion.",
      "created_at" : "2016-05-17T07:19:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-219638549",
      "id" : 219638549,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-05-17T07:19:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/219638549",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Rebased, and fixed the behaviour @paveljanik saw.",
      "created_at" : "2016-05-25T15:26:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-221612165",
      "id" : 221612165,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-05-25T15:26:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/221612165",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Travis didn't run on this one yet. Mind to do a \"null-rebase\" of the last commit and force push?",
      "created_at" : "2016-06-03T11:47:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-223558640",
      "id" : 223558640,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-06-03T11:47:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223558640",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r65817271"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/65817271"
         }
      },
      "body" : "@sipa  Have you made sure the test are not using the default?\r\n\r\nI get a failure in `test/addrman_tests.cpp:71`\r\n\r\n\r\n```cpp\r\ntest/addrman_tests.cpp: In member function Ã¢ÂÂvoid addrman_tests::addrman_simple::test_method()Ã¢ÂÂ:\r\ntest/addrman_tests.cpp:71:31: error: no matching function for call to Ã¢ÂÂCAddress::CAddress(CService&)Ã¢ÂÂ\r\n     addrman.Add(CAddress(addr1), source);\r\n                               ^\r\n",
      "commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "created_at" : "2016-06-05T13:17:02Z",
      "diff_hunk" : "@@ -251,7 +251,7 @@ class CAddress : public CService\n {\n public:\n     CAddress();\n-    explicit CAddress(CService ipIn, uint64_t nServicesIn = NODE_NETWORK);\n+    explicit CAddress(CService ipIn, uint64_t nServicesIn);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r65817271",
      "id" : 65817271,
      "original_commit_id" : "68146f6217f381efe1849dde2d2c0bfa56244130",
      "original_position" : 5,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749",
      "updated_at" : "2016-06-13T15:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/65817271",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r65862637"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/65862637"
         }
      },
      "body" : "Fixed!",
      "commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "created_at" : "2016-06-06T09:41:14Z",
      "diff_hunk" : "@@ -251,7 +251,7 @@ class CAddress : public CService\n {\n public:\n     CAddress();\n-    explicit CAddress(CService ipIn, uint64_t nServicesIn = NODE_NETWORK);\n+    explicit CAddress(CService ipIn, uint64_t nServicesIn);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r65862637",
      "id" : 65862637,
      "original_commit_id" : "68146f6217f381efe1849dde2d2c0bfa56244130",
      "original_position" : 5,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749",
      "updated_at" : "2016-06-13T15:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/65862637",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Rebased.",
      "created_at" : "2016-06-08T12:12:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-224570699",
      "id" : 224570699,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-06-08T12:12:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/224570699",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Rebased on top of #8083, and making it use this PR's nRelevantServices as the nRequiredServices value requested from filtering seeds.",
      "created_at" : "2016-06-08T16:19:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-224644585",
      "id" : 224644585,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-06-08T16:20:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/224644585",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Nit: For readability, can we get a constant NODE_SERVICES_NONE or so (i'm at a loss for a good name) rather than passing 0 everywhere?",
      "created_at" : "2016-06-08T16:40:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-224650936",
      "id" : 224650936,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-06-08T16:40:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/224650936",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "For discussion: I've instead switched the NODE_* flags to an enum.",
      "created_at" : "2016-06-08T17:14:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-224662447",
      "id" : 224662447,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-06-08T17:14:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/224662447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "ahhh, much better. Thanks.",
      "created_at" : "2016-06-08T17:34:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-224668298",
      "id" : 224668298,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-06-08T17:34:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/224668298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "> For discussion: I've instead switched the NODE_* flags to an enum.\r\n\r\nACK",
      "created_at" : "2016-06-09T05:44:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-224805288",
      "id" : 224805288,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-06-09T05:44:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/224805288",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r66728275"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66728275"
         }
      },
      "body" : "Fixed.",
      "commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "created_at" : "2016-06-12T21:50:41Z",
      "diff_hunk" : "@@ -4505,6 +4505,18 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         CAddress addrFrom;\n         uint64_t nNonce = 1;\n         vRecv >> pfrom->nVersion >> pfrom->nServices >> nTime >> addrMe;\n+        if (!pfrom->fInbound)\n+        {\n+            addrman.SetServices(pfrom->addr, pfrom->nServices);\n+        }\n+        if (pfrom->nServicesExpected & ~pfrom->nServices)\n+        {\n+            LogPrint(\"net\", \"peer=%d does not offer the expected services (%08x offered, %08x expected); disconnecting\\n\", pfrom->id, pfrom->nServices, pfrom->nServicesExpected);\n+            pfrom->PushMessage(NetMsgType::REJECT, strCommand, REJECT_NONSTANDARD,\n+                               strprintf(\"Expected to offer services %08x\", pfrom->nServicesExpected));\n+            pfrom->fDisconnect = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r66728275",
      "id" : 66728275,
      "original_commit_id" : "d4b854dccfd6afef4a1daf056b15d4f3f0d52eaa",
      "original_position" : 13,
      "path" : "src/main.cpp",
      "position" : 17,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749",
      "updated_at" : "2016-06-13T15:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66728275",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Rebased and addressed @kazcw 's comment.",
      "created_at" : "2016-06-12T21:51:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-225462649",
      "id" : 225462649,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-06-12T21:51:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/225462649",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r66788076"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66788076"
         }
      },
      "body" : "Maybe make the bitmask of required services a constant",
      "commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "created_at" : "2016-06-13T13:09:10Z",
      "diff_hunk" : "@@ -4785,6 +4785,9 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         {\n             boost::this_thread::interruption_point();\n \n+            if (!(addr.nServices & NODE_NETWORK))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r66788076",
      "id" : 66788076,
      "original_commit_id" : "d2acb5164bd0fc72057ae59013717842916025ed",
      "original_position" : 4,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749",
      "updated_at" : "2016-06-13T15:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66788076",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r66788726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66788726"
         }
      },
      "body" : "Or wait, shouldn't this be nRelevantServices?\r\nThough I'm not sure \"relevantservices\" is a good name if we *only* consider nodes with those service bits.",
      "commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "created_at" : "2016-06-13T13:13:37Z",
      "diff_hunk" : "@@ -1596,6 +1596,10 @@ void ThreadOpenConnections()\n             if (IsLimited(addr))\n                 continue;\n \n+            // only connect to full nodes\n+            if (!(addr.nServices & NODE_NETWORK))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r66788726",
      "id" : 66788726,
      "original_commit_id" : "d2acb5164bd0fc72057ae59013717842916025ed",
      "original_position" : 5,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749",
      "updated_at" : "2016-06-13T15:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66788726",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r66789157"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66789157"
         }
      },
      "body" : "There may be relevant services that are not required, but still preferred. I'll add a constant for required services.",
      "commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "created_at" : "2016-06-13T13:17:01Z",
      "diff_hunk" : "@@ -1596,6 +1596,10 @@ void ThreadOpenConnections()\n             if (IsLimited(addr))\n                 continue;\n \n+            // only connect to full nodes\n+            if (!(addr.nServices & NODE_NETWORK))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r66789157",
      "id" : 66789157,
      "original_commit_id" : "d2acb5164bd0fc72057ae59013717842916025ed",
      "original_position" : 5,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749",
      "updated_at" : "2016-06-13T15:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66789157",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r66796013"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66796013"
         }
      },
      "body" : "Done.",
      "commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "created_at" : "2016-06-13T14:01:39Z",
      "diff_hunk" : "@@ -1596,6 +1596,10 @@ void ThreadOpenConnections()\n             if (IsLimited(addr))\n                 continue;\n \n+            // only connect to full nodes\n+            if (!(addr.nServices & NODE_NETWORK))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r66796013",
      "id" : 66796013,
      "original_commit_id" : "d2acb5164bd0fc72057ae59013717842916025ed",
      "original_position" : 5,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749",
      "updated_at" : "2016-06-13T15:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66796013",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "ACK",
      "created_at" : "2016-06-13T17:25:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-225650298",
      "id" : 225650298,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-06-13T17:25:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/225650298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "utACK ecd7fd3",
      "created_at" : "2016-06-13T17:29:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-225651222",
      "id" : 225651222,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-06-13T17:29:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/225651222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r76002206"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76002206"
         }
      },
      "body" : "Is disconnection really the right solution here? For example, let's say we were expecting NODE_NETWORK yet we connect and now find the node is a pruned node. This wouldn't be an issue if we're already caught up with the blockchain, would it?",
      "commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "created_at" : "2016-08-24T06:43:57Z",
      "diff_hunk" : "@@ -4611,7 +4611,22 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         CAddress addrMe;\n         CAddress addrFrom;\n         uint64_t nNonce = 1;\n-        vRecv >> pfrom->nVersion >> pfrom->nServices >> nTime >> addrMe;\n+        uint64_t nServiceInt;\n+        vRecv >> pfrom->nVersion >> nServiceInt >> nTime >> addrMe;\n+        pfrom->nServices = ServiceFlags(nServiceInt);\n+        if (!pfrom->fInbound)\n+        {\n+            addrman.SetServices(pfrom->addr, pfrom->nServices);\n+        }\n+        if (pfrom->nServicesExpected & ~pfrom->nServices)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r76002206",
      "id" : 76002206,
      "original_commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "original_position" : 12,
      "path" : "src/main.cpp",
      "position" : 12,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749",
      "updated_at" : "2016-08-24T06:43:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76002206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r76003466"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76003466"
         }
      },
      "body" : "Why only connect to full nodes? Surely this is only a requirement when we are more than 550 blocks behind on the blockchain. Also, with this change, it is possible that a node that was previously pruning becomes a full-node, and it will never be rediscovered again as a full-node for as long as it's IP address remains the same.",
      "commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "created_at" : "2016-08-24T06:56:55Z",
      "diff_hunk" : "@@ -1592,6 +1595,10 @@ void ThreadOpenConnections()\n             if (IsLimited(addr))\n                 continue;\n \n+            // only connect to full nodes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r76003466",
      "id" : 76003466,
      "original_commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "original_position" : 89,
      "path" : "src/net.cpp",
      "position" : 89,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749",
      "updated_at" : "2016-08-24T07:01:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76003466",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r76004213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76004213"
         }
      },
      "body" : "> Why only connect to full nodes? Surely this is only a requirement when we\nare more than 550 blocks behind on the blockchain.\n\nNo, we always want this requirement.\n\nOtherwise we may end up trying to connect to lightweight clients that do\nnot even relay blocks at all.\n",
      "commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "created_at" : "2016-08-24T07:04:59Z",
      "diff_hunk" : "@@ -1592,6 +1595,10 @@ void ThreadOpenConnections()\n             if (IsLimited(addr))\n                 continue;\n \n+            // only connect to full nodes",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r76004213",
      "id" : 76004213,
      "original_commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "original_position" : 89,
      "path" : "src/net.cpp",
      "position" : 89,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749",
      "updated_at" : "2016-08-24T07:04:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76004213",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r77127494"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/77127494"
         }
      },
      "body" : "Ok, I think I have found a problem with this line. Shouldn't it instead read:-\r\n\r\n`if (nRelevantServices & ~pfrom->nServices)`\r\n\r\n?\r\n\r\ni.e. the ExpectedServices are irrelevant (which are ANDed with nRelevantServices anyway). E.g. if the relevant services are NODE_NETWORK (as they usually are) and you connect to a node which HAS NODE_NETWORK but it wasn't expected to have NODE_NETWORK, then why would you still want it to disconnect? Afterall ServicesExpected is simply an old version of what the node used to advertise. nServices is the up-to-date information so why refer to the out-of-date information when you have the up-to-date information?",
      "commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "created_at" : "2016-09-01T07:43:33Z",
      "diff_hunk" : "@@ -4611,7 +4611,22 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         CAddress addrMe;\n         CAddress addrFrom;\n         uint64_t nNonce = 1;\n-        vRecv >> pfrom->nVersion >> pfrom->nServices >> nTime >> addrMe;\n+        uint64_t nServiceInt;\n+        vRecv >> pfrom->nVersion >> nServiceInt >> nTime >> addrMe;\n+        pfrom->nServices = ServiceFlags(nServiceInt);\n+        if (!pfrom->fInbound)\n+        {\n+            addrman.SetServices(pfrom->addr, pfrom->nServices);\n+        }\n+        if (pfrom->nServicesExpected & ~pfrom->nServices)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r77127494",
      "id" : 77127494,
      "original_commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "original_position" : 12,
      "path" : "src/main.cpp",
      "position" : 12,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749",
      "updated_at" : "2016-09-01T07:43:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/77127494",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "No, there can be relevant services that a peer does not advertize, and we decide to connect to them anyway. We shouldn't disconnect them later just because they happen to not have that service listed.\n\nI'm tired of explaining this over and over again. Relevant does not mean required; it means relevant. You're welcome to add comments with explanations about the meaning of variables and logic, but please don't try to change code you don't understand.",
      "created_at" : "2016-09-01T07:49:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#issuecomment-244002662",
      "id" : 244002662,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7749",
      "updated_at" : "2016-09-01T07:49:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/244002662",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r83543182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/83543182"
         }
      },
      "body" : "Why return false rather than true? False just causes an extra error message to be displayed in debug.log (saying ProcessMessage failed).",
      "commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "created_at" : "2016-10-16T01:25:04Z",
      "diff_hunk" : "@@ -4611,7 +4611,22 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         CAddress addrMe;\n         CAddress addrFrom;\n         uint64_t nNonce = 1;\n-        vRecv >> pfrom->nVersion >> pfrom->nServices >> nTime >> addrMe;\n+        uint64_t nServiceInt;\n+        vRecv >> pfrom->nVersion >> nServiceInt >> nTime >> addrMe;\n+        pfrom->nServices = ServiceFlags(nServiceInt);\n+        if (!pfrom->fInbound)\n+        {\n+            addrman.SetServices(pfrom->addr, pfrom->nServices);\n+        }\n+        if (pfrom->nServicesExpected & ~pfrom->nServices)\n+        {\n+            LogPrint(\"net\", \"peer=%d does not offer the expected services (%08x offered, %08x expected); disconnecting\\n\", pfrom->id, pfrom->nServices, pfrom->nServicesExpected);\n+            pfrom->PushMessage(NetMsgType::REJECT, strCommand, REJECT_NONSTANDARD,\n+                               strprintf(\"Expected to offer services %08x\", pfrom->nServicesExpected));\n+            pfrom->fDisconnect = true;\n+            return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7749#discussion_r83543182",
      "id" : 83543182,
      "original_commit_id" : "ecd7fd37c888f8ebc64cf3d92272975b37ae54ca",
      "original_position" : 18,
      "path" : "src/main.cpp",
      "position" : 18,
      "pull_request_review_id" : 4382178,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7749",
      "updated_at" : "2016-10-16T01:25:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/83543182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   }
]
