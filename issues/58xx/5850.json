{
   "assignee" : null,
   "body" : "Recently I had an error on an ARM node running latest master. As its file system is on a USB stick it is notoriously unreliable, normally I just start a reindex, but as other similar problems have been reported, this time I decided to investigate\r\n\r\n    2015-02-27 04:30:05 ERROR: ReadBlockFromDisk: Deserialize or I/O error - ReadCompactSize(): size too large at CBlockDiskPos(nFile=196, nPos=67432382)\r\n\r\nLooking at the file:\r\n\r\n    -rw------- 1 debian debian 134202024 Feb 11 03:28 blk00196.dat\r\n\r\nblk00196.dat, offset 0x404efbe. Not a block header in sight.\r\n\r\n    0404efb0  aa 65 b2 9d 80 ae 02 21  00 e0 43 0e 47 6d fe 26  |.e.....!..C.Gm.&|\r\n    0404efc0  0b 51 ae 47 c2 9a 4c c5  d0 10 0d da ff c5 9f de  |.Q.G..L.........|\r\n    0404efd0  4a 73 63 92 3c 07 33 65  c8 01 21 02 5b 2c d7 c3  |Jsc.<.3e..!.[,..|\r\n    0404efe0  00 c4 67 38 f8 48 94 00  1e f6 fc 8a eb 33 ee bc  |..g8.H.......3..|\r\n\r\nAccording to block database:\r\n\r\n    nHeight=330411 nFile=196 nDataPos=0404d320 nUndoPos=007ff580 hash=000000000000000011d3e32f9276f2b2aa154dedfe4a7a63df9cbaaf86f3939d\r\n    nHeight=330388 nFile=196 nDataPos=0404efbe nUndoPos=00718a26 hash=00000000000000000d61fbd0001a82706380d6b9ba5a09011097a6e9b967bf65\r\n    nHeight=330412 nFile=196 nDataPos=0405586d nUndoPos=00800983 hash=00000000000000000f611e05c0d6f1800cfd05291e224fa5377d988ea627ff94\r\n\r\nAfter creating a script that scans for all valid block headers in a block file, I found a strange occurence in blk00196.dat:\r\n\r\n    Range             DataPos  Hash                                                             Height\r\n    03df9be8-03e935a2 03df9bf0 0000000000000000057e7aea33fc6d3599023ff14bb8f7cccf0517cfe53ca110 330364 \r\n    03e935a2-03edce1a 03e935aa 0000000000000000090fc723e88fc12543e328dacc9c5d59664a10dd5e11f4c0 330404 \r\n    03edce1a-03f484c7 03edce22 000000000000000002d445d11051e3c55dd7c083b8a0ed2c38808cddb3d433be 330405 \r\n    03ee3121-03f4e7ce 03ee3129 000000000000000002d445d11051e3c55dd7c083b8a0ed2c38808cddb3d433be 330405 Overlap with last block (03ee3121,03f4e7ce)\r\n    03f4e7ce-03f78aab 03f4e7d6 00000000000000000788eca10eaa37ad18c28bdb7b1abd0de580c77bb9e5dfbc 330406 \r\n\r\nIt looks like overlapping blocks are written. This doesn't seem like normal disk corruption.\r\n\r\nThe above offset `0404efbe` for block 330388 would fall into the range claimed by another block, 330411:\r\n\r\n    Range             DataPos  Hash                                                             Height\r\n    0404d318-04055865 0404d320 000000000000000011d3e32f9276f2b2aa154dedfe4a7a63df9cbaaf86f3939d 330411 \r\n\r\nFull information (as well as supporting scripts) can be found here: https://download.visucore.com/tmp/2015_03_arm_error.tar.xz\r\n\r\n- `blk00196.dat`          Block data\r\n- `db_file196.txt`         Database dump for all blocks in 196, sorted by offset\r\n- `dump_blk00196.txt`   Block scan list for blocks in 196\r\n- `list-blocks.py`      Script to scan and list blocks in a .dat file\r\n- `log_block_database.patch`    Patch to bitcoind to log block database at startup\r\n",
   "closed_at" : "2015-03-10T11:56:52Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 4,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5850/comments",
   "created_at" : "2015-03-03T11:09:48Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5850/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/5850",
   "id" : 59626907,
   "labels" : [
      {
         "color" : "e10c02",
         "name" : "Priority High",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Priority%20High"
      },
      {
         "color" : "fbca04",
         "name" : "UTXO Db and Indexes",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5850/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 5850,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Deserialize error: overlapping blocks in block files?",
   "updated_at" : "2015-03-10T11:56:52Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/5850",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   }
}
