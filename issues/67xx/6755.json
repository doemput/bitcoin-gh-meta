{
   "assignee" : null,
   "body" : "During the initial headers download, a client may start to request the same headers multiple times from its syncing peer.  This happens if a new block is found while the peer is syncing, for the following reason:\r\n\r\nFor the ordinary headers syncing procedure, the client starts by asking for an initial set of headers, and then whenever it receives a message with 2,000 headers, it follows up with a request for more.  *However*, if a new block is found, its peer sends a corresponding inv message, which prompts the syncing client to *also* ask for the headers preceding the new block.  This requests the same headers again, and when they are received a second time, it continues requesting more.  Depending on how many new blocks are found and how long the header syncing lasts, this may lead to a situation where the same set of headers is requested many times.\r\n\r\nThis obviously puts unnecessary strain on both the client that syncs and the peer that sends the data.  This is a problem particularly for altcoins with either of a high block frequency or merge-mining (much larger header messages), but it happens with Bitcoin itself as well.\r\n\r\nTo fix it, we could keep (in-memory only) for each peer the highest \"from\" height for which we requested headers from it.  Whenever a new request would be sent with a smaller number, we drop it instead.  Alternatively, one could probably also make the logic for requesting headers following an inv message smarter, so that it does not request when we are in the initial headers sync.  What do you think?  I'm willing to implement a patch for whatever solution is suggested.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6755/comments",
   "created_at" : "2015-10-04T14:08:28Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6755/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/6755",
   "id" : 109682810,
   "labels" : [
      {
         "color" : "006b75",
         "name" : "P2P",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      },
      {
         "color" : "981023",
         "name" : "Resource usage",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Resource%20usage"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6755/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 6755,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Duplicate getheaders requests",
   "updated_at" : "2016-02-16T12:38:41Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6755",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/4943644?v=3",
      "events_url" : "https://api.github.com/users/domob1812/events{/privacy}",
      "followers_url" : "https://api.github.com/users/domob1812/followers",
      "following_url" : "https://api.github.com/users/domob1812/following{/other_user}",
      "gists_url" : "https://api.github.com/users/domob1812/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/domob1812",
      "id" : 4943644,
      "login" : "domob1812",
      "organizations_url" : "https://api.github.com/users/domob1812/orgs",
      "received_events_url" : "https://api.github.com/users/domob1812/received_events",
      "repos_url" : "https://api.github.com/users/domob1812/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/domob1812/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/domob1812/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/domob1812"
   }
}
