[
   {
      "body" : "If the mempool treats wallet transactions any differently then it becomes\npossible to fingerprint nodes (or worse).\nOn Sep 26, 2015 2:16 AM, \"MarcoFalke\" <notifications@github.com> wrote:\n\n> Steps to reproduce on 48efbdb\n> <https://github.com/bitcoin/bitcoin/commit/48efbdbe986355bd2478f0fdd366b20952fbf30a>\n> :\n>\n> -> settxfee 0.04\n> <- true\n>\n> -> sendtoaddress mwEHWzBhaPYiErWWhmWW7QCjGoKNPaQQax 16\n> <- Error: The transaction was rejected! This might happen if some of the coins in your wallet were already spent, such as if you used a copy of wallet.dat and coins were spent in the copy but not marked as spent here. (code -4)\n>\n> Ã¢ÂÂ\n> Reply to this email directly or view it on GitHub\n> <https://github.com/bitcoin/bitcoin/issues/6725>.\n>\n",
      "created_at" : "2015-09-26T09:34:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6725#issuecomment-143414899",
      "id" : 143414899,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6725",
      "updated_at" : "2015-09-26T09:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143414899",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "body" : "@pstratem Can you elaborate? There is already rpc and/or command-line parameters in place to tell the mempool (implicitly) to treat one or more transactions differently when doing a fee-sanity-check. As the node who wants to fingerprint you does not know which params you run, fingerprinting would be hard? Am I missing something?\r\n\r\nNonetheless, #6726 limits the scope of `REJECT_HIGHFEE` to raw transactions. Once this is merged, a follow up commit will remove the fee check from the mempool completely and place it in the rawrpcwallet code. Effectively, the mempool should then no longer distinguish p2p, raw and wallet txs.",
      "created_at" : "2015-09-26T09:56:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6725#issuecomment-143416524",
      "id" : 143416524,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6725",
      "updated_at" : "2015-09-26T09:56:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143416524",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "agree with @pstratem.\r\nIf you know would broadcast transactions that would normally be invalid to accept to a mempool, other nodes could track these transactions.\r\n\r\nThe mempool should not treat own wallet transaction different. I think even for mempool cleaning i should be avoided.\r\n\r\nWhat's the use case of accepting local wallet transactions to the mempool where we can be pretty sure that it won't be broadcasted through other nodes?",
      "created_at" : "2015-09-28T06:49:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6725#issuecomment-143653939",
      "id" : 143653939,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6725",
      "updated_at" : "2015-09-28T06:49:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143653939",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "> @jonasschnelli What's the use case of accepting local wallet transactions to the mempool where we can be pretty sure that it won't be broadcasted through other nodes?\r\n\r\nSuch transactions have enough fee so they *will* be broadcast by the network...\r\n\r\nWhat's the use case of having the mempool take care of fee-capping? Shouldn't this be part of the module which passes the transactions to the mempool?",
      "created_at" : "2015-09-28T08:44:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6725#issuecomment-143680410",
      "id" : 143680410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6725",
      "updated_at" : "2015-09-28T08:44:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143680410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "> Such transactions have enough fee so they will be broadcast by the network...\r\n\r\nRight. I was just referencing to your PR title (\"Mempool should not reject wallet created transactions\"). In a world where the wallet and the mempool/node is decoupled, this won't work (out of the box) and would require a different concept of \"privileged transaction\" in the mempool (which i'm not sure if this would even make sense).\r\n\r\nI agree that the `bool fRejectAbsurdFee`-check does not belog to the mempool and was very likely done that way because there is currently now way to check wether a transaction would get accepted or rejected (tx inputs check).",
      "created_at" : "2015-09-28T09:06:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6725#issuecomment-143684955",
      "id" : 143684955,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6725",
      "updated_at" : "2015-09-28T09:06:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143684955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@sdaftuar The AcceptToMempool logic should not even know that the transaction originated from a local wallet.\r\n\r\nAny transaction generated by the wallet should be processed as if the transaction was received by the network.",
      "created_at" : "2015-09-28T20:13:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6725#issuecomment-143861781",
      "id" : 143861781,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6725",
      "updated_at" : "2015-09-28T20:13:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143861781",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/620611?v=3",
         "events_url" : "https://api.github.com/users/pstratem/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pstratem/followers",
         "following_url" : "https://api.github.com/users/pstratem/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pstratem/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pstratem",
         "id" : 620611,
         "login" : "pstratem",
         "organizations_url" : "https://api.github.com/users/pstratem/orgs",
         "received_events_url" : "https://api.github.com/users/pstratem/received_events",
         "repos_url" : "https://api.github.com/users/pstratem/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pstratem/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pstratem"
      }
   },
   {
      "body" : "I agree with @pstratem.\r\n\r\nIf we priories transaction in the men pool it should be independent from the wallet. Like an additional rpc command. But as said, this open door for fingerprinting nodes.\r\n\r\nA wallet can keep track of what happens to one of its transaction and resends it (and perhaps after RBF or CPFP).",
      "created_at" : "2015-09-29T03:48:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6725#issuecomment-143935867",
      "id" : 143935867,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6725",
      "updated_at" : "2015-09-29T03:48:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/143935867",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Wrapping this up, there seems several more or less unrelated issues to solve:\r\n\r\n(partly copied from @sdaftuar post)\r\n\r\n* a wallet tx **qualifies** for entry into the user's own mempool but get's rejected (tracked in this issue)\r\n*     a wallet tx **wouldn't qualify** for entry into the user's own mempool (probably needs UI improvement mentioned by @morcos in issue https://github.com/bitcoin/bitcoin/issues/6972#issuecomment-155256471 )\r\n*    a wallet tx **gets evicted** from the user's mempool after being accepted (which seems to be tracked in #6959)\r\n",
      "created_at" : "2015-11-10T10:21:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6725#issuecomment-155380105",
      "id" : 155380105,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6725",
      "updated_at" : "2015-11-10T10:21:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155380105",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "See latest commit in #6134, this should solve the problem of accidentally generating a tx with too low fee or priority to be accepted by a limited mempool.",
      "created_at" : "2015-11-10T23:32:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6725#issuecomment-155601999",
      "id" : 155601999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6725",
      "updated_at" : "2015-11-10T23:32:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/155601999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "This issue was solved in #7084. The other issues seem to be tracked in other tickets.",
      "created_at" : "2016-03-14T00:35:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/6725#issuecomment-196089101",
      "id" : 196089101,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6725",
      "updated_at" : "2016-03-14T00:35:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/196089101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
