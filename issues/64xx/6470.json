{
   "assignee" : null,
   "body" : "@sipa @sdaftuar @jtimon @petertodd \r\nOK, this is the best combination of approaches I could put together.\r\n\r\nI took #6455 and I removed the floating relay fee commit.  I really like that idea, but it needs to be much slower acting I think and not subject to potential abuse.  That can be a later improvement.\r\n\r\nI added 3 things:\r\n- Reserved space between the soft cap and hard cap.  The soft cap is currently set to 70% of the hard cap.  Once the soft cap is hit, you first try to evict as in 6455, but if you fail, you have another chance to get in if you are still under the hard cap.  There are 10 \"rate zones\" between the hard cap and soft cap and the effective minRelayRate to get into the mempool doubles for each additional zone.\r\n- Any required minRelayFee for your transaction alone is considered inside the StageTrimToSize loop.\r\n- Periodically (once a second) we use the knowledge that surplus fees over the minRelayRate must have been paid if the size of the mempool is over the soft cap.  We use these fees in aggregate to try to trim from the bottom of the mempool.  This allows us to aggregate many small high fee transactions to evict a low paying large transaction or long chain.\r\n\r\nThe reject rates in my test setup have dropped to 0.3% for 30k feerate tx's and 0.05% for 60k feerate tx's. (See other results in #6455).\r\n\r\nI made an attempt to tweak the looping parameters in StageTrimToSize to something that I think made sense, but with the contrived test setup, and only one set of simulation data, they are probably best evaluated on the basis of intuition and not relying entirely on the resulting rejection rates.\r\n\r\nIt turns out the slowest part of StageTrimToSize was GetRand() by a long shot, so I hacked it out, but I'm sure @sipa will want to replace my hack with something nicer.\r\n\r\nThe code works as is, but could still use some work, but I think its time to get more eyes on this suggestion for a plan forward.\r\n",
   "closed_at" : "2015-09-02T17:20:35Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
      "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
      "followers_url" : "https://api.github.com/users/morcos/followers",
      "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
      "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/morcos",
      "id" : 4360349,
      "login" : "morcos",
      "organizations_url" : "https://api.github.com/users/morcos/orgs",
      "received_events_url" : "https://api.github.com/users/morcos/received_events",
      "repos_url" : "https://api.github.com/users/morcos/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/morcos"
   },
   "comments" : 27,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6470/comments",
   "created_at" : "2015-07-23T23:08:18Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6470/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/6470",
   "id" : 96923378,
   "labels" : [
      {
         "color" : "fef2c0",
         "name" : "Mempool",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Mempool"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6470/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 6470,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/6470.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/6470",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/6470.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/6470"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Super Duper MemPool Limiter",
   "updated_at" : "2015-09-03T06:08:21Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/6470",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
      "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
      "followers_url" : "https://api.github.com/users/morcos/followers",
      "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
      "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/morcos",
      "id" : 4360349,
      "login" : "morcos",
      "organizations_url" : "https://api.github.com/users/morcos/orgs",
      "received_events_url" : "https://api.github.com/users/morcos/received_events",
      "repos_url" : "https://api.github.com/users/morcos/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/morcos"
   }
}
