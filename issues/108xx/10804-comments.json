[
   {
      "body" : "My immediate reaction to this is the same as https://github.com/bitcoin/bitcoin/pull/10757#issuecomment-313714215 and https://github.com/bitcoin/bitcoin/pull/9733#issuecomment-291981292. I'm not a fan of these statistical RPCs, which seem to me to be very interesting, but really only provide niche functionality. My issue is that they add maintenance burden for features that are only likely to be used by very few people. For me, they're better served by a fork of the project or a patch set. To my mind, this project should try to minimize functionality to what's essential for end users.\r\n\r\nI understand that I may be in the minority in that view, and that it's probably discouraging for contributors for proposed PRs to be rejected, so I'm not going to push the point.",
      "created_at" : "2017-07-13T21:44:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10804#issuecomment-315210781",
      "id" : 315210781,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10804",
      "updated_at" : "2017-07-13T21:44:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315210781",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "I generally agree with you, this is easily done out but the problem is when the UTXO set is very large:\r\n - listunspent can take minutes to complete;\r\n - the result is a huge array;\r\n - no pagination support\r\n - locks held too much time.\r\n\r\nThe goal with this RPC, is to create a flexible UTXO counting to solve the above problems in one-shot.\r\n\r\nTypically this is useful for online wallets to monitor the UTXO set, to trigger sweep transactions, to understand if there are good unspents for the upcoming transactions to have the least input count (hence low fee), etc..",
      "created_at" : "2017-07-14T22:18:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10804#issuecomment-315481252",
      "id" : 315481252,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10804",
      "updated_at" : "2017-07-14T22:18:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315481252",
      "user" : {
         "avatar_url" : "https://avatars5.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "body" : ">  For me, they're better served by a fork of the project or a patch set. To my mind, this project should try to minimize functionality to what's essential for end users.\r\n\r\n@jnewbery IMO there is space for a basic statistical feature like this in core, which is by far one of the easiest around in code.",
      "created_at" : "2017-07-14T22:21:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10804#issuecomment-315481771",
      "id" : 315481771,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10804",
      "updated_at" : "2017-07-14T22:21:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315481771",
      "user" : {
         "avatar_url" : "https://avatars5.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "body" : "I don't share @jnewbery's general resent against statistical calls. Sometimes the information to compute the statistics is available only server-side.\r\n\r\nIn this case, however, all the information is available in the `listunspent` result. So this can just as well be computed in an external script. Building it into bitcoind is an unnecessary burden.\r\n\r\n> For me, they're better served by a fork of the project or a patch set. To my mind, this project should try to minimize functionality to what's essential for end users.\r\n\r\nSo my point is that this doesn't even require a fork. All the information to compute is is already available.",
      "created_at" : "2017-07-17T12:46:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10804#issuecomment-315745348",
      "id" : 315745348,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10804",
      "updated_at" : "2017-07-17T12:47:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315745348",
      "user" : {
         "avatar_url" : "https://avatars4.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> all the information is available in the listunspent\r\n\r\n@laanwj sure but it's not that feasible when it's a huge data set, even with `listunspent` query options.",
      "created_at" : "2017-07-17T13:03:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10804#issuecomment-315749175",
      "id" : 315749175,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10804",
      "updated_at" : "2017-07-17T13:03:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315749175",
      "user" : {
         "avatar_url" : "https://avatars5.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "body" : "Closing since the general opinion is to compute client side. I guess the above bottlenecks should be tackled instead.",
      "created_at" : "2017-07-17T14:49:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10804#issuecomment-315778162",
      "id" : 315778162,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10804",
      "updated_at" : "2017-07-17T14:49:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315778162",
      "user" : {
         "avatar_url" : "https://avatars5.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10804#discussion_r128236386"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10804"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/128236386"
         }
      },
      "body" : "Ã°ÂÂÂ ",
      "commit_id" : "b680b5b9cea69ace96c0472bcf3ed7cec098eedf",
      "created_at" : "2017-07-19T12:54:35Z",
      "diff_hunk" : "@@ -2664,6 +2664,100 @@ UniValue listunspent(const JSONRPCRequest& request)\n     return results;\n }\n \n+UniValue histunspent(const JSONRPCRequest& request)\n+{\n+    CWallet * const pwallet = GetWalletForJSONRPCRequest(request);\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+    if (request.fHelp || request.params.size() > 5)\n+        throw std::runtime_error(\n+            \"histunspent [ranges] ( min_depth max_depth )\\n\"\n+            \"\\nReturns an histogram of unspent transaction output amounts\\n\"\n+            \"with between min_depth and max_depth (inclusive) confirmations.\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. ranges             (array) A json array of amounts that define the histogram bins\\n\"\n+            \"2. min_depth          (numeric, optional, default=1) The minimum confirmations to filter\\n\"\n+            \"3. max_depth          (numeric, optional, default=9999999) The maximum confirmations to filter\\n\"\n+            \"\\nResult\\n\"\n+            \"{\\n\"\n+            \"  \\\"bins\\\" : \\\"[]\\\",           (array) A json array of counts of amounts in each bin\\n\"\n+            \"  \\\"ranges\\\" : \\\"[]\\\",         (array) A json array of amounts that define the histogram bins\\n\"\n+            \"}\\n\"\n+\n+            \"\\nExamples\\n\"\n+            + HelpExampleCli(\"histunspent\", \"\\\"[0,1,10,100,1000,10000]\\\"\")\n+        );\n+\n+    std::vector<unsigned int> bins;\n+    std::map<CAmount, unsigned int> ranges;\n+    CAmount min_amount = 0;\n+    CAmount max_amount = MAX_MONEY;\n+\n+    if (!request.params[0].isNull()) {\n+        const std::vector<UniValue>& values = request.params[0].getValues();\n+\n+        if (values.size() < 2) {\n+            // throw invalid range (minimum 2 amounts);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10804#discussion_r128236386",
      "id" : 128236386,
      "original_commit_id" : "b680b5b9cea69ace96c0472bcf3ed7cec098eedf",
      "original_position" : 39,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 39,
      "pull_request_review_id" : 50895564,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10804",
      "updated_at" : "2017-07-19T12:54:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/128236386",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/4319748?v=4",
         "events_url" : "https://api.github.com/users/pedrobranco/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pedrobranco/followers",
         "following_url" : "https://api.github.com/users/pedrobranco/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pedrobranco/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pedrobranco",
         "id" : 4319748,
         "login" : "pedrobranco",
         "organizations_url" : "https://api.github.com/users/pedrobranco/orgs",
         "received_events_url" : "https://api.github.com/users/pedrobranco/received_events",
         "repos_url" : "https://api.github.com/users/pedrobranco/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pedrobranco/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pedrobranco/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pedrobranco"
      }
   }
]
