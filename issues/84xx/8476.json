{
   "assignee" : null,
   "assignees" : [],
   "body" : "I'm not sure what is relevant so I'm including a lot of information. I'd be happy to take suggestions for ways to fix this.  I'm also posting here on the chance this is a bug or behavior that could be improved.\n\nA log message in debug.log dated 2016-08-06 12:22:19 corresponds to about Sat Aug  6 13:22:37 CDT 2016 on my local time (`date`) while the corresponding `hwtime` shows Sat 06 Aug 2016 01:22:47 PM CDT .\n\n```\nUbuntu 14.04.5 LTS\n\nbitcoin-cli getinfo\n{\n  \"version\": 120100,\n  \"protocolversion\": 70012,\n  \"blocks\": 422168,\n  \"timeoffset\": -26,\n  \"connections\": 20,\n  \"proxy\": \"\",\n  \"difficulty\": 213492501107.5134,\n  \"testnet\": false,\n  \"relayfee\": 0.00001000,\n  \"errors\": \"\"\n}\n```\n\nA few weeks ago I dropped off the main chain.\n\n```\nbitcoin-cli getblockcount\n422168\n```\n\nHere is the debug log from around that time. \n\n```\n2016-07-25 03:31:17 UpdateTip: 3 of last 100 blocks have unexpected version\n2016-07-25 03:31:18 UpdateTip: new best=00000000000000000304f0c7db28c15cc4226dfc491d4c4f0d8b9ae48744453a  height=422168  log2_work=85.035791  tx=144585606  date=2016-07-25 05:26:32 progress=1.000042  cache=211.6MiB(136697tx)\n2016-07-25 03:31:18 UpdateTip: 3 of last 100 blocks have unexpected version\n2016-07-25 03:31:18 ERROR: CheckBlockHeader(): block timestamp too far in the future\n2016-07-25 03:31:18 InvalidChainFound: invalid block=000000000000000001f4de9d78ed4c2015cb676440e58069f67319ae31e71c75  height=422169  log2_work=85.035824  date=2016-07-25 05:38:02\n2016-07-25 03:31:18 InvalidChainFound:  current best=00000000000000000304f0c7db28c15cc4226dfc491d4c4f0d8b9ae48744453a  height=422168  log2_work=85.035791  date=2016-07-25 05:26:32\n2016-07-25 03:31:18 ERROR: ConnectTip(): ConnectBlock 000000000000000001f4de9d78ed4c2015cb676440e58069f67319ae31e71c75 failed\n2016-07-25 03:31:18 InvalidChainFound: invalid block=000000000000000001f4de9d78ed4c2015cb676440e58069f67319ae31e71c75  height=422169  log2_work=85.035824  date=2016-07-25 05:38:02\n2016-07-25 03:31:18 InvalidChainFound:  current best=00000000000000000304f0c7db28c15cc4226dfc491d4c4f0d8b9ae48744453a  height=422168  log2_work=85.035791  date=2016-07-25 05:26:32\n2016-07-25 03:31:18 mapBlockIndex.size() = 422233\n2016-07-25 03:31:18 nBestHeight = 422168\n```\n\nI have since updated my local time and hwtime (I'm not sure it was ever wrong) and restarted but I do not rejoin the main chain.\n\nIf my system clock gets out of sync and I later fix it, will I automatically rejoin the previously rejected chain?  Should this be the default behavior?\n\nRandom recent log near 'invalid header':\n\n```\n2016-07-29 01:09:26 ERROR: CheckBlockHeader(): block timestamp too far in the future\n2016-07-29 01:09:26 ERROR: invalid header received\n2016-07-29 01:09:26 ProcessMessages(headers, 82 bytes) FAILED peer=33\n2016-07-29 01:09:59 ERROR: CheckBlockHeader(): block timestamp too far in the future\n2016-07-29 01:09:59 ERROR: invalid header received\n2016-07-29 01:09:59 ProcessMessages(headers, 82 bytes) FAILED peer=625\n2016-07-29 01:10:32 receive version message: /bitnodes.21.co:0.1/: version 70002, blocks=422693, us=68.184.202.88:8333, peer=878\n2016-07-29 01:10:32 AdvertizeLocal: advertizing address 68.184.202.88:8333\n2016-07-29 01:11:04 receive version message: /Snoopy:0.2.1/: version 70001, blocks=0, us=68.184.202.88:8333, peer=879\n2016-07-29 01:11:04 AdvertizeLocal: advertizing address td6iaq6jpck24fxx.onion:8333\n2016-07-29 01:14:25 receive version message: /bitnodes.21.co:0.1/: version 70002, blocks=422694, us=68.184.202.88:8333, peer=880\n2016-07-29 01:14:25 AdvertizeLocal: advertizing address td6iaq6jpck24fxx.onion:8333\n2016-07-29 01:15:00 receive version message: /bitnodes.21.co:0.1/: version 70002, blocks=422694, us=68.184.202.88:8333, peer=881\n2016-07-29 01:15:00 AdvertizeLocal: advertizing address td6iaq6jpck24fxx.onion:8333\n2016-07-29 01:15:10 ERROR: CheckBlockHeader(): block timestamp too far in the future\n2016-07-29 01:15:10 ERROR: invalid header received\n2016-07-29 01:15:10 ProcessMessages(headers, 82 bytes) FAILED peer=33\n2016-07-29 01:15:36 ERROR: CheckBlockHeader(): block timestamp too far in the future\n2016-07-29 01:15:36 ERROR: invalid header received\n2016-07-29 01:15:36 ProcessMessages(headers, 82 bytes) FAILED peer=625\n```\n\nLog after a restart, still at 422168:\n\n```\n2016-08-06 18:29:09 Bitcoin version v0.12.1 (2016-04-11 13:01:43 +0200)\n2016-08-06 18:29:09 InitParameterInteraction: parameter interaction: -whitelistforcerelay=1 -> setting -whitelistrelay=1\n2016-08-06 18:29:09 Default data directory /home/b/.bitcoin\n2016-08-06 18:29:09 Using data directory /home/b/.bitcoin\n2016-08-06 18:29:09 Using config file /home/b/.bitcoin/bitcoin.conf\n2016-08-06 18:29:09 Using at most 125 connections (1024 file descriptors available)\n2016-08-06 18:29:09 Using 4 threads for script verification\n2016-08-06 18:29:09 scheduler thread start\n2016-08-06 18:29:09 HTTP: creating work queue of depth 16\n2016-08-06 18:29:09 Config options rpcuser and rpcpassword will soon be deprecated. Locally-run instances may remove rpcuser to use cookie-based auth, or may be replaced with rpcauth. Please see share/rpcuser for rpcauth auth generation.\n2016-08-06 18:29:09 HTTP: starting 4 worker threads\n2016-08-06 18:29:09 Bound to [::]:8333\n2016-08-06 18:29:09 Bound to 0.0.0.0:8333\n2016-08-06 18:29:09 Cache configuration:\n2016-08-06 18:29:09 * Using 2.0MiB for block index database\n2016-08-06 18:29:09 * Using 257.5MiB for chain state database\n2016-08-06 18:29:09 * Using 740.5MiB for in-memory UTXO set\n2016-08-06 18:29:09 init message: Loading block index...\n2016-08-06 18:29:09 Opening LevelDB in /home/b/.bitcoin/blocks/index\n2016-08-06 18:29:10 Opened LevelDB successfully\n2016-08-06 18:29:10 Using obfuscation key for /home/b/.bitcoin/blocks/index: 0000000000000000\n2016-08-06 18:29:10 Opening LevelDB in /home/b/.bitcoin/chainstate\n2016-08-06 18:29:10 Opened LevelDB successfully\n2016-08-06 18:29:10 Using obfuscation key for /home/b/.bitcoin/chainstate: 0000000000000000\n2016-08-06 18:29:23 LoadBlockIndexDB: last block file = 579\n2016-08-06 18:29:23 LoadBlockIndexDB: last block file info: CBlockFileInfo(blocks=155, size=126842528, heights=422025...422178, time=2016-07-24...2016-07-25)\n2016-08-06 18:29:23 Checking all blk files are present...\n2016-08-06 18:29:23 LoadBlockIndexDB: transaction index disabled\n2016-08-06 18:29:23 LoadBlockIndexDB: hashBestChain=00000000000000000304f0c7db28c15cc4226dfc491d4c4f0d8b9ae48744453a height=422168 date=2016-07-25 05:26:32 progress=0.993518\n2016-08-06 18:29:24 init message: Verifying blocks...\n2016-08-06 18:29:24 Verifying last 288 blocks at level 3\n2016-08-06 18:35:14 No coin database inconsistencies in last 289 blocks (435545 transactions)\n2016-08-06 18:35:15  block index          365687ms\n2016-08-06 18:35:15 No wallet support compiled in!\n2016-08-06 18:35:15 init message: Activating best chain...\n2016-08-06 18:35:15 mapBlockIndex.size() = 422233\n2016-08-06 18:35:15 nBestHeight = 422168\n2016-08-06 18:35:15 init message: Loading addresses...\n2016-08-06 18:35:15 torcontrol thread start\n2016-08-06 18:35:15 tor: Reading cached private key from /home/b/.bitcoin/onion_private_key\n2016-08-06 18:35:15 tor: Succesfully connected!\n2016-08-06 18:35:15 tor: Connected to Tor version 0.2.8.6\n2016-08-06 18:35:15 tor: Supported authentication method: COOKIE\n2016-08-06 18:35:15 tor: Supported authentication method: SAFECOOKIE\n2016-08-06 18:35:15 tor: Using SAFECOOKIE authentication, reading cookie authentication from /var/run/tor/control.authcookie\n2016-08-06 18:35:15 tor: SAFECOOKIE authentication challenge succesful\n2016-08-06 18:35:15 tor: AUTHCHALLENGE ServerHash fce8296710d767170c325e4f411fb9bc5f34e56481cbe59dcd31b49de7ee0914 ServerNonce b284aa41a9c892e071d7431b17bbac572059de09f3fa6866006c2f18a78a1cea\n2016-08-06 18:35:15 tor: Authentication succesful\n2016-08-06 18:35:15 tor: ADD_ONION succesful\n2016-08-06 18:35:15 tor: Got service ID td6iaq6jpck24fxx, advertizing service td6iaq6jpck24fxx.onion:8333\n2016-08-06 18:35:15 tor: Cached service private key to /home/b/.bitcoin/onion_private_key\n2016-08-06 18:35:15 AddLocal(td6iaq6jpck24fxx.onion:8333,4)\n2016-08-06 18:35:15 Loaded 10651 addresses from peers.dat  276ms\n2016-08-06 18:35:15 init message: Done loading\n2016-08-06 18:35:15 addcon thread start\n2016-08-06 18:35:15 opencon thread start\n2016-08-06 18:35:15 msghand thread start\n2016-08-06 18:35:15 dnsseed thread start\n2016-08-06 18:35:15 net thread start\n2016-08-06 18:35:15 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=1\n2016-08-06 18:35:15 receive version message: /Satoshi:0.9.99/: version 70002, blocks=-1, us=68.184.202.88:8333, peer=2\n2016-08-06 18:35:15 receive version message: /Satoshi:0.9.99/: version 70002, blocks=-1, us=68.184.202.88:8333, peer=3\n2016-08-06 18:35:15 receive version message: /ViaBTC:bitpeer.0.2.0/: version 70012, blocks=0, us=0.0.0.0:0, peer=4\n2016-08-06 18:35:15 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=5\n2016-08-06 18:35:15 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=6\n2016-08-06 18:35:15 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=7\n2016-08-06 18:35:15 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=8\n2016-08-06 18:35:15 receive version message: /Satoshi:0.9.99/: version 70002, blocks=-1, us=68.184.202.88:8333, peer=9\n2016-08-06 18:35:15 receive version message: /bitnodes.21.co:0.1/: version 70002, blocks=424011, us=68.184.202.88:8333, peer=10\n2016-08-06 18:35:15 receive version message: /Satoshi:0.9.99/: version 70002, blocks=-1, us=68.184.202.88:8333, peer=11\n2016-08-06 18:35:15 receive version message: /Satoshi:0.11.2/: version 70002, blocks=423129, us=68.184.202.88:8333, peer=12\n2016-08-06 18:35:15 socket send error Bad file descriptor (9)\n2016-08-06 18:35:15 receive version message: /bitnodes.21.co:0.1/: version 70002, blocks=424012, us=68.184.202.88:8333, peer=13\n2016-08-06 18:35:15 receive version message: /Satoshi:0.11.2/: version 70002, blocks=422168, us=68.184.202.88:8333, peer=14\n2016-08-06 18:35:15 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=15\n2016-08-06 18:35:15 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=16\n2016-08-06 18:35:15 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=17\n2016-08-06 18:35:15 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=18\n2016-08-06 18:35:15 receive version message: /Satoshi:0.9.99/: version 70002, blocks=-1, us=68.184.202.88:8333, peer=19\n2016-08-06 18:35:15 receive version message: /Satoshi:0.9.99/: version 70002, blocks=-1, us=68.184.202.88:8333, peer=20\n2016-08-06 18:35:15 socket send error Bad file descriptor (9)\n2016-08-06 18:35:15 receive version message: /Snoopy:0.2.1/: version 70001, blocks=0, us=68.184.202.88:8333, peer=21\n2016-08-06 18:35:15 receive version message: /Satoshi:0.9.99/: version 70002, blocks=-1, us=68.184.202.88:8333, peer=22\n2016-08-06 18:35:15 socket send error Bad file descriptor (9)\n2016-08-06 18:35:15 receive version message: /bitcoin-seeder:0.01/: version 60000, blocks=350000, us=68.184.202.88:8333, peer=23\n2016-08-06 18:35:15 receive version message: /bitcoin-seeder:0.01/: version 60000, blocks=350000, us=68.184.202.88:8333, peer=24\n2016-08-06 18:35:15 receive version message: /Satoshi:0.9.99/: version 70002, blocks=-1, us=68.184.202.88:8333, peer=25\n2016-08-06 18:35:15 socket send error Bad file descriptor (9)\n2016-08-06 18:35:15 receive version message: /bitcoin-seeder:0.01/: version 60000, blocks=350000, us=68.184.202.88:8333, peer=26\n2016-08-06 18:35:15 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=27\n2016-08-06 18:35:15 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=28\n2016-08-06 18:35:15 receive version message: /bitcoin-seeder:0.01/: version 60000, blocks=350000, us=68.184.202.88:8333, peer=29\n2016-08-06 18:35:15 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=31\n2016-08-06 18:35:15 receive version message: /btcnodes.org-seeder:0.01/: version 60000, blocks=230000, us=68.184.202.88:8333, peer=32\n2016-08-06 18:35:15 receive version message: /bitcoin-seeder:0.01/: version 60000, blocks=230000, us=68.184.202.88:8333, peer=33\n2016-08-06 18:35:15 receive version message: /Satoshi:0.9.99/: version 70002, blocks=-1, us=68.184.202.88:8333, peer=34\n2016-08-06 18:35:15 socket send error Bad file descriptor (9)\n2016-08-06 18:35:15 receive version message: /Satoshi:0.9.99/: version 70002, blocks=-1, us=68.184.202.88:8333, peer=35\n2016-08-06 18:35:15 receive version message: /bitcoin-seeder:0.01/: version 60000, blocks=350000, us=68.184.202.88:8333, peer=36\n2016-08-06 18:35:15 socket send error Bad file descriptor (9)\n2016-08-06 18:35:15 receive version message: /Satoshi:0.9.99/: version 70002, blocks=-1, us=68.184.202.88:8333, peer=37\n2016-08-06 18:35:15 receive version message: /bitcoin-seeder:0.01/: version 60000, blocks=350000, us=68.184.202.88:8333, peer=38\n2016-08-06 18:35:15 receive version message: /Satoshi:0.9.99/: version 70002, blocks=-1, us=68.184.202.88:8333, peer=39\n2016-08-06 18:35:15 receive version message: /bitnodes.21.co:0.1/: version 70002, blocks=424012, us=68.184.202.88:8333, peer=40\n2016-08-06 18:35:15 receive version message: /bitcoin-seeder:0.01/: version 60000, blocks=350000, us=68.184.202.88:8333, peer=41\n2016-08-06 18:35:17 receive version message: /Satoshi:0.11.2/ljr:20151118/: version 70002, blocks=424015, us=68.184.202.88:39816, peer=42\n2016-08-06 18:35:21 connect() to 62.34.146.14:8333 failed after select(): No route to host (113)\n2016-08-06 18:35:26 P2P peers available. Skipped DNS seeding.\n2016-08-06 18:35:26 dnsseed thread exit\n2016-08-06 18:35:44 SOCKS5 connecting 6sgukxaz6m6qigtk.onion\n2016-08-06 18:36:02 receive version message: /bitcoin-seeder:0.01/: version 60000, blocks=230000, us=68.184.202.88:8333, peer=43\n2016-08-06 18:36:04 ERROR: Error reading proxy response\n2016-08-06 18:36:04 connect() to [2601:5c9:0:a400::1]:8333 failed: Network is unreachable (101)\n2016-08-06 18:36:05 receive version message: /Satoshi:0.10.2/: version 70002, blocks=424015, us=68.184.202.88:34278, peer=44\n2016-08-06 18:36:11 connect() to 104.139.88.49:8333 failed after select(): Connection refused (111)\n2016-08-06 18:36:18 receive version message: /Satoshi:0.12.1/: version 70012, blocks=424015, us=68.184.202.88:35966, peer=45\n2016-08-06 18:36:24 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=47\n2016-08-06 18:36:30 SOCKS5 connecting pjghcivzkoersesd.onion\n2016-08-06 18:36:34 SOCKS5 connected pjghcivzkoersesd.onion\n2016-08-06 18:36:34 receive version message: /Satoshi:0.12.1/: version 70012, blocks=424015, us=0.0.0.0:0, peer=48\n2016-08-06 18:36:43 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=49\n2016-08-06 18:36:46 receive version message: /Satoshi:0.10.0/: version 70002, blocks=424015, us=68.184.202.88:34941, peer=50\n2016-08-06 18:36:46 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=51\n2016-08-06 18:36:47 receive version message: /Satoshi:0.12.1/: version 70012, blocks=424015, us=68.184.202.88:37247, peer=52\n2016-08-06 18:36:49 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=53\n2016-08-06 18:36:53 connect() to 213.140.88.188:8333 failed after select(): Connection refused (111)\n2016-08-06 18:37:06 receive version message: /bitnodes.21.co:0.1/: version 70002, blocks=424014, us=td6iaq6jpck24fxx.onion:8333, peer=54\n2016-08-06 18:37:11 receive version message: /Satoshi:0.12.99/: version 70013, blocks=424015, us=68.184.202.88:48672, peer=55\n2016-08-06 18:37:14 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=56\n2016-08-06 18:37:25 receive version message: /Satoshi:0.12.1/: version 70012, blocks=424013, us=68.184.202.88:46594, peer=57\n2016-08-06 18:37:30 receive version message: /Snoopy:0.2.1/: version 70001, blocks=0, us=68.184.202.88:8333, peer=58\n2016-08-06 18:38:15 receive version message: /bitcoinj:0.12.2/: version 70001, blocks=424015, us=127.0.0.1:8333, peer=59\n2016-08-06 18:38:17 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=60\n2016-08-06 18:38:42 receive version message: /bitcoin-seeder:0.01/: version 60000, blocks=350000, us=68.184.202.88:8333, peer=61\n2016-08-06 18:38:44 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=62\n2016-08-06 18:38:54 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=63\n2016-08-06 18:38:59 receive version message: /bitcoinj:0.14.1/: version 70001, blocks=0, us=127.0.0.1:8333, peer=64\n2016-08-06 18:39:12 receive version message: /Satoshi:0.11.0/: version 70002, blocks=375495, us=68.184.202.88:8333, peer=65\n2016-08-06 18:39:20 receive version message: /Satoshi:0.12.1/: version 70012, blocks=374602, us=68.184.202.88:8333, peer=66\n```\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 7,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8476/comments",
   "created_at" : "2016-08-06T18:44:27Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8476/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/8476",
   "id" : 169760556,
   "labels" : [
      {
         "color" : "000000",
         "default" : false,
         "id" : 219890555,
         "name" : "Block storage",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Block%20storage"
      },
      {
         "color" : "006b75",
         "default" : false,
         "id" : 98298007,
         "name" : "P2P",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8476/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 8476,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Can't seem to rejoin the main chain:  Bitcoind stuck at block 422168. \"Timestamp too far in future.\"",
   "updated_at" : "2016-11-03T20:40:34Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8476",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/1205677?v=3",
      "events_url" : "https://api.github.com/users/nathaniel-mahieu/events{/privacy}",
      "followers_url" : "https://api.github.com/users/nathaniel-mahieu/followers",
      "following_url" : "https://api.github.com/users/nathaniel-mahieu/following{/other_user}",
      "gists_url" : "https://api.github.com/users/nathaniel-mahieu/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/nathaniel-mahieu",
      "id" : 1205677,
      "login" : "nathaniel-mahieu",
      "organizations_url" : "https://api.github.com/users/nathaniel-mahieu/orgs",
      "received_events_url" : "https://api.github.com/users/nathaniel-mahieu/received_events",
      "repos_url" : "https://api.github.com/users/nathaniel-mahieu/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/nathaniel-mahieu/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/nathaniel-mahieu/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/nathaniel-mahieu"
   }
}
