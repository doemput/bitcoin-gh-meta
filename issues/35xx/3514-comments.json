[
   {
      "body" : "Needs rebase after #3516",
      "created_at" : "2014-01-13T17:16:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-32189832",
      "id" : 32189832,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-01-13T17:16:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/32189832",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Will rebase tonight.",
      "created_at" : "2014-01-13T17:17:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-32189923",
      "id" : 32189923,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-01-13T17:17:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/32189923",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Did a sync from scratch using this branch (plus #3517) on mainnet, a significant part of which under valgrind. Seems to work fine, though sometimes long chains of accumulated orphans are connected, resulting in cs_main being locked for a long time. I'll try to fix that independently.",
      "created_at" : "2014-01-18T20:49:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-32692633",
      "id" : 32692633,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-01-18T20:49:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/32692633",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Rebase after logging changes.",
      "created_at" : "2014-01-27T21:36:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-33425618",
      "id" : 33425618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-01-27T21:36:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33425618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "ACK\r\n",
      "created_at" : "2014-01-29T19:52:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-33623127",
      "id" : 33623127,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-01-29T19:52:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33623127",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/494411?v=3",
         "events_url" : "https://api.github.com/users/jgarzik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jgarzik/followers",
         "following_url" : "https://api.github.com/users/jgarzik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jgarzik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jgarzik",
         "id" : 494411,
         "login" : "jgarzik",
         "organizations_url" : "https://api.github.com/users/jgarzik/orgs",
         "received_events_url" : "https://api.github.com/users/jgarzik/received_events",
         "repos_url" : "https://api.github.com/users/jgarzik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jgarzik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jgarzik"
      }
   },
   {
      "body" : "I did some testing with block syncs, no problems found, worked fine for me.",
      "created_at" : "2014-01-30T13:22:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-33686852",
      "id" : 33686852,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-01-30T13:22:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33686852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "There is one potential problem here, namely that the many orphans can result in very long chains (I've seen up to ~400)  of blocks being connected within a single cs_main lock, essentially making the program look frozen. This can be solved by pushing some locks down, but may need some discussion first.\r\n\r\nI could easily submit the limit-orphans commit as a separate pull request though, as I suppose that can be seen as a memory usage bug fix.",
      "created_at" : "2014-01-30T13:26:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-33687117",
      "id" : 33687117,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-01-30T13:26:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/33687117",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/f59d8f0b644d49324cabd19c58cf2262d49e1392 for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.",
      "created_at" : "2014-02-08T16:31:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-34548315",
      "id" : 34548315,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-02-08T16:31:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/34548315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2110907?v=3",
         "events_url" : "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitcoinPullTester/followers",
         "following_url" : "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitcoinPullTester",
         "id" : 2110907,
         "login" : "BitcoinPullTester",
         "organizations_url" : "https://api.github.com/users/BitcoinPullTester/orgs",
         "received_events_url" : "https://api.github.com/users/BitcoinPullTester/received_events",
         "repos_url" : "https://api.github.com/users/BitcoinPullTester/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitcoinPullTester/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitcoinPullTester"
      }
   },
   {
      "body" : "Regarding slowing down the download of the small blocks - how about factoring in the block size and incrementally changing how many peers are used as the block sizes get larger?",
      "created_at" : "2014-02-23T01:06:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-35820557",
      "id" : 35820557,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-02-23T01:06:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35820557",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/3514#discussion_r9973890"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9973890"
         }
      },
      "body" : "Why was this here?",
      "commit_id" : "f59d8f0b644d49324cabd19c58cf2262d49e1392",
      "created_at" : "2014-02-23T01:08:33Z",
      "diff_hunk" : "@@ -2021,7 +2105,6 @@ bool AddToBlockIndex(CBlock& block, CValidationState& state, const CDiskBlockPos\n          pindexNew->nSequenceId = nBlockSequenceId++;\n     }\n     assert(pindexNew);\n-    mapAlreadyAskedFor.erase(CInv(MSG_BLOCK, hash));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#discussion_r9973890",
      "id" : 9973890,
      "original_commit_id" : "f59d8f0b644d49324cabd19c58cf2262d49e1392",
      "original_position" : 122,
      "path" : "src/main.cpp",
      "position" : 122,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3514",
      "updated_at" : "2014-02-23T01:08:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/9973890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Looks good. I shall test it now!",
      "created_at" : "2014-02-23T01:13:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-35820672",
      "id" : 35820672,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-02-23T01:13:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35820672",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Regarding limiting the number of orphans held in memory - how is this done? Are nodes going to be downloading blocks and then discarding them? If so, this is going to create a bandwidth overhead among nodes...",
      "created_at" : "2014-02-23T01:18:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-35820744",
      "id" : 35820744,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-02-23T01:18:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/35820744",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "I've been testing this a few days now. The stuck block detection doesn't seem to be working:-\r\n\r\n2014-02-26 22:24:01 Requesting block 00000000000000014e06412631ff67305cde77c6631dc58a2ce35308558cee05 from 216.99.101.192:8333\r\n2014-02-26 22:28:31 ResendWalletTransactions()\r\n2014-02-26 22:54:16 socket recv error 110\r\n2014-02-26 22:54:17 receive version message: /Satoshi:0.8.6/: version 70001, blocks=287993, us=70.42.240.30:57711, them=207.255.42.202:8333, peer=207.255.42.202:8333\r\n2014-02-26 22:54:17 Added time data, samples 10, offset +0 (+0 minutes)\r\n2014-02-26 22:56:34 socket recv error 110\r\n2014-02-26 22:57:26 connect() to 173.79.229.22:8333 failed after select(): Connection refused\r\n2014-02-26 22:57:28 socket recv error 110\r\n2014-02-26 22:58:03 socket recv error 110\r\n\r\nalmost an 30 minutes went by with no download happening, and it didn't seem to notice.",
      "created_at" : "2014-02-26T23:29:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-36191367",
      "id" : 36191367,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-02-26T23:29:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/36191367",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/3514#discussion_r10105319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/10105319"
         }
      },
      "body" : "Magic number... why so high? In the later stages of block download I'd have thought a number close to 1 would be appropriate.",
      "commit_id" : "f59d8f0b644d49324cabd19c58cf2262d49e1392",
      "created_at" : "2014-02-26T23:31:13Z",
      "diff_hunk" : "@@ -59,6 +59,11 @@\n static const unsigned int LOCKTIME_THRESHOLD = 500000000; // Tue Nov  5 00:53:20 1985 UTC\n /** Maximum number of script-checking threads allowed */\n static const int MAX_SCRIPTCHECK_THREADS = 16;\n+/** Number of blocks that can be requested at any given time from a single peer. */\n+static const int MAX_BLOCKS_IN_TRANSIT_PER_PEER = 128;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#discussion_r10105319",
      "id" : 10105319,
      "original_commit_id" : "f59d8f0b644d49324cabd19c58cf2262d49e1392",
      "original_position" : 5,
      "path" : "src/main.h",
      "position" : 5,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3514",
      "updated_at" : "2014-02-26T23:31:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/10105319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/3514#discussion_r10163903"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/10163903"
         }
      },
      "body" : "Because blocks used to be tracked using the (weak) mapAlreadyAskedFor mechanism, but this patch introduces a better way, that retains information about whom it was asked from.",
      "commit_id" : "f59d8f0b644d49324cabd19c58cf2262d49e1392",
      "created_at" : "2014-02-28T13:40:31Z",
      "diff_hunk" : "@@ -2021,7 +2105,6 @@ bool AddToBlockIndex(CBlock& block, CValidationState& state, const CDiskBlockPos\n          pindexNew->nSequenceId = nBlockSequenceId++;\n     }\n     assert(pindexNew);\n-    mapAlreadyAskedFor.erase(CInv(MSG_BLOCK, hash));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#discussion_r10163903",
      "id" : 10163903,
      "original_commit_id" : "f59d8f0b644d49324cabd19c58cf2262d49e1392",
      "original_position" : 122,
      "path" : "src/main.cpp",
      "position" : 122,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3514",
      "updated_at" : "2014-02-28T13:40:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/10163903",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "So far upon testing this code, I've not yet seen it downloading blocks from more than one node. There's not even any code to send a getblocks to more than one node from what I can tell. If a node is deemed to be unresponsive it's forcefully disconnected. How come this is ok, and yet my pull request to disconnect nodes sending blocks my nodes already had was considered not ok?",
      "created_at" : "2014-03-01T20:37:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-36435818",
      "id" : 36435818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-03-01T20:37:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/36435818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "This does not do parallel block download yet, as that requires\nheaders-first sync. This is a step towards that, though.\n\nAnd disconnecting unresponsive peers is fine - it's the only way to not\nwaste their bandwidth if we don't need/want requested blocks anymore.\n\nWhat is not fine, is disconecting peers because they're the second ones to\nrespond to a block that we requested twice. We should simply not request\nthe same block twice in the first place. That is what this pull request is\nsupposed to do. If you still see already have block messages with this\npatch, there is possibly a bug in it that will need to be addressed.",
      "created_at" : "2014-03-01T20:44:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-36435987",
      "id" : 36435987,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-03-01T20:44:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/36435987",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/3514#discussion_r10192843"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/10192843"
         }
      },
      "body" : "That would be a further optimization, yes.",
      "commit_id" : "f59d8f0b644d49324cabd19c58cf2262d49e1392",
      "created_at" : "2014-03-01T22:26:50Z",
      "diff_hunk" : "@@ -59,6 +59,11 @@\n static const unsigned int LOCKTIME_THRESHOLD = 500000000; // Tue Nov  5 00:53:20 1985 UTC\n /** Maximum number of script-checking threads allowed */\n static const int MAX_SCRIPTCHECK_THREADS = 16;\n+/** Number of blocks that can be requested at any given time from a single peer. */\n+static const int MAX_BLOCKS_IN_TRANSIT_PER_PEER = 128;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#discussion_r10192843",
      "id" : 10192843,
      "original_commit_id" : "f59d8f0b644d49324cabd19c58cf2262d49e1392",
      "original_position" : 5,
      "path" : "src/main.h",
      "position" : 5,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3514",
      "updated_at" : "2014-03-01T22:26:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/10192843",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa I deleted my previous comment about \"already have\" messages - none seen with this patch so far! But... a misbehaving node could still send random blocks if it wanted to, so at some point in the future I suspect we'll want to set that sort of behaviour as misbehaviour - maybe even as part of this pull request...?",
      "created_at" : "2014-03-02T00:27:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-36441709",
      "id" : 36441709,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-03-02T00:27:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/36441709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "@rebroad That's a good question. The problem is that the current code actually does broadcast blocks sometimes without inv, namely newly mined blocks which are certain not be exist anywhere else.\r\n",
      "created_at" : "2014-03-02T00:44:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-36442056",
      "id" : 36442056,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-03-02T00:44:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/36442056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "why would it broadcast a block without broadcasting the inv first?\r\n\r\nAs an aside note, I notice the block download got stuck today, and wasn't able to recover - it was still downloading blocks that were being advertised (i.e. the latest block mined), but the initial block download stayed stuck.",
      "created_at" : "2014-03-02T07:41:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-36448412",
      "id" : 36448412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2016-12-05T00:54:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/36448412",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "@sipa Re misbehaviour, it could just be for nodes sending unsolicited blocks that the node already has. Perhaps +30.",
      "created_at" : "2014-03-02T09:09:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-36449673",
      "id" : 36449673,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-03-02T09:09:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/36449673",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "The stuck download detection seems like it might not be working.\r\n",
      "created_at" : "2014-03-08T00:15:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-37081770",
      "id" : 37081770,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2016-12-05T00:54:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/37081770",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "I think this has been pulled prematurely. It's still got problems as I mentioned above. For one, it doesn't resume download if the OS is suspended and resumed.",
      "created_at" : "2014-03-30T04:08:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-39017091",
      "id" : 39017091,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2016-12-05T00:53:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/39017091",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "@rebroad can you post new problems and bug reports in new issues? If you just dump them into existing, closed issues they will probably get lost.\r\n\r\n",
      "created_at" : "2014-03-30T07:47:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-39019879",
      "id" : 39019879,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-03-30T07:47:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/39019879",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "And IMO, going toward headers-first / parallel block download is the single most important point in continued development of Bitcoin Core right now.\r\n\r\nAs this is pull is an important step in that direction, this was prioritized to be merged as soon as possible after 0.9.0 was released.\r\n\r\nIf a little temporary inconvenience while the kinks are worked out is too much for you, I suggest staying with 0.9 for now. Thanks for helping test though.\r\n",
      "created_at" : "2014-03-30T10:32:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-39022308",
      "id" : 39022308,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-03-30T10:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/39022308",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "The stuck download detection here is just a very simple prototype. It only uses some hardcoded constants as thresholds. The purpose is turning it into a detection for one peer being slower than the other, once actual parallel downloading is there.\r\n\r\n@rebroad  Is this a regression introduced by this pullreq, or a pre-existing problem that you expected to be fixed by this but wasn't?",
      "created_at" : "2014-03-30T15:01:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-39027526",
      "id" : 39027526,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-03-30T15:01:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/39027526",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa it's a regression.",
      "created_at" : "2014-03-31T17:27:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-39116197",
      "id" : 39116197,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-03-31T17:27:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/39116197",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "I suspended my PC with bitcoin running a few nights and it had no problem recovering connections when re-awakened.\r\n\r\n@rebroad Do you perhaps have a dynamic IP, that changes if you computer was suspended for a while? If so Bitcoin indeed doesn't cope with it too well (it will AFAIK still advertise the old address so you won't get incoming connections). But that's not a regression or new issue.\r\n",
      "created_at" : "2014-04-04T07:27:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-39538408",
      "id" : 39538408,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-04-04T07:27:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/39538408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj yes, my IP address changes, but I don't accept incoming connections either. The getting stuck after a suspend didn't happen before I applied this pullreq AFAIK.",
      "created_at" : "2014-04-06T03:29:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#issuecomment-39657511",
      "id" : 39657511,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/3514",
      "updated_at" : "2014-04-06T03:29:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/39657511",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/3514#discussion_r85498800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3514"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85498800"
         }
      },
      "body" : "Really don't like the use of functions that clearly don't do what their name suggests they do.\r\n\r\nWhat parts of this function are needed? And what would the function be called if it did what it is needing to do here?",
      "commit_id" : "f59d8f0b644d49324cabd19c58cf2262d49e1392",
      "created_at" : "2016-10-28T09:28:22Z",
      "diff_hunk" : "@@ -227,8 +247,71 @@ void InitializeNode(NodeId nodeid, const CNode *pnode) {\n \n void FinalizeNode(NodeId nodeid) {\n     LOCK(cs_main);\n+    CNodeState *state = State(nodeid);\n+\n+    BOOST_FOREACH(const QueuedBlock& entry, state->vBlocksInFlight)\n+        mapBlocksInFlight.erase(entry.hash);\n+    BOOST_FOREACH(const uint256& hash, state->vBlocksToDownload)\n+        mapBlocksToDownload.erase(hash);\n+\n     mapNodeState.erase(nodeid);\n }\n+\n+// Requires cs_main.\n+void MarkBlockAsReceived(const uint256 &hash, NodeId nodeFrom = -1) {\n+    map<uint256, pair<NodeId, list<uint256>::iterator> >::iterator itToDownload = mapBlocksToDownload.find(hash);\n+    if (itToDownload != mapBlocksToDownload.end()) {\n+        CNodeState *state = State(itToDownload->second.first);\n+        state->vBlocksToDownload.erase(itToDownload->second.second);\n+        state->nBlocksToDownload--;\n+        mapBlocksToDownload.erase(itToDownload);\n+    }\n+\n+    map<uint256, pair<NodeId, list<QueuedBlock>::iterator> >::iterator itInFlight = mapBlocksInFlight.find(hash);\n+    if (itInFlight != mapBlocksInFlight.end()) {\n+        CNodeState *state = State(itInFlight->second.first);\n+        state->vBlocksInFlight.erase(itInFlight->second.second);\n+        state->nBlocksInFlight--;\n+        if (itInFlight->second.first == nodeFrom)\n+            state->nLastBlockReceive = GetTimeMicros();\n+        mapBlocksInFlight.erase(itInFlight);\n+    }\n+\n+}\n+\n+// Requires cs_main.\n+bool AddBlockToQueue(NodeId nodeid, const uint256 &hash) {\n+    if (mapBlocksToDownload.count(hash) || mapBlocksInFlight.count(hash))\n+        return false;\n+\n+    CNodeState *state = State(nodeid);\n+    if (state == NULL)\n+        return false;\n+\n+    list<uint256>::iterator it = state->vBlocksToDownload.insert(state->vBlocksToDownload.end(), hash);\n+    state->nBlocksToDownload++;\n+    if (state->nBlocksToDownload > 5000)\n+        Misbehaving(nodeid, 10);\n+    mapBlocksToDownload[hash] = std::make_pair(nodeid, it);\n+    return true;\n+}\n+\n+// Requires cs_main.\n+void MarkBlockAsInFlight(NodeId nodeid, const uint256 &hash) {\n+    CNodeState *state = State(nodeid);\n+    assert(state != NULL);\n+\n+    // Make sure it's not listed somewhere already.\n+    MarkBlockAsReceived(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/3514#discussion_r85498800",
      "id" : 85498800,
      "original_commit_id" : "f59d8f0b644d49324cabd19c58cf2262d49e1392",
      "original_position" : 97,
      "path" : "src/main.cpp",
      "position" : 97,
      "pull_request_review_id" : 6211703,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/3514",
      "updated_at" : "2016-10-28T09:29:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85498800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   }
]
