[
   {
      "body" : "I also run into this with armory. ",
      "created_at" : "2016-09-23T04:23:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8798#issuecomment-249099812",
      "id" : 249099812,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8798",
      "updated_at" : "2016-09-23T04:23:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/249099812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7988928?v=3",
         "events_url" : "https://api.github.com/users/BitpopCoin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BitpopCoin/followers",
         "following_url" : "https://api.github.com/users/BitpopCoin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BitpopCoin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BitpopCoin",
         "id" : 7988928,
         "login" : "BitpopCoin",
         "organizations_url" : "https://api.github.com/users/BitpopCoin/orgs",
         "received_events_url" : "https://api.github.com/users/BitpopCoin/received_events",
         "repos_url" : "https://api.github.com/users/BitpopCoin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BitpopCoin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BitpopCoin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BitpopCoin"
      }
   },
   {
      "body" : "@EthanHeilman Can you please look at this issue?",
      "created_at" : "2016-09-24T07:22:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8798#issuecomment-249350483",
      "id" : 249350483,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8798",
      "updated_at" : "2016-09-24T07:22:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/249350483",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "@paveljanik I'll take a look. I am not familiar with the new connection exhaustion countermeasure code and I should be.",
      "created_at" : "2016-09-24T16:59:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8798#issuecomment-249375441",
      "id" : 249375441,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8798",
      "updated_at" : "2016-09-24T16:59:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/249375441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "I'm hitting this issue now as I have an SPV node running on limited hardware that connects to a trusted full node on another machine.  The full node accepts public connections as well and sometimes doesn't have a slot for my SPV node even though the IP it's connecting from is whitelisted.  It'd be nice if the full node would eject some other non-whitelisted node to make room for my SPV node when it's trying to connect.",
      "created_at" : "2016-11-15T20:05:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8798#issuecomment-260751749",
      "id" : 260751749,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8798",
      "updated_at" : "2016-11-15T20:05:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/260751749",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7641?v=3",
         "events_url" : "https://api.github.com/users/asoltys/events{/privacy}",
         "followers_url" : "https://api.github.com/users/asoltys/followers",
         "following_url" : "https://api.github.com/users/asoltys/following{/other_user}",
         "gists_url" : "https://api.github.com/users/asoltys/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/asoltys",
         "id" : 7641,
         "login" : "asoltys",
         "organizations_url" : "https://api.github.com/users/asoltys/orgs",
         "received_events_url" : "https://api.github.com/users/asoltys/received_events",
         "repos_url" : "https://api.github.com/users/asoltys/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/asoltys/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/asoltys/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/asoltys"
      }
   },
   {
      "body" : "@asoltys As a temporary measure, I believe that these iptables rules will limit the number of incoming connections:\r\n\r\n    # add any number of the below whitelist rules, replacing 1.2.3.4 with an IP or CIDR subnet\r\n    iptables -A INPUT -p tcp --syn --dport 8333 -s 1.2.3.4 -j ACCEPT\r\n    # except for the whitelisted IPs, limit to 100 connections\r\n    iptables -A INPUT -p tcp --syn --dport 8333 -m connlimit --connlimit-above 100 --connlimit-mask 0 -j REJECT --reject-with tcp-reset\r\n\r\nNote that the `--connlimit-above 100` limit will only apply to connections that actually hit that rule -- whitelisted connections will not be counted. So the above rule allows for (by default) 8 outgoing connections, 100 non-whitelisted incoming connections, and 12 reserved slots for whitelisted IPs.\r\n\r\n(This is largely untested.)",
      "created_at" : "2016-11-15T21:04:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8798#issuecomment-260767564",
      "id" : 260767564,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8798",
      "updated_at" : "2016-11-15T21:08:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/260767564",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/628984?v=3",
         "events_url" : "https://api.github.com/users/theymos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theymos/followers",
         "following_url" : "https://api.github.com/users/theymos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theymos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theymos",
         "id" : 628984,
         "login" : "theymos",
         "organizations_url" : "https://api.github.com/users/theymos/orgs",
         "received_events_url" : "https://api.github.com/users/theymos/received_events",
         "repos_url" : "https://api.github.com/users/theymos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theymos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theymos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theymos"
      }
   },
   {
      "body" : "@theymos thanks I hadn't even thought of using iptables but that should do the trick!",
      "created_at" : "2016-11-16T01:57:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8798#issuecomment-260830649",
      "id" : 260830649,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8798",
      "updated_at" : "2016-11-16T01:57:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/260830649",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7641?v=3",
         "events_url" : "https://api.github.com/users/asoltys/events{/privacy}",
         "followers_url" : "https://api.github.com/users/asoltys/followers",
         "following_url" : "https://api.github.com/users/asoltys/following{/other_user}",
         "gists_url" : "https://api.github.com/users/asoltys/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/asoltys",
         "id" : 7641,
         "login" : "asoltys",
         "organizations_url" : "https://api.github.com/users/asoltys/orgs",
         "received_events_url" : "https://api.github.com/users/asoltys/received_events",
         "repos_url" : "https://api.github.com/users/asoltys/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/asoltys/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/asoltys/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/asoltys"
      }
   },
   {
      "body" : "@theymos thanks for raising this - I was wondering why my whitelisted SPV node had stopped being able to connect to my full-node - this would explain why.\r\n\r\nI don't think reverting #6374 is the best solution though - at least, not in a way that available inbound connections are reduced while the white connections are not in use. Ideally I would like to see the feature where when a white connection comes in, an existing low-rating inbound connection is evicted to make room for it. This way it's simply a case of white connections having priority over other inbound connections, without needing to state how many slots to reserve.",
      "created_at" : "2016-11-16T05:06:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8798#issuecomment-260855242",
      "id" : 260855242,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8798",
      "updated_at" : "2016-11-16T05:09:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/260855242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   }
]
