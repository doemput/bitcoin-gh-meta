[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've consolidated the important info from the original issue here.\r\n\r\n---\r\n\r\nTo see if I could reproduce I did this:\r\n- Create a brand-new Ubuntu Xenial (16.04) VM, from today's (2015-09-14) cloud image \r\n- Install the necessary dependencies, and build requirements from these documents:\r\n\r\n```\r\nsudo apt-get install g++-mingw-w64-i686 mingw-w64-i686-dev g++-mingw-w64-x86-64 mingw-w64-x86-64-dev curl\r\nsudo apt-get install build-essential libtool autotools-dev automake pkg-config libssl-dev libevent-dev bsdmainutils\r\n```\r\n\r\nWhile doing this I indeed saw some logging output about gcc alternatives: I wonder which one was selected by default. Apparently the -win32 variant, not the POSIX one.\r\n- Follow the instructions for building for windows 64-bit:\r\n\r\n```\r\n    cd depends\r\n    make HOST=x86_64-w64-mingw32 -j4\r\n    cd ..\r\n    ./autogen.sh\r\n    ./configure --prefix=`pwd`/depends/x86_64-w64-mingw32\r\n    make\r\n```\r\n- It fails with the following error, the same error that you get:\r\n\r\n```\r\n/usr/lib/gcc/x86_64-w64-mingw32/5.3-win32/include/c++/bits/unique_ptr.h:49:28: note: declared here\r\n   template<typename> class auto_ptr;\r\n                            ^\r\nhttpserver.cpp:69:10: error: Ã¢ÂÂmutexÃ¢ÂÂ in namespace Ã¢ÂÂstdÃ¢ÂÂ does not name a type\r\n     std::mutex cs;\r\n          ^\r\nhttpserver.cpp:70:10: error: Ã¢ÂÂcondition_variableÃ¢ÂÂ in namespace Ã¢ÂÂstdÃ¢ÂÂ does not name a type\r\n     std::condition_variable cond;\r\n```\r\n- I changed the alternatives to -posix under  `sudo update-alternatives --config ...` as suggested in this patch.\r\n- Cleaned and re-built bitcoin (but not the dependencies - maybe I should), and this time it passed.\r\n- Status (Windows 10):\r\n\r\n```\r\nbitcoin-test.exe: crashes on start\r\nbitcoin-qt.exe: crashes on start\r\nbitcoind.exe: seems to work, but throws bad_cast on exit\r\nbitcoin-cli.exe: seems to work, but cannot connect to server?\r\nbitcoin-tx.exe: seems to work\r\n```\r\n- Going to clean and re-build the dependencies, as well as bitcoin entirely _with the -posix compiler_.\r\n- This didn't change anything, still same status as above.\r\n\r\n---\r\n\r\nOK I've done some research. In principle, `std::mutex` is supported in the -win32 compiler variant (which we've always used, and are using in Trusty). No POSIX emulation layer is needed for c++11 threads. However the problem with `<mutex>` and friends on newer Ubuntu's mingw-w64 seems to be the following:\r\n- Firstly, there is a `/usr/lib/gcc/x86_64-w64-mingw32/5.3-win32/include/c++/mutex`. However the definition of the actual class is guarded by `_GLIBCXX_HAS_GTHREADS`.\r\n- However it requires building glibcxx with a certain library (not to be confused with GLIB's \"libgthread\"):\r\n  - `_GLIBCXX_HAS_GTHREADS` is supposed to be defined in `/usr/lib/gcc/x86_64-w64-mingw32/5.3-win32/include/c++/x86_64-w64-mingw32/bits/c++config.h` when this has been done\r\n\r\nThis is an Ubuntu-specific problem: the \"gthreads\" (GCC threads) library is not linked into libcxx.\r\n\r\nOn Trusty this is not an issue as gthreads is provided:\r\n- `/usr/include/c++/4.8/x86_64-w64-mingw32/bits/c++config.h` defines `_GLIBCXX_HAS_GTHREADS`.\r\n\r\nThere is a https://github.com/meganz/mingw-std-threads which some people use to work around this problem. But in principle I think Ubuntu should solve this upstream.\r\n\r\n---\r\n\r\nI have verified that after reverting the C++11 threads changes (https://github.com/laanwj/bitcoin/tree/2016_09_windows_hell), it builds normally with the default -win32 compiler. ~~`bitcoin-qt` then works, without having to disable hardening.~~\r\nFalse positive: I was building without wallet, with the wallet it still crashes. What a shit.\r\n\r\nHowever:\r\n- bitcoin-test.exe: crashes on start\r\n- bitcoin-qt.exe: crashes on start\r\n- bitcoind.exe: seems to work\r\n- bitcoin-cli.exe: seems to work, but cannot connect to server?\r\n- bitcoin-tx.exe: seems to work\r\n\r\n> The issue with bitcoin-cli looks like https://sourceforge.net/p/levent/bugs/363/ which is linked to mingw (but not its POSIX mode specifically)\r\n\r\nThis issue doesn't go away either, unfortunately.\r\n\r\n---\r\n\r\nLooks like `-fstack-protector-all` is the specific hardening flag that exposes problems. Apparently it affects use of BerkeleyDB and boost::test. The tests pass (at least in wine) without `--stack-protector-all`. It also makes Bitcoin-Qt with wallet start again. \r\n\r\nSo apparently there are three, at most tangentially related issues regarding Windows:\r\n- The `std::mutex` `std::condition_variable` etc problem on Ubuntu 15.10+. Can apparently be solved by enabling POSIX compatibility, or by using something like https://github.com/meganz/mingw-std-threads.\r\n- `-fstack-protector-all` issue (`-fstack-protector` doesn't have this problem, neither do the other hardening flags like nxcompat) - causes the tests to crash at startup (before even getting to our code in BasicTestingSetup!), as well as bitcoin-qt to crash at startup _if the wallet is enabled_.\r\n- libevent 'zu' header issue - causes bitcoin-cli and bitcoind to be unable to connect over RPC (which as mentioned by @sstone, looks like https://sourceforge.net/p/levent/bugs/363/) (fixed in #8730)\r\n\r\nI wonder when each of these issues started. My only recommendation for now is: **use an Ubuntu Trusty VM for windows cross-compilation**\r\n",
      "created_at" : "2016-10-08T09:10:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-252413423",
      "id" : 252413423,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-09-29T13:33:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/252413423",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "body" : "Hello. Just FYI, I stumbled upon this while tinkering with some stuff. Ubuntu 16.10 (I don't think anybody has mentioned this version yet) has the same mutex issues when building. Man, what a mess....",
      "created_at" : "2016-12-24T22:36:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-269102918",
      "id" : 269102918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2016-12-24T22:36:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/269102918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5931802?v=3",
         "events_url" : "https://api.github.com/users/droark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/droark/followers",
         "following_url" : "https://api.github.com/users/droark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/droark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/droark",
         "id" : 5931802,
         "login" : "droark",
         "organizations_url" : "https://api.github.com/users/droark/orgs",
         "received_events_url" : "https://api.github.com/users/droark/received_events",
         "repos_url" : "https://api.github.com/users/droark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/droark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/droark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/droark"
      }
   },
   {
      "body" : "Is there a workaround for the following error?\r\nIs there a workaround for the following error?\r\nIs there a workaround for the following error?\r\n\r\n\r\nIn file included from support/allocators/secure.h:9:0,\r\n                 from key.h:11,\r\n                 from base58.h:18,\r\n                 from httprpc.cpp:7:\r\n./support/lockedpool.h:195:18: error: Ã¢ÂÂmutexÃ¢ÂÂ in namespace Ã¢ÂÂstdÃ¢ÂÂ does not name a type\r\n     mutable std::mutex mutex;\r\n                  ^\r\n./support/lockedpool.h:228:17: error: Ã¢ÂÂonce_flagÃ¢ÂÂ in namespace Ã¢ÂÂstdÃ¢ÂÂ does not name a type\r\n     static std::once_flag init_flag;\r\n                 ^\r\n./support/lockedpool.h: In static member function Ã¢ÂÂstatic LockedPoolManager& LockedPoolManager::Instance()Ã¢ÂÂ:\r\n./support/lockedpool.h:215:9: error: Ã¢ÂÂcall_onceÃ¢ÂÂ is not a member of Ã¢ÂÂstdÃ¢ÂÂ\r\n         std::call_once(LockedPoolManager::init_flag, LockedPoolManager::CreateInstance);\r\n         ^\r\n./support/lockedpool.h:215:24: error: Ã¢ÂÂinit_flagÃ¢ÂÂ is not a member of Ã¢ÂÂLockedPoolManagerÃ¢ÂÂ\r\n         std::call_once(LockedPoolManager::init_flag, LockedPoolManager::CreateInstance);\r\n",
      "created_at" : "2017-06-14T02:12:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-308299583",
      "id" : 308299583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-06-14T02:12:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308299583",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/4187912?v=3",
         "events_url" : "https://api.github.com/users/moonss777/events{/privacy}",
         "followers_url" : "https://api.github.com/users/moonss777/followers",
         "following_url" : "https://api.github.com/users/moonss777/following{/other_user}",
         "gists_url" : "https://api.github.com/users/moonss777/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/moonss777",
         "id" : 4187912,
         "login" : "moonss777",
         "organizations_url" : "https://api.github.com/users/moonss777/orgs",
         "received_events_url" : "https://api.github.com/users/moonss777/received_events",
         "repos_url" : "https://api.github.com/users/moonss777/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/moonss777/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/moonss777/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/moonss777"
      }
   },
   {
      "body" : "I have same problem!",
      "created_at" : "2017-08-21T12:24:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-323730734",
      "id" : 323730734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-08-21T12:24:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/323730734",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/2098466?v=4",
         "events_url" : "https://api.github.com/users/eMosbat/events{/privacy}",
         "followers_url" : "https://api.github.com/users/eMosbat/followers",
         "following_url" : "https://api.github.com/users/eMosbat/following{/other_user}",
         "gists_url" : "https://api.github.com/users/eMosbat/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/eMosbat",
         "id" : 2098466,
         "login" : "eMosbat",
         "organizations_url" : "https://api.github.com/users/eMosbat/orgs",
         "received_events_url" : "https://api.github.com/users/eMosbat/received_events",
         "repos_url" : "https://api.github.com/users/eMosbat/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/eMosbat/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/eMosbat/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/eMosbat"
      }
   },
   {
      "body" : "I re-tested cross-depends build with the most recent Ubuntu at this time (17.04, Zesty):\r\n\r\n- Had to select the 'posix' variant, to prevent errors about `std::mutex`. It looks like mingw-w64, as of 6.2.1, still has no `std::mutex` implementation for win32 threads.\r\n```\r\nsudo update-alternatives --config x86_64-w64-mingw32-g++\r\nsudo update-alternatives --config x86_64-w64-mingw32-gcc\r\n```\r\n- All depends, as well as the whole project built without errors.\r\n- `test_bitcoin.exe` runs successfully with default hardening settings, all tests pass\r\n- `bitcoin-qt.exe` runs successfully, gets synchronizing\r\n\r\nSo good news: the problem I've reported here is gone with newest Ubuntu. I haven't tried any other versions, but clearly 16.04 (and possible 16.10) was a dud in this regard.\r\n\r\nWe should update `build-windows.md` as such, and add the part about POSIX alternatives from #8653 (but not recommend `--disable-hardening`!).",
      "created_at" : "2017-08-26T08:41:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-325103511",
      "id" : 325103511,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-08-26T08:45:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/325103511",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "So TL;DR. **Do not use Ubuntu 16.04 for cross-building Bitcoin Core to Windows** (reflected in build guide since #11119) use:\r\n- 14.04 (recommended, gitian does this - no need to set alternatives)\r\n- 17.04 (as tested above - need to set alternatives to posix)\r\n\r\nThis will likely never change. Ubuntu doesn't make major changes to compiler versions after the fact, even with compiler bugs like this. With this, I'm closing project https://github.com/bitcoin/bitcoin/projects/1 (but leaving this issue open, as will remain an issue).\r\n",
      "created_at" : "2017-08-26T09:03:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-325105430",
      "id" : 325105430,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-08-26T10:47:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/325105430",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I've actually got that problem compiling 0.14 on 32-bit on Ubuntu 17.04 running in Linux Subsystem for Windows, the issue was present in 16.04 so I upgraded and switched to gcc and gcc POSIX alternatives. Recompiled deps and run make clean but compiling still gives the following error.\r\n```\r\nIn file included from support/allocators/secure.h:9:0,\r\n                 from key.h:13,\r\n                 from base58.h:21,\r\n                 from alert.cpp:11:\r\n./support/lockedpool.h:195:18: error: Ã¢ÂÂmutexÃ¢ÂÂ in namespace Ã¢ÂÂstdÃ¢ÂÂ does not name a type\r\n     mutable std::mutex mutex;\r\n                  ^~~~~\r\n./support/lockedpool.h:228:17: error: Ã¢ÂÂonce_flagÃ¢ÂÂ in namespace Ã¢ÂÂstdÃ¢ÂÂ does not name a type\r\n     static std::once_flag init_flag;\r\n                 ^~~~~~~~~\r\n./support/lockedpool.h: In static member function Ã¢ÂÂstatic LockedPoolManager& LockedPoolManager::Instance()Ã¢ÂÂ:\r\n./support/lockedpool.h:215:9: error: Ã¢ÂÂcall_onceÃ¢ÂÂ is not a member of Ã¢ÂÂstdÃ¢ÂÂ\r\n         std::call_once(LockedPoolManager::init_flag, LockedPoolManager::CreateInstance);\r\n         ^~~\r\n./support/lockedpool.h:215:24: error: Ã¢ÂÂinit_flagÃ¢ÂÂ is not a member of Ã¢ÂÂLockedPoolManagerÃ¢ÂÂ\r\n         std::call_once(LockedPoolManager::init_flag, LockedPoolManager::CreateInstance);\r\n```\r\nTo build everything...\r\n```\r\n    export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games\r\n    cd depends\r\n    make HOST=i686-w64-mingw32 V=1 -j4 AUTOCONF=: AUTOHEADER=: AUTOMAKE=: ACLOCAL=:\r\n    cd ..\r\n    ./autogen.sh\r\n    ./configure --prefix=`pwd`/depends/i686-w64-mingw32 --with-miniupnpc --with-qrencode --disable-tests --disable-gui-tests --disable-dependency-tracking --disable-bench\r\n    make\r\n```\r\ngcc version output.\r\n```\r\ngcc -v\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/6/lto-wrapper\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 6.3.0-12ubuntu2' --with-bugurl=file:///usr/share/doc/gcc-6/README.Bugs --enable-languages=c,ada,c++,java,go,d,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-6 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --disable-browser-plugin --enable-java-awt=gtk --enable-gtk-cairo --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-6-amd64/jre --enable-java-home --with-jvm-root-dir=/usr/lib/jvm/java-1.5.0-gcj-6-amd64 --with-jvm-jar-dir=/usr/lib/jvm-exports/java-1.5.0-gcj-6-amd64 --with-arch-directory=amd64 --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 6.3.0 20170406 (Ubuntu 6.3.0-12ubuntu2)\r\n```\r\nI'll just go use 14.04 for now, I seem to be the odd one out having this with 32-bit.",
      "created_at" : "2017-09-16T16:21:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-329978468",
      "id" : 329978468,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-09-17T08:31:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/329978468",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/5293433?v=4",
         "events_url" : "https://api.github.com/users/Bushstar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Bushstar/followers",
         "following_url" : "https://api.github.com/users/Bushstar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Bushstar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Bushstar",
         "id" : 5293433,
         "login" : "Bushstar",
         "organizations_url" : "https://api.github.com/users/Bushstar/orgs",
         "received_events_url" : "https://api.github.com/users/Bushstar/received_events",
         "repos_url" : "https://api.github.com/users/Bushstar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Bushstar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Bushstar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Bushstar"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Had to select the 'posix' variant, to prevent errors about std::mutex. It looks like mingw-w64, as of 6.2.1, still has no std::mutex implementation for win32 threads.\r\n\r\nIt might be worth noting that the mingw-w64 win32 compiler option will probably never work with std::mutex etc, at least not without adding workarounds to the bitcoin source code.\r\n\r\nThe mingw-w64 win32 option was added to allow the Win32 thread API to be used instead of the winpthread wrapper library. I assume because the performance of using the Win32 threading API directly was significant enough to go to all the hassle of creating two different mingw-w64 cross compilers.\r\n\r\nThe problem for bitcoin is that the std::mutex etc decalrations have been excluded from the mingw-w64 headers via a pre-processor directive when using the mingw-w64 win32 cross compiler because they conflict with Win32 thread headers.\r\n\r\nThe fix is simply to set the default mingw-w64 cross compiler to posix as per the command mentioned previously:\r\n\r\n> sudo update-alternatives --config x86_64-w64-mingw32-g++\r\n\r\nIt'd be super if that single got added to the build-windows.md file to save a lot of frustration for people building on Windows Subsystem for Linux (which most Windows devs will now be doing since it's so handy).",
      "created_at" : "2017-09-29T12:54:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-333118448",
      "id" : 333118448,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-09-29T12:54:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333118448",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/197660?v=4",
         "events_url" : "https://api.github.com/users/sipsorcery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipsorcery/followers",
         "following_url" : "https://api.github.com/users/sipsorcery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipsorcery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipsorcery",
         "id" : 197660,
         "login" : "sipsorcery",
         "organizations_url" : "https://api.github.com/users/sipsorcery/orgs",
         "received_events_url" : "https://api.github.com/users/sipsorcery/received_events",
         "repos_url" : "https://api.github.com/users/sipsorcery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipsorcery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipsorcery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipsorcery"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> It'd be super if that single got added to the build-windows.md file to save a lot of frustration for people building on Windows Subsystem for Linux (which most Windows devs will now be doing since it's so handy).\r\n\r\nIf WFL indeed supports ubuntu 17.04, instructions for that could be added that mention doing that (feel free to do so). Currently the instructions internationally only mention 14.04 because using 16.04 is dangerous, and that used to be the only more recent version available.\r\n(and 14.04 doesn't need the update-alternatives)",
      "created_at" : "2017-09-29T13:17:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-333123621",
      "id" : 333123621,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-09-29T13:18:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333123621",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@laanwj I added some notes in https://github.com/bitcoin/bitcoin/pull/11244#issuecomment-328244575, and can create a PR shortly.",
      "created_at" : "2017-09-29T13:20:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-333124188",
      "id" : 333124188,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-09-29T13:33:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333124188",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Where 16.04 is LTS, why is it dangerous?\n\nOn 29 Sep 2017 15:18, \"Wladimir J. van der Laan\" <notifications@github.com>\nwrote:\n\nIt'd be super if that single got added to the build-windows.md file to save\na lot of frustration for people building on Windows Subsystem for Linux\n(which most Windows devs will now be doing since it's so handy).\n\nIf WFL indeed supports ubuntu 17.04, instructions for that could be added\nthat mention doing that (feel free to do so). Currently the instructions\ninternationally only mention 14.04 because using 16.04 is dangerous, and\nthat used to be the only more recent version available.\n\nÃ¢ÂÂ\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\n<https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-333123621>,\nor mute\nthe thread\n<https://github.com/notifications/unsubscribe-auth/AdBhR0vssAstnEhiQguTaOkENkZLfkiRks5snO4sgaJpZM4J9EFv>\n.\n",
      "created_at" : "2017-09-29T13:31:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-333126974",
      "id" : 333126974,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-09-29T13:31:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333126974",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/30433607?v=4",
         "events_url" : "https://api.github.com/users/musabi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/musabi/followers",
         "following_url" : "https://api.github.com/users/musabi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/musabi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/musabi",
         "id" : 30433607,
         "login" : "musabi",
         "organizations_url" : "https://api.github.com/users/musabi/orgs",
         "received_events_url" : "https://api.github.com/users/musabi/received_events",
         "repos_url" : "https://api.github.com/users/musabi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/musabi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/musabi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/musabi"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> Where 16.04 is LTS, why is it dangerous? \r\n\r\nBecause of the stack protector issue with the mingw compiler you're posting this in (see above). As far as I know, unless you or someone else can confirm otherwise, it still exists with 16.04.\r\n\r\n> @laanwj I added some notes in #11244 (comment), and can create a PR shortly.\r\n\r\nThanks!\r\n",
      "created_at" : "2017-09-29T13:38:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-333128720",
      "id" : 333128720,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-09-29T13:39:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333128720",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Hi guys\r\n\r\nMy attempt to compile core failed at the end because of this WSL problem. \r\n\r\nAs discussed here by the WSL guys, you are forced to use Xenial and there is no option to install an earlier version and they say it has to be resolved from the Bitcoin side. \r\nhttps://github.com/Microsoft/BashOnWindows/issues/2321\r\n\r\nIf it can't be fixed from the bitcoin side I would propose that the windows build notes (build-windows.md) get modified to remove the WSL section or add a note until a compatible WSL release is available. \r\nhttps://github.com/bitcoin/bitcoin/blob/master/doc/build-windows.md#compiling-with-windows-subsystem-for-linux \r\nThat same guide could use additional dependency details like the BerkeleyDB 4.8 dependency for wallets and QT which are present on the build-unix.md file. \r\n\r\nWould save some frustration from other newcomers. \r\nThanks!",
      "created_at" : "2017-10-01T21:50:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-333409492",
      "id" : 333409492,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-10-01T22:13:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333409492",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/32406248?v=4",
         "events_url" : "https://api.github.com/users/avilaHash/events{/privacy}",
         "followers_url" : "https://api.github.com/users/avilaHash/followers",
         "following_url" : "https://api.github.com/users/avilaHash/following{/other_user}",
         "gists_url" : "https://api.github.com/users/avilaHash/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/avilaHash",
         "id" : 32406248,
         "login" : "avilaHash",
         "organizations_url" : "https://api.github.com/users/avilaHash/orgs",
         "received_events_url" : "https://api.github.com/users/avilaHash/received_events",
         "repos_url" : "https://api.github.com/users/avilaHash/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/avilaHash/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/avilaHash/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/avilaHash"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "With a bit of ubuntu package wrangling I've been able to successfully build on WSL and an Ubuntu 16.04.3 Server virtual machine (Vmware Workstation Pro 12.5.7). The steps below install the mingw packages from zesty onto xenial. I'm sure this is not recommended/supported so if the instance you're building on is used for other purposes be aware you might break something. \r\n\r\nOut of interest I'm still trying to track down the change related to fstack-protector-all that broke the mingw cross compiled binaries. It's proving difficult to track down the source of the debian mingw packages. If anybody knows where they can be located please let me know.\r\n\r\n ### WSL & Ubuntu 16.04.3 Server VM (vmware 12.5.7):\r\n - $ sudo apt update\r\n - $ sudo apt upgrade\r\n - $ lsb_release -a\r\n  Distributor ID: \tUbuntu\r\n  Description:\t\tUbuntu 16.04.3 LTS\r\n  Release:\t\t\t16.04\r\n  Codename:\t\t\txenial\r\n - $ sudo apt install build-essential libtool autotools-dev automake pkg-config bsdmainutils curl git\r\n - $ sudo add-apt-repository \"deb http://archive.ubuntu.com/ubuntu zesty universe\" [if not found: sudo apt-get install software-properties-common]\r\n - $ sudo apt update\r\n - $ sudo apt upgrade\r\n - $ sudo wget http://archive.ubuntu.com/ubuntu/pool/main/b/binutils/binutils_2.28-3ubuntu1_amd64.deb\r\n - $ sduo dpkg -i binutils_2.28-3ubuntu1_amd64.deb\r\n - $ sudo apt install -t zesty binutils-mingw-w64-x86-64 gcc-mingw-w64-x86-64 g++-mingw-w64-x86-64 mingw-w64-x86-64-dev\r\n - $ apt search mingw\r\n   binutils-mingw-w64-x86-64/zesty,now 2.28-1ubuntu1+7.4ubuntu1 amd64 [installed]\r\n   g++-mingw-w64-x86-64/zesty,now 6.2.1-4ubuntu1+19.2 amd64 [installed]\r\n   gcc-mingw-w64-base/zesty,now 6.2.1-4ubuntu1+19.2 amd64 [installed,automatic]\r\n   gcc-mingw-w64-x86-64/zesty,now 6.2.1-4ubuntu1+19.2 amd64 [installed]\r\n   mingw-w64-common/zesty,now 5.0.1-1 all [installed,automatic]\r\n   mingw-w64-x86-64-dev/zesty,now 5.0.1-1 all [installed]\r\n - $ sudo update-alternatives --config x86_64-w64-mingw32-g++ [select posix option]\r\n - $ sudo git clone https://github.com/bitcoin/bitcoin.git\r\n - $ chmod -R a+rw /usr/src/bitcoin\r\n - $ cd bitcoin/depends\r\n - $ Check path using $ echo $PATH, if any windows dirs included with spaces breaks build scripts, set using $ PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\r\n - $ make HOST=x86_64-w64-mingw32\r\n - $ cd ..\r\n - $ ./autogen.sh\r\n - $ CONFIG_SITE=$PWD/depends/x86_64-w64-mingw32/share/config.site ./configure --prefix=/\r\n - $ make\r\n - $ sudo make install\r\n",
      "created_at" : "2017-10-01T23:45:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-333415451",
      "id" : 333415451,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-10-01T23:45:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333415451",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/197660?v=4",
         "events_url" : "https://api.github.com/users/sipsorcery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipsorcery/followers",
         "following_url" : "https://api.github.com/users/sipsorcery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipsorcery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipsorcery",
         "id" : 197660,
         "login" : "sipsorcery",
         "organizations_url" : "https://api.github.com/users/sipsorcery/orgs",
         "received_events_url" : "https://api.github.com/users/sipsorcery/received_events",
         "repos_url" : "https://api.github.com/users/sipsorcery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipsorcery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipsorcery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipsorcery"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> If it can't be fixed from the bitcoin side I would propose that the windows build notes (build-windows.md) get modified to remove the WSL section or add a note until a compatible WSL release is available.\r\n\r\nPlease file a PR to update the guide, then. It won't be updated if no one does it, and none of the regular contributors uses windows, it makes sense if it is written by someone that actually uses WSL.\r\n\r\n> The steps below install the mingw packages from zesty onto xenial. I'm sure this is not recommended/supported so if the instance you're building on is used for other purposes be aware you might break something.\r\n\r\n@sipsorcery Thanks for figuring this out!",
      "created_at" : "2017-10-02T08:13:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/8732#issuecomment-333468149",
      "id" : 333468149,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8732",
      "updated_at" : "2017-10-02T08:15:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333468149",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
