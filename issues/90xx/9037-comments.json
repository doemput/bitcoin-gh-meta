[
   {
      "body" : "This is the test-before-evict feature originally proposed in #6355.",
      "created_at" : "2016-10-28T21:54:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-257038295",
      "id" : 257038295,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-10-28T21:54:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257038295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "One issue which needs to be address in my code above is that I read from mapInfo via [ ]. This violates the very sensible coding style guide requirement that [ ] is never used for map reads. I could use an assert as is used in other code in addrman:\r\n\r\n```cpp\r\nassert(mapInfo.count(nId) == 1);\r\n```\r\n\r\nInstead I'd prefer to create a private method for accessing mapInfo elements by nId similar to CAddrMan::Find. As this is a refactor task which touches code outside of test-before-evict, I want to break it out into a separate commit to be included in this pull request.",
      "created_at" : "2016-10-28T22:04:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-257040021",
      "id" : 257040021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-10-28T22:04:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257040021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620289"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620289"
         }
      },
      "body" : "Lock is held, could use Good_\n",
      "commit_id" : "a96139e89abd66be4cdfd0e732381406724f7ba8",
      "created_at" : "2016-10-28T22:27:57Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;\n+        CAddrInfo& infoNew = mapInfo[nIdnew];\n+\n+        bool eraseCollision = false;\n+\n+        // Which tried bucket to move the entry to.\n+        int nKBucket = infoNew.GetTriedBucket(nKey);\n+        int nKBucketPos = infoNew.GetBucketPosition(nKey, false, nKBucket);\n+\n+        if (!infoNew.IsValid()) { // nIdnew may no longer map to a valid address\n+            eraseCollision = true;\n+\n+        // The position in the tried bucket is not empty\n+        } else if (vvTried[nKBucket][nKBucketPos] != -1) {\n+\n+            // Get the to-be-evicted address that is being tested\n+            int nIdold = vvTried[nKBucket][nKBucketPos];\n+            CAddrInfo& infoOld = mapInfo[nIdold];\n+\n+            // Has successfully connected in last X hours\n+            if (GetAdjustedTime() - infoOld.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                eraseCollision = true;\n+\n+            // Has attempted to connect and failed in last X hours\n+            } else if (GetAdjustedTime() - infoOld.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                LogPrint(\"addrman\", \"Swapping %s for %s in tried table\\n\", infoNew.ToString(), infoOld.ToString());\n+                // Replaces an existing address already in the tried table with the new address\n+                Good(infoNew, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620289",
      "id" : 85620289,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 70,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6328197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2017-02-16T11:38:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620289",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620319"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620319"
         }
      },
      "body" : "Lock held as above\n",
      "commit_id" : "a96139e89abd66be4cdfd0e732381406724f7ba8",
      "created_at" : "2016-10-28T22:28:22Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;\n+        CAddrInfo& infoNew = mapInfo[nIdnew];\n+\n+        bool eraseCollision = false;\n+\n+        // Which tried bucket to move the entry to.\n+        int nKBucket = infoNew.GetTriedBucket(nKey);\n+        int nKBucketPos = infoNew.GetBucketPosition(nKey, false, nKBucket);\n+\n+        if (!infoNew.IsValid()) { // nIdnew may no longer map to a valid address\n+            eraseCollision = true;\n+\n+        // The position in the tried bucket is not empty\n+        } else if (vvTried[nKBucket][nKBucketPos] != -1) {\n+\n+            // Get the to-be-evicted address that is being tested\n+            int nIdold = vvTried[nKBucket][nKBucketPos];\n+            CAddrInfo& infoOld = mapInfo[nIdold];\n+\n+            // Has successfully connected in last X hours\n+            if (GetAdjustedTime() - infoOld.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                eraseCollision = true;\n+\n+            // Has attempted to connect and failed in last X hours\n+            } else if (GetAdjustedTime() - infoOld.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                LogPrint(\"addrman\", \"Swapping %s for %s in tried table\\n\", infoNew.ToString(), infoOld.ToString());\n+                // Replaces an existing address already in the tried table with the new address\n+                Good(infoNew, false);\n+                eraseCollision = true;\n+            }\n+        } else { // Collision is not actually a collision anymore\n+            Good(infoNew, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620319",
      "id" : 85620319,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 74,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6328197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2017-02-16T11:38:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620371"
         }
      },
      "body" : "Nit: is this cast necessary?\n",
      "commit_id" : "a96139e89abd66be4cdfd0e732381406724f7ba8",
      "created_at" : "2016-10-28T22:29:00Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85620371",
      "id" : 85620371,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 43,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6328197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2017-02-16T11:38:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85620371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85624346"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85624346"
         }
      },
      "body" : "Nit: I think std::advance would be clearer than a loop for picking one element\n",
      "commit_id" : "a96139e89abd66be4cdfd0e732381406724f7ba8",
      "created_at" : "2016-10-28T23:15:27Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;\n+        CAddrInfo& infoNew = mapInfo[nIdnew];\n+\n+        bool eraseCollision = false;\n+\n+        // Which tried bucket to move the entry to.\n+        int nKBucket = infoNew.GetTriedBucket(nKey);\n+        int nKBucketPos = infoNew.GetBucketPosition(nKey, false, nKBucket);\n+\n+        if (!infoNew.IsValid()) { // nIdnew may no longer map to a valid address\n+            eraseCollision = true;\n+\n+        // The position in the tried bucket is not empty\n+        } else if (vvTried[nKBucket][nKBucketPos] != -1) {\n+\n+            // Get the to-be-evicted address that is being tested\n+            int nIdold = vvTried[nKBucket][nKBucketPos];\n+            CAddrInfo& infoOld = mapInfo[nIdold];\n+\n+            // Has successfully connected in last X hours\n+            if (GetAdjustedTime() - infoOld.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                eraseCollision = true;\n+\n+            // Has attempted to connect and failed in last X hours\n+            } else if (GetAdjustedTime() - infoOld.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                LogPrint(\"addrman\", \"Swapping %s for %s in tried table\\n\", infoNew.ToString(), infoOld.ToString());\n+                // Replaces an existing address already in the tried table with the new address\n+                Good(infoNew, false);\n+                eraseCollision = true;\n+            }\n+        } else { // Collision is not actually a collision anymore\n+            Good(infoNew, false);\n+            eraseCollision = true;\n+        }\n+\n+        if (eraseCollision){\n+            setTriedCollisions.erase(it++);\n+        } else {\n+            it++;\n+        }\n+    }\n+}\n+\n+CAddrInfo CAddrMan::SelectTriedCollision_()\n+{\n+    int nRnd = GetRandInt(setTriedCollisions.size());\n+\n+    int i = 0;\n+    // Selects a random element from setTriedCollisions.\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end(); it++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85624346",
      "id" : 85624346,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 92,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6328197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2017-02-16T11:38:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85624346",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651668"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85651668"
         }
      },
      "body" : "Good call!\n",
      "commit_id" : "a96139e89abd66be4cdfd0e732381406724f7ba8",
      "created_at" : "2016-10-30T02:00:06Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;\n+        CAddrInfo& infoNew = mapInfo[nIdnew];\n+\n+        bool eraseCollision = false;\n+\n+        // Which tried bucket to move the entry to.\n+        int nKBucket = infoNew.GetTriedBucket(nKey);\n+        int nKBucketPos = infoNew.GetBucketPosition(nKey, false, nKBucket);\n+\n+        if (!infoNew.IsValid()) { // nIdnew may no longer map to a valid address\n+            eraseCollision = true;\n+\n+        // The position in the tried bucket is not empty\n+        } else if (vvTried[nKBucket][nKBucketPos] != -1) {\n+\n+            // Get the to-be-evicted address that is being tested\n+            int nIdold = vvTried[nKBucket][nKBucketPos];\n+            CAddrInfo& infoOld = mapInfo[nIdold];\n+\n+            // Has successfully connected in last X hours\n+            if (GetAdjustedTime() - infoOld.nLastSuccess < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                eraseCollision = true;\n+\n+            // Has attempted to connect and failed in last X hours\n+            } else if (GetAdjustedTime() - infoOld.nLastTry < ADDRMAN_REPLACEMENT_HOURS*(60*60)) {\n+                LogPrint(\"addrman\", \"Swapping %s for %s in tried table\\n\", infoNew.ToString(), infoOld.ToString());\n+                // Replaces an existing address already in the tried table with the new address\n+                Good(infoNew, false);\n+                eraseCollision = true;\n+            }\n+        } else { // Collision is not actually a collision anymore\n+            Good(infoNew, false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651668",
      "id" : 85651668,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 74,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6357044,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2017-02-16T11:38:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85651668",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651671"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85651671"
         }
      },
      "body" : "Nope, removed it.\n",
      "commit_id" : "a96139e89abd66be4cdfd0e732381406724f7ba8",
      "created_at" : "2016-10-30T02:00:34Z",
      "diff_hunk" : "@@ -528,3 +540,75 @@ void CAddrMan::SetServices_(const CService& addr, ServiceFlags nServices)\n int CAddrMan::RandomInt(int nMax){\n     return GetRandInt(nMax);\n }\n+\n+void CAddrMan::ResolveCollisions_()\n+{\n+    for (std::set<int>::iterator it = setTriedCollisions.begin(); it != setTriedCollisions.end();) {\n+        int nIdnew = (int)*it;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#discussion_r85651671",
      "id" : 85651671,
      "original_commit_id" : "18e642c9c5f6b213ea4c8c44acc349185dfe1840",
      "original_position" : 43,
      "path" : "src/addrman.cpp",
      "position" : null,
      "pull_request_review_id" : 6357047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9037",
      "updated_at" : "2017-02-16T11:38:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/85651671",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "I added some extra checks to ensure that if setTriedCollisions points to a key which doesn't exist in mapInfo it just removes that bad key.",
      "created_at" : "2016-11-01T19:38:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-257671470",
      "id" : 257671470,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-11-01T19:38:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/257671470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "Is this good to merge? Any changes I should make?",
      "created_at" : "2016-11-21T23:36:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-262102202",
      "id" : 262102202,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-11-21T23:36:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/262102202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "Fixed a merge conflict.",
      "created_at" : "2016-12-09T00:38:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-265899420",
      "id" : 265899420,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-12-09T00:38:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265899420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "@sipa Any suggestions or improvements I can make to this?",
      "created_at" : "2016-12-18T20:51:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-267845720",
      "id" : 267845720,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2016-12-18T20:51:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267845720",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "utACK\r\n\r\n@EthanHeilman Sorry for the delay here. I think we should try to get this in for 0.15. Would you mind rebasing again?",
      "created_at" : "2017-04-09T15:45:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-292793699",
      "id" : 292793699,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-04-09T15:45:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/292793699",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Will rebase today or tomorrow.",
      "created_at" : "2017-04-10T17:05:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-293014073",
      "id" : 293014073,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-04-10T17:05:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293014073",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "@sipa rebased, also updated some of the log statement to follow the new format.",
      "created_at" : "2017-04-13T13:43:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-293899032",
      "id" : 293899032,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-04-13T13:43:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293899032",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/274814?v=3",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "Updated to obey new Bitcoin coding style guide",
      "created_at" : "2017-07-27T08:35:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-318296882",
      "id" : 318296882,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-07-27T08:35:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/318296882",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "ping @theuni ",
      "created_at" : "2017-08-10T20:48:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-321668922",
      "id" : 321668922,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-08-10T20:48:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321668922",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/274814?v=4",
         "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
         "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/EthanHeilman",
         "id" : 274814,
         "login" : "EthanHeilman",
         "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
         "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
         "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/EthanHeilman"
      }
   },
   {
      "body" : "@EthanHeilman Thanks for adapting the style. I'll review thoroughly soon.",
      "created_at" : "2017-08-16T21:51:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9037#issuecomment-322909931",
      "id" : 322909931,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9037",
      "updated_at" : "2017-08-16T21:51:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/322909931",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   }
]
