[
   {
      "body" : "Possibly dumb question but to be sure I am understanding the change correctly: In pure SPV mode, this will still download and store full blocks for everything after the oldest key-birthday?",
      "created_at" : "2016-11-03T22:41:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-258295814",
      "id" : 258295814,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-11-03T22:41:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/258295814",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "> Possibly dumb question but to be sure I am understanding the change correctly: In pure SPV mode, this will still download and store full blocks for everything after the oldest key-birthday?\r\n\r\nYes.\r\nA next step could be to support BIP37 bloom filter against authenticated nodes (once we have BIP150).\r\nBIP37 has huge privacy implication while this PRs full block SPV mode does not.\r\n\r\nRight now the `-spvonly` mode is not very bandwidth efficient (if you assume you'll never want to do the full validation of the chain).",
      "created_at" : "2016-11-04T07:21:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-258360541",
      "id" : 258360541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-11-04T09:34:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/258360541",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "`getwalletinfo` reports the SPV sync state:\r\n\r\n```\r\n{\r\n  \"walletversion\": 130000,\r\n  \"balance\": 10.00000000,\r\n  \"unconfirmed_balance\": 0.00000000,\r\n  \"immature_balance\": 0.00000000,\r\n  \"txcount\": 1,\r\n  \"keypoololdest\": 1478202465,\r\n  \"keypoolsize\": 10,\r\n  \"paytxfee\": 0.00000010,\r\n  \"hdmasterkeyid\": \"fc2f268240531df6890b66f53141606b7f1f091b\",\r\n  \"spv\": {\r\n    \"enabled\": true,\r\n    \"hybrid_mode\": false,\r\n    \"synced_up_to_height\": 102,\r\n    \"best_known_header_height\": 102,\r\n    \"sync_in_progress\": false\r\n  }\r\n}\r\n```\r\n\r\nIf a sync is in progress, it can look like this:\r\n```\r\n{\r\n  \"walletversion\": 130000,\r\n  \"balance\": 0.00010000,\r\n  \"unconfirmed_balance\": 0.00000000,\r\n  \"immature_balance\": 0.00000000,\r\n  \"txcount\": 1,\r\n  \"keypoololdest\": 1477594751,\r\n  \"keypoolsize\": 100,\r\n  \"paytxfee\": 0.00000000,\r\n  \"hdmasterkeyid\": \"b397c61fb9d18e24d3a42f9c3c7b5d88b15005d3\",\r\n  \"spv\": {\r\n    \"enabled\": true,\r\n    \"hybrid_mode\": true,\r\n    \"synced_up_to_height\": 436884,\r\n    \"best_known_header_height\": 437299,\r\n    \"sync_in_progress\": true,\r\n    \"started\": 1478252299,\r\n    \"is_cancled\": false,\r\n    \"requested_blocks\": 416,\r\n    \"loaded_blocks\": 4,\r\n    \"processed_blocks\": 1\r\n  }\r\n}\r\n```",
      "created_at" : "2016-11-04T09:39:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-258383543",
      "id" : 258383543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-11-04T09:39:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/258383543",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "What are major things that need to be done to finalize this change? Are making hybrid SPV mode compatible with pruning, and improving reorg handling critical parts of this change, or would they be future improvements? Looking through the code, there are lots of minor things I could comment on, but I'm assuming I should hold off if you're mainly looking for \"conceptual review\" right now from core developers (the concept does seems great to me).\r\n\r\nI do have one piece of feedback, though. Based on my understanding of the change, I think the following flag / feature descriptions might be more comprehensible to users:\r\n\r\n* **prioritized block download** (instead of \"hybrid SPV\")  - When enabled, bitcoin downloads the full blockchain as usual, but prioritizes downloading of newer blocks (currently all blocks after the earliest wallet transaction date), before older blocks. This causes relevant transactions to show up in the wallet earlier during an initial sync, allowing the wallet to become functional more quickly, but at the cost of revealing some information about the age of addresses in the wallet to peers on the network.\r\n\r\n* **partial sync** (instead of \"full SPV\") - When enabled, bitcoin downloads only part of the blockchain (currently all blocks after the earliest wallet transaction date), but still downloads and stores full blocks. This means less of the blockchain needs to be downloaded and stored locally, but at the cost of not being able to fully validate transactions, and of revealing some information about the age of addresses in the wallet to peers on the network. This mode is also is incompatible with the `-prune` block pruning mode (since bitcoin can't compute the UTXO set), so a node with partial syncing enabled may wind up using more disk space than a node with pruning enabled, despite downloading less data over the network.\r\n\r\nI think I like these names more than \"hybrid SPV\" / \"full SPV\", just because I think the modern usage of the term \"SPV\" refers to the wallets that don't download full blocks, don't validate transactions, barely require any storage, and sync almost immediately, and this is not what is implemented in these new modes. I do understand that historically the term SPV refered to a wider variety of network/storage saving schemes, but I don't think it would be good to go back and muddy the more clear modern meaning of what an SPV wallet is.",
      "created_at" : "2016-11-04T14:37:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-258448467",
      "id" : 258448467,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-11-04T14:39:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/258448467",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "> What are major things that need to be done to finalize this change? Are making hybrid SPV mode compatible with pruning, and improving reorg handling critical parts of this change, or would they be future improvements? Looking through the code, there are lots of minor things I could comment on, but I'm assuming I should hold off if you're mainly looking for \"conceptual review\" right now from core developers (the concept does seems great to me).\r\n\r\nFeels free to comment on the minor things directly in the code.\r\nI don't expect that this will go into master as it is (to big, includes to many risks, lack of reviewers). As always, I'll try to split this into independent sub-PRs. This one is to get an fully running PoC and maybe discuss it on a higher level.\r\n\r\n> prioritized block download\r\n\r\nYes. Seems fine for me. But we just need to make sure that users know that *no validation* happens on the \"prioritized blocks\".\r\n\r\n> partial sync\r\n\r\nYes. Though I think an expected feature would be to drop the part where we store blocks on the disk when using `-spvonly`.\r\nAnd I'm aiming to use some kind of BIP37 mechanism to allow low-bandwidth transaction scan against a trusted full node (after BIP150/151). Maybe we need to choose the wording with that in mind.",
      "created_at" : "2016-11-04T14:46:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-258450775",
      "id" : 258450775,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-11-04T14:46:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/258450775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86562135"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86562135"
         }
      },
      "body" : "Remove unused split argument?",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T14:56:24Z",
      "diff_hunk" : "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.mininode import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import time\n+from pprint import pprint\n+\n+\n+class WalletSPVTest(BitcoinTestFramework):\n+ \n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4\n+\n+        self.utxo = []\n+        self.txouts = gen_return_txouts()\n+        self.extra_args = [[\"-debug=net\"], [\"-spv=1\", \"-spvonly=1\", \"-debug=net\"], [\"-debug=net\"]]\n+\n+    def setup_network(self, split=False):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86562135",
      "id" : 86562135,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 24,
      "path" : "qa/rpc-tests/walletspv.py",
      "position" : null,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86562135",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86562184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86562184"
         }
      },
      "body" : "Seems unused",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T14:56:38Z",
      "diff_hunk" : "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.mininode import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import time\n+from pprint import pprint",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86562184",
      "id" : 86562184,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 10,
      "path" : "qa/rpc-tests/walletspv.py",
      "position" : null,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86562184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86562817"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86562817"
         }
      },
      "body" : "Can this be dropped? Number of nodes seems to change during the test.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T14:59:20Z",
      "diff_hunk" : "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.mininode import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import time\n+from pprint import pprint\n+\n+\n+class WalletSPVTest(BitcoinTestFramework):\n+ \n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86562817",
      "id" : 86562817,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 18,
      "path" : "qa/rpc-tests/walletspv.py",
      "position" : 17,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86562817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86562993"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86562993"
         }
      },
      "body" : "Unused?",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T15:00:13Z",
      "diff_hunk" : "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.mininode import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import time\n+from pprint import pprint\n+\n+\n+class WalletSPVTest(BitcoinTestFramework):\n+ \n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4\n+\n+        self.utxo = []",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86562993",
      "id" : 86562993,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 20,
      "path" : "qa/rpc-tests/walletspv.py",
      "position" : null,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86562993",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86566087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86566087"
         }
      },
      "body" : "Sleep probably deserves comment if sync_spv and sync_blocks (in util.py) aren't enough to be able to remove it.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T15:13:59Z",
      "diff_hunk" : "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.mininode import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import time\n+from pprint import pprint\n+\n+\n+class WalletSPVTest(BitcoinTestFramework):\n+ \n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4\n+\n+        self.utxo = []\n+        self.txouts = gen_return_txouts()\n+        self.extra_args = [[\"-debug=net\"], [\"-spv=1\", \"-spvonly=1\", \"-debug=net\"], [\"-debug=net\"]]\n+\n+    def setup_network(self, split=False):\n+        self.nodes = start_nodes(3, self.options.tmpdir, self.extra_args)\n+        connect_nodes(self.nodes[0], 1)\n+        connect_nodes(self.nodes[0], 2)\n+        connect_nodes(self.nodes[1], 2)\n+        self.is_network_split=False\n+        self.sync_all()\n+\n+    def sync_spv(self, headerheight, wait=1, timeout=20):\n+        \"\"\"\n+        Wait until everybody has the same tip\n+        \"\"\"\n+        maxheight = 0\n+        while timeout > 0:\n+            insync = True\n+            for x in self.nodes:\n+                info = x.getwalletinfo()\n+                if info['spv']['enabled'] == True:\n+                    if not info['spv']['synced_up_to_height'] == headerheight:\n+                        insync = False\n+            if insync == True:\n+                return True\n+            timeout -= wait\n+            time.sleep(wait)\n+        raise AssertionError(\"SPV sync failed\")\n+\n+    def run_test(self):\n+        # Generate some old blocks\n+        addr = self.nodes[1].getnewaddress() #for 1 conf tx\n+        self.nodes[0].generate(130)\n+        self.nodes[0].sendtoaddress(addr, 1.1)\n+        self.nodes[0].generate(1)\n+        headerheight = self.nodes[0].getblockchaininfo()['headers']\n+        self.sync_spv(headerheight)\n+        time.sleep(5)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86566087",
      "id" : 86566087,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 58,
      "path" : "qa/rpc-tests/walletspv.py",
      "position" : null,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86566087",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86567884"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86567884"
         }
      },
      "body" : "Curious, why stop 1st node here, instead of just starting a 4th node? Is it to make sure the wallet file is synced to disk? Probably good to have a little comment here describing this part of the test.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T15:21:53Z",
      "diff_hunk" : "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.mininode import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import time\n+from pprint import pprint\n+\n+\n+class WalletSPVTest(BitcoinTestFramework):\n+ \n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4\n+\n+        self.utxo = []\n+        self.txouts = gen_return_txouts()\n+        self.extra_args = [[\"-debug=net\"], [\"-spv=1\", \"-spvonly=1\", \"-debug=net\"], [\"-debug=net\"]]\n+\n+    def setup_network(self, split=False):\n+        self.nodes = start_nodes(3, self.options.tmpdir, self.extra_args)\n+        connect_nodes(self.nodes[0], 1)\n+        connect_nodes(self.nodes[0], 2)\n+        connect_nodes(self.nodes[1], 2)\n+        self.is_network_split=False\n+        self.sync_all()\n+\n+    def sync_spv(self, headerheight, wait=1, timeout=20):\n+        \"\"\"\n+        Wait until everybody has the same tip\n+        \"\"\"\n+        maxheight = 0\n+        while timeout > 0:\n+            insync = True\n+            for x in self.nodes:\n+                info = x.getwalletinfo()\n+                if info['spv']['enabled'] == True:\n+                    if not info['spv']['synced_up_to_height'] == headerheight:\n+                        insync = False\n+            if insync == True:\n+                return True\n+            timeout -= wait\n+            time.sleep(wait)\n+        raise AssertionError(\"SPV sync failed\")\n+\n+    def run_test(self):\n+        # Generate some old blocks\n+        addr = self.nodes[1].getnewaddress() #for 1 conf tx\n+        self.nodes[0].generate(130)\n+        self.nodes[0].sendtoaddress(addr, 1.1)\n+        self.nodes[0].generate(1)\n+        headerheight = self.nodes[0].getblockchaininfo()['headers']\n+        self.sync_spv(headerheight)\n+        time.sleep(5)\n+        \n+        node1info = self.nodes[1].getblockchaininfo()\n+        assert_equal(node1info['blocks'], 0)\n+        assert_equal(node1info['headers'], headerheight)\n+        spvinfo = self.nodes[1].getwalletinfo()['spv']\n+        assert_equal(headerheight, spvinfo['best_known_header_height'])\n+        lt = self.nodes[1].listtransactions()\n+        \n+        # node1 is in SPV only mode\n+        # txes should not be present in the wallet with spv\n+        assert_equal(lt[0]['address'], addr)\n+        assert_equal(lt[0]['spv'], True)\n+        assert_equal(lt[0]['confirmations'], 1)\n+        \n+        print(\"Restarting nodes without -spvonly (hybrid SPV)\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86567884",
      "id" : 86567884,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 73,
      "path" : "qa/rpc-tests/walletspv.py",
      "position" : 70,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86567884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86568366"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86568366"
         }
      },
      "body" : "Check len(lt) is 1?",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T15:23:57Z",
      "diff_hunk" : "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.mininode import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import time\n+from pprint import pprint\n+\n+\n+class WalletSPVTest(BitcoinTestFramework):\n+ \n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4\n+\n+        self.utxo = []\n+        self.txouts = gen_return_txouts()\n+        self.extra_args = [[\"-debug=net\"], [\"-spv=1\", \"-spvonly=1\", \"-debug=net\"], [\"-debug=net\"]]\n+\n+    def setup_network(self, split=False):\n+        self.nodes = start_nodes(3, self.options.tmpdir, self.extra_args)\n+        connect_nodes(self.nodes[0], 1)\n+        connect_nodes(self.nodes[0], 2)\n+        connect_nodes(self.nodes[1], 2)\n+        self.is_network_split=False\n+        self.sync_all()\n+\n+    def sync_spv(self, headerheight, wait=1, timeout=20):\n+        \"\"\"\n+        Wait until everybody has the same tip\n+        \"\"\"\n+        maxheight = 0\n+        while timeout > 0:\n+            insync = True\n+            for x in self.nodes:\n+                info = x.getwalletinfo()\n+                if info['spv']['enabled'] == True:\n+                    if not info['spv']['synced_up_to_height'] == headerheight:\n+                        insync = False\n+            if insync == True:\n+                return True\n+            timeout -= wait\n+            time.sleep(wait)\n+        raise AssertionError(\"SPV sync failed\")\n+\n+    def run_test(self):\n+        # Generate some old blocks\n+        addr = self.nodes[1].getnewaddress() #for 1 conf tx\n+        self.nodes[0].generate(130)\n+        self.nodes[0].sendtoaddress(addr, 1.1)\n+        self.nodes[0].generate(1)\n+        headerheight = self.nodes[0].getblockchaininfo()['headers']\n+        self.sync_spv(headerheight)\n+        time.sleep(5)\n+        \n+        node1info = self.nodes[1].getblockchaininfo()\n+        assert_equal(node1info['blocks'], 0)\n+        assert_equal(node1info['headers'], headerheight)\n+        spvinfo = self.nodes[1].getwalletinfo()['spv']\n+        assert_equal(headerheight, spvinfo['best_known_header_height'])\n+        lt = self.nodes[1].listtransactions()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86568366",
      "id" : 86568366,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 65,
      "path" : "qa/rpc-tests/walletspv.py",
      "position" : 62,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86568366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86568416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86568416"
         }
      },
      "body" : "Check len(lt)?",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T15:24:09Z",
      "diff_hunk" : "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.mininode import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import time\n+from pprint import pprint\n+\n+\n+class WalletSPVTest(BitcoinTestFramework):\n+ \n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4\n+\n+        self.utxo = []\n+        self.txouts = gen_return_txouts()\n+        self.extra_args = [[\"-debug=net\"], [\"-spv=1\", \"-spvonly=1\", \"-debug=net\"], [\"-debug=net\"]]\n+\n+    def setup_network(self, split=False):\n+        self.nodes = start_nodes(3, self.options.tmpdir, self.extra_args)\n+        connect_nodes(self.nodes[0], 1)\n+        connect_nodes(self.nodes[0], 2)\n+        connect_nodes(self.nodes[1], 2)\n+        self.is_network_split=False\n+        self.sync_all()\n+\n+    def sync_spv(self, headerheight, wait=1, timeout=20):\n+        \"\"\"\n+        Wait until everybody has the same tip\n+        \"\"\"\n+        maxheight = 0\n+        while timeout > 0:\n+            insync = True\n+            for x in self.nodes:\n+                info = x.getwalletinfo()\n+                if info['spv']['enabled'] == True:\n+                    if not info['spv']['synced_up_to_height'] == headerheight:\n+                        insync = False\n+            if insync == True:\n+                return True\n+            timeout -= wait\n+            time.sleep(wait)\n+        raise AssertionError(\"SPV sync failed\")\n+\n+    def run_test(self):\n+        # Generate some old blocks\n+        addr = self.nodes[1].getnewaddress() #for 1 conf tx\n+        self.nodes[0].generate(130)\n+        self.nodes[0].sendtoaddress(addr, 1.1)\n+        self.nodes[0].generate(1)\n+        headerheight = self.nodes[0].getblockchaininfo()['headers']\n+        self.sync_spv(headerheight)\n+        time.sleep(5)\n+        \n+        node1info = self.nodes[1].getblockchaininfo()\n+        assert_equal(node1info['blocks'], 0)\n+        assert_equal(node1info['headers'], headerheight)\n+        spvinfo = self.nodes[1].getwalletinfo()['spv']\n+        assert_equal(headerheight, spvinfo['best_known_header_height'])\n+        lt = self.nodes[1].listtransactions()\n+        \n+        # node1 is in SPV only mode\n+        # txes should not be present in the wallet with spv\n+        assert_equal(lt[0]['address'], addr)\n+        assert_equal(lt[0]['spv'], True)\n+        assert_equal(lt[0]['confirmations'], 1)\n+        \n+        print(\"Restarting nodes without -spvonly (hybrid SPV)\")\n+        self.stop_node(1)\n+        os.mkdir(self.options.tmpdir + \"/node3/regtest\")\n+        shutil.copyfile(self.options.tmpdir + \"/node1/regtest/wallet.dat\", self.options.tmpdir + \"/node3/regtest/wallet.dat\")\n+        self.nodes[1] = start_node(1, self.options.tmpdir, [\"-spv=1\", \"-debug=net\"])\n+        connect_nodes_bi(self.nodes,0, 1)\n+        connect_nodes_bi(self.nodes,1, 2)\n+    \n+        self.nodes[0].resendwallettransactions()\n+        self.sync_all()\n+        \n+        lt = self.nodes[1].listtransactions()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86568416",
      "id" : 86568416,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 84,
      "path" : "qa/rpc-tests/walletspv.py",
      "position" : 81,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86568416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86570301"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86570301"
         }
      },
      "body" : "Not sure, but maybe it's possible to test this by starting up a new hybrid SPV node with a wallet and no chain data and seeing which blocks it first requests using a stub peer. The `test_getblocktxn_requests` and `test_compactblock_requests` tests in `p2p-compactblocks.py` do something like this using a custom `TestNode` peer.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T15:32:41Z",
      "diff_hunk" : "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.mininode import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import time\n+from pprint import pprint\n+\n+\n+class WalletSPVTest(BitcoinTestFramework):\n+ \n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4\n+\n+        self.utxo = []\n+        self.txouts = gen_return_txouts()\n+        self.extra_args = [[\"-debug=net\"], [\"-spv=1\", \"-spvonly=1\", \"-debug=net\"], [\"-debug=net\"]]\n+\n+    def setup_network(self, split=False):\n+        self.nodes = start_nodes(3, self.options.tmpdir, self.extra_args)\n+        connect_nodes(self.nodes[0], 1)\n+        connect_nodes(self.nodes[0], 2)\n+        connect_nodes(self.nodes[1], 2)\n+        self.is_network_split=False\n+        self.sync_all()\n+\n+    def sync_spv(self, headerheight, wait=1, timeout=20):\n+        \"\"\"\n+        Wait until everybody has the same tip\n+        \"\"\"\n+        maxheight = 0\n+        while timeout > 0:\n+            insync = True\n+            for x in self.nodes:\n+                info = x.getwalletinfo()\n+                if info['spv']['enabled'] == True:\n+                    if not info['spv']['synced_up_to_height'] == headerheight:\n+                        insync = False\n+            if insync == True:\n+                return True\n+            timeout -= wait\n+            time.sleep(wait)\n+        raise AssertionError(\"SPV sync failed\")\n+\n+    def run_test(self):\n+        # Generate some old blocks\n+        addr = self.nodes[1].getnewaddress() #for 1 conf tx\n+        self.nodes[0].generate(130)\n+        self.nodes[0].sendtoaddress(addr, 1.1)\n+        self.nodes[0].generate(1)\n+        headerheight = self.nodes[0].getblockchaininfo()['headers']\n+        self.sync_spv(headerheight)\n+        time.sleep(5)\n+        \n+        node1info = self.nodes[1].getblockchaininfo()\n+        assert_equal(node1info['blocks'], 0)\n+        assert_equal(node1info['headers'], headerheight)\n+        spvinfo = self.nodes[1].getwalletinfo()['spv']\n+        assert_equal(headerheight, spvinfo['best_known_header_height'])\n+        lt = self.nodes[1].listtransactions()\n+        \n+        # node1 is in SPV only mode\n+        # txes should not be present in the wallet with spv\n+        assert_equal(lt[0]['address'], addr)\n+        assert_equal(lt[0]['spv'], True)\n+        assert_equal(lt[0]['confirmations'], 1)\n+        \n+        print(\"Restarting nodes without -spvonly (hybrid SPV)\")\n+        self.stop_node(1)\n+        os.mkdir(self.options.tmpdir + \"/node3/regtest\")\n+        shutil.copyfile(self.options.tmpdir + \"/node1/regtest/wallet.dat\", self.options.tmpdir + \"/node3/regtest/wallet.dat\")\n+        self.nodes[1] = start_node(1, self.options.tmpdir, [\"-spv=1\", \"-debug=net\"])\n+        connect_nodes_bi(self.nodes,0, 1)\n+        connect_nodes_bi(self.nodes,1, 2)\n+    \n+        self.nodes[0].resendwallettransactions()\n+        self.sync_all()\n+        \n+        lt = self.nodes[1].listtransactions()\n+\n+        # tx should now be fully validated\n+        assert_equal(lt[0]['address'], addr)\n+        assert_equal(lt[0]['spv'], False)\n+        assert_equal(lt[0]['confirmations'], 1)\n+        \n+        # start another node with initial hyprid SPV mode\n+        # use the wallet from node1\n+        self.nodes.append(start_node(3, self.options.tmpdir, [\"-debug=net\",\"-spv=1\"]))\n+        connect_nodes_bi(self.nodes,0, 3)\n+        connect_nodes_bi(self.nodes,0, 2)\n+        headerheight = self.nodes[0].getblockchaininfo()['headers']\n+        self.sync_spv(headerheight)\n+        # make sure we have identical mempools\n+        self.nodes[0].resendwallettransactions()\n+        self.sync_all()\n+        \n+        # currently there is no efficient way to test for the \"SPV first\" wallet listing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86570301",
      "id" : 86570301,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 102,
      "path" : "qa/rpc-tests/walletspv.py",
      "position" : 99,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86570301",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86570358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86570358"
         }
      },
      "body" : "Check len(lt)?",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T15:32:59Z",
      "diff_hunk" : "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2015-2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.mininode import *\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import time\n+from pprint import pprint\n+\n+\n+class WalletSPVTest(BitcoinTestFramework):\n+ \n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 4\n+\n+        self.utxo = []\n+        self.txouts = gen_return_txouts()\n+        self.extra_args = [[\"-debug=net\"], [\"-spv=1\", \"-spvonly=1\", \"-debug=net\"], [\"-debug=net\"]]\n+\n+    def setup_network(self, split=False):\n+        self.nodes = start_nodes(3, self.options.tmpdir, self.extra_args)\n+        connect_nodes(self.nodes[0], 1)\n+        connect_nodes(self.nodes[0], 2)\n+        connect_nodes(self.nodes[1], 2)\n+        self.is_network_split=False\n+        self.sync_all()\n+\n+    def sync_spv(self, headerheight, wait=1, timeout=20):\n+        \"\"\"\n+        Wait until everybody has the same tip\n+        \"\"\"\n+        maxheight = 0\n+        while timeout > 0:\n+            insync = True\n+            for x in self.nodes:\n+                info = x.getwalletinfo()\n+                if info['spv']['enabled'] == True:\n+                    if not info['spv']['synced_up_to_height'] == headerheight:\n+                        insync = False\n+            if insync == True:\n+                return True\n+            timeout -= wait\n+            time.sleep(wait)\n+        raise AssertionError(\"SPV sync failed\")\n+\n+    def run_test(self):\n+        # Generate some old blocks\n+        addr = self.nodes[1].getnewaddress() #for 1 conf tx\n+        self.nodes[0].generate(130)\n+        self.nodes[0].sendtoaddress(addr, 1.1)\n+        self.nodes[0].generate(1)\n+        headerheight = self.nodes[0].getblockchaininfo()['headers']\n+        self.sync_spv(headerheight)\n+        time.sleep(5)\n+        \n+        node1info = self.nodes[1].getblockchaininfo()\n+        assert_equal(node1info['blocks'], 0)\n+        assert_equal(node1info['headers'], headerheight)\n+        spvinfo = self.nodes[1].getwalletinfo()['spv']\n+        assert_equal(headerheight, spvinfo['best_known_header_height'])\n+        lt = self.nodes[1].listtransactions()\n+        \n+        # node1 is in SPV only mode\n+        # txes should not be present in the wallet with spv\n+        assert_equal(lt[0]['address'], addr)\n+        assert_equal(lt[0]['spv'], True)\n+        assert_equal(lt[0]['confirmations'], 1)\n+        \n+        print(\"Restarting nodes without -spvonly (hybrid SPV)\")\n+        self.stop_node(1)\n+        os.mkdir(self.options.tmpdir + \"/node3/regtest\")\n+        shutil.copyfile(self.options.tmpdir + \"/node1/regtest/wallet.dat\", self.options.tmpdir + \"/node3/regtest/wallet.dat\")\n+        self.nodes[1] = start_node(1, self.options.tmpdir, [\"-spv=1\", \"-debug=net\"])\n+        connect_nodes_bi(self.nodes,0, 1)\n+        connect_nodes_bi(self.nodes,1, 2)\n+    \n+        self.nodes[0].resendwallettransactions()\n+        self.sync_all()\n+        \n+        lt = self.nodes[1].listtransactions()\n+\n+        # tx should now be fully validated\n+        assert_equal(lt[0]['address'], addr)\n+        assert_equal(lt[0]['spv'], False)\n+        assert_equal(lt[0]['confirmations'], 1)\n+        \n+        # start another node with initial hyprid SPV mode\n+        # use the wallet from node1\n+        self.nodes.append(start_node(3, self.options.tmpdir, [\"-debug=net\",\"-spv=1\"]))\n+        connect_nodes_bi(self.nodes,0, 3)\n+        connect_nodes_bi(self.nodes,0, 2)\n+        headerheight = self.nodes[0].getblockchaininfo()['headers']\n+        self.sync_spv(headerheight)\n+        # make sure we have identical mempools\n+        self.nodes[0].resendwallettransactions()\n+        self.sync_all()\n+        \n+        # currently there is no efficient way to test for the \"SPV first\" wallet listing\n+        # but we test that the hybrid modes results with a standard full validated wtxns\n+        lt = self.nodes[3].listtransactions()\n+        assert_equal(lt[0]['address'], addr)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86570358",
      "id" : 86570358,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 105,
      "path" : "qa/rpc-tests/walletspv.py",
      "position" : 102,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86570358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86570531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86570531"
         }
      },
      "body" : "Spelling of cancelled.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T15:33:42Z",
      "diff_hunk" : "@@ -0,0 +1,128 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"blockrequest.h\"\n+\n+#include \"chainparams.h\"\n+#include \"main.h\"\n+\n+#include <exception>\n+\n+std::shared_ptr<CBlockRequest> currentBlockRequest; //multithread save pointer (CBlockRequest, the object, is also lock-free)\n+\n+CBlockRequest::CBlockRequest(std::vector<CBlockIndex*> vBlocksToDownloadIn, int64_t createdIn, const std::function<bool(std::shared_ptr<CBlockRequest>, CBlockIndex *pindex)> progressCallbackIn) : vBlocksToDownload(vBlocksToDownloadIn), created(createdIn), progressCallback(progressCallbackIn)\n+{\n+    fCancled = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86570531",
      "id" : 86570531,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 16,
      "path" : "src/blockrequest.cpp",
      "position" : null,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86570531",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86570686"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86570686"
         }
      },
      "body" : "s/multithread save/thread-safe",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T15:34:19Z",
      "diff_hunk" : "@@ -0,0 +1,128 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"blockrequest.h\"\n+\n+#include \"chainparams.h\"\n+#include \"main.h\"\n+\n+#include <exception>\n+\n+std::shared_ptr<CBlockRequest> currentBlockRequest; //multithread save pointer (CBlockRequest, the object, is also lock-free)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86570686",
      "id" : 86570686,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 12,
      "path" : "src/blockrequest.cpp",
      "position" : null,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86570686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86574526"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86574526"
         }
      },
      "body" : "Since bitcoin is using c++11 can you just initialize these in the header?",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T15:52:04Z",
      "diff_hunk" : "@@ -0,0 +1,128 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"blockrequest.h\"\n+\n+#include \"chainparams.h\"\n+#include \"main.h\"\n+\n+#include <exception>\n+\n+std::shared_ptr<CBlockRequest> currentBlockRequest; //multithread save pointer (CBlockRequest, the object, is also lock-free)\n+\n+CBlockRequest::CBlockRequest(std::vector<CBlockIndex*> vBlocksToDownloadIn, int64_t createdIn, const std::function<bool(std::shared_ptr<CBlockRequest>, CBlockIndex *pindex)> progressCallbackIn) : vBlocksToDownload(vBlocksToDownloadIn), created(createdIn), progressCallback(progressCallbackIn)\n+{\n+    fCancled = false;\n+    requestedUpToSize = 0;\n+    processedUpToSize = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86574526",
      "id" : 86574526,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 18,
      "path" : "src/blockrequest.cpp",
      "position" : null,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86574526",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86577850"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86577850"
         }
      },
      "body" : "Should be size_t",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T16:05:46Z",
      "diff_hunk" : "@@ -0,0 +1,128 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"blockrequest.h\"\n+\n+#include \"chainparams.h\"\n+#include \"main.h\"\n+\n+#include <exception>\n+\n+std::shared_ptr<CBlockRequest> currentBlockRequest; //multithread save pointer (CBlockRequest, the object, is also lock-free)\n+\n+CBlockRequest::CBlockRequest(std::vector<CBlockIndex*> vBlocksToDownloadIn, int64_t createdIn, const std::function<bool(std::shared_ptr<CBlockRequest>, CBlockIndex *pindex)> progressCallbackIn) : vBlocksToDownload(vBlocksToDownloadIn), created(createdIn), progressCallback(progressCallbackIn)\n+{\n+    fCancled = false;\n+    requestedUpToSize = 0;\n+    processedUpToSize = 0;\n+}\n+\n+CBlockRequest::~CBlockRequest()\n+{\n+    LogPrint(\"net\", \"Deallocating CBlockRequest\\n\");\n+}\n+\n+void CBlockRequest::processWithPossibleBlock(const CBlock* pblock, CBlockIndex *pindex)\n+{\n+    // don't process anything if request was cancled\n+    if (this->fCancled)\n+        return;\n+\n+    int MAX_PROCESS = 5;\n+    int loop_processed = 0;\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindexRequest = this->vBlocksToDownload[i];\n+        CBlock loadBlock;\n+        const CBlock *currentBlock = &loadBlock;\n+\n+        // if a block has been passed, check if is the next item in the sequence\n+        if (pindex && pblock && pindex == pindexRequest)\n+            currentBlock = pblock;\n+        else if (pindexRequest->nStatus & BLOCK_HAVE_DATA) {\n+            if (!ReadBlockFromDisk(loadBlock, pindexRequest, Params().GetConsensus()))\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+        } else {\n+            break;\n+        }\n+\n+        // fire signal with txns\n+        int cnt = 0;\n+        BOOST_FOREACH(const CTransaction &tx, currentBlock->vtx) {\n+            GetMainSignals().SyncTransaction(tx, pindexRequest, cnt, false);\n+            cnt++;\n+        }\n+        this->processedUpToSize++;\n+\n+        // log some info\n+        LogPrint(\"net\", \"BlockRequest: proccessed up to %ld of total requested %ld blocks\\n\", this->processedUpToSize, this->vBlocksToDownload.size());\n+\n+        if (progressCallback)\n+            if (!progressCallback(shared_from_this(), pindexRequest))\n+                this->cancel();\n+\n+        // release global block request pointer if request has been completed\n+        if (this->processedUpToSize == this->vBlocksToDownload.size())\n+            currentBlockRequest = nullptr;\n+\n+        if (loop_processed >= MAX_PROCESS)\n+            break;\n+        loop_processed++;\n+    }\n+}\n+\n+void CBlockRequest::cancel()\n+{\n+    fCancled = true;\n+    if (currentBlockRequest.get() == this) {\n+        // release shared pointer\n+        currentBlockRequest = nullptr;\n+    }\n+}\n+\n+bool CBlockRequest::isCancled()\n+{\n+    return fCancled;\n+}\n+\n+void CBlockRequest::setAsCurrentRequest()\n+{\n+    // if there is an existing block request, cancle it\n+    if (currentBlockRequest != nullptr)\n+        currentBlockRequest->fCancled = true;\n+\n+    currentBlockRequest = shared_from_this();\n+}\n+\n+void CBlockRequest::fillInNextBlocks(std::vector<CBlockIndex*>& vBlocks, unsigned int count, std::function<bool(CBlockIndex*)> filterBlocksCallback)\n+{\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86577850",
      "id" : 86577850,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 99,
      "path" : "src/blockrequest.cpp",
      "position" : 99,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86577850",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86580666"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86580666"
         }
      },
      "body" : "this is not quite right English and I don't understand what it is saying. Do you mean \"we haven't already downloaded this block nor do we have its data\"?\r\n\r\n\"we don't\" tends to mean \"we should not\".",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T16:20:18Z",
      "diff_hunk" : "@@ -0,0 +1,128 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"blockrequest.h\"\n+\n+#include \"chainparams.h\"\n+#include \"main.h\"\n+\n+#include <exception>\n+\n+std::shared_ptr<CBlockRequest> currentBlockRequest; //multithread save pointer (CBlockRequest, the object, is also lock-free)\n+\n+CBlockRequest::CBlockRequest(std::vector<CBlockIndex*> vBlocksToDownloadIn, int64_t createdIn, const std::function<bool(std::shared_ptr<CBlockRequest>, CBlockIndex *pindex)> progressCallbackIn) : vBlocksToDownload(vBlocksToDownloadIn), created(createdIn), progressCallback(progressCallbackIn)\n+{\n+    fCancled = false;\n+    requestedUpToSize = 0;\n+    processedUpToSize = 0;\n+}\n+\n+CBlockRequest::~CBlockRequest()\n+{\n+    LogPrint(\"net\", \"Deallocating CBlockRequest\\n\");\n+}\n+\n+void CBlockRequest::processWithPossibleBlock(const CBlock* pblock, CBlockIndex *pindex)\n+{\n+    // don't process anything if request was cancled\n+    if (this->fCancled)\n+        return;\n+\n+    int MAX_PROCESS = 5;\n+    int loop_processed = 0;\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindexRequest = this->vBlocksToDownload[i];\n+        CBlock loadBlock;\n+        const CBlock *currentBlock = &loadBlock;\n+\n+        // if a block has been passed, check if is the next item in the sequence\n+        if (pindex && pblock && pindex == pindexRequest)\n+            currentBlock = pblock;\n+        else if (pindexRequest->nStatus & BLOCK_HAVE_DATA) {\n+            if (!ReadBlockFromDisk(loadBlock, pindexRequest, Params().GetConsensus()))\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+        } else {\n+            break;\n+        }\n+\n+        // fire signal with txns\n+        int cnt = 0;\n+        BOOST_FOREACH(const CTransaction &tx, currentBlock->vtx) {\n+            GetMainSignals().SyncTransaction(tx, pindexRequest, cnt, false);\n+            cnt++;\n+        }\n+        this->processedUpToSize++;\n+\n+        // log some info\n+        LogPrint(\"net\", \"BlockRequest: proccessed up to %ld of total requested %ld blocks\\n\", this->processedUpToSize, this->vBlocksToDownload.size());\n+\n+        if (progressCallback)\n+            if (!progressCallback(shared_from_this(), pindexRequest))\n+                this->cancel();\n+\n+        // release global block request pointer if request has been completed\n+        if (this->processedUpToSize == this->vBlocksToDownload.size())\n+            currentBlockRequest = nullptr;\n+\n+        if (loop_processed >= MAX_PROCESS)\n+            break;\n+        loop_processed++;\n+    }\n+}\n+\n+void CBlockRequest::cancel()\n+{\n+    fCancled = true;\n+    if (currentBlockRequest.get() == this) {\n+        // release shared pointer\n+        currentBlockRequest = nullptr;\n+    }\n+}\n+\n+bool CBlockRequest::isCancled()\n+{\n+    return fCancled;\n+}\n+\n+void CBlockRequest::setAsCurrentRequest()\n+{\n+    // if there is an existing block request, cancle it\n+    if (currentBlockRequest != nullptr)\n+        currentBlockRequest->fCancled = true;\n+\n+    currentBlockRequest = shared_from_this();\n+}\n+\n+void CBlockRequest::fillInNextBlocks(std::vector<CBlockIndex*>& vBlocks, unsigned int count, std::function<bool(CBlockIndex*)> filterBlocksCallback)\n+{\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindex = this->vBlocksToDownload[i];\n+        if ( filterBlocksCallback(pindex) && !(pindex->nStatus & BLOCK_HAVE_DATA)) {\n+            // we don't already download this block and we don't have its data already",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86580666",
      "id" : 86580666,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 102,
      "path" : "src/blockrequest.cpp",
      "position" : null,
      "pull_request_review_id" : 7234423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86580666",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86586389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86586389"
         }
      },
      "body" : "Maybe instead of a break just add vBlocks.size() < count as a condition in the for loop. I think that would make it clearer what count is supposed to represent (maximum number of blocks ever allowed in vBlocks as opposed to some limit associated with block state).",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T16:48:20Z",
      "diff_hunk" : "@@ -0,0 +1,128 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"blockrequest.h\"\n+\n+#include \"chainparams.h\"\n+#include \"main.h\"\n+\n+#include <exception>\n+\n+std::shared_ptr<CBlockRequest> currentBlockRequest; //multithread save pointer (CBlockRequest, the object, is also lock-free)\n+\n+CBlockRequest::CBlockRequest(std::vector<CBlockIndex*> vBlocksToDownloadIn, int64_t createdIn, const std::function<bool(std::shared_ptr<CBlockRequest>, CBlockIndex *pindex)> progressCallbackIn) : vBlocksToDownload(vBlocksToDownloadIn), created(createdIn), progressCallback(progressCallbackIn)\n+{\n+    fCancled = false;\n+    requestedUpToSize = 0;\n+    processedUpToSize = 0;\n+}\n+\n+CBlockRequest::~CBlockRequest()\n+{\n+    LogPrint(\"net\", \"Deallocating CBlockRequest\\n\");\n+}\n+\n+void CBlockRequest::processWithPossibleBlock(const CBlock* pblock, CBlockIndex *pindex)\n+{\n+    // don't process anything if request was cancled\n+    if (this->fCancled)\n+        return;\n+\n+    int MAX_PROCESS = 5;\n+    int loop_processed = 0;\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindexRequest = this->vBlocksToDownload[i];\n+        CBlock loadBlock;\n+        const CBlock *currentBlock = &loadBlock;\n+\n+        // if a block has been passed, check if is the next item in the sequence\n+        if (pindex && pblock && pindex == pindexRequest)\n+            currentBlock = pblock;\n+        else if (pindexRequest->nStatus & BLOCK_HAVE_DATA) {\n+            if (!ReadBlockFromDisk(loadBlock, pindexRequest, Params().GetConsensus()))\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+        } else {\n+            break;\n+        }\n+\n+        // fire signal with txns\n+        int cnt = 0;\n+        BOOST_FOREACH(const CTransaction &tx, currentBlock->vtx) {\n+            GetMainSignals().SyncTransaction(tx, pindexRequest, cnt, false);\n+            cnt++;\n+        }\n+        this->processedUpToSize++;\n+\n+        // log some info\n+        LogPrint(\"net\", \"BlockRequest: proccessed up to %ld of total requested %ld blocks\\n\", this->processedUpToSize, this->vBlocksToDownload.size());\n+\n+        if (progressCallback)\n+            if (!progressCallback(shared_from_this(), pindexRequest))\n+                this->cancel();\n+\n+        // release global block request pointer if request has been completed\n+        if (this->processedUpToSize == this->vBlocksToDownload.size())\n+            currentBlockRequest = nullptr;\n+\n+        if (loop_processed >= MAX_PROCESS)\n+            break;\n+        loop_processed++;\n+    }\n+}\n+\n+void CBlockRequest::cancel()\n+{\n+    fCancled = true;\n+    if (currentBlockRequest.get() == this) {\n+        // release shared pointer\n+        currentBlockRequest = nullptr;\n+    }\n+}\n+\n+bool CBlockRequest::isCancled()\n+{\n+    return fCancled;\n+}\n+\n+void CBlockRequest::setAsCurrentRequest()\n+{\n+    // if there is an existing block request, cancle it\n+    if (currentBlockRequest != nullptr)\n+        currentBlockRequest->fCancled = true;\n+\n+    currentBlockRequest = shared_from_this();\n+}\n+\n+void CBlockRequest::fillInNextBlocks(std::vector<CBlockIndex*>& vBlocks, unsigned int count, std::function<bool(CBlockIndex*)> filterBlocksCallback)\n+{\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindex = this->vBlocksToDownload[i];\n+        if ( filterBlocksCallback(pindex) && !(pindex->nStatus & BLOCK_HAVE_DATA)) {\n+            // we don't already download this block and we don't have its data already\n+            vBlocks.push_back(pindex);\n+            if (vBlocks.size() == count) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86586389",
      "id" : 86586389,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 104,
      "path" : "src/blockrequest.cpp",
      "position" : null,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86586389",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86587229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86587229"
         }
      },
      "body" : "Can omit nulls since this defines default arguments.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T16:52:59Z",
      "diff_hunk" : "@@ -0,0 +1,128 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"blockrequest.h\"\n+\n+#include \"chainparams.h\"\n+#include \"main.h\"\n+\n+#include <exception>\n+\n+std::shared_ptr<CBlockRequest> currentBlockRequest; //multithread save pointer (CBlockRequest, the object, is also lock-free)\n+\n+CBlockRequest::CBlockRequest(std::vector<CBlockIndex*> vBlocksToDownloadIn, int64_t createdIn, const std::function<bool(std::shared_ptr<CBlockRequest>, CBlockIndex *pindex)> progressCallbackIn) : vBlocksToDownload(vBlocksToDownloadIn), created(createdIn), progressCallback(progressCallbackIn)\n+{\n+    fCancled = false;\n+    requestedUpToSize = 0;\n+    processedUpToSize = 0;\n+}\n+\n+CBlockRequest::~CBlockRequest()\n+{\n+    LogPrint(\"net\", \"Deallocating CBlockRequest\\n\");\n+}\n+\n+void CBlockRequest::processWithPossibleBlock(const CBlock* pblock, CBlockIndex *pindex)\n+{\n+    // don't process anything if request was cancled\n+    if (this->fCancled)\n+        return;\n+\n+    int MAX_PROCESS = 5;\n+    int loop_processed = 0;\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindexRequest = this->vBlocksToDownload[i];\n+        CBlock loadBlock;\n+        const CBlock *currentBlock = &loadBlock;\n+\n+        // if a block has been passed, check if is the next item in the sequence\n+        if (pindex && pblock && pindex == pindexRequest)\n+            currentBlock = pblock;\n+        else if (pindexRequest->nStatus & BLOCK_HAVE_DATA) {\n+            if (!ReadBlockFromDisk(loadBlock, pindexRequest, Params().GetConsensus()))\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+        } else {\n+            break;\n+        }\n+\n+        // fire signal with txns\n+        int cnt = 0;\n+        BOOST_FOREACH(const CTransaction &tx, currentBlock->vtx) {\n+            GetMainSignals().SyncTransaction(tx, pindexRequest, cnt, false);\n+            cnt++;\n+        }\n+        this->processedUpToSize++;\n+\n+        // log some info\n+        LogPrint(\"net\", \"BlockRequest: proccessed up to %ld of total requested %ld blocks\\n\", this->processedUpToSize, this->vBlocksToDownload.size());\n+\n+        if (progressCallback)\n+            if (!progressCallback(shared_from_this(), pindexRequest))\n+                this->cancel();\n+\n+        // release global block request pointer if request has been completed\n+        if (this->processedUpToSize == this->vBlocksToDownload.size())\n+            currentBlockRequest = nullptr;\n+\n+        if (loop_processed >= MAX_PROCESS)\n+            break;\n+        loop_processed++;\n+    }\n+}\n+\n+void CBlockRequest::cancel()\n+{\n+    fCancled = true;\n+    if (currentBlockRequest.get() == this) {\n+        // release shared pointer\n+        currentBlockRequest = nullptr;\n+    }\n+}\n+\n+bool CBlockRequest::isCancled()\n+{\n+    return fCancled;\n+}\n+\n+void CBlockRequest::setAsCurrentRequest()\n+{\n+    // if there is an existing block request, cancle it\n+    if (currentBlockRequest != nullptr)\n+        currentBlockRequest->fCancled = true;\n+\n+    currentBlockRequest = shared_from_this();\n+}\n+\n+void CBlockRequest::fillInNextBlocks(std::vector<CBlockIndex*>& vBlocks, unsigned int count, std::function<bool(CBlockIndex*)> filterBlocksCallback)\n+{\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindex = this->vBlocksToDownload[i];\n+        if ( filterBlocksCallback(pindex) && !(pindex->nStatus & BLOCK_HAVE_DATA)) {\n+            // we don't already download this block and we don't have its data already\n+            vBlocks.push_back(pindex);\n+            if (vBlocks.size() == count) {\n+                break;\n+            }\n+        }\n+    }\n+\n+    //try to push already available blocks through the signal\n+    this->processWithPossibleBlock(NULL, NULL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86587229",
      "id" : 86587229,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 111,
      "path" : "src/blockrequest.cpp",
      "position" : 111,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86587229",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86588729"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86588729"
         }
      },
      "body" : "Maybe call this something like SyncDownloadedTransactions. Since the purpose of this function is to invoke the SyncTransaction signal, seems like it should be named similarly to the signal.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T16:59:59Z",
      "diff_hunk" : "@@ -0,0 +1,55 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BLOCKREQUEST_H\n+#define BITCOIN_BLOCKREQUEST_H\n+\n+#include <atomic>\n+#include \"chain.h\"\n+#include \"consensus/consensus.h\"\n+#include \"net.h\"\n+#include <stdint.h>\n+#include <vector>\n+\n+// \"Lock free\" block request\n+class CBlockRequest : public std::enable_shared_from_this<CBlockRequest> {\n+public:\n+    std::atomic<size_t> requestedUpToSize; //requested up to this element in vBlocksToDownload\n+    std::atomic<size_t> processedUpToSize; //processed up to this element in vBlocksToDownload\n+\n+    const std::vector<CBlockIndex*> vBlocksToDownload;\n+    const int64_t created; //!When the request was started\n+\n+    /** Constructor of the lock free CBlockRequest, vBlocksToDownloadIn remains constant */\n+    CBlockRequest(std::vector<CBlockIndex*> vBlocksToDownloadIn, int64_t created, const std::function<bool(std::shared_ptr<CBlockRequest>, CBlockIndex *pindex)> progressCallbackIn);\n+    ~CBlockRequest();\n+\n+    /** Process the request, check if there are blocks available to \"stream\"\n+        over the SyncTransaction signal \n+        Allow to provide an optional block to avoid disk re-loading\n+     */\n+    void processWithPossibleBlock(const CBlock* pblock = NULL, CBlockIndex *pindex = NULL);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86588729",
      "id" : 86588729,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 32,
      "path" : "src/blockrequest.h",
      "position" : 32,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86588729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "@ryanofsky \r\n\r\n> but at the cost of revealing some information about the age of addresses in the wallet to peers on the network\r\n\r\nThe bigger cost is that the wallet could end up downloading a completely fake chain, since it isn't anchored to the genesis block. Presumably the client has no idea what block height or difficulty to expect and so evil peers could feed the SPV client minimum difficulty blocks of their own construction containing transactions that don't exist on the main chain.",
      "created_at" : "2016-11-04T17:00:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-258488676",
      "id" : 258488676,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-11-04T17:00:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/258488676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/573356?v=3",
         "events_url" : "https://api.github.com/users/dooglus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dooglus/followers",
         "following_url" : "https://api.github.com/users/dooglus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dooglus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dooglus",
         "id" : 573356,
         "login" : "dooglus",
         "organizations_url" : "https://api.github.com/users/dooglus/orgs",
         "received_events_url" : "https://api.github.com/users/dooglus/received_events",
         "repos_url" : "https://api.github.com/users/dooglus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dooglus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dooglus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dooglus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86589553"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86589553"
         }
      },
      "body" : "Should be const (the member function).",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T17:04:21Z",
      "diff_hunk" : "@@ -0,0 +1,128 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"blockrequest.h\"\n+\n+#include \"chainparams.h\"\n+#include \"main.h\"\n+\n+#include <exception>\n+\n+std::shared_ptr<CBlockRequest> currentBlockRequest; //multithread save pointer (CBlockRequest, the object, is also lock-free)\n+\n+CBlockRequest::CBlockRequest(std::vector<CBlockIndex*> vBlocksToDownloadIn, int64_t createdIn, const std::function<bool(std::shared_ptr<CBlockRequest>, CBlockIndex *pindex)> progressCallbackIn) : vBlocksToDownload(vBlocksToDownloadIn), created(createdIn), progressCallback(progressCallbackIn)\n+{\n+    fCancled = false;\n+    requestedUpToSize = 0;\n+    processedUpToSize = 0;\n+}\n+\n+CBlockRequest::~CBlockRequest()\n+{\n+    LogPrint(\"net\", \"Deallocating CBlockRequest\\n\");\n+}\n+\n+void CBlockRequest::processWithPossibleBlock(const CBlock* pblock, CBlockIndex *pindex)\n+{\n+    // don't process anything if request was cancled\n+    if (this->fCancled)\n+        return;\n+\n+    int MAX_PROCESS = 5;\n+    int loop_processed = 0;\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindexRequest = this->vBlocksToDownload[i];\n+        CBlock loadBlock;\n+        const CBlock *currentBlock = &loadBlock;\n+\n+        // if a block has been passed, check if is the next item in the sequence\n+        if (pindex && pblock && pindex == pindexRequest)\n+            currentBlock = pblock;\n+        else if (pindexRequest->nStatus & BLOCK_HAVE_DATA) {\n+            if (!ReadBlockFromDisk(loadBlock, pindexRequest, Params().GetConsensus()))\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+        } else {\n+            break;\n+        }\n+\n+        // fire signal with txns\n+        int cnt = 0;\n+        BOOST_FOREACH(const CTransaction &tx, currentBlock->vtx) {\n+            GetMainSignals().SyncTransaction(tx, pindexRequest, cnt, false);\n+            cnt++;\n+        }\n+        this->processedUpToSize++;\n+\n+        // log some info\n+        LogPrint(\"net\", \"BlockRequest: proccessed up to %ld of total requested %ld blocks\\n\", this->processedUpToSize, this->vBlocksToDownload.size());\n+\n+        if (progressCallback)\n+            if (!progressCallback(shared_from_this(), pindexRequest))\n+                this->cancel();\n+\n+        // release global block request pointer if request has been completed\n+        if (this->processedUpToSize == this->vBlocksToDownload.size())\n+            currentBlockRequest = nullptr;\n+\n+        if (loop_processed >= MAX_PROCESS)\n+            break;\n+        loop_processed++;\n+    }\n+}\n+\n+void CBlockRequest::cancel()\n+{\n+    fCancled = true;\n+    if (currentBlockRequest.get() == this) {\n+        // release shared pointer\n+        currentBlockRequest = nullptr;\n+    }\n+}\n+\n+bool CBlockRequest::isCancled()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86589553",
      "id" : 86589553,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 83,
      "path" : "src/blockrequest.cpp",
      "position" : null,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86589553",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86590493"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86590493"
         }
      },
      "body" : "Should be const, I think.\r\n\r\nAlso might rename fillInNextBlocks to getNextBlocks to be clearer that this is returning information about the next blocks in the request, not changing the next blocks in the request.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T17:08:49Z",
      "diff_hunk" : "@@ -0,0 +1,128 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"blockrequest.h\"\n+\n+#include \"chainparams.h\"\n+#include \"main.h\"\n+\n+#include <exception>\n+\n+std::shared_ptr<CBlockRequest> currentBlockRequest; //multithread save pointer (CBlockRequest, the object, is also lock-free)\n+\n+CBlockRequest::CBlockRequest(std::vector<CBlockIndex*> vBlocksToDownloadIn, int64_t createdIn, const std::function<bool(std::shared_ptr<CBlockRequest>, CBlockIndex *pindex)> progressCallbackIn) : vBlocksToDownload(vBlocksToDownloadIn), created(createdIn), progressCallback(progressCallbackIn)\n+{\n+    fCancled = false;\n+    requestedUpToSize = 0;\n+    processedUpToSize = 0;\n+}\n+\n+CBlockRequest::~CBlockRequest()\n+{\n+    LogPrint(\"net\", \"Deallocating CBlockRequest\\n\");\n+}\n+\n+void CBlockRequest::processWithPossibleBlock(const CBlock* pblock, CBlockIndex *pindex)\n+{\n+    // don't process anything if request was cancled\n+    if (this->fCancled)\n+        return;\n+\n+    int MAX_PROCESS = 5;\n+    int loop_processed = 0;\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindexRequest = this->vBlocksToDownload[i];\n+        CBlock loadBlock;\n+        const CBlock *currentBlock = &loadBlock;\n+\n+        // if a block has been passed, check if is the next item in the sequence\n+        if (pindex && pblock && pindex == pindexRequest)\n+            currentBlock = pblock;\n+        else if (pindexRequest->nStatus & BLOCK_HAVE_DATA) {\n+            if (!ReadBlockFromDisk(loadBlock, pindexRequest, Params().GetConsensus()))\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+        } else {\n+            break;\n+        }\n+\n+        // fire signal with txns\n+        int cnt = 0;\n+        BOOST_FOREACH(const CTransaction &tx, currentBlock->vtx) {\n+            GetMainSignals().SyncTransaction(tx, pindexRequest, cnt, false);\n+            cnt++;\n+        }\n+        this->processedUpToSize++;\n+\n+        // log some info\n+        LogPrint(\"net\", \"BlockRequest: proccessed up to %ld of total requested %ld blocks\\n\", this->processedUpToSize, this->vBlocksToDownload.size());\n+\n+        if (progressCallback)\n+            if (!progressCallback(shared_from_this(), pindexRequest))\n+                this->cancel();\n+\n+        // release global block request pointer if request has been completed\n+        if (this->processedUpToSize == this->vBlocksToDownload.size())\n+            currentBlockRequest = nullptr;\n+\n+        if (loop_processed >= MAX_PROCESS)\n+            break;\n+        loop_processed++;\n+    }\n+}\n+\n+void CBlockRequest::cancel()\n+{\n+    fCancled = true;\n+    if (currentBlockRequest.get() == this) {\n+        // release shared pointer\n+        currentBlockRequest = nullptr;\n+    }\n+}\n+\n+bool CBlockRequest::isCancled()\n+{\n+    return fCancled;\n+}\n+\n+void CBlockRequest::setAsCurrentRequest()\n+{\n+    // if there is an existing block request, cancle it\n+    if (currentBlockRequest != nullptr)\n+        currentBlockRequest->fCancled = true;\n+\n+    currentBlockRequest = shared_from_this();\n+}\n+\n+void CBlockRequest::fillInNextBlocks(std::vector<CBlockIndex*>& vBlocks, unsigned int count, std::function<bool(CBlockIndex*)> filterBlocksCallback)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86590493",
      "id" : 86590493,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 97,
      "path" : "src/blockrequest.cpp",
      "position" : 97,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86590493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86590719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86590719"
         }
      },
      "body" : "Should be const, and probably use size_t. Also maybe change \"loaded\" in the name to \"downloaded\" or \"have data\" to be consistent with other names here (\"loaded\" by itself is kind of vague).",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T17:10:08Z",
      "diff_hunk" : "@@ -0,0 +1,128 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"blockrequest.h\"\n+\n+#include \"chainparams.h\"\n+#include \"main.h\"\n+\n+#include <exception>\n+\n+std::shared_ptr<CBlockRequest> currentBlockRequest; //multithread save pointer (CBlockRequest, the object, is also lock-free)\n+\n+CBlockRequest::CBlockRequest(std::vector<CBlockIndex*> vBlocksToDownloadIn, int64_t createdIn, const std::function<bool(std::shared_ptr<CBlockRequest>, CBlockIndex *pindex)> progressCallbackIn) : vBlocksToDownload(vBlocksToDownloadIn), created(createdIn), progressCallback(progressCallbackIn)\n+{\n+    fCancled = false;\n+    requestedUpToSize = 0;\n+    processedUpToSize = 0;\n+}\n+\n+CBlockRequest::~CBlockRequest()\n+{\n+    LogPrint(\"net\", \"Deallocating CBlockRequest\\n\");\n+}\n+\n+void CBlockRequest::processWithPossibleBlock(const CBlock* pblock, CBlockIndex *pindex)\n+{\n+    // don't process anything if request was cancled\n+    if (this->fCancled)\n+        return;\n+\n+    int MAX_PROCESS = 5;\n+    int loop_processed = 0;\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindexRequest = this->vBlocksToDownload[i];\n+        CBlock loadBlock;\n+        const CBlock *currentBlock = &loadBlock;\n+\n+        // if a block has been passed, check if is the next item in the sequence\n+        if (pindex && pblock && pindex == pindexRequest)\n+            currentBlock = pblock;\n+        else if (pindexRequest->nStatus & BLOCK_HAVE_DATA) {\n+            if (!ReadBlockFromDisk(loadBlock, pindexRequest, Params().GetConsensus()))\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+        } else {\n+            break;\n+        }\n+\n+        // fire signal with txns\n+        int cnt = 0;\n+        BOOST_FOREACH(const CTransaction &tx, currentBlock->vtx) {\n+            GetMainSignals().SyncTransaction(tx, pindexRequest, cnt, false);\n+            cnt++;\n+        }\n+        this->processedUpToSize++;\n+\n+        // log some info\n+        LogPrint(\"net\", \"BlockRequest: proccessed up to %ld of total requested %ld blocks\\n\", this->processedUpToSize, this->vBlocksToDownload.size());\n+\n+        if (progressCallback)\n+            if (!progressCallback(shared_from_this(), pindexRequest))\n+                this->cancel();\n+\n+        // release global block request pointer if request has been completed\n+        if (this->processedUpToSize == this->vBlocksToDownload.size())\n+            currentBlockRequest = nullptr;\n+\n+        if (loop_processed >= MAX_PROCESS)\n+            break;\n+        loop_processed++;\n+    }\n+}\n+\n+void CBlockRequest::cancel()\n+{\n+    fCancled = true;\n+    if (currentBlockRequest.get() == this) {\n+        // release shared pointer\n+        currentBlockRequest = nullptr;\n+    }\n+}\n+\n+bool CBlockRequest::isCancled()\n+{\n+    return fCancled;\n+}\n+\n+void CBlockRequest::setAsCurrentRequest()\n+{\n+    // if there is an existing block request, cancle it\n+    if (currentBlockRequest != nullptr)\n+        currentBlockRequest->fCancled = true;\n+\n+    currentBlockRequest = shared_from_this();\n+}\n+\n+void CBlockRequest::fillInNextBlocks(std::vector<CBlockIndex*>& vBlocks, unsigned int count, std::function<bool(CBlockIndex*)> filterBlocksCallback)\n+{\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindex = this->vBlocksToDownload[i];\n+        if ( filterBlocksCallback(pindex) && !(pindex->nStatus & BLOCK_HAVE_DATA)) {\n+            // we don't already download this block and we don't have its data already\n+            vBlocks.push_back(pindex);\n+            if (vBlocks.size() == count) {\n+                break;\n+            }\n+        }\n+    }\n+\n+    //try to push already available blocks through the signal\n+    this->processWithPossibleBlock(NULL, NULL);\n+}\n+\n+unsigned int CBlockRequest::amountOfBlocksLoaded()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86590719",
      "id" : 86590719,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 114,
      "path" : "src/blockrequest.cpp",
      "position" : 114,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86590719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86590787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86590787"
         }
      },
      "body" : "Should be size_t",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T17:10:32Z",
      "diff_hunk" : "@@ -0,0 +1,128 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"blockrequest.h\"\n+\n+#include \"chainparams.h\"\n+#include \"main.h\"\n+\n+#include <exception>\n+\n+std::shared_ptr<CBlockRequest> currentBlockRequest; //multithread save pointer (CBlockRequest, the object, is also lock-free)\n+\n+CBlockRequest::CBlockRequest(std::vector<CBlockIndex*> vBlocksToDownloadIn, int64_t createdIn, const std::function<bool(std::shared_ptr<CBlockRequest>, CBlockIndex *pindex)> progressCallbackIn) : vBlocksToDownload(vBlocksToDownloadIn), created(createdIn), progressCallback(progressCallbackIn)\n+{\n+    fCancled = false;\n+    requestedUpToSize = 0;\n+    processedUpToSize = 0;\n+}\n+\n+CBlockRequest::~CBlockRequest()\n+{\n+    LogPrint(\"net\", \"Deallocating CBlockRequest\\n\");\n+}\n+\n+void CBlockRequest::processWithPossibleBlock(const CBlock* pblock, CBlockIndex *pindex)\n+{\n+    // don't process anything if request was cancled\n+    if (this->fCancled)\n+        return;\n+\n+    int MAX_PROCESS = 5;\n+    int loop_processed = 0;\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindexRequest = this->vBlocksToDownload[i];\n+        CBlock loadBlock;\n+        const CBlock *currentBlock = &loadBlock;\n+\n+        // if a block has been passed, check if is the next item in the sequence\n+        if (pindex && pblock && pindex == pindexRequest)\n+            currentBlock = pblock;\n+        else if (pindexRequest->nStatus & BLOCK_HAVE_DATA) {\n+            if (!ReadBlockFromDisk(loadBlock, pindexRequest, Params().GetConsensus()))\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+        } else {\n+            break;\n+        }\n+\n+        // fire signal with txns\n+        int cnt = 0;\n+        BOOST_FOREACH(const CTransaction &tx, currentBlock->vtx) {\n+            GetMainSignals().SyncTransaction(tx, pindexRequest, cnt, false);\n+            cnt++;\n+        }\n+        this->processedUpToSize++;\n+\n+        // log some info\n+        LogPrint(\"net\", \"BlockRequest: proccessed up to %ld of total requested %ld blocks\\n\", this->processedUpToSize, this->vBlocksToDownload.size());\n+\n+        if (progressCallback)\n+            if (!progressCallback(shared_from_this(), pindexRequest))\n+                this->cancel();\n+\n+        // release global block request pointer if request has been completed\n+        if (this->processedUpToSize == this->vBlocksToDownload.size())\n+            currentBlockRequest = nullptr;\n+\n+        if (loop_processed >= MAX_PROCESS)\n+            break;\n+        loop_processed++;\n+    }\n+}\n+\n+void CBlockRequest::cancel()\n+{\n+    fCancled = true;\n+    if (currentBlockRequest.get() == this) {\n+        // release shared pointer\n+        currentBlockRequest = nullptr;\n+    }\n+}\n+\n+bool CBlockRequest::isCancled()\n+{\n+    return fCancled;\n+}\n+\n+void CBlockRequest::setAsCurrentRequest()\n+{\n+    // if there is an existing block request, cancle it\n+    if (currentBlockRequest != nullptr)\n+        currentBlockRequest->fCancled = true;\n+\n+    currentBlockRequest = shared_from_this();\n+}\n+\n+void CBlockRequest::fillInNextBlocks(std::vector<CBlockIndex*>& vBlocks, unsigned int count, std::function<bool(CBlockIndex*)> filterBlocksCallback)\n+{\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindex = this->vBlocksToDownload[i];\n+        if ( filterBlocksCallback(pindex) && !(pindex->nStatus & BLOCK_HAVE_DATA)) {\n+            // we don't already download this block and we don't have its data already\n+            vBlocks.push_back(pindex);\n+            if (vBlocks.size() == count) {\n+                break;\n+            }\n+        }\n+    }\n+\n+    //try to push already available blocks through the signal\n+    this->processWithPossibleBlock(NULL, NULL);\n+}\n+\n+unsigned int CBlockRequest::amountOfBlocksLoaded()\n+{\n+    unsigned int haveData = 0;\n+    for (unsigned int i = 0; i < this->vBlocksToDownload.size() ; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86590787",
      "id" : 86590787,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 117,
      "path" : "src/blockrequest.cpp",
      "position" : 117,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86590787",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86595525"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86595525"
         }
      },
      "body" : "Could do vBlocksToDownload(std::move(vBlocksToDownloadIn)) to avoid copying vector.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T17:33:33Z",
      "diff_hunk" : "@@ -0,0 +1,128 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"blockrequest.h\"\n+\n+#include \"chainparams.h\"\n+#include \"main.h\"\n+\n+#include <exception>\n+\n+std::shared_ptr<CBlockRequest> currentBlockRequest; //multithread save pointer (CBlockRequest, the object, is also lock-free)\n+\n+CBlockRequest::CBlockRequest(std::vector<CBlockIndex*> vBlocksToDownloadIn, int64_t createdIn, const std::function<bool(std::shared_ptr<CBlockRequest>, CBlockIndex *pindex)> progressCallbackIn) : vBlocksToDownload(vBlocksToDownloadIn), created(createdIn), progressCallback(progressCallbackIn)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86595525",
      "id" : 86595525,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 14,
      "path" : "src/blockrequest.cpp",
      "position" : null,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86595525",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86596587"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86596587"
         }
      },
      "body" : "Would be nice to name the variable after the command line argument it comes from (currently \"-spvonly\", possibly something else like \"partial sync\" in the future).",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T17:38:51Z",
      "diff_hunk" : "@@ -88,6 +89,8 @@ CAmount maxTxFee = DEFAULT_TRANSACTION_MAXFEE;\n CTxMemPool mempool(::minRelayTxFee);\n FeeFilterRounder filterRounder(::minRelayTxFee);\n \n+std::atomic<bool> fAutodownloadBlocks(true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86596587",
      "id" : 86596587,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 12,
      "path" : "src/main.cpp",
      "position" : 12,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86596587",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86596969"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86596969"
         }
      },
      "body" : "Extra whitespace.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T17:40:41Z",
      "diff_hunk" : "@@ -211,6 +214,7 @@ namespace {\n         CBlockIndex* pindex;                                     //!< Optional.\n         bool fValidatedHeaders;                                  //!< Whether this block has validated headers at the time of request.\n         std::unique_ptr<PartiallyDownloadedBlock> partialBlock;  //!< Optional, used for CMPCTBLOCK downloads\n+        std::shared_ptr<CBlockRequest> blockRequest;                  //!< Optional, used for specific block downloads (SPV)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86596969",
      "id" : 86596969,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 21,
      "path" : "src/main.cpp",
      "position" : 21,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86596969",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86599461"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86599461"
         }
      },
      "body" : "Maybe s/check mapBlocksInFlight/exclude blocks in flight/ to be more specific. (I had thought it was doing the opposite the first time reading this).",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T17:52:39Z",
      "diff_hunk" : "@@ -562,6 +573,26 @@ void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vector<CBl\n     // Make sure pindexBestKnownBlock is up to date, we'll need it.\n     ProcessBlockAvailability(nodeid);\n \n+    // if there is an open CBlockRequest (out-of-band/specific block donwload), privileg it\n+    if (blockRequest && !blockRequest->isCancled()) {\n+        // fill in next blocks to download, pass in a filter function to check mapBlocksInFlight",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86599461",
      "id" : 86599461,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 88,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86599461",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86607005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86607005"
         }
      },
      "body" : "Relying on this fHeadersChain argument here is bugging me (the argument is optional and defaults to false), since it seems easy for callers to screw up. I think it would be best to either make it a mandatory argument and/or provide some overload like the following, that would pass in the right value automatically for callers:\r\n\r\n```\r\nbool CheckFinal(const CMerkleTx& mtx, int flags=-1)\r\n{\r\n  return CheckFinal(mtx, flags, mtx.fSPV);\r\n}\r\n```",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-04T18:31:24Z",
      "diff_hunk" : "@@ -838,8 +869,7 @@ bool CheckFinalTx(const CTransaction &tx, int flags)\n     // evaluated is what is used. Thus if we want to know if a\n     // transaction can be part of the *next* block, we need to call\n     // IsFinalTx() with one more than chainActive.Height().\n-    const int nBlockHeight = chainActive.Height() + 1;\n-\n+    const int nBlockHeight = ((fHeadersChain && pindexBestHeader) ? pindexBestHeader->nHeight : chainActive.Height()) + 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86607005",
      "id" : 86607005,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 124,
      "path" : "src/main.cpp",
      "position" : 124,
      "pull_request_review_id" : 7215966,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86607005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "We've done this 6 months ago in Vcash and will be deploying it soon (ZeroLedger). With the extensions we call it SPV+. Let us know if we can help. Ã°ÂÂÂ",
      "created_at" : "2016-11-04T22:02:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-258558710",
      "id" : 258558710,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-11-06T22:38:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/258558710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/9442594?v=3",
         "events_url" : "https://api.github.com/users/john-connor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/john-connor/followers",
         "following_url" : "https://api.github.com/users/john-connor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/john-connor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/john-connor",
         "id" : 9442594,
         "login" : "john-connor",
         "organizations_url" : "https://api.github.com/users/john-connor/orgs",
         "received_events_url" : "https://api.github.com/users/john-connor/received_events",
         "repos_url" : "https://api.github.com/users/john-connor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/john-connor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/john-connor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/john-connor"
      }
   },
   {
      "body" : "@ryanofsky \r\nThanks for the feedback! Will work myself through it next week.\r\n\r\n> but at the cost of revealing some information about the age of addresses in the wallet to peers on the network\r\n\r\nWhy would your peer reveal information about the age of his keys? We are downloading blocks from different peers and I don't see a possibility to meaningful track ages of the wallets keys because they way of how we retrieve blocks in identical to how we retrieve blocks in standard IBD.\r\n\r\n@dooglus \r\n> The bigger cost is that the wallet could end up downloading a completely fake chain, since it isn't anchored to the genesis block. Presumably the client has no idea what block height or difficulty to expect and so evil peers could feed the SPV client minimum difficulty blocks of their own construction containing transactions that don't exist on the main chain.\r\n\r\nBecause we already have downloaded and built the headers-only-chain, all \"SPV\" downloaded blocks are linked to the genesis block. Though, not through verification, only through a simple PoW/chainwork check. And there are also the checkpoints (though not sure how long).\r\nBut yes. The risk of getting sybilled of the main chain during the headers-sync can cause more pain in SPV mode.",
      "created_at" : "2016-11-05T21:34:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-258642234",
      "id" : 258642234,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-11-05T21:34:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/258642234",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@john-connor can you post a link to any code you think would be useful please?",
      "created_at" : "2016-11-06T13:35:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-258681226",
      "id" : 258681226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-11-06T13:35:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/258681226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86790811"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86790811"
         }
      },
      "body" : "Maybe this could be called NotifyHeaderTip instead of UpdatedBlockHeaderTip? It doesn't seem good to have two different but confusingly similar names for this.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T14:55:50Z",
      "diff_hunk" : "@@ -3028,6 +3058,7 @@ static void NotifyHeaderTip() {\n     // Send block tip changed notifications without cs_main\n     if (fNotify) {\n         uiInterface.NotifyHeaderTip(fInitialBlockDownload, pindexHeader);\n+        GetMainSignals().UpdatedBlockHeaderTip(fInitialBlockDownload, pindexHeader);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86790811",
      "id" : 86790811,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 150,
      "path" : "src/main.cpp",
      "position" : 150,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86790811",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86838373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86838373"
         }
      },
      "body" : "New variable seems to be unused. Could you continue to pass null to MarkBlockAsInFlight instead of this? Probably deserves comment if this variable is actually being used in some unseen way.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T18:36:22Z",
      "diff_hunk" : "@@ -6867,12 +6923,14 @@ bool SendMessages(CNode* pto, CConnman& connman)\n         if (!pto->fDisconnect && !pto->fClient && (fFetch || !IsInitialBlockDownload()) && state.nBlocksInFlight < MAX_BLOCKS_IN_TRANSIT_PER_PEER) {\n             vector<CBlockIndex*> vToDownload;\n             NodeId staller = -1;\n-            FindNextBlocksToDownload(pto->GetId(), MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.nBlocksInFlight, vToDownload, staller, consensusParams);\n+            std::shared_ptr<CBlockRequest> blockRequest = CBlockRequest::GetCurrentRequest();\n+            FindNextBlocksToDownload(pto->GetId(), MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.nBlocksInFlight, vToDownload, staller, consensusParams, blockRequest);\n             BOOST_FOREACH(CBlockIndex *pindex, vToDownload) {\n                 uint32_t nFetchFlags = GetFetchFlags(pto, pindex->pprev, consensusParams);\n                 vGetData.push_back(CInv(MSG_BLOCK | nFetchFlags, pindex->GetBlockHash()));\n-                MarkBlockAsInFlight(pto->GetId(), pindex->GetBlockHash(), consensusParams, pindex);\n-                LogPrint(\"net\", \"Requesting block %s (%d) peer=%d\\n\", pindex->GetBlockHash().ToString(),\n+                list<QueuedBlock>::iterator *queuedBlockIt = NULL;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86838373",
      "id" : 86838373,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 379,
      "path" : "src/main.cpp",
      "position" : 379,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86838373",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86840752"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86840752"
         }
      },
      "body" : "Having validated default true seems less safe than having validated default false, or not having a default at all.\r\n\r\nAlso it seems like validated == !fSpv. Seems like this argument could be changed to an fSpv, or the other fSpv's could be changed to validated variables for more consistency.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T18:47:57Z",
      "diff_hunk" : "@@ -32,7 +32,9 @@ void UnregisterAllValidationInterfaces();\n class CValidationInterface {\n protected:\n     virtual void UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockIndex *pindexFork, bool fInitialDownload) {}\n-    virtual void SyncTransaction(const CTransaction &tx, const CBlockIndex *pindex, int posInBlock) {}\n+    virtual void UpdatedBlockHeaderTip(bool fInitialDownload, const CBlockIndex *pindexNew) {}\n+    virtual void SyncTransaction(const CTransaction &tx, const CBlockIndex *pindex, int posInBlock, bool validated = true) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86840752",
      "id" : 86840752,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 6,
      "path" : "src/validationinterface.h",
      "position" : 6,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86840752",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86841043"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86841043"
         }
      },
      "body" : "Variable is unused.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T18:49:16Z",
      "diff_hunk" : "@@ -59,6 +61,12 @@ CFeeRate CWallet::fallbackFee = CFeeRate(DEFAULT_FALLBACK_FEE);\n \n const uint256 CMerkleTx::ABANDON_HASH(uint256S(\"0000000000000000000000000000000000000000000000000000000000000001\"));\n \n+std::atomic<bool> fUseSPV(true);\n+std::atomic<bool> fSPVOnly(true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86841043",
      "id" : 86841043,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 21,
      "path" : "src/wallet/wallet.cpp",
      "position" : 21,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86841043",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86841670"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86841670"
         }
      },
      "body" : "Should be DEFAULT_ENABLE_PURE_SPV",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T18:52:20Z",
      "diff_hunk" : "@@ -3352,6 +3455,8 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n     if (showDebug)\n         strUsage += HelpMessageOpt(\"-sendfreetransactions\", strprintf(_(\"Send transactions as zero-fee transactions if possible (default: %u)\"), DEFAULT_SEND_FREE_TRANSACTIONS));\n     strUsage += HelpMessageOpt(\"-spendzeroconfchange\", strprintf(_(\"Spend unconfirmed change when sending transactions (default: %u)\"), DEFAULT_SPEND_ZEROCONF_CHANGE));\n+    strUsage += HelpMessageOpt(\"-spv\", strprintf(_(\"Use hybrid SPV mode to show transactions before verification (default: %u)\"), DEFAULT_ENABLE_HYBRID_SPV));\n+    strUsage += HelpMessageOpt(\"-spvonly\", strprintf(_(\"Use hybrid SPV mode to show transactions before verification (default: %u)\"), DEFAULT_ENABLE_HYBRID_SPV));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86841670",
      "id" : 86841670,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 245,
      "path" : "src/wallet/wallet.cpp",
      "position" : 245,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86841670",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86841759"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86841759"
         }
      },
      "body" : "Should be DEFAULT_ENABLE_PURE_SPV (for -spvonly)",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T18:52:49Z",
      "diff_hunk" : "@@ -3632,9 +3745,103 @@ bool CWallet::ParameterInteraction()\n     fSendFreeTransactions = GetBoolArg(\"-sendfreetransactions\", DEFAULT_SEND_FREE_TRANSACTIONS);\n     fWalletRbf = GetBoolArg(\"-walletrbf\", DEFAULT_WALLET_RBF);\n \n+    if (GetBoolArg(\"-spvonly\", DEFAULT_ENABLE_PURE_SPV) && SoftSetBoolArg(\"-spv\", true)) {\n+        LogPrintf(\"%s: parameter interaction: -spvonly=1 -> setting -spv=1\\n\", __func__);\n+    }\n+\n+    // if using block pruning, then disallow spv\n+    if (GetArg(\"-prune\", 0)) {\n+        if (GetBoolArg(\"-spv\", DEFAULT_ENABLE_HYBRID_SPV) || GetBoolArg(\"-spvonly\", DEFAULT_ENABLE_HYBRID_SPV))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86841759",
      "id" : 86841759,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 274,
      "path" : "src/wallet/wallet.cpp",
      "position" : 274,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86841759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86856212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86856212"
         }
      },
      "body" : "Can pindexNew ever be null? If if it is null, should fReOrg always be true in this case, or should fReorg only be true if bestSpvBlockHash is null? Comment might be useful to clarify.\r\n\r\nIf pIndexNew should never be null, would suggest either asserting this or changing the while to a do-while, and removing the \"pindexNew && ...\" check below.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T20:00:11Z",
      "diff_hunk" : "@@ -1139,6 +1163,82 @@ void CWallet::SyncTransaction(const CTransaction& tx, const CBlockIndex *pindex,\n     }\n }\n \n+void CWallet::UpdatedBlockHeaderTip(bool fInitialDownload, const CBlockIndex *pindexNew)\n+{\n+    int bestSPVBlockHeight = 0;\n+    {\n+        LOCK2(cs_main, cs_wallet);\n+        bestSPVBlockHeight = nBestSpvHeight;\n+    }\n+\n+    // check if the new tip extends the wallets current known best headers tip\n+    const CBlockIndex *pCurrent = pindexNew;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86856212",
      "id" : 86856212,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 97,
      "path" : "src/wallet/wallet.cpp",
      "position" : 97,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86856212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86856702"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86856702"
         }
      },
      "body" : "This while loop duplicates the loop above (even masking the pCurrent variable), maybe both loops could be replaced with a new FindPrevBlockWithHash(uint256) function call.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T20:02:37Z",
      "diff_hunk" : "@@ -1139,6 +1163,82 @@ void CWallet::SyncTransaction(const CTransaction& tx, const CBlockIndex *pindex,\n     }\n }\n \n+void CWallet::UpdatedBlockHeaderTip(bool fInitialDownload, const CBlockIndex *pindexNew)\n+{\n+    int bestSPVBlockHeight = 0;\n+    {\n+        LOCK2(cs_main, cs_wallet);\n+        bestSPVBlockHeight = nBestSpvHeight;\n+    }\n+\n+    // check if the new tip extends the wallets current known best headers tip\n+    const CBlockIndex *pCurrent = pindexNew;\n+    bool fReorg = true;\n+    while (pCurrent)\n+    {\n+        if (pCurrent->GetBlockHash() == bestSpvBlockHash || bestSpvBlockHash.IsNull())\n+        {\n+            // new header tip extends the current headers chain, standard operation\n+            fReorg = false;\n+            break;\n+        }\n+        pCurrent = pCurrent->pprev;\n+    }\n+    if (fReorg)\n+    {\n+        // we are on a different chain, we don't know at which dept the fork happend\n+        // do a SPV rescan back to the oldest wtx time that was received from a block that now has been forked away\n+        CWalletDB walletdb(strWalletFile, \"r+\", false);\n+        int64_t rescanBackTo = std::numeric_limits<int64_t>::max();\n+        // the current wallets best header tip is not in the active headers chain\n+        for (map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it)\n+        {\n+            CWalletTx* wtx = &(*it).second;\n+            if (wtx->fSPV)\n+            {\n+                bool found = false;\n+                const CBlockIndex *pCurrent = pindexNew;\n+                while (pCurrent)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86856702",
      "id" : 86856702,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 123,
      "path" : "src/wallet/wallet.cpp",
      "position" : 123,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86856702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86857881"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86857881"
         }
      },
      "body" : "Why is it significant that the txn is SPV? Isn't any transaction that's been reorged away be no longer confirmed? Might be good to have a comment on this here.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T20:09:13Z",
      "diff_hunk" : "@@ -1139,6 +1163,82 @@ void CWallet::SyncTransaction(const CTransaction& tx, const CBlockIndex *pindex,\n     }\n }\n \n+void CWallet::UpdatedBlockHeaderTip(bool fInitialDownload, const CBlockIndex *pindexNew)\n+{\n+    int bestSPVBlockHeight = 0;\n+    {\n+        LOCK2(cs_main, cs_wallet);\n+        bestSPVBlockHeight = nBestSpvHeight;\n+    }\n+\n+    // check if the new tip extends the wallets current known best headers tip\n+    const CBlockIndex *pCurrent = pindexNew;\n+    bool fReorg = true;\n+    while (pCurrent)\n+    {\n+        if (pCurrent->GetBlockHash() == bestSpvBlockHash || bestSpvBlockHash.IsNull())\n+        {\n+            // new header tip extends the current headers chain, standard operation\n+            fReorg = false;\n+            break;\n+        }\n+        pCurrent = pCurrent->pprev;\n+    }\n+    if (fReorg)\n+    {\n+        // we are on a different chain, we don't know at which dept the fork happend\n+        // do a SPV rescan back to the oldest wtx time that was received from a block that now has been forked away\n+        CWalletDB walletdb(strWalletFile, \"r+\", false);\n+        int64_t rescanBackTo = std::numeric_limits<int64_t>::max();\n+        // the current wallets best header tip is not in the active headers chain\n+        for (map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it)\n+        {\n+            CWalletTx* wtx = &(*it).second;\n+            if (wtx->fSPV)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86857881",
      "id" : 86857881,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 119,
      "path" : "src/wallet/wallet.cpp",
      "position" : 119,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86857881",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86858376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86858376"
         }
      },
      "body" : ";",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T20:11:55Z",
      "diff_hunk" : "@@ -3632,9 +3745,103 @@ bool CWallet::ParameterInteraction()\n     fSendFreeTransactions = GetBoolArg(\"-sendfreetransactions\", DEFAULT_SEND_FREE_TRANSACTIONS);\n     fWalletRbf = GetBoolArg(\"-walletrbf\", DEFAULT_WALLET_RBF);\n \n+    if (GetBoolArg(\"-spvonly\", DEFAULT_ENABLE_PURE_SPV) && SoftSetBoolArg(\"-spv\", true)) {\n+        LogPrintf(\"%s: parameter interaction: -spvonly=1 -> setting -spv=1\\n\", __func__);\n+    }\n+\n+    // if using block pruning, then disallow spv\n+    if (GetArg(\"-prune\", 0)) {\n+        if (GetBoolArg(\"-spv\", DEFAULT_ENABLE_HYBRID_SPV) || GetBoolArg(\"-spvonly\", DEFAULT_ENABLE_HYBRID_SPV))\n+            return InitError(_(\"Prune mode is incompatible with -spv|-spvonly.\"));\n+    }\n+\n+    fUseSPV = GetBoolArg(\"-spv\", DEFAULT_ENABLE_HYBRID_SPV);\n+    fAutodownloadBlocks = !GetBoolArg(\"-spvonly\", DEFAULT_ENABLE_PURE_SPV);\n+\n     return true;\n }\n \n+void CWallet::ScanSPV(int64_t optional_timestamp)\n+{\n+    CBlockIndex *pIndex = NULL;\n+    CBlockIndex *chainActiveTip = NULL;\n+    // calculate the oldest key and don't use nTimeFirstKey\n+    // adding WatchOnly addresses will result in nTimeFirstKey == 1\n+    int64_t oldest_key = std::numeric_limits<int64_t>::max();;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86858376",
      "id" : 86858376,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 290,
      "path" : "src/wallet/wallet.cpp",
      "position" : 290,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86858376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86858734"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86858734"
         }
      },
      "body" : "It'd be good to say what best means in a comment. ",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T20:14:01Z",
      "diff_hunk" : "@@ -616,7 +629,9 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     typedef std::map<unsigned int, CMasterKey> MasterKeyMap;\n     MasterKeyMap mapMasterKeys;\n     unsigned int nMasterKeyMaxID;\n-\n+    int nBestSpvHeight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86858734",
      "id" : 86858734,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 69,
      "path" : "src/wallet/wallet.h",
      "position" : 69,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86858734",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86860221"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86860221"
         }
      },
      "body" : "Above you are acquiring a lock when you read the nBestSpvHeight variable. Is it not necessary to have a lock when writing the same variable?",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T20:22:06Z",
      "diff_hunk" : "@@ -1139,6 +1163,82 @@ void CWallet::SyncTransaction(const CTransaction& tx, const CBlockIndex *pindex,\n     }\n }\n \n+void CWallet::UpdatedBlockHeaderTip(bool fInitialDownload, const CBlockIndex *pindexNew)\n+{\n+    int bestSPVBlockHeight = 0;\n+    {\n+        LOCK2(cs_main, cs_wallet);\n+        bestSPVBlockHeight = nBestSpvHeight;\n+    }\n+\n+    // check if the new tip extends the wallets current known best headers tip\n+    const CBlockIndex *pCurrent = pindexNew;\n+    bool fReorg = true;\n+    while (pCurrent)\n+    {\n+        if (pCurrent->GetBlockHash() == bestSpvBlockHash || bestSpvBlockHash.IsNull())\n+        {\n+            // new header tip extends the current headers chain, standard operation\n+            fReorg = false;\n+            break;\n+        }\n+        pCurrent = pCurrent->pprev;\n+    }\n+    if (fReorg)\n+    {\n+        // we are on a different chain, we don't know at which dept the fork happend\n+        // do a SPV rescan back to the oldest wtx time that was received from a block that now has been forked away\n+        CWalletDB walletdb(strWalletFile, \"r+\", false);\n+        int64_t rescanBackTo = std::numeric_limits<int64_t>::max();\n+        // the current wallets best header tip is not in the active headers chain\n+        for (map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it)\n+        {\n+            CWalletTx* wtx = &(*it).second;\n+            if (wtx->fSPV)\n+            {\n+                bool found = false;\n+                const CBlockIndex *pCurrent = pindexNew;\n+                while (pCurrent)\n+                {\n+                    if (wtx->hashBlock == pCurrent->GetBlockHash())\n+                    {\n+                        found = true;\n+                        break;\n+                    }\n+                    pCurrent = pCurrent->pprev;\n+                }\n+                if (!found)\n+                {\n+                    if (wtx->GetTxTime() < rescanBackTo)\n+                        rescanBackTo = wtx->GetTxTime();\n+                    // wtx is no longer confirmed\n+                    wtx->hashBlock.SetNull();\n+                    wtx->MarkDirty();\n+                    walletdb.WriteTx(*wtx);\n+                }\n+            }\n+        }\n+        // try to find a reasonable height to spv-scan from again\n+        const CBlockIndex *pCurrent = pindexNew;\n+        nBestSpvHeight = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86860221",
      "id" : 86860221,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 145,
      "path" : "src/wallet/wallet.cpp",
      "position" : 145,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86860221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86860556"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86860556"
         }
      },
      "body" : "Is this actually supposed to be bestSPVBlockHeight not nBestSpvHeight? Why compare against previous height instead of current? If this is intended would suggest adding a comment to explain and also renaming bestSPVBlockHeight to previousBestSPVBlockHeight to make clear this is supposed to be the previous height.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T20:24:03Z",
      "diff_hunk" : "@@ -1139,6 +1163,82 @@ void CWallet::SyncTransaction(const CTransaction& tx, const CBlockIndex *pindex,\n     }\n }\n \n+void CWallet::UpdatedBlockHeaderTip(bool fInitialDownload, const CBlockIndex *pindexNew)\n+{\n+    int bestSPVBlockHeight = 0;\n+    {\n+        LOCK2(cs_main, cs_wallet);\n+        bestSPVBlockHeight = nBestSpvHeight;\n+    }\n+\n+    // check if the new tip extends the wallets current known best headers tip\n+    const CBlockIndex *pCurrent = pindexNew;\n+    bool fReorg = true;\n+    while (pCurrent)\n+    {\n+        if (pCurrent->GetBlockHash() == bestSpvBlockHash || bestSpvBlockHash.IsNull())\n+        {\n+            // new header tip extends the current headers chain, standard operation\n+            fReorg = false;\n+            break;\n+        }\n+        pCurrent = pCurrent->pprev;\n+    }\n+    if (fReorg)\n+    {\n+        // we are on a different chain, we don't know at which dept the fork happend\n+        // do a SPV rescan back to the oldest wtx time that was received from a block that now has been forked away\n+        CWalletDB walletdb(strWalletFile, \"r+\", false);\n+        int64_t rescanBackTo = std::numeric_limits<int64_t>::max();\n+        // the current wallets best header tip is not in the active headers chain\n+        for (map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it)\n+        {\n+            CWalletTx* wtx = &(*it).second;\n+            if (wtx->fSPV)\n+            {\n+                bool found = false;\n+                const CBlockIndex *pCurrent = pindexNew;\n+                while (pCurrent)\n+                {\n+                    if (wtx->hashBlock == pCurrent->GetBlockHash())\n+                    {\n+                        found = true;\n+                        break;\n+                    }\n+                    pCurrent = pCurrent->pprev;\n+                }\n+                if (!found)\n+                {\n+                    if (wtx->GetTxTime() < rescanBackTo)\n+                        rescanBackTo = wtx->GetTxTime();\n+                    // wtx is no longer confirmed\n+                    wtx->hashBlock.SetNull();\n+                    wtx->MarkDirty();\n+                    walletdb.WriteTx(*wtx);\n+                }\n+            }\n+        }\n+        // try to find a reasonable height to spv-scan from again\n+        const CBlockIndex *pCurrent = pindexNew;\n+        nBestSpvHeight = 0;\n+        bestSpvBlockHash.SetNull();\n+        while (pCurrent)\n+        {\n+            if (pCurrent->GetBlockTime() < rescanBackTo)\n+            {\n+                nBestSpvHeight = pCurrent->nHeight;\n+                bestSpvBlockHash = pCurrent->GetBlockHash();\n+                break;\n+            }\n+            pCurrent = pCurrent->pprev;\n+        }\n+        if (nBestSpvHeight > 0 && rescanBackTo != std::numeric_limits<int64_t>::max())\n+            ScanSPV(rescanBackTo);\n+    }\n+    if (fUseSPV && pindexNew && pindexNew->nHeight > bestSPVBlockHeight)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86860556",
      "id" : 86860556,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 160,
      "path" : "src/wallet/wallet.cpp",
      "position" : 160,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86860556",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86864580"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86864580"
         }
      },
      "body" : "I don't understand in general what the resend wallet transaction code is for, and probably this isn't the place to explain it, but it might be nice to have a comment here saying how the SPV condition relates.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-07T20:45:30Z",
      "diff_hunk" : "@@ -1544,7 +1644,7 @@ bool CWalletTx::RelayWalletTransaction(CConnman* connman)\n     assert(pwallet->GetBroadcastTransactions());\n     if (!IsCoinBase())\n     {\n-        if (GetDepthInMainChain() == 0 && !isAbandoned() && InMempool()) {\n+        if (GetDepthInMainChain() == 0 && !isAbandoned() && (InMempool() || fSPV)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86864580",
      "id" : 86864580,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 172,
      "path" : "src/wallet/wallet.cpp",
      "position" : 172,
      "pull_request_review_id" : 7429755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86864580",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86998508"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86998508"
         }
      },
      "body" : "Thanks, will change.",
      "commit_id" : "96bdeffb78eecb7a82f7325272ed9374e8dcd782",
      "created_at" : "2016-11-08T14:29:34Z",
      "diff_hunk" : "@@ -0,0 +1,128 @@\n+// Copyright (c) 2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include \"blockrequest.h\"\n+\n+#include \"chainparams.h\"\n+#include \"main.h\"\n+\n+#include <exception>\n+\n+std::shared_ptr<CBlockRequest> currentBlockRequest; //multithread save pointer (CBlockRequest, the object, is also lock-free)\n+\n+CBlockRequest::CBlockRequest(std::vector<CBlockIndex*> vBlocksToDownloadIn, int64_t createdIn, const std::function<bool(std::shared_ptr<CBlockRequest>, CBlockIndex *pindex)> progressCallbackIn) : vBlocksToDownload(vBlocksToDownloadIn), created(createdIn), progressCallback(progressCallbackIn)\n+{\n+    fCancled = false;\n+    requestedUpToSize = 0;\n+    processedUpToSize = 0;\n+}\n+\n+CBlockRequest::~CBlockRequest()\n+{\n+    LogPrint(\"net\", \"Deallocating CBlockRequest\\n\");\n+}\n+\n+void CBlockRequest::processWithPossibleBlock(const CBlock* pblock, CBlockIndex *pindex)\n+{\n+    // don't process anything if request was cancled\n+    if (this->fCancled)\n+        return;\n+\n+    int MAX_PROCESS = 5;\n+    int loop_processed = 0;\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindexRequest = this->vBlocksToDownload[i];\n+        CBlock loadBlock;\n+        const CBlock *currentBlock = &loadBlock;\n+\n+        // if a block has been passed, check if is the next item in the sequence\n+        if (pindex && pblock && pindex == pindexRequest)\n+            currentBlock = pblock;\n+        else if (pindexRequest->nStatus & BLOCK_HAVE_DATA) {\n+            if (!ReadBlockFromDisk(loadBlock, pindexRequest, Params().GetConsensus()))\n+                throw std::runtime_error(std::string(__func__) + \"Can't read block from disk\");\n+        } else {\n+            break;\n+        }\n+\n+        // fire signal with txns\n+        int cnt = 0;\n+        BOOST_FOREACH(const CTransaction &tx, currentBlock->vtx) {\n+            GetMainSignals().SyncTransaction(tx, pindexRequest, cnt, false);\n+            cnt++;\n+        }\n+        this->processedUpToSize++;\n+\n+        // log some info\n+        LogPrint(\"net\", \"BlockRequest: proccessed up to %ld of total requested %ld blocks\\n\", this->processedUpToSize, this->vBlocksToDownload.size());\n+\n+        if (progressCallback)\n+            if (!progressCallback(shared_from_this(), pindexRequest))\n+                this->cancel();\n+\n+        // release global block request pointer if request has been completed\n+        if (this->processedUpToSize == this->vBlocksToDownload.size())\n+            currentBlockRequest = nullptr;\n+\n+        if (loop_processed >= MAX_PROCESS)\n+            break;\n+        loop_processed++;\n+    }\n+}\n+\n+void CBlockRequest::cancel()\n+{\n+    fCancled = true;\n+    if (currentBlockRequest.get() == this) {\n+        // release shared pointer\n+        currentBlockRequest = nullptr;\n+    }\n+}\n+\n+bool CBlockRequest::isCancled()\n+{\n+    return fCancled;\n+}\n+\n+void CBlockRequest::setAsCurrentRequest()\n+{\n+    // if there is an existing block request, cancle it\n+    if (currentBlockRequest != nullptr)\n+        currentBlockRequest->fCancled = true;\n+\n+    currentBlockRequest = shared_from_this();\n+}\n+\n+void CBlockRequest::fillInNextBlocks(std::vector<CBlockIndex*>& vBlocks, unsigned int count, std::function<bool(CBlockIndex*)> filterBlocksCallback)\n+{\n+    for (unsigned int i = this->processedUpToSize; i < this->vBlocksToDownload.size() ; i++) {\n+        CBlockIndex *pindex = this->vBlocksToDownload[i];\n+        if ( filterBlocksCallback(pindex) && !(pindex->nStatus & BLOCK_HAVE_DATA)) {\n+            // we don't already download this block and we don't have its data already",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#discussion_r86998508",
      "id" : 86998508,
      "original_commit_id" : "eb13afe4de6c01bc95ca33f85dee964cb4ae8049",
      "original_position" : 102,
      "path" : "src/blockrequest.cpp",
      "position" : null,
      "pull_request_review_id" : 7627715,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9076",
      "updated_at" : "2016-11-08T14:34:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/86998508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Binaries are available here: https://bitcoin.jonasschnelli.ch/pulls/9076/",
      "created_at" : "2016-11-09T07:31:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-259350360",
      "id" : 259350360,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-11-09T07:31:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/259350360",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "@jonasschnelli Conceptually, I'm not for putting the ability to change the node's security model into Core's code base right now. To me, this client should target being a fully validating node. Otherwise, the code will become more complex and difficult to reason about. I hope this does not come across as throwing stones because that's not how I mean it. Coincidentally, I thought a lot about this recently due to work on #9180. That PR effectively created another flavor of a non-fully validating hybrid mode and the feedback in that PR may apply here. If nothing else, this comment will link in that work on another potential hybrid mode possibility if you hadn't seen it already.",
      "created_at" : "2016-11-28T11:29:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-263248392",
      "id" : 263248392,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-11-28T11:29:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263248392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6440430?v=3",
         "events_url" : "https://api.github.com/users/mruddy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mruddy/followers",
         "following_url" : "https://api.github.com/users/mruddy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mruddy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mruddy",
         "id" : 6440430,
         "login" : "mruddy",
         "organizations_url" : "https://api.github.com/users/mruddy/orgs",
         "received_events_url" : "https://api.github.com/users/mruddy/received_events",
         "repos_url" : "https://api.github.com/users/mruddy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mruddy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mruddy"
      }
   },
   {
      "body" : "@mruddy That's a fair view, and probably one that is shared by some contributors. Let me offer some other perspective, though.\r\n\r\nI believe that conceptually, in the long term, the Bitcoin Core wallet should be more isolated and separated from the node/consensus logic. I'm unsure what this will mean for organization of code base, but at least it should run as a separate process for security reasons. There is ongoing discussion on how the wallet and node processes should interact, but my view is that they should just use the P2P protocol. The P2P protocol was designed for supporting light wallets, and our server side implementation of it is well tested for this purpose. Apart from questions about mempool tracking and feerate estimation, there is effectively no server side work to accomplish this.\r\n\r\nI see this PR as a step towards the client side. It's just allowing the wallet code to run with consensus enforcement done in another process. It's different from the checkpoints discussion in that it doesn't result in a node that acts like a full node.",
      "created_at" : "2016-11-28T19:18:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-263366183",
      "id" : 263366183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-11-28T19:18:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263366183",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@sipa Thanks for the additional insight. I can see that. The node security model is distinct from the wallet security model. The longer term goal of wallet-node separation seems appealing.\r\n\r\nI'm still concerned about keeping complexity down while maintaining these logical separations in a single repo.\r\n\r\nFor example, do you think it would be valid feedback for the current patch that changes to ProcessNewBlock and AcceptBlock violate wallet-node code level separation?\r\n\r\nIf the interface between the processes is the P2P protocol, then I think the difference should be handled as separate cases at the P2P level (e.g.- in ProcessMessage). A wallet process may accept P2P block messages and do something with them, but that processing should be way different than what a node process does. If the wallet process was doing all the same work all over again, then the main benefits of the separation would be only run time process/network isolation and perhaps availability.\r\n\r\nI'm assuming that the wallet-node design evolves so that the wallet process becomes heavily dependent on its trusted node process (which is ok) to determine the validity of and then pass on only valid and possibly filtered blocks and transactions. Why even check the header in the wallet process? Just take what is received from the trusted node, and update the TXO info. Having a designed goal for the wallet process would help giving feedback for this PR because, for example, it may be the case that the wallet only needs to maintain a header chain for re-org handling and then set (maybe bloom) filters in its trusted nodes to get what it needs for TXO management.\r\n\r\nThere could be lots of flag interactions like, for wallet processes, only connect to explicitly designated endpoints rather than trying to find seed nodes, etc...\r\nAssuming a shared code base, having some polymorphism in parameter interaction and P2P message processing could be valuable. But, I tend to think separate repo is preferable.\r\n\r\nI think a good vision for how the wallet and node should interact would help review this PR. Then questions about code base structure, and whether to keep it all in the same binary or not can be answered.",
      "created_at" : "2016-11-29T02:03:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-263454808",
      "id" : 263454808,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-11-29T02:03:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263454808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6440430?v=3",
         "events_url" : "https://api.github.com/users/mruddy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mruddy/followers",
         "following_url" : "https://api.github.com/users/mruddy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mruddy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mruddy",
         "id" : 6440430,
         "login" : "mruddy",
         "organizations_url" : "https://api.github.com/users/mruddy/orgs",
         "received_events_url" : "https://api.github.com/users/mruddy/received_events",
         "repos_url" : "https://api.github.com/users/mruddy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mruddy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mruddy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mruddy"
      }
   },
   {
      "body" : "So is this a step towards being able to run bitcoind as a NETWORK_NODE and run bitcoin-qt as an SPV client connecting to it (and trusting it)?",
      "created_at" : "2016-12-11T13:03:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-266280862",
      "id" : 266280862,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-12-11T13:03:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/266280862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Please do this, I don't have the fastest hardware or the most reliable Internet connection. Being able to send/receive before or during the initial sync would be awesome. Thanks.",
      "created_at" : "2016-12-12T01:20:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-266323852",
      "id" : 266323852,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-12-12T01:20:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/266323852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4371?v=3",
         "events_url" : "https://api.github.com/users/diegoviola/events{/privacy}",
         "followers_url" : "https://api.github.com/users/diegoviola/followers",
         "following_url" : "https://api.github.com/users/diegoviola/following{/other_user}",
         "gists_url" : "https://api.github.com/users/diegoviola/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/diegoviola",
         "id" : 4371,
         "login" : "diegoviola",
         "organizations_url" : "https://api.github.com/users/diegoviola/orgs",
         "received_events_url" : "https://api.github.com/users/diegoviola/received_events",
         "repos_url" : "https://api.github.com/users/diegoviola/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/diegoviola/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/diegoviola/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/diegoviola"
      }
   },
   {
      "body" : "needs rebase",
      "created_at" : "2016-12-15T04:03:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-267233346",
      "id" : 267233346,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-12-15T04:03:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267233346",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "What would be involved in getting with working with pruned-node ability also? And why not make it download all the headers so that it is at least connect to the genesis block as suggested by @dooglus ?",
      "created_at" : "2016-12-30T07:00:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-269739281",
      "id" : 269739281,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2016-12-30T07:00:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/269739281",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Closing in favour of #9483",
      "created_at" : "2017-01-24T13:10:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9076#issuecomment-274798707",
      "id" : 274798707,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9076",
      "updated_at" : "2017-01-24T13:10:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/274798707",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   }
]
