[
   {
      "author_association" : "MEMBER",
      "body" : "utACK 617c459c6c56911e70855dbe139ab095f435e73e.\r\nMakes sense.\r\nIdeally we should add a test for this.",
      "created_at" : "2017-09-03T17:37:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11225#issuecomment-326819358",
      "id" : 326819358,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11225",
      "updated_at" : "2017-09-03T17:37:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326819358",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "utACK d01a9682b126a5f83c7311e652e6e62f2c2e1d20\r\n\r\nThis should be backported to 0.15(.1), I think.",
      "created_at" : "2017-09-03T21:21:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11225#issuecomment-326832027",
      "id" : 326832027,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11225",
      "updated_at" : "2017-09-03T21:21:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326832027",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11225#discussion_r136785871"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11225"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136785871"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Remove extra space.",
      "commit_id" : "d01a9682b126a5f83c7311e652e6e62f2c2e1d20",
      "created_at" : "2017-09-04T09:55:41Z",
      "diff_hunk" : "@@ -914,6 +914,15 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n             wtx.fFromMe = wtxIn.fFromMe;\n             fUpdated = true;\n         }\n+        // If we have a witness-stripped version of this transaction, and we\n+        // see a new version with a witness, then we must be upgrading a pre-segwit\n+        // wallet.  Store the new version of the transaction with the witness,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11225#discussion_r136785871",
      "id" : 136785871,
      "original_commit_id" : "d01a9682b126a5f83c7311e652e6e62f2c2e1d20",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 60371906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11225",
      "updated_at" : "2017-09-04T10:06:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136785871",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11225#discussion_r136788036"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11225"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136788036"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "First check stored transaction:\r\n```cpp\r\nif (!wtx.tx->HasWitness() && wtxIn.tx->HasWitness()) {\r\n```",
      "commit_id" : "d01a9682b126a5f83c7311e652e6e62f2c2e1d20",
      "created_at" : "2017-09-04T10:05:59Z",
      "diff_hunk" : "@@ -914,6 +914,15 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n             wtx.fFromMe = wtxIn.fFromMe;\n             fUpdated = true;\n         }\n+        // If we have a witness-stripped version of this transaction, and we\n+        // see a new version with a witness, then we must be upgrading a pre-segwit\n+        // wallet.  Store the new version of the transaction with the witness,\n+        // as the stripped-version must be invalid.\n+        // TODO: Store all versions of the transaction, instead of just one.\n+        if (wtxIn.tx->HasWitness() && !wtx.tx->HasWitness()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11225#discussion_r136788036",
      "id" : 136788036,
      "original_commit_id" : "d01a9682b126a5f83c7311e652e6e62f2c2e1d20",
      "original_position" : 9,
      "path" : "src/wallet/wallet.cpp",
      "position" : 9,
      "pull_request_review_id" : 60371906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11225",
      "updated_at" : "2017-09-04T10:06:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/136788036",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "BTW, remove TODO comment and create an issue since it requires a significant change/discussion?",
      "created_at" : "2017-09-04T10:08:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11225#issuecomment-326923390",
      "id" : 326923390,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11225",
      "updated_at" : "2017-09-04T10:08:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326923390",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@promag I opened #11240 to expand on the issue mentioned in the TODO.",
      "created_at" : "2017-09-05T16:14:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11225#issuecomment-327226352",
      "id" : 327226352,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11225",
      "updated_at" : "2017-09-05T16:14:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/327226352",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Wait, do we want to also update if the witness was malleated on its way into a block?",
      "created_at" : "2017-09-21T21:07:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11225#issuecomment-331282175",
      "id" : 331282175,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11225",
      "updated_at" : "2017-09-21T21:07:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/331282175",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@TheBlueMatt I considered that issue, and decided it was more conservative (at least for now) to not do that, because:\r\na) You can always figure out what version of the transaction got mined if you need to (just go look it up in the block file -- ok not great if you're pruning, but in theory this is possible)\r\nb) It's conceivable that the mined version is invalid-to-you (ie violates policy), and throwing away a known-good signature you made, which you might be able to reproduce, is scary, say in the event of a reorg that causes the malleated-version of the transaction to no longer be confirmed.\r\n\r\nb) is pretty edge-case, to be sure, but since the only benefit to storing the actually-confirmed-witness is recordkeeping, which doesn't affect our wallet's behavior, I figure why risk it.  IMO we should eventually store both the original version of the transaction and any malleated versions that get confirmed.",
      "created_at" : "2017-09-22T12:50:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11225#issuecomment-331437627",
      "id" : 331437627,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11225",
      "updated_at" : "2017-09-22T12:50:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/331437627",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yea, ok, more complexity than I figured, this is clearly better than nothing as-is and anything more looks like it'll take some real rewriting of our malleability handling.\r\nutACK d01a9682b126a5f83c7311e652e6e62f2c2e1d20 +/- outstanding nits.",
      "created_at" : "2017-09-25T02:34:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11225#issuecomment-331762600",
      "id" : 331762600,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11225",
      "updated_at" : "2017-09-25T02:34:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/331762600",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
