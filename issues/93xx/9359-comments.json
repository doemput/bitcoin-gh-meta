[
   {
      "body" : "Seems a duplicate of #8717?\r\n\r\n(except that you add a test)",
      "created_at" : "2016-12-16T10:03:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9359#issuecomment-267559195",
      "id" : 267559195,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9359",
      "updated_at" : "2016-12-16T10:04:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267559195",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "@laanwj, it's basically the same as #8717 (which I didn't know about) except it adds the test and places the new assignment in between fCreditCached and fAvailableCreditCached following the order of CWalletTx class members. So I think it's a slightly better PR.",
      "created_at" : "2016-12-16T16:08:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9359#issuecomment-267628548",
      "id" : 267628548,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9359",
      "updated_at" : "2016-12-16T16:08:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267628548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Right. Will merge #8717 first, then we can rebase this into a test-only pull.\r\n(utACK otherwise)",
      "created_at" : "2016-12-21T10:29:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9359#issuecomment-268489355",
      "id" : 268489355,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9359",
      "updated_at" : "2016-12-21T10:30:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268489355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9359#discussion_r93428610"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93428610"
         }
      },
      "body" : "Travis:\r\n\r\n```\r\nAssertion failed: lock cs_main not held in ../../src/wallet/wallet.cpp:3761; locks held:\r\nRunning 221 test cases...\r\nunknown location(0): fatal error: in \"wallet_tests/coin_mark_dirty_immature_credit\": signal: SIGABRT (application abort requested)\r\n../../src/wallet/test/wallet_tests.cpp(371): last checkpoint\r\ntest_bitcoin: ../../src/key.cpp:300: void ECC_Start(): Assertion `secp256k1_context_sign == __null' failed.\r\nunknown location(0): fatal error: in \"wallet_tests/coin_selection_tests\": signal: SIGABRT (application abort requested)\r\n../../src/wallet/test/wallet_tests.cpp(70): last checkpoint: \"coin_selection_tests\" fixture entry.\r\ntest_bitcoin: ../../src/key.cpp:300: void ECC_Start(): Assertion `secp256k1_context_sign == __null' failed.\r\nunknown location(0): fatal error: in \"wallet_crypto/decrypt\": signal: SIGABRT (application abort requested)\r\n../../src/wallet/test/crypto_tests.cpp(217): last checkpoint: \"decrypt\" fixture entry.",
      "commit_id" : "52045d1bb71cd4be7ae269c63a8260df02a8cb56",
      "created_at" : "2016-12-21T12:22:40Z",
      "diff_hunk" : "@@ -351,4 +353,28 @@ BOOST_AUTO_TEST_CASE(ApproximateBestSubset)\n     BOOST_CHECK_EQUAL(setCoinsRet.size(), 2U);\n }\n \n+// Check that GetImmatureCredit() returns a newly calculated value instead of\n+// the cached value after a MarkDirty() call.\n+//\n+// This is regression test written to verify a bugfix for the immature credit\n+// function. Similar tests probably should be written for the other credit and\n+// debit functions.\n+BOOST_FIXTURE_TEST_CASE(coin_mark_dirty_immature_credit, TestChain100Setup)\n+{\n+    CWallet wallet;\n+    CWalletTx wtx(&wallet, MakeTransactionRef(coinbaseTxns.back()));\n+    wtx.hashBlock = chainActive.Tip()->GetBlockHash();\n+    wtx.nIndex = 0;\n+\n+    // Call GetImmatureCredit() once before adding the key to the wallet to\n+    // cache the current immature credit amount, which is 0.\n+    BOOST_CHECK_EQUAL(wtx.GetImmatureCredit(), 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9359#discussion_r93428610",
      "id" : 93428610,
      "original_commit_id" : "e18c4b6178ff5067675c07f21652d26eca6389bf",
      "original_position" : 28,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : 29,
      "pull_request_review_id" : 13955117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9359",
      "updated_at" : "2017-01-04T21:06:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93428610",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9359#discussion_r94689464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9359"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/94689464"
         }
      },
      "body" : "Thanks, the locking error has been fixed.",
      "commit_id" : "52045d1bb71cd4be7ae269c63a8260df02a8cb56",
      "created_at" : "2017-01-04T23:43:45Z",
      "diff_hunk" : "@@ -351,4 +353,28 @@ BOOST_AUTO_TEST_CASE(ApproximateBestSubset)\n     BOOST_CHECK_EQUAL(setCoinsRet.size(), 2U);\n }\n \n+// Check that GetImmatureCredit() returns a newly calculated value instead of\n+// the cached value after a MarkDirty() call.\n+//\n+// This is regression test written to verify a bugfix for the immature credit\n+// function. Similar tests probably should be written for the other credit and\n+// debit functions.\n+BOOST_FIXTURE_TEST_CASE(coin_mark_dirty_immature_credit, TestChain100Setup)\n+{\n+    CWallet wallet;\n+    CWalletTx wtx(&wallet, MakeTransactionRef(coinbaseTxns.back()));\n+    wtx.hashBlock = chainActive.Tip()->GetBlockHash();\n+    wtx.nIndex = 0;\n+\n+    // Call GetImmatureCredit() once before adding the key to the wallet to\n+    // cache the current immature credit amount, which is 0.\n+    BOOST_CHECK_EQUAL(wtx.GetImmatureCredit(), 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9359#discussion_r94689464",
      "id" : 94689464,
      "original_commit_id" : "e18c4b6178ff5067675c07f21652d26eca6389bf",
      "original_position" : 28,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : 29,
      "pull_request_review_id" : 15223142,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9359",
      "updated_at" : "2017-01-04T23:43:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/94689464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "ACK 52045d1 (test passes on version rebased onto master)",
      "created_at" : "2017-02-09T05:46:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9359#issuecomment-278553319",
      "id" : 278553319,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9359",
      "updated_at" : "2017-02-09T05:46:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/278553319",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "Rebased 52045d1bb71cd4be7ae269c63a8260df02a8cb56 -> 7ed143c10ec7c34843cb025951a6bbf279d1774d ([immature.5](https://github.com/ryanofsky/bitcoin/commits/pr/immature.5) -> [immature.6](https://github.com/ryanofsky/bitcoin/commits/pr/immature.6)) because of conflict with recent changes in wallet_tests.cpp.",
      "created_at" : "2017-03-01T10:47:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9359#issuecomment-283307455",
      "id" : 283307455,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9359",
      "updated_at" : "2017-03-01T10:47:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/283307455",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "utACK 7ed143c10ec7c34843cb025951a6bbf279d1774d. Sorry, somehow forgot about this pull.",
      "created_at" : "2017-03-02T21:26:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9359#issuecomment-283786968",
      "id" : 283786968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9359",
      "updated_at" : "2017-03-02T21:26:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/283786968",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
