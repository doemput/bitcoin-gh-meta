[
   {
      "body" : "@rebroad the total can't be greater than the block without at least one individual index being out of bound.",
      "created_at" : "2016-12-08T06:27:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9300#issuecomment-265663596",
      "id" : 265663596,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9300",
      "updated_at" : "2016-12-08T06:27:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265663596",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell IIUIC, it is about the number of requested indexes, not about the value of each individual index.",
      "created_at" : "2016-12-08T08:12:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9300#issuecomment-265679191",
      "id" : 265679191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9300",
      "updated_at" : "2016-12-08T08:12:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265679191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9300#discussion_r91464762"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91464762"
         }
      },
      "body" : "`id -> GetID()`",
      "commit_id" : "558e96721685fd0c018cc83683d97f58cb7db1e3",
      "created_at" : "2016-12-08T08:20:23Z",
      "diff_hunk" : "@@ -1519,6 +1519,12 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         CBlock block;\n         assert(ReadBlockFromDisk(block, it->second, chainparams.GetConsensus()));\n \n+        if (req.indexes.size() >= block.vtx.size()) {\n+            LogPrintf(\"recv getblocktxn. too many requests (%d >= %d) peer=%d\\n\", req.indexes.size(), block.vtx.size(), pfrom->id);\n+            Misbehaving(pfrom->id, 100);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9300#discussion_r91464762",
      "id" : 91464762,
      "original_commit_id" : "558e96721685fd0c018cc83683d97f58cb7db1e3",
      "original_position" : 6,
      "path" : "src/net_processing.cpp",
      "position" : 6,
      "pull_request_review_id" : 11972181,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9300",
      "updated_at" : "2016-12-08T08:20:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91464762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9300#discussion_r91464884"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9300"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91464884"
         }
      },
      "body" : "Please try to keep the style of logging consistent, see `LogPrintf` a few lines below.",
      "commit_id" : "558e96721685fd0c018cc83683d97f58cb7db1e3",
      "created_at" : "2016-12-08T08:21:19Z",
      "diff_hunk" : "@@ -1519,6 +1519,12 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         CBlock block;\n         assert(ReadBlockFromDisk(block, it->second, chainparams.GetConsensus()));\n \n+        if (req.indexes.size() >= block.vtx.size()) {\n+            LogPrintf(\"recv getblocktxn. too many requests (%d >= %d) peer=%d\\n\", req.indexes.size(), block.vtx.size(), pfrom->id);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9300#discussion_r91464884",
      "id" : 91464884,
      "original_commit_id" : "558e96721685fd0c018cc83683d97f58cb7db1e3",
      "original_position" : 5,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 11972308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9300",
      "updated_at" : "2016-12-08T08:21:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/91464884",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Travis fails in `p2p-compactblocks.py` (https://travis-ci.org/bitcoin/bitcoin/jobs/182188214#L3516).\r\n",
      "created_at" : "2016-12-08T08:25:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9300#issuecomment-265681684",
      "id" : 265681684,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9300",
      "updated_at" : "2016-12-08T08:25:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265681684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "The indexes in a getblocktxn request are differentially encoded. If there are N entries, the index of the highest one will be at least N-1. Because of that, this test is unnecessary. However, it may be worthwhile to point this out in the code with a comment.",
      "created_at" : "2016-12-08T08:31:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9300#issuecomment-265682775",
      "id" : 265682775,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9300",
      "updated_at" : "2016-12-08T08:41:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265682775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Yup, there is `+1` in the `ForRead` part of `SerializationOp` (https://github.com/bitcoin/bitcoin/blob/master/src/blockencodings.h#L60).\r\n\r\nSo NACK.\r\n",
      "created_at" : "2016-12-08T08:53:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9300#issuecomment-265686812",
      "id" : 265686812,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9300",
      "updated_at" : "2016-12-08T08:53:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265686812",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "@paveljanik   lets imagine that  the data sent was 0,0,0,0,0,0,0.  The indexes this signals are 0,1,2,3,4,5,6.    You can imagine the encoding as signaling how many transactions to skip.  Skip 0, include one, Skip 0 more, include one, Skip 0 ...  This is run-length encoding.\r\n\r\nThere is no sequence of N inputs whos highest decoded index is less than N-1. Because of this there is no way for excessive entries to fail to also end up with a higher index number than the number of txn in the block. I suppose someone could compare the size of the vector with the block before actually decoding the indexes, but the computation is trivial and the same cases will already get rejected.\r\n\r\nI think rebroad was expecting a getblocktxn that requested the same transaction over and over again many more times than there were even transactions in the block or something like that. But this kind of pointless request is simply impossible to represent in a getblocktxn. The efficient encoding also means whole classes of 'attack request' just aren't possible... which is no accident. :)\r\n\r\nThe worst possible getblocktxn is one that is N_transactions worth of 0s, which is functionally equivalent to just getdata-ing the whole block. (one of my earlier design drafts had us communicate if skips or transactions were signaled, so that including everything would simply be 'skips signaled' then an empty list... and the largest valid getblocktxn message would have been fetching every other transaction.  But we found that requests that didn't have many skips were only common for the first block after restart.. so it wasn't worth the complexity just to save a few bytes in cases which never happen. :)\r\n \r\n ",
      "created_at" : "2016-12-08T09:17:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9300#issuecomment-265691672",
      "id" : 265691672,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9300",
      "updated_at" : "2016-12-08T09:21:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265691672",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Please close this.",
      "created_at" : "2016-12-10T19:19:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9300#issuecomment-266231122",
      "id" : 266231122,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9300",
      "updated_at" : "2016-12-10T19:19:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/266231122",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell thanks for the explanation and sorry for the time taken to do so. seems like more thought was put into the design than I'd been able to imagine.",
      "created_at" : "2016-12-11T17:14:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9300#issuecomment-266294012",
      "id" : 266294012,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9300",
      "updated_at" : "2016-12-11T17:14:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/266294012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   }
]
