[
   {
      "body" : "You can't instantly stop responding to requests for thing you offered just because you had a reorg.  Doing so would be abusive to your peers.   This protection from fingerprinting is much more aggressive than what we do for getblocks (the original code was also more aggressive which is why we didn't consider fingerprinting an issue). No additional fingerprinting protection is provided by being more restrictive than getblocks. ",
      "created_at" : "2016-12-16T18:47:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9363#issuecomment-267666934",
      "id" : 267666934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9363",
      "updated_at" : "2016-12-16T18:47:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267666934",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell I think you misunderstand the purpose of this PR, but I realised I have not really explained it.\r\n\r\nThe current functionality is that getblocktxns requests are ignored for old blocks (old defined by superceeded by 10 or more blocks) UNLESS they are blocks on an alt chain, in which case the request is accepted as long as their height on the alt chain is within 10 of the height on the active chain.\r\n\r\nDepending on when the alt chain forked, the block heights could have become out of sync with the active chain and not be representative of \"10 blocks ago\" based on the height check. i.e. on the alt chain, they could be blocks 20 blocks ago from that alt chain's tip, or if the difficulty really went down on the alt chain, they could be blocks from thousands of blocks ago (assuming the block time warp attack vulnerability still exists). Anyway, I realise the time warp attack would be incredibly expensive, and therefore unlikely to happen, but still, the code doesn't need to be vulnerable to this, IMHO. (And yes, I know that if a time warp occurred there would be \"bigger\" things to worry about than fingerprinting).\r\n\r\nThis change therefore changes the check to go back only the equivalent of 10 blocks in terms of work, after-all it is the work which decides which is the winning fork (as of version 0.3.3 anyway), not the height. The deciding factor for the re-org should surely be used here, not an irrelevant factor (i.e. the height).",
      "created_at" : "2016-12-17T07:00:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9363#issuecomment-267747479",
      "id" : 267747479,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9363",
      "updated_at" : "2016-12-17T07:56:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267747479",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Thanks for clarifying what you're trying to address, that wasn't clear to me before. I'll re-review with that understanding.",
      "created_at" : "2016-12-18T06:53:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9363#issuecomment-267806708",
      "id" : 267806708,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9363",
      "updated_at" : "2016-12-18T06:53:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267806708",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell I realise that the maths isn't perfect if the block data requests is within 10 blocks of a difficulty change, the result might mean that it is effectively 9 or 11 blocks, but I felt this was close enough to 10 to not worry about. The way to make it exactly 10 would be to perhaps use -->pprev->pprev->pprev etc to get back to the block 10 ago (of course checking that nHeight is at least 11 also, or maybe the smallest height  that compact blocks became active), but I decided against this approach as the code was more complex for little extra gain.",
      "created_at" : "2016-12-19T03:54:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9363#issuecomment-267876688",
      "id" : 267876688,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9363",
      "updated_at" : "2016-12-19T03:54:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267876688",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "@rebroad Instead of using work, what are your thoughts on using chainActive.FindFork()?",
      "created_at" : "2016-12-20T00:57:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9363#issuecomment-268123325",
      "id" : 268123325,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9363",
      "updated_at" : "2016-12-20T00:57:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268123325",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "@gmaxwell I'm not sure how FindFork() would help, but looking at the code has helped me find a better way (aa632967c917c79208f35f42e820074aa8df2736).\r\n",
      "created_at" : "2016-12-20T06:53:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9363#issuecomment-268169329",
      "id" : 268169329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9363",
      "updated_at" : "2016-12-20T07:10:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268169329",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Looking at #5918 (which fixed this issue for getdatas of blocks), it is using GetBlockProofEquivalendTime(), so for 10 blocks, this would be 10 * 10 * 60 seconds into the past permissible. I'm not sure if using this function would provide any advantage though.",
      "created_at" : "2016-12-23T05:02:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9363#issuecomment-268941119",
      "id" : 268941119,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9363",
      "updated_at" : "2016-12-23T05:02:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/268941119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Renamed as some additional commits to be added shortly.",
      "created_at" : "2017-01-21T09:15:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9363#issuecomment-274250094",
      "id" : 274250094,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9363",
      "updated_at" : "2017-01-21T09:15:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/274250094",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "No new commits have been pushed, and no more comments made. Feel free to re-open when you've pushed more code.",
      "created_at" : "2017-04-26T10:49:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9363#issuecomment-297352045",
      "id" : 297352045,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9363",
      "updated_at" : "2017-04-26T10:49:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/297352045",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   }
]
