[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r92869959"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92869959"
         }
      },
      "body" : "You can use `__func__` here.\r\n",
      "commit_id" : "6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8",
      "created_at" : "2016-12-16T19:20:59Z",
      "diff_hunk" : "@@ -3300,6 +3256,48 @@ void CWallet::GetKeyBirthTimes(std::map<CKeyID, int64_t> &mapKeyBirth) const {\n         mapKeyBirth[it->first] = it->second->GetBlockTime() - 7200; // block times can be 2h off\n }\n \n+unsigned int CWallet::GetTimeSmart(const CWalletTx& wtx) const\n+{\n+    unsigned int nTimeSmart = wtx.nTimeReceived;\n+    if (!wtx.hashUnset()) {\n+        if (mapBlockIndex.count(wtx.hashBlock)) {\n+            int64_t latestNow = wtx.nTimeReceived;\n+            int64_t latestEntry = 0;\n+            {\n+                // Tolerate times up to the last timestamp in the wallet not more than 5 minutes into the future\n+                int64_t latestTolerated = latestNow + 300;\n+                const TxItems& txOrdered = wtxOrdered;\n+                for (auto it = txOrdered.rbegin(); it != txOrdered.rend(); ++it) {\n+                    CWalletTx* const pwtx = it->second.first;\n+                    if (pwtx == &wtx)\n+                        continue;\n+                    CAccountingEntry* const pacentry = it->second.second;\n+                    int64_t nSmartTime;\n+                    if (pwtx) {\n+                        nSmartTime = pwtx->nTimeSmart;\n+                        if (!nSmartTime)\n+                            nSmartTime = pwtx->nTimeReceived;\n+                    } else\n+                        nSmartTime = pacentry->nTime;\n+                    if (nSmartTime <= latestTolerated) {\n+                        latestEntry = nSmartTime;\n+                        if (nSmartTime > latestNow)\n+                            latestNow = nSmartTime;\n+                        break;\n+                    }\n+                }\n+            }\n+\n+            int64_t blocktime = mapBlockIndex[wtx.hashBlock]->GetBlockTime();\n+            nTimeSmart = std::max(latestEntry, std::min(blocktime, latestNow));\n+        } else\n+            LogPrintf(\"GetTimeSmart(): found %s in block %s not in index\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r92869959",
      "id" : 92869959,
      "original_commit_id" : "406e9759478e86d37cd4fca255841fd3291417c3",
      "original_position" : 92,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 13394521,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2017-02-10T20:21:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92869959",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r92875006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92875006"
         }
      },
      "body" : "Thanks, done.",
      "commit_id" : "6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8",
      "created_at" : "2016-12-16T19:50:59Z",
      "diff_hunk" : "@@ -3300,6 +3256,48 @@ void CWallet::GetKeyBirthTimes(std::map<CKeyID, int64_t> &mapKeyBirth) const {\n         mapKeyBirth[it->first] = it->second->GetBlockTime() - 7200; // block times can be 2h off\n }\n \n+unsigned int CWallet::GetTimeSmart(const CWalletTx& wtx) const\n+{\n+    unsigned int nTimeSmart = wtx.nTimeReceived;\n+    if (!wtx.hashUnset()) {\n+        if (mapBlockIndex.count(wtx.hashBlock)) {\n+            int64_t latestNow = wtx.nTimeReceived;\n+            int64_t latestEntry = 0;\n+            {\n+                // Tolerate times up to the last timestamp in the wallet not more than 5 minutes into the future\n+                int64_t latestTolerated = latestNow + 300;\n+                const TxItems& txOrdered = wtxOrdered;\n+                for (auto it = txOrdered.rbegin(); it != txOrdered.rend(); ++it) {\n+                    CWalletTx* const pwtx = it->second.first;\n+                    if (pwtx == &wtx)\n+                        continue;\n+                    CAccountingEntry* const pacentry = it->second.second;\n+                    int64_t nSmartTime;\n+                    if (pwtx) {\n+                        nSmartTime = pwtx->nTimeSmart;\n+                        if (!nSmartTime)\n+                            nSmartTime = pwtx->nTimeReceived;\n+                    } else\n+                        nSmartTime = pacentry->nTime;\n+                    if (nSmartTime <= latestTolerated) {\n+                        latestEntry = nSmartTime;\n+                        if (nSmartTime > latestNow)\n+                            latestNow = nSmartTime;\n+                        break;\n+                    }\n+                }\n+            }\n+\n+            int64_t blocktime = mapBlockIndex[wtx.hashBlock]->GetBlockTime();\n+            nTimeSmart = std::max(latestEntry, std::min(blocktime, latestNow));\n+        } else\n+            LogPrintf(\"GetTimeSmart(): found %s in block %s not in index\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r92875006",
      "id" : 92875006,
      "original_commit_id" : "406e9759478e86d37cd4fca255841fd3291417c3",
      "original_position" : 92,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 13399737,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2017-02-10T20:21:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92875006",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "utACK 022267ac634b13690414252c4deba7f499f98c63",
      "created_at" : "2016-12-16T20:34:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#issuecomment-267689587",
      "id" : 267689587,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9369",
      "updated_at" : "2016-12-16T20:34:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267689587",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r92917935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92917935"
         }
      },
      "body" : "The old code is testing `hashUnset()` of `wtxIn`. But the new code is checking `hashUnset()` of `wtx`. Is it the same?",
      "commit_id" : "6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8",
      "created_at" : "2016-12-17T08:25:14Z",
      "diff_hunk" : "@@ -844,51 +844,7 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n         wtx.nTimeReceived = GetAdjustedTime();\n         wtx.nOrderPos = IncOrderPosNext(&walletdb);\n         wtxOrdered.insert(make_pair(wtx.nOrderPos, TxPair(&wtx, (CAccountingEntry*)0)));\n-\n-        wtx.nTimeSmart = wtx.nTimeReceived;\n-        if (!wtxIn.hashUnset())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r92917935",
      "id" : 92917935,
      "original_commit_id" : "022267ac634b13690414252c4deba7f499f98c63",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 13443282,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2017-02-10T20:21:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92917935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r92921052"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92921052"
         }
      },
      "body" : "Yes, the change replaces this and other uses of `wtxIn` with `wtx`. Because this code is running in the case where `fInsertedNew ` is true, `wtx` at this point is just a copy of `wtxIn` with two extra fields set (`nTimeReceived` and `nOrderPos`)",
      "commit_id" : "6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8",
      "created_at" : "2016-12-17T12:34:54Z",
      "diff_hunk" : "@@ -844,51 +844,7 @@ bool CWallet::AddToWallet(const CWalletTx& wtxIn, bool fFlushOnClose)\n         wtx.nTimeReceived = GetAdjustedTime();\n         wtx.nOrderPos = IncOrderPosNext(&walletdb);\n         wtxOrdered.insert(make_pair(wtx.nOrderPos, TxPair(&wtx, (CAccountingEntry*)0)));\n-\n-        wtx.nTimeSmart = wtx.nTimeReceived;\n-        if (!wtxIn.hashUnset())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r92921052",
      "id" : 92921052,
      "original_commit_id" : "022267ac634b13690414252c4deba7f499f98c63",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 13446083,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2017-02-10T20:21:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92921052",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "ACK https://github.com/bitcoin/bitcoin/commit/022267ac634b13690414252c4deba7f499f98c63",
      "created_at" : "2016-12-17T16:43:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#issuecomment-267772529",
      "id" : 267772529,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9369",
      "updated_at" : "2016-12-17T16:43:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267772529",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "utACK 406e975",
      "created_at" : "2016-12-19T01:42:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#issuecomment-267864215",
      "id" : 267864215,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9369",
      "updated_at" : "2016-12-19T01:42:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267864215",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r93014619"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93014619"
         }
      },
      "body" : "Would it be an idea to put this on CWalletTx instead? A quick scan of the code doesn't reveal any accesses to CWallet fields.",
      "commit_id" : "6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8",
      "created_at" : "2016-12-19T11:33:22Z",
      "diff_hunk" : "@@ -3300,6 +3256,46 @@ void CWallet::GetKeyBirthTimes(std::map<CKeyID, int64_t> &mapKeyBirth) const {\n         mapKeyBirth[it->first] = it->second->GetBlockTime() - 7200; // block times can be 2h off\n }\n \n+unsigned int CWallet::GetTimeSmart(const CWalletTx& wtx) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r93014619",
      "id" : 93014619,
      "original_commit_id" : "022267ac634b13690414252c4deba7f499f98c63",
      "original_position" : 57,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 13534481,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2017-02-10T20:21:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93014619",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r93016780"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93016780"
         }
      },
      "body" : "I think this makes most sense here next to CWallet::GetKeyBirthTimes. It ~~accesses CWallet::mapBlockIndex and~~ scans the CWallet::wtxOrdered field.",
      "commit_id" : "6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8",
      "created_at" : "2016-12-19T11:46:06Z",
      "diff_hunk" : "@@ -3300,6 +3256,46 @@ void CWallet::GetKeyBirthTimes(std::map<CKeyID, int64_t> &mapKeyBirth) const {\n         mapKeyBirth[it->first] = it->second->GetBlockTime() - 7200; // block times can be 2h off\n }\n \n+unsigned int CWallet::GetTimeSmart(const CWalletTx& wtx) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r93016780",
      "id" : 93016780,
      "original_commit_id" : "022267ac634b13690414252c4deba7f499f98c63",
      "original_position" : 57,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 13536632,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2017-02-10T20:21:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93016780",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r93017291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93017291"
         }
      },
      "body" : "(Never mind part of comment above about mapBlockIndex, which is a global.)",
      "commit_id" : "6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8",
      "created_at" : "2016-12-19T11:50:05Z",
      "diff_hunk" : "@@ -3300,6 +3256,46 @@ void CWallet::GetKeyBirthTimes(std::map<CKeyID, int64_t> &mapKeyBirth) const {\n         mapKeyBirth[it->first] = it->second->GetBlockTime() - 7200; // block times can be 2h off\n }\n \n+unsigned int CWallet::GetTimeSmart(const CWalletTx& wtx) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r93017291",
      "id" : 93017291,
      "original_commit_id" : "022267ac634b13690414252c4deba7f499f98c63",
      "original_position" : 57,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 13537151,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2017-02-10T20:21:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/93017291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "I think code style wise this would be improved by naming GetTimeSmart to RecomputeTimeSmart or ComputeTimeSmart because it's not a simple accessor. If someone were to decide to call GetTimeSmart in place of accessing the cached value, the name wouldn't imply the overhead otherwise.\r\n\r\nOtherwise, makes sense to me, utACK as is for 212a686.\r\n",
      "created_at" : "2017-01-13T19:42:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#issuecomment-272529030",
      "id" : 272529030,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9369",
      "updated_at" : "2017-01-13T19:42:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/272529030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/886523?v=3",
         "events_url" : "https://api.github.com/users/JeremyRubin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/JeremyRubin/followers",
         "following_url" : "https://api.github.com/users/JeremyRubin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/JeremyRubin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/JeremyRubin",
         "id" : 886523,
         "login" : "JeremyRubin",
         "organizations_url" : "https://api.github.com/users/JeremyRubin/orgs",
         "received_events_url" : "https://api.github.com/users/JeremyRubin/received_events",
         "repos_url" : "https://api.github.com/users/JeremyRubin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/JeremyRubin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/JeremyRubin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/JeremyRubin"
      }
   },
   {
      "body" : "Renamed method to ComputeTimeSmart in 1c474c253170ffa7ebc50abca93bf673c0ae0f4f and squashed 1c474c253170ffa7ebc50abca93bf673c0ae0f4f -> b75a9b95a43bf88e9e977fb9ad5bcb5e3266bbd9.",
      "created_at" : "2017-01-19T15:38:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#issuecomment-273808834",
      "id" : 273808834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9369",
      "updated_at" : "2017-01-19T15:38:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/273808834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r100457818"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/100457818"
         }
      },
      "body" : "I think an additional comment below this describing what a smart timestamp is would be helpful, even if the reader may deduce this from the logic section below. (It's not super clear to me, but seems to be a way to adapt the time stamp depending on various hints deduced from the state of the transaction.)",
      "commit_id" : "6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8",
      "created_at" : "2017-02-10T01:55:06Z",
      "diff_hunk" : "@@ -3324,6 +3280,67 @@ void CWallet::GetKeyBirthTimes(std::map<CKeyID, int64_t> &mapKeyBirth) const {\n         mapKeyBirth[it->first] = it->second->GetBlockTime() - 7200; // block times can be 2h off\n }\n \n+/**\n+ * Compute smart timestamp for a transaction being added to the wallet.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r100457818",
      "id" : 100457818,
      "original_commit_id" : "b75a9b95a43bf88e9e977fb9ad5bcb5e3266bbd9",
      "original_position" : 58,
      "path" : "src/wallet/wallet.cpp",
      "position" : 58,
      "pull_request_review_id" : 21166049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2017-02-10T20:21:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/100457818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r100458260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/100458260"
         }
      },
      "body" : "Nit / coding standard: E.g. Google coding style guide advises against `if (..) { .. } else ..`, recommending instead `if (..) { .. } else { .. }`, i.e. use braces in `else` if braces were used in `if`.",
      "commit_id" : "6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8",
      "created_at" : "2017-02-10T01:59:27Z",
      "diff_hunk" : "@@ -3324,6 +3280,67 @@ void CWallet::GetKeyBirthTimes(std::map<CKeyID, int64_t> &mapKeyBirth) const {\n         mapKeyBirth[it->first] = it->second->GetBlockTime() - 7200; // block times can be 2h off\n }\n \n+/**\n+ * Compute smart timestamp for a transaction being added to the wallet.\n+ *\n+ * Logic:\n+ * - If sending a transaction, assign its timestamp to the current time.\n+ * - If receiving a transaction outside a block, assign its timestamp to the\n+ *   current time.\n+ * - If receiving a block with a future timestamp, assign all its (not already\n+ *   known) transactions' timestamps to the current time.\n+ * - If receiving a block with a past timestamp, before the most recent known\n+ *   transaction (that we care about), assign all its (not already known)\n+ *   transactions' timestamps to the same timestamp as that most-recent-known\n+ *   transaction.\n+ * - If receiving a block with a past timestamp, but after the most recent known\n+ *   transaction, assign all its (not already known) transactions' timestamps to\n+ *   the block time.\n+ *\n+ * For more information see CWalletTx::nTimeSmart,\n+ * https://bitcointalk.org/?topic=54527, or\n+ * https://github.com/bitcoin/bitcoin/pull/1393.\n+ */\n+unsigned int CWallet::ComputeTimeSmart(const CWalletTx& wtx) const\n+{\n+    unsigned int nTimeSmart = wtx.nTimeReceived;\n+    if (!wtx.hashUnset()) {\n+        if (mapBlockIndex.count(wtx.hashBlock)) {\n+            int64_t latestNow = wtx.nTimeReceived;\n+            int64_t latestEntry = 0;\n+            {\n+                // Tolerate times up to the last timestamp in the wallet not more than 5 minutes into the future\n+                int64_t latestTolerated = latestNow + 300;\n+                const TxItems& txOrdered = wtxOrdered;\n+                for (auto it = txOrdered.rbegin(); it != txOrdered.rend(); ++it) {\n+                    CWalletTx* const pwtx = it->second.first;\n+                    if (pwtx == &wtx)\n+                        continue;\n+                    CAccountingEntry* const pacentry = it->second.second;\n+                    int64_t nSmartTime;\n+                    if (pwtx) {\n+                        nSmartTime = pwtx->nTimeSmart;\n+                        if (!nSmartTime)\n+                            nSmartTime = pwtx->nTimeReceived;\n+                    } else\n+                        nSmartTime = pacentry->nTime;\n+                    if (nSmartTime <= latestTolerated) {\n+                        latestEntry = nSmartTime;\n+                        if (nSmartTime > latestNow)\n+                            latestNow = nSmartTime;\n+                        break;\n+                    }\n+                }\n+            }\n+\n+            int64_t blocktime = mapBlockIndex[wtx.hashBlock]->GetBlockTime();\n+            nTimeSmart = std::max(latestEntry, std::min(blocktime, latestNow));\n+        } else",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r100458260",
      "id" : 100458260,
      "original_commit_id" : "b75a9b95a43bf88e9e977fb9ad5bcb5e3266bbd9",
      "original_position" : 112,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 21166049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2017-02-10T20:21:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/100458260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r100461779"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/100461779"
         }
      },
      "body" : "Our own coding style document says the same.",
      "commit_id" : "6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8",
      "created_at" : "2017-02-10T02:38:27Z",
      "diff_hunk" : "@@ -3324,6 +3280,67 @@ void CWallet::GetKeyBirthTimes(std::map<CKeyID, int64_t> &mapKeyBirth) const {\n         mapKeyBirth[it->first] = it->second->GetBlockTime() - 7200; // block times can be 2h off\n }\n \n+/**\n+ * Compute smart timestamp for a transaction being added to the wallet.\n+ *\n+ * Logic:\n+ * - If sending a transaction, assign its timestamp to the current time.\n+ * - If receiving a transaction outside a block, assign its timestamp to the\n+ *   current time.\n+ * - If receiving a block with a future timestamp, assign all its (not already\n+ *   known) transactions' timestamps to the current time.\n+ * - If receiving a block with a past timestamp, before the most recent known\n+ *   transaction (that we care about), assign all its (not already known)\n+ *   transactions' timestamps to the same timestamp as that most-recent-known\n+ *   transaction.\n+ * - If receiving a block with a past timestamp, but after the most recent known\n+ *   transaction, assign all its (not already known) transactions' timestamps to\n+ *   the block time.\n+ *\n+ * For more information see CWalletTx::nTimeSmart,\n+ * https://bitcointalk.org/?topic=54527, or\n+ * https://github.com/bitcoin/bitcoin/pull/1393.\n+ */\n+unsigned int CWallet::ComputeTimeSmart(const CWalletTx& wtx) const\n+{\n+    unsigned int nTimeSmart = wtx.nTimeReceived;\n+    if (!wtx.hashUnset()) {\n+        if (mapBlockIndex.count(wtx.hashBlock)) {\n+            int64_t latestNow = wtx.nTimeReceived;\n+            int64_t latestEntry = 0;\n+            {\n+                // Tolerate times up to the last timestamp in the wallet not more than 5 minutes into the future\n+                int64_t latestTolerated = latestNow + 300;\n+                const TxItems& txOrdered = wtxOrdered;\n+                for (auto it = txOrdered.rbegin(); it != txOrdered.rend(); ++it) {\n+                    CWalletTx* const pwtx = it->second.first;\n+                    if (pwtx == &wtx)\n+                        continue;\n+                    CAccountingEntry* const pacentry = it->second.second;\n+                    int64_t nSmartTime;\n+                    if (pwtx) {\n+                        nSmartTime = pwtx->nTimeSmart;\n+                        if (!nSmartTime)\n+                            nSmartTime = pwtx->nTimeReceived;\n+                    } else\n+                        nSmartTime = pacentry->nTime;\n+                    if (nSmartTime <= latestTolerated) {\n+                        latestEntry = nSmartTime;\n+                        if (nSmartTime > latestNow)\n+                            latestNow = nSmartTime;\n+                        break;\n+                    }\n+                }\n+            }\n+\n+            int64_t blocktime = mapBlockIndex[wtx.hashBlock]->GetBlockTime();\n+            nTimeSmart = std::max(latestEntry, std::min(blocktime, latestNow));\n+        } else",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r100461779",
      "id" : 100461779,
      "original_commit_id" : "b75a9b95a43bf88e9e977fb9ad5bcb5e3266bbd9",
      "original_position" : 112,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 21169929,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2017-02-10T20:21:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/100461779",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r100574008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/100574008"
         }
      },
      "body" : "I don't think I understand how this should change. The comment on `nTimeSmart` describes what the smart timestamp is and the comment on `ComputeTimeSmart` describes how a smart timestamp is computed, and both comments reference each other.",
      "commit_id" : "6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8",
      "created_at" : "2017-02-10T16:44:22Z",
      "diff_hunk" : "@@ -3324,6 +3280,67 @@ void CWallet::GetKeyBirthTimes(std::map<CKeyID, int64_t> &mapKeyBirth) const {\n         mapKeyBirth[it->first] = it->second->GetBlockTime() - 7200; // block times can be 2h off\n }\n \n+/**\n+ * Compute smart timestamp for a transaction being added to the wallet.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r100574008",
      "id" : 100574008,
      "original_commit_id" : "b75a9b95a43bf88e9e977fb9ad5bcb5e3266bbd9",
      "original_position" : 58,
      "path" : "src/wallet/wallet.cpp",
      "position" : 58,
      "pull_request_review_id" : 21288799,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2017-02-10T20:21:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/100574008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r100613101"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/100613101"
         }
      },
      "body" : "Added braces in cb48cd7d720d7af466614652c1e2a56dcce068bc",
      "commit_id" : "6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8",
      "created_at" : "2017-02-10T20:01:56Z",
      "diff_hunk" : "@@ -3324,6 +3280,67 @@ void CWallet::GetKeyBirthTimes(std::map<CKeyID, int64_t> &mapKeyBirth) const {\n         mapKeyBirth[it->first] = it->second->GetBlockTime() - 7200; // block times can be 2h off\n }\n \n+/**\n+ * Compute smart timestamp for a transaction being added to the wallet.\n+ *\n+ * Logic:\n+ * - If sending a transaction, assign its timestamp to the current time.\n+ * - If receiving a transaction outside a block, assign its timestamp to the\n+ *   current time.\n+ * - If receiving a block with a future timestamp, assign all its (not already\n+ *   known) transactions' timestamps to the current time.\n+ * - If receiving a block with a past timestamp, before the most recent known\n+ *   transaction (that we care about), assign all its (not already known)\n+ *   transactions' timestamps to the same timestamp as that most-recent-known\n+ *   transaction.\n+ * - If receiving a block with a past timestamp, but after the most recent known\n+ *   transaction, assign all its (not already known) transactions' timestamps to\n+ *   the block time.\n+ *\n+ * For more information see CWalletTx::nTimeSmart,\n+ * https://bitcointalk.org/?topic=54527, or\n+ * https://github.com/bitcoin/bitcoin/pull/1393.\n+ */\n+unsigned int CWallet::ComputeTimeSmart(const CWalletTx& wtx) const\n+{\n+    unsigned int nTimeSmart = wtx.nTimeReceived;\n+    if (!wtx.hashUnset()) {\n+        if (mapBlockIndex.count(wtx.hashBlock)) {\n+            int64_t latestNow = wtx.nTimeReceived;\n+            int64_t latestEntry = 0;\n+            {\n+                // Tolerate times up to the last timestamp in the wallet not more than 5 minutes into the future\n+                int64_t latestTolerated = latestNow + 300;\n+                const TxItems& txOrdered = wtxOrdered;\n+                for (auto it = txOrdered.rbegin(); it != txOrdered.rend(); ++it) {\n+                    CWalletTx* const pwtx = it->second.first;\n+                    if (pwtx == &wtx)\n+                        continue;\n+                    CAccountingEntry* const pacentry = it->second.second;\n+                    int64_t nSmartTime;\n+                    if (pwtx) {\n+                        nSmartTime = pwtx->nTimeSmart;\n+                        if (!nSmartTime)\n+                            nSmartTime = pwtx->nTimeReceived;\n+                    } else\n+                        nSmartTime = pacentry->nTime;\n+                    if (nSmartTime <= latestTolerated) {\n+                        latestEntry = nSmartTime;\n+                        if (nSmartTime > latestNow)\n+                            latestNow = nSmartTime;\n+                        break;\n+                    }\n+                }\n+            }\n+\n+            int64_t blocktime = mapBlockIndex[wtx.hashBlock]->GetBlockTime();\n+            nTimeSmart = std::max(latestEntry, std::min(blocktime, latestNow));\n+        } else",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r100613101",
      "id" : 100613101,
      "original_commit_id" : "b75a9b95a43bf88e9e977fb9ad5bcb5e3266bbd9",
      "original_position" : 112,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 21288799,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2017-02-10T20:25:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/100613101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Rearranged commits to put tests before refactoring cb48cd7d720d7af466614652c1e2a56dcce068bc -> 6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8 ([atw-timesmart.6](https://github.com/ryanofsky/bitcoin/commits/pr/atw-timesmart.6) -> [atw-timesmart.7](https://github.com/ryanofsky/bitcoin/commits/pr/atw-timesmart.7))\r\n",
      "created_at" : "2017-02-10T20:22:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#issuecomment-279056064",
      "id" : 279056064,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9369",
      "updated_at" : "2017-02-10T20:22:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/279056064",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r100691355"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/100691355"
         }
      },
      "body" : "It just felt like I didn't have a good grasp what it was by reading the code. You're probably right that it's sufficient if it's described in the variable comment, though.",
      "commit_id" : "6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8",
      "created_at" : "2017-02-12T12:59:10Z",
      "diff_hunk" : "@@ -3324,6 +3280,67 @@ void CWallet::GetKeyBirthTimes(std::map<CKeyID, int64_t> &mapKeyBirth) const {\n         mapKeyBirth[it->first] = it->second->GetBlockTime() - 7200; // block times can be 2h off\n }\n \n+/**\n+ * Compute smart timestamp for a transaction being added to the wallet.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#discussion_r100691355",
      "id" : 100691355,
      "original_commit_id" : "b75a9b95a43bf88e9e977fb9ad5bcb5e3266bbd9",
      "original_position" : 58,
      "path" : "src/wallet/wallet.cpp",
      "position" : 58,
      "pull_request_review_id" : 21406707,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/9369",
      "updated_at" : "2017-02-12T12:59:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/100691355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/250224?v=3",
         "events_url" : "https://api.github.com/users/kallewoof/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kallewoof/followers",
         "following_url" : "https://api.github.com/users/kallewoof/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kallewoof/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kallewoof",
         "id" : 250224,
         "login" : "kallewoof",
         "organizations_url" : "https://api.github.com/users/kallewoof/orgs",
         "received_events_url" : "https://api.github.com/users/kallewoof/received_events",
         "repos_url" : "https://api.github.com/users/kallewoof/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kallewoof/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kallewoof"
      }
   },
   {
      "body" : "Rebased 6587aa3b293b89c81dd7a4a8cc142d6e0a5670f8 -> 2ffffb36e138a5e060b6b3eaada3080ee3c4de75 ([atw-timesmart.7](https://github.com/ryanofsky/bitcoin/commits/pr/atw-timesmart.7) -> [atw-timesmart.8](https://github.com/ryanofsky/bitcoin/commits/pr/atw-timesmart.8)) because of conflict in wallet.h with #9108.\r\n",
      "created_at" : "2017-03-01T10:44:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#issuecomment-283306821",
      "id" : 283306821,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9369",
      "updated_at" : "2017-03-01T10:44:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/283306821",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Fixed mocktime test bug in 819696357bb407196e6f01175f2d4459848c7d9b.\r\n\r\nRebased 819696357bb407196e6f01175f2d4459848c7d9b -> 79b25edd74053d7a655882d4c16bb5dba43c90a2 ([pr/atw-timesmart.9](https://github.com/ryanofsky/bitcoin/commits/pr/atw-timesmart.9) -> [pr/atw-timesmart.10](https://github.com/ryanofsky/bitcoin/commits/pr/atw-timesmart.10)) because of conflicts with pwalletMain renames in #9775.\r\n",
      "created_at" : "2017-03-03T19:44:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/9369#issuecomment-284051389",
      "id" : 284051389,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9369",
      "updated_at" : "2017-03-03T19:44:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/284051389",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
