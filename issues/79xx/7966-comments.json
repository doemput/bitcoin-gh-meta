[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61467339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61467339"
         }
      },
      "body" : "Also, in C++11, you no longer need to avoid the '>>' in `Template1<Template2<Template3>>`.",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-04-28T17:22:08Z",
      "diff_hunk" : "@@ -71,8 +71,7 @@ class WorkQueue\n     /** Mutex protects entire object */\n     CWaitableCriticalSection cs;\n     CConditionVariable cond;\n-    /* XXX in C++11 we can use std::unique_ptr here and avoid manual cleanup */\n-    std::deque<WorkItem*> queue;\n+    std::deque<std::unique_ptr<WorkItem> > queue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61467339",
      "id" : 61467339,
      "original_commit_id" : "c0c7d8b7d747e8adc8b1bfaa2a8d1b4d6d4e52c8",
      "original_position" : 6,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61467339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61468317"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61468317"
         }
      },
      "body" : "I was just about to ask why the space is there...",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-04-28T17:28:11Z",
      "diff_hunk" : "@@ -71,8 +71,7 @@ class WorkQueue\n     /** Mutex protects entire object */\n     CWaitableCriticalSection cs;\n     CConditionVariable cond;\n-    /* XXX in C++11 we can use std::unique_ptr here and avoid manual cleanup */\n-    std::deque<WorkItem*> queue;\n+    std::deque<std::unique_ptr<WorkItem> > queue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61468317",
      "id" : 61468317,
      "original_commit_id" : "c0c7d8b7d747e8adc8b1bfaa2a8d1b4d6d4e52c8",
      "original_position" : 6,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61468317",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61486514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61486514"
         }
      },
      "body" : "@paveljanik because `>>` is an operator. But yes with c++11 this is apparently parsed differently so will remove the space.",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-04-28T19:15:46Z",
      "diff_hunk" : "@@ -71,8 +71,7 @@ class WorkQueue\n     /** Mutex protects entire object */\n     CWaitableCriticalSection cs;\n     CConditionVariable cond;\n-    /* XXX in C++11 we can use std::unique_ptr here and avoid manual cleanup */\n-    std::deque<WorkItem*> queue;\n+    std::deque<std::unique_ptr<WorkItem> > queue;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61486514",
      "id" : 61486514,
      "original_commit_id" : "c0c7d8b7d747e8adc8b1bfaa2a8d1b4d6d4e52c8",
      "original_position" : 6,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61486514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61494617"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61494617"
         }
      },
      "body" : "Do we need an empty destructor?",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-04-28T20:12:13Z",
      "diff_hunk" : "@@ -106,19 +105,15 @@ class WorkQueue\n      */\n     ~WorkQueue()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61494617",
      "id" : 61494617,
      "original_commit_id" : "3fc99f4d9b3d23112b46e38f2586a80e766bcc30",
      "original_position" : 12,
      "path" : "src/httpserver.cpp",
      "position" : 46,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61494617",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61504551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61504551"
         }
      },
      "body" : "`item` has been given to the queue here",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-04-28T21:20:50Z",
      "diff_hunk" : "@@ -288,11 +282,9 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n \n     // Dispatch to worker thread\n     if (i != iend) {\n-        std::auto_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n+        std::unique_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n         assert(workQueue);\n-        if (workQueue->Enqueue(item.get()))\n-            item.release(); /* if true, queue took ownership */\n-        else\n+        if (!workQueue->Enqueue(std::move(item)))\n             item->req->WriteReply(HTTP_INTERNAL, \"Work queue depth exceeded\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61504551",
      "id" : 61504551,
      "original_commit_id" : "3fc99f4d9b3d23112b46e38f2586a80e766bcc30",
      "original_position" : 73,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61504551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61504588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61504588"
         }
      },
      "body" : "use after move here",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-04-28T21:21:09Z",
      "diff_hunk" : "@@ -288,11 +282,9 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n \n     // Dispatch to worker thread\n     if (i != iend) {\n-        std::auto_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n+        std::unique_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n         assert(workQueue);\n-        if (workQueue->Enqueue(item.get()))\n-            item.release(); /* if true, queue took ownership */\n-        else\n+        if (!workQueue->Enqueue(std::move(item)))\n             item->req->WriteReply(HTTP_INTERNAL, \"Work queue depth exceeded\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61504588",
      "id" : 61504588,
      "original_commit_id" : "3fc99f4d9b3d23112b46e38f2586a80e766bcc30",
      "original_position" : 73,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61504588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61726526"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61726526"
         }
      },
      "body" : "@kazcw @theuni Bah, good catch. I suppose there's no such thing as a conditional move?\r\nMaybe it could return the unique_pointer (\"move back\") if it couldn't be pushed into the queue?\r\nThe other option would be to move the error message into the queue but that'd not be very nice.\r\n",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-05-02T11:06:23Z",
      "diff_hunk" : "@@ -288,11 +282,9 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n \n     // Dispatch to worker thread\n     if (i != iend) {\n-        std::auto_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n+        std::unique_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n         assert(workQueue);\n-        if (workQueue->Enqueue(item.get()))\n-            item.release(); /* if true, queue took ownership */\n-        else\n+        if (!workQueue->Enqueue(std::move(item)))\n             item->req->WriteReply(HTTP_INTERNAL, \"Work queue depth exceeded\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61726526",
      "id" : 61726526,
      "original_commit_id" : "3fc99f4d9b3d23112b46e38f2586a80e766bcc30",
      "original_position" : 73,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61726526",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61726770"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61726770"
         }
      },
      "body" : "I'll remove it.",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-05-02T11:10:48Z",
      "diff_hunk" : "@@ -106,19 +105,15 @@ class WorkQueue\n      */\n     ~WorkQueue()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61726770",
      "id" : 61726770,
      "original_commit_id" : "3fc99f4d9b3d23112b46e38f2586a80e766bcc30",
      "original_position" : 12,
      "path" : "src/httpserver.cpp",
      "position" : 46,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61726770",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61756912"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61756912"
         }
      },
      "body" : "The actual moving happens in `unique_ptr`'s ctor. The function just needs to accept a `unique_ptr&&`, then it can freely move that into a new `unique_ptr` or not.",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-05-02T15:44:47Z",
      "diff_hunk" : "@@ -288,11 +282,9 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n \n     // Dispatch to worker thread\n     if (i != iend) {\n-        std::auto_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n+        std::unique_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n         assert(workQueue);\n-        if (workQueue->Enqueue(item.get()))\n-            item.release(); /* if true, queue took ownership */\n-        else\n+        if (!workQueue->Enqueue(std::move(item)))\n             item->req->WriteReply(HTTP_INTERNAL, \"Work queue depth exceeded\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r61756912",
      "id" : 61756912,
      "original_commit_id" : "3fc99f4d9b3d23112b46e38f2586a80e766bcc30",
      "original_position" : 73,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/61756912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62015537"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62015537"
         }
      },
      "body" : "On second thought, I'm going to keep it, the precondition comment is still relevant.\r\n",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-05-04T09:59:01Z",
      "diff_hunk" : "@@ -106,19 +105,15 @@ class WorkQueue\n      */\n     ~WorkQueue()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62015537",
      "id" : 62015537,
      "original_commit_id" : "3fc99f4d9b3d23112b46e38f2586a80e766bcc30",
      "original_position" : 12,
      "path" : "src/httpserver.cpp",
      "position" : 46,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62015537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62015847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62015847"
         }
      },
      "body" : "@kazcw I've updated to do that. Can you please re-review to see if this was what you meant?\r\n",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-05-04T10:01:37Z",
      "diff_hunk" : "@@ -288,11 +282,9 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n \n     // Dispatch to worker thread\n     if (i != iend) {\n-        std::auto_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n+        std::unique_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n         assert(workQueue);\n-        if (workQueue->Enqueue(item.get()))\n-            item.release(); /* if true, queue took ownership */\n-        else\n+        if (!workQueue->Enqueue(std::move(item)))\n             item->req->WriteReply(HTTP_INTERNAL, \"Work queue depth exceeded\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62015847",
      "id" : 62015847,
      "original_commit_id" : "3fc99f4d9b3d23112b46e38f2586a80e766bcc30",
      "original_position" : 73,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62015847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62031320"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62031320"
         }
      },
      "body" : "It doesn't seem to work. I've tested with a (hacked) work-queue size of 0, and the connection is closed before the error message can be sent.",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-05-04T12:41:35Z",
      "diff_hunk" : "@@ -288,11 +282,9 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n \n     // Dispatch to worker thread\n     if (i != iend) {\n-        std::auto_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n+        std::unique_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n         assert(workQueue);\n-        if (workQueue->Enqueue(item.get()))\n-            item.release(); /* if true, queue took ownership */\n-        else\n+        if (!workQueue->Enqueue(std::move(item)))\n             item->req->WriteReply(HTTP_INTERNAL, \"Work queue depth exceeded\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62031320",
      "id" : 62031320,
      "original_commit_id" : "3fc99f4d9b3d23112b46e38f2586a80e766bcc30",
      "original_position" : 73,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62031320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62033874"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62033874"
         }
      },
      "body" : "Leaving out the std::move in the `->Enqueue` line gives a compile error about pointer conversions:\r\n```\r\n/home/orion/projects/bitcoin/bitcoin/src/httpserver.cpp:289:33: error: no viable conversion from 'unique_ptr<HTTPWorkItem>' to 'unique_ptr<HTTPClosure>'\r\n        if (!workQueue->Enqueue(item))\r\n```\r\nBleh.",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-05-04T13:01:08Z",
      "diff_hunk" : "@@ -288,11 +282,9 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n \n     // Dispatch to worker thread\n     if (i != iend) {\n-        std::auto_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n+        std::unique_ptr<HTTPWorkItem> item(new HTTPWorkItem(hreq.release(), path, i->handler));\n         assert(workQueue);\n-        if (workQueue->Enqueue(item.get()))\n-            item.release(); /* if true, queue took ownership */\n-        else\n+        if (!workQueue->Enqueue(std::move(item)))\n             item->req->WriteReply(HTTP_INTERNAL, \"Work queue depth exceeded\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62033874",
      "id" : 62033874,
      "original_commit_id" : "3fc99f4d9b3d23112b46e38f2586a80e766bcc30",
      "original_position" : 73,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62033874",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Decided to forget about using std::move to move items conditionally into the queue, the resulting code was too complex, the old code is cleaner.\r\n",
      "created_at" : "2016-05-04T13:33:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#issuecomment-216866129",
      "id" : 216866129,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7966",
      "updated_at" : "2016-05-04T13:33:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/216866129",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62150648"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62150648"
         }
      },
      "body" : "nit: ```queue.emplace_back(item);```",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-05-05T05:49:01Z",
      "diff_hunk" : "@@ -118,7 +112,7 @@ class WorkQueue\n         if (queue.size() >= maxDepth) {\n             return false;\n         }\n-        queue.push_back(item);\n+        queue.push_back(std::unique_ptr<WorkItem>(item));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62150648",
      "id" : 62150648,
      "original_commit_id" : "867bc6d38227a4adc1ffe5faf0c05b1647398c6a",
      "original_position" : 60,
      "path" : "src/httpserver.cpp",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T06:28:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62150648",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "body" : "ut ACK, other than the little nit",
      "created_at" : "2016-05-05T05:49:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#issuecomment-217081021",
      "id" : 217081021,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7966",
      "updated_at" : "2016-05-05T05:49:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217081021",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62208255"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62208255"
         }
      },
      "body" : "Creating the unique_ptr here defeats the purpose of the emplace :)\r\nPassing it item directly would mean that the unique_ptr would be constructed in-place. As is, it's moved instead.\r\n\r\nNot worth worrying about, just pointing it out.",
      "commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "created_at" : "2016-05-05T15:57:45Z",
      "diff_hunk" : "@@ -118,7 +112,7 @@ class WorkQueue\n         if (queue.size() >= maxDepth) {\n             return false;\n         }\n-        queue.push_back(item);\n+        queue.emplace_back(std::unique_ptr<WorkItem>(item));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7966#discussion_r62208255",
      "id" : 62208255,
      "original_commit_id" : "f0188f9178a22fd493ed228c008d4cc25ac2952d",
      "original_position" : 60,
      "path" : "src/httpserver.cpp",
      "position" : 60,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7966",
      "updated_at" : "2016-05-05T15:57:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62208255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   }
]
