[
   {
      "body" : "Code review ACK, will test.",
      "created_at" : "2016-05-05T17:37:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-217220702",
      "id" : 217220702,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-05-05T17:37:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217220702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "> [This object bimodality is necessary because lookup on a set requires\r\nconstructing an object of the set's key type, an inconvenience corrected in\r\nC++14.]\r\n\r\nI thought we were only at C++11?  Or are you suggesting this is something else that would be corrected by moving to C++14?",
      "created_at" : "2016-05-06T02:51:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-217336579",
      "id" : 217336579,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-05-06T02:52:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217336579",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "I'm just blaming C++<=11 for my tagged union. When we eventually switch to C++14 there's a much cleaner solution that doesn't require putting two things that should be different types in the same class.",
      "created_at" : "2016-05-06T03:36:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-217340659",
      "id" : 217340659,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-05-06T03:36:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217340659",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7997#discussion_r62286760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62286760"
         }
      },
      "body" : "`noexcept`, then a `throw`\r\n\r\nDid I misunderstand the meaning of this qualifier?",
      "commit_id" : "507437a0f067dd696c1fe9698f4ad60a3801ce3f",
      "created_at" : "2016-05-06T04:05:54Z",
      "diff_hunk" : "@@ -306,17 +307,41 @@ struct ancestor_score {};\n class CBlockPolicyEstimator;\n \n /** An inpoint - a combination of a transaction and an index n into its vin */\n-class CInPoint\n+struct CInPoint\n {\n+    const CTransaction *const ptx;\n+    const uint32_t n;\n+    constexpr size_t DynamicMemoryUsage() const noexcept { return 0; }\n+    const COutPoint& GetOutPoint() const noexcept { return ptx->vin[n].prevout; }\n+};\n+\n+/* reference to a COutPoint that is either \"free\" or inside a CTransaction spending it\n+ *\n+ * must not outlive the COutPoint\n+ */\n+class CSpendRef\n+{\n+private:\n+    union {\n+    const COutPoint *const spent;\n+    const CTransaction *const spender;\n+    };\n+    const uint32_t n;\n+    const bool haveSpender;\n public:\n-    const CTransaction* ptx;\n-    uint32_t n;\n-\n-    CInPoint() { SetNull(); }\n-    CInPoint(const CTransaction* ptxIn, uint32_t nIn) { ptx = ptxIn; n = nIn; }\n-    void SetNull() { ptx = NULL; n = (uint32_t) -1; }\n-    bool IsNull() const { return (ptx == NULL && n == (uint32_t) -1); }\n-    size_t DynamicMemoryUsage() const { return 0; }\n+    /* COutPoint in a spending CTransaction */\n+    constexpr CSpendRef(const CInPoint& inpoint) noexcept : spender(inpoint.ptx), n(inpoint.n), haveSpender(true) {}\n+    /* \"free\" COutPoint */\n+    constexpr CSpendRef(const COutPoint& outpoint) noexcept : spent(&outpoint), n(0), haveSpender(false) {}\n+    const COutPoint& GetOutPoint() const noexcept {\n+        return haveSpender ? GetInPoint().GetOutPoint() : *spent;\n+    }\n+    constexpr CInPoint GetInPoint() const noexcept {\n+        return haveSpender ? CInPoint{ spender, n } : throw std::logic_error(\"!haveSpender in CSpendRef::GetInPoint()\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#discussion_r62286760",
      "id" : 62286760,
      "original_commit_id" : "26427666fd17c32a8f5bba0a67e7d896608d90e1",
      "original_position" : 51,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7997",
      "updated_at" : "2016-05-09T23:05:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62286760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7997#discussion_r62290026"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62290026"
         }
      },
      "body" : "`noexcept` guarantees `std::terminate` occurs if an exception escapes the function; it's a hard assert that's allowed inside a `constexpr`.",
      "commit_id" : "507437a0f067dd696c1fe9698f4ad60a3801ce3f",
      "created_at" : "2016-05-06T05:31:07Z",
      "diff_hunk" : "@@ -306,17 +307,41 @@ struct ancestor_score {};\n class CBlockPolicyEstimator;\n \n /** An inpoint - a combination of a transaction and an index n into its vin */\n-class CInPoint\n+struct CInPoint\n {\n+    const CTransaction *const ptx;\n+    const uint32_t n;\n+    constexpr size_t DynamicMemoryUsage() const noexcept { return 0; }\n+    const COutPoint& GetOutPoint() const noexcept { return ptx->vin[n].prevout; }\n+};\n+\n+/* reference to a COutPoint that is either \"free\" or inside a CTransaction spending it\n+ *\n+ * must not outlive the COutPoint\n+ */\n+class CSpendRef\n+{\n+private:\n+    union {\n+    const COutPoint *const spent;\n+    const CTransaction *const spender;\n+    };\n+    const uint32_t n;\n+    const bool haveSpender;\n public:\n-    const CTransaction* ptx;\n-    uint32_t n;\n-\n-    CInPoint() { SetNull(); }\n-    CInPoint(const CTransaction* ptxIn, uint32_t nIn) { ptx = ptxIn; n = nIn; }\n-    void SetNull() { ptx = NULL; n = (uint32_t) -1; }\n-    bool IsNull() const { return (ptx == NULL && n == (uint32_t) -1); }\n-    size_t DynamicMemoryUsage() const { return 0; }\n+    /* COutPoint in a spending CTransaction */\n+    constexpr CSpendRef(const CInPoint& inpoint) noexcept : spender(inpoint.ptx), n(inpoint.n), haveSpender(true) {}\n+    /* \"free\" COutPoint */\n+    constexpr CSpendRef(const COutPoint& outpoint) noexcept : spent(&outpoint), n(0), haveSpender(false) {}\n+    const COutPoint& GetOutPoint() const noexcept {\n+        return haveSpender ? GetInPoint().GetOutPoint() : *spent;\n+    }\n+    constexpr CInPoint GetInPoint() const noexcept {\n+        return haveSpender ? CInPoint{ spender, n } : throw std::logic_error(\"!haveSpender in CSpendRef::GetInPoint()\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#discussion_r62290026",
      "id" : 62290026,
      "original_commit_id" : "26427666fd17c32a8f5bba0a67e7d896608d90e1",
      "original_position" : 51,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7997",
      "updated_at" : "2016-05-09T23:05:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62290026",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7997#discussion_r62290239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62290239"
         }
      },
      "body" : "TIL, thanks @kazcw ",
      "commit_id" : "507437a0f067dd696c1fe9698f4ad60a3801ce3f",
      "created_at" : "2016-05-06T05:36:51Z",
      "diff_hunk" : "@@ -306,17 +307,41 @@ struct ancestor_score {};\n class CBlockPolicyEstimator;\n \n /** An inpoint - a combination of a transaction and an index n into its vin */\n-class CInPoint\n+struct CInPoint\n {\n+    const CTransaction *const ptx;\n+    const uint32_t n;\n+    constexpr size_t DynamicMemoryUsage() const noexcept { return 0; }\n+    const COutPoint& GetOutPoint() const noexcept { return ptx->vin[n].prevout; }\n+};\n+\n+/* reference to a COutPoint that is either \"free\" or inside a CTransaction spending it\n+ *\n+ * must not outlive the COutPoint\n+ */\n+class CSpendRef\n+{\n+private:\n+    union {\n+    const COutPoint *const spent;\n+    const CTransaction *const spender;\n+    };\n+    const uint32_t n;\n+    const bool haveSpender;\n public:\n-    const CTransaction* ptx;\n-    uint32_t n;\n-\n-    CInPoint() { SetNull(); }\n-    CInPoint(const CTransaction* ptxIn, uint32_t nIn) { ptx = ptxIn; n = nIn; }\n-    void SetNull() { ptx = NULL; n = (uint32_t) -1; }\n-    bool IsNull() const { return (ptx == NULL && n == (uint32_t) -1); }\n-    size_t DynamicMemoryUsage() const { return 0; }\n+    /* COutPoint in a spending CTransaction */\n+    constexpr CSpendRef(const CInPoint& inpoint) noexcept : spender(inpoint.ptx), n(inpoint.n), haveSpender(true) {}\n+    /* \"free\" COutPoint */\n+    constexpr CSpendRef(const COutPoint& outpoint) noexcept : spent(&outpoint), n(0), haveSpender(false) {}\n+    const COutPoint& GetOutPoint() const noexcept {\n+        return haveSpender ? GetInPoint().GetOutPoint() : *spent;\n+    }\n+    constexpr CInPoint GetInPoint() const noexcept {\n+        return haveSpender ? CInPoint{ spender, n } : throw std::logic_error(\"!haveSpender in CSpendRef::GetInPoint()\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#discussion_r62290239",
      "id" : 62290239,
      "original_commit_id" : "26427666fd17c32a8f5bba0a67e7d896608d90e1",
      "original_position" : 51,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7997",
      "updated_at" : "2016-05-09T23:05:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/62290239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "ACK.  Nice improvement!",
      "created_at" : "2016-05-06T18:41:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-217525452",
      "id" : 217525452,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-05-06T18:41:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217525452",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=3",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "body" : "utACK 2642766",
      "created_at" : "2016-05-07T02:25:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-217599789",
      "id" : 217599789,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-05-07T02:25:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217599789",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/413395?v=3",
         "events_url" : "https://api.github.com/users/dcousens/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dcousens/followers",
         "following_url" : "https://api.github.com/users/dcousens/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dcousens/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dcousens",
         "id" : 413395,
         "login" : "dcousens",
         "organizations_url" : "https://api.github.com/users/dcousens/orgs",
         "received_events_url" : "https://api.github.com/users/dcousens/received_events",
         "repos_url" : "https://api.github.com/users/dcousens/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dcousens/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dcousens/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dcousens"
      }
   },
   {
      "body" : "Concept ACK",
      "created_at" : "2016-05-09T19:33:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-217965578",
      "id" : 217965578,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-05-09T19:33:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/217965578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "I just realized that no users of `mapNextTx` need to know which CTxIn of a transaction spends a particular prevout. This makes a map-based approach possible with the same memory usage as this set implementation. I'm going to replace this with the map implementation because it's definitely cleaner that way (doesn't require the CSpendRef trick, and a map better reflects the function of the data structure).",
      "created_at" : "2016-05-09T22:32:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-218009628",
      "id" : 218009628,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-05-09T22:32:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/218009628",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7997#discussion_r63296674"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/63296674"
         }
      },
      "body" : "Feel like this might lead to errors at some point? I'd kinda prefer if you only do this for insert().",
      "commit_id" : "507437a0f067dd696c1fe9698f4ad60a3801ce3f",
      "created_at" : "2016-05-15T19:29:28Z",
      "diff_hunk" : "@@ -0,0 +1,51 @@\n+#ifndef BITCOIN_INDIRECTMAP_H\n+#define BITCOIN_INDIRECTMAP_H\n+\n+template <class T>\n+struct DereferencingComparator { bool operator()(const T a, const T b) const { return *a < *b; } };\n+\n+/* Map whose keys are pointers, but are compared by their dereferenced values.\n+ *\n+ * Differs from a plain std::map<const K*, T, DereferencingComparator<K*> > in\n+ * that methods that take a key for comparison take a K rather than taking a K*\n+ * (taking a K* would be confusing, since it's the value rather than the address\n+ * of the object for comparison that matters due to the dereferencing comparator).\n+ *\n+ * Objects pointed to by keys must not be modified in any way that changes the\n+ * result of DereferencingComparator.\n+ */\n+template <class K, class T>\n+class indirectmap {\n+private:\n+    typedef std::map<const K*, T, DereferencingComparator<const K*> > base;\n+    base m;\n+public:\n+    typedef typename base::iterator iterator;\n+    typedef typename base::const_iterator const_iterator;\n+    typedef typename base::size_type size_type;\n+\n+    // passthrough (pointer interface)\n+    T& operator[](const K* key) { return m[key]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#discussion_r63296674",
      "id" : 63296674,
      "original_commit_id" : "507437a0f067dd696c1fe9698f4ad60a3801ce3f",
      "original_position" : 28,
      "path" : "src/indirectmap.h",
      "position" : 28,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7997",
      "updated_at" : "2016-05-15T19:29:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/63296674",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "ACK 507437a0f067dd696c1fe9698f4ad60a3801ce3f +/- removing [] and forcing insertion through insert(). It'd also be nice to get a test for indirectmap, or at least the following, if you're feeling lazy:\r\n\r\n```\r\ndiff --git a/src/txmempool.cpp b/src/txmempool.cpp\r\nindex 2f867c8..42c3da4 100644\r\n--- a/src/txmempool.cpp\r\n+++ b/src/txmempool.cpp\r\n@@ -673,6 +673,7 @@ void CTxMemPool::check(const CCoinsViewCache *pcoins) const\r\n             // Check whether its inputs are marked in mapNextTx.\r\n             auto it3 = mapNextTx.find(txin.prevout);\r\n             assert(it3 != mapNextTx.end());\r\n+            assert(it3->first == &txin.prevout);\r\n             assert(it3->second == &tx);\r\n             i++;\r\n         }\r\n```",
      "created_at" : "2016-05-15T19:50:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-219306578",
      "id" : 219306578,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-05-15T19:51:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/219306578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7997#discussion_r63426979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7997"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/63426979"
         }
      },
      "body" : "I guess it's the correct thing to do if you want to mimic the std::map interface as good as possible, but operator[] automatically constructing elements is annoying...",
      "commit_id" : "507437a0f067dd696c1fe9698f4ad60a3801ce3f",
      "created_at" : "2016-05-16T21:15:16Z",
      "diff_hunk" : "@@ -0,0 +1,51 @@\n+#ifndef BITCOIN_INDIRECTMAP_H\n+#define BITCOIN_INDIRECTMAP_H\n+\n+template <class T>\n+struct DereferencingComparator { bool operator()(const T a, const T b) const { return *a < *b; } };\n+\n+/* Map whose keys are pointers, but are compared by their dereferenced values.\n+ *\n+ * Differs from a plain std::map<const K*, T, DereferencingComparator<K*> > in\n+ * that methods that take a key for comparison take a K rather than taking a K*\n+ * (taking a K* would be confusing, since it's the value rather than the address\n+ * of the object for comparison that matters due to the dereferencing comparator).\n+ *\n+ * Objects pointed to by keys must not be modified in any way that changes the\n+ * result of DereferencingComparator.\n+ */\n+template <class K, class T>\n+class indirectmap {\n+private:\n+    typedef std::map<const K*, T, DereferencingComparator<const K*> > base;\n+    base m;\n+public:\n+    typedef typename base::iterator iterator;\n+    typedef typename base::const_iterator const_iterator;\n+    typedef typename base::size_type size_type;\n+\n+    // passthrough (pointer interface)\n+    T& operator[](const K* key) { return m[key]; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#discussion_r63426979",
      "id" : 63426979,
      "original_commit_id" : "507437a0f067dd696c1fe9698f4ad60a3801ce3f",
      "original_position" : 28,
      "path" : "src/indirectmap.h",
      "position" : 28,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7997",
      "updated_at" : "2016-05-16T21:15:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/63426979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "The find-and-maybe-insert operator does seem especially squirrelly in this case. Added a squashme with `insert(...)` instead; added the assertion.",
      "created_at" : "2016-05-16T21:38:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-219556261",
      "id" : 219556261,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-05-16T21:38:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/219556261",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "body" : "utACK f379416127f0832ba4aa73c1af874df79b58124c",
      "created_at" : "2016-05-16T22:34:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-219568800",
      "id" : 219568800,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-05-16T22:34:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/219568800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Seems you forgot to add the assertion?",
      "created_at" : "2016-05-17T05:05:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-219620225",
      "id" : 219620225,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-05-17T05:05:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/219620225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Oops, I hadn't saved the changes to the file yet",
      "created_at" : "2016-05-17T05:22:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-219622071",
      "id" : 219622071,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-05-17T05:22:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/219622071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   },
   {
      "body" : "re-ACK 64949c7f9c7d47df170fa3814bb5aa89235c8e74",
      "created_at" : "2016-05-17T17:26:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-219791530",
      "id" : 219791530,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-05-17T17:26:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/219791530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Can you squash?",
      "created_at" : "2016-06-02T15:25:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-223326917",
      "id" : 223326917,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-06-02T15:25:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223326917",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Squashed all my commits from 64949c7 -> 9805f4a",
      "created_at" : "2016-06-02T19:34:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7997#issuecomment-223398068",
      "id" : 223398068,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7997",
      "updated_at" : "2016-06-02T19:34:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223398068",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1047859?v=3",
         "events_url" : "https://api.github.com/users/kazcw/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kazcw/followers",
         "following_url" : "https://api.github.com/users/kazcw/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kazcw/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kazcw",
         "id" : 1047859,
         "login" : "kazcw",
         "organizations_url" : "https://api.github.com/users/kazcw/orgs",
         "received_events_url" : "https://api.github.com/users/kazcw/received_events",
         "repos_url" : "https://api.github.com/users/kazcw/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kazcw/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kazcw/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kazcw"
      }
   }
]
