{
   "assignee" : null,
   "body" : "Fixes #2724 and #1570.\r\n\r\nAdds the automatically-subtract-the-fee-from-the-amount-and-send-whats-left feature to the GUI and rpc (sendtoaddres,sendfrom,sendmany).\r\n\r\nThe checkbox is only shown for the first recipient. This is to avoid confusion and to make the implementation\r\nas simple as possible: We deduct the fee from the first recipient, if its not enough -> fail\r\nIf whats left to send is dust -> fail\r\n\r\n-----------\r\nThere is an edge case to consider: Instead of moving dust change to fees, we raise the change\r\nuntil no dust and deduct from the recipient.\r\nExample:\r\nAmount: 10000 satoshis\r\nFee: 300 satoshis\r\nSelected unspent output: 10001 satoshis\r\n\r\nNow normally:\r\nRecipient receives: 9700\r\nFee: 300\r\nChange: 1\r\nTo pay: 10000\r\n\r\nBut 1 satoshi is dust, so instead we do:\r\nRecipient receives: 9155 (9700 - 545)\r\nFee: 300\r\nChange: 546 (1 + 545)\r\nTo pay: 9455\r\n\r\nSo you end up paying less than 10000 in this edge case. But if we would move dust-change to fees (or recipient) you would pay 10001 which would be totally unexpected if you enter 10000 and say \"please just deduct the fee from the 10000 and send whats left\".\r\n\r\n![subtractfeefromamount7](https://cloud.githubusercontent.com/assets/2814559/3252143/f67cf112-f1bb-11e3-88f0-e30a1573c80d.png)\r\n\r\nWithout checkbox\r\n![subtractfeefromamount4](https://cloud.githubusercontent.com/assets/2814559/3252150/0eab2c18-f1bc-11e3-95b7-417f85a0d642.png)\r\n\r\nWith checkbox\r\n![subtractfeefromamount3](https://cloud.githubusercontent.com/assets/2814559/3252154/166c5468-f1bc-11e3-9b47-17b3cc0787b4.png)\r\n\r\nDust edge case\r\n![subtractfeefromamount5](https://cloud.githubusercontent.com/assets/2814559/3252158/1f515790-f1bc-11e3-91cc-75b242912050.png)\r\n\r\nrpc\r\n![subtractfeefromamount6](https://cloud.githubusercontent.com/assets/2814559/3252160/244fe5cc-f1bc-11e3-9a18-48acc6e080c2.png)\r\n\r\n\r\n\r\n\r\n\r\n",
   "closed_at" : "2015-02-26T13:16:08Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 30,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4331/comments",
   "created_at" : "2014-06-11T23:04:58Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4331/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/4331",
   "id" : 35536564,
   "labels" : [
      {
         "color" : "02d7e1",
         "name" : "Wallet",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4331/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 4331,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/4331.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4331",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/4331.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4331"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Subtract fee from amount",
   "updated_at" : "2015-02-26T13:16:08Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4331",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/2814559?v=3",
      "events_url" : "https://api.github.com/users/cozz/events{/privacy}",
      "followers_url" : "https://api.github.com/users/cozz/followers",
      "following_url" : "https://api.github.com/users/cozz/following{/other_user}",
      "gists_url" : "https://api.github.com/users/cozz/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/cozz",
      "id" : 2814559,
      "login" : "cozz",
      "organizations_url" : "https://api.github.com/users/cozz/orgs",
      "received_events_url" : "https://api.github.com/users/cozz/received_events",
      "repos_url" : "https://api.github.com/users/cozz/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/cozz/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/cozz/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/cozz"
   }
}
