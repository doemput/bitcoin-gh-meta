[
   {
      "body" : "I realise I may be misunderstanding the code as it is, and that some of these commits are based on false assumptions. I think it's better to test assumptions as part of code-review. Now and again I have been known to be right in some of my observations!",
      "created_at" : "2016-08-29T05:34:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8622#issuecomment-243035668",
      "id" : 243035668,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8622",
      "updated_at" : "2016-08-29T05:34:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243035668",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "sorry... still needs testing",
      "created_at" : "2016-08-29T07:27:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8622#issuecomment-243051590",
      "id" : 243051590,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8622",
      "updated_at" : "2016-08-29T07:27:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243051590",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Can you please test locally first?",
      "created_at" : "2016-08-29T07:33:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8622#issuecomment-243052706",
      "id" : 243052706,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8622",
      "updated_at" : "2016-08-29T07:33:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243052706",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "@paveljanik I do.. but not enough sometimes. I'm a premature pusher it seems :-s\r\n\r\nAlso, as soon as I am happy with my code, I want to push it to my github account, but if I do that while the pull is closed, then I'm unable to re-open it, so I have to open it before pushing. But if I leave it open, other developers on github complain if it's not read enough, which sometime it isn't, so I close it until I am sure.\r\n\r\nIf there is a better way to do this, please let me know. The opening and closing seems to be due to a feature in github which locks the pull closed if pushes are done while it is closed :-s",
      "created_at" : "2016-08-29T08:08:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8622#issuecomment-243059392",
      "id" : 243059392,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8622",
      "updated_at" : "2016-08-29T08:10:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243059392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "@rebroad Leave it open or leave it closed. You already included the [WIP] tag.\r\n\r\nOtherwise you are sending out about 1200 emails every time you click the button.",
      "created_at" : "2016-08-29T08:13:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8622#issuecomment-243060270",
      "id" : 243060270,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8622",
      "updated_at" : "2016-08-29T08:13:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243060270",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "@MarcoFalke ok, I will find a better way to do this. Does changing the title also send as many emails? I don't even feel having conversation via comments is the best way either - is there no private messaging function on github for example?",
      "created_at" : "2016-08-29T08:16:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8622#issuecomment-243060961",
      "id" : 243060961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8622",
      "updated_at" : "2016-08-29T08:18:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243060961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Pushing a commit to a PR, changing the title, opening, closing, ... all\nsend mails. And people who are subscribed to the project receive all these\nmails from all pull requests.\n\nIf you want to actively experiment, why not work in a separate branch,\nwithout a PR? Once you're happy with the result, you can push the PR'ed\nbranch.\n",
      "created_at" : "2016-08-29T08:21:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8622#issuecomment-243061871",
      "id" : 243061871,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8622",
      "updated_at" : "2016-08-29T08:21:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243061871",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "@rebroad I also suggest popping into IRC to ask questions/sound ideas. It's a lot more efficient to get direction and focus.",
      "created_at" : "2016-08-29T10:00:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8622#issuecomment-243084034",
      "id" : 243084034,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8622",
      "updated_at" : "2016-08-29T10:00:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/243084034",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7275704?v=3",
         "events_url" : "https://api.github.com/users/btcdrak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/btcdrak/followers",
         "following_url" : "https://api.github.com/users/btcdrak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/btcdrak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/btcdrak",
         "id" : 7275704,
         "login" : "btcdrak",
         "organizations_url" : "https://api.github.com/users/btcdrak/orgs",
         "received_events_url" : "https://api.github.com/users/btcdrak/received_events",
         "repos_url" : "https://api.github.com/users/btcdrak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/btcdrak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/btcdrak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/btcdrak"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8622#discussion_r77123930"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8622"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/77123930"
         }
      },
      "body" : "It seems to me that nServicesExpected doesn't need to be mentioned here at all. It's irrelevant. It's simply what was advertised in the addresses messages. If nServices includes all the relevant services then surely the connection should remain. Firstly, the network selection code is such that if the relevant services wasn't present in ExpectedServices it wouldn't even have tried connecting to it. and secondly, even if the network selection code tries connecting to it, then as long as nServices (the latest update of what the node provides) includes the relevant services, the connection should remain even if the ExpectedServices (an out of date snapshot of what other nodes say the node provides) says it doesn't provide the service.\r\n\r\nI therefore propose changing this line to:-\r\n`if (nRelevantServices & ~pfrom->nServices) {`\r\n\r\nany objections?",
      "commit_id" : "817c19c6cb3c27e2d33db17be06af3e60dc0fc71",
      "created_at" : "2016-09-01T07:09:17Z",
      "diff_hunk" : "@@ -4977,6 +4958,37 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n             return true;\n         }\n \n+        string remoteAddr;\n+        if (fLogIPs)\n+            remoteAddr = \", peeraddr=\" + pfrom->addr.ToString();\n+\n+        LogPrintf(\"receive version message: %s: version %d, blocks=%d, us=%s, peer=%d%s\\n\",\n+                  pfrom->cleanSubVer, pfrom->nVersion,\n+                  pfrom->nStartingHeight, addrMe.ToString(), pfrom->id,\n+                  remoteAddr);\n+\n+        if (pfrom->nServicesExpected != pfrom->nServices) {\n+            LogPrint(\"net\", \"peer=%d does not offer the expected services (%08x offered, %08x expected)\", pfrom->id, pfrom->nServices, pfrom->nServicesExpected);\n+            if (pfrom->nServicesExpected & nRelevantServices & ~pfrom->nServices) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8622#discussion_r77123930",
      "id" : 77123930,
      "original_commit_id" : "817c19c6cb3c27e2d33db17be06af3e60dc0fc71",
      "original_position" : 41,
      "path" : "src/main.cpp",
      "position" : 41,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8622",
      "updated_at" : "2016-09-01T07:11:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/77123930",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "I don't understand what you're trying to fix here.\n",
      "created_at" : "2016-09-01T07:44:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8622#issuecomment-244001766",
      "id" : 244001766,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8622",
      "updated_at" : "2016-09-01T07:44:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/244001766",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "No, as mentioned elsewhere, we definitely can connect to nodes that do not advertize all relevant service bits. Please stop trying find ways to change this before understanding the intention.",
      "created_at" : "2016-09-01T08:02:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8622#issuecomment-244005575",
      "id" : 244005575,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8622",
      "updated_at" : "2016-09-01T08:02:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/244005575",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
