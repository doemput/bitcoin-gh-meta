[
   {
      "body" : "Impressive changeset!\r\nGeneral Concept ACK.\r\n\r\nInstead of the extending the RPC auth, I could imaging using different RPC endpoints would also work.\r\n* Accessing RPC at `/` would result in the default wallet.\r\n* Accessing RPC at `/<walletid>` would result in using the wallet with the id `<walletid>`.\r\n\r\nbitcoin-cli could just support a new argument `-walletid`.\r\nSomething like `bitcoin-cli -walletid=something getbalance` would result in the same RPC call just against the endpoint `/something`.\r\nMaybe this would result in a simple RPC access to the multiple wallets.\r\n\r\nWill review soon.",
      "created_at" : "2016-09-10T06:54:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-246095336",
      "id" : 246095336,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2016-09-10T06:54:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/246095336",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "> Instead of the extending the RPC auth, I could imaging using different RPC endpoints would also work.\r\n\r\nIndeed, although my main purpose in doing this was to isolate JoinMarket, and it's less isolated if it has auth to my real hotwallet. :)\r\n\r\n(Also, endpoints seemed like they'd require more code.)\r\n\r\n> Accessing RPC at `/<walletid>` would result in using the wallet with the id `<walletid>`.\r\n\r\nThis isn't very future-proof. If we go this route, I'd suggest `/?wallet=<walletid>`",
      "created_at" : "2016-09-10T10:22:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-246104190",
      "id" : 246104190,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2016-09-10T10:22:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/246104190",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Nice, Concept ACK. Will test.",
      "created_at" : "2016-09-14T21:21:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-247158244",
      "id" : 247158244,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2016-09-14T21:21:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/247158244",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7275704?v=3",
         "events_url" : "https://api.github.com/users/btcdrak/events{/privacy}",
         "followers_url" : "https://api.github.com/users/btcdrak/followers",
         "following_url" : "https://api.github.com/users/btcdrak/following{/other_user}",
         "gists_url" : "https://api.github.com/users/btcdrak/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/btcdrak",
         "id" : 7275704,
         "login" : "btcdrak",
         "organizations_url" : "https://api.github.com/users/btcdrak/orgs",
         "received_events_url" : "https://api.github.com/users/btcdrak/received_events",
         "repos_url" : "https://api.github.com/users/btcdrak/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/btcdrak/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/btcdrak/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/btcdrak"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r79791358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/79791358"
         }
      },
      "body" : "I like the approach by @jonasschnelli better. Let's keep most of the multiwallet logic in `wallet.cpp`.\n",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2016-09-21T09:17:28Z",
      "diff_hunk" : "@@ -196,8 +196,9 @@ void Shutdown()\n     StopRPC();\n     StopHTTPServer();\n #ifdef ENABLE_WALLET\n-    if (pwalletMain)\n-        pwalletMain->Flush(false);\n+    for (CWallet_ptr pwallet : vpwallets) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r79791358",
      "id" : 79791358,
      "original_commit_id" : "996948af12b418562cbc2d29c1d7f9d8b9ca2a46",
      "original_position" : 6,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 912360,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/79791358",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "Rebased, but please prioritise #8775 review (which this is based on) first. Once that's merged, it may or may not make sense to split the Qt changes out of this.",
      "created_at" : "2017-01-03T22:48:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-270247894",
      "id" : 270247894,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-01-03T22:48:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/270247894",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Concept ACK.\r\n\r\nSyntax for the auth field should have a clear way to extend it to support a list of wallets (first being the default, I guess).  I think.  To support things like the path selected wallets suggested above later.",
      "created_at" : "2017-01-07T15:31:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-271090119",
      "id" : 271090119,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-01-07T15:35:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271090119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Moved RPC/GUI changes out of this, and rebased.",
      "created_at" : "2017-02-03T05:10:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-277166185",
      "id" : 277166185,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-02-03T05:10:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/277166185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104261222"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104261222"
         }
      },
      "body" : "It's not in `wallet.cpp` now. Moving it there seems like a good idea, but independent of this PR...",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-03T23:09:58Z",
      "diff_hunk" : "@@ -196,8 +196,9 @@ void Shutdown()\n     StopRPC();\n     StopHTTPServer();\n #ifdef ENABLE_WALLET\n-    if (pwalletMain)\n-        pwalletMain->Flush(false);\n+    for (CWallet_ptr pwallet : vpwallets) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104261222",
      "id" : 104261222,
      "original_commit_id" : "996948af12b418562cbc2d29c1d7f9d8b9ca2a46",
      "original_position" : 6,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 25090434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104261222",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Rebased and now the next-step in multiwallet integration.",
      "created_at" : "2017-03-04T03:54:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-284124924",
      "id" : 284124924,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-04T03:54:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/284124924",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Re-Concept ACK.\r\nBinaries to play with: https://bitcoin.jonasschnelli.ch/build/PR/8694",
      "created_at" : "2017-03-06T08:34:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-284332981",
      "id" : 284332981,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-06T09:57:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/284332981",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104459247"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104459247"
         }
      },
      "body" : "Curious, why have a `CWallet_ptr` typedef instead of using `CWallet *`? Is there a plan to switch to a different type of pointer later? Curious, because this seems to make the rest of the code more opaque. For example:\r\n\r\n```\r\nfor (CWallet_ptr pwallet : vpwallets)\r\n```\r\n\r\nBecause this says `CWallet_ptr` instead of `CWallet*` it's unclear whether the copy initialization has extra cost (which it would for a shared_ptr), implying a const reference should be used instead.\r\n",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-06T16:37:12Z",
      "diff_hunk" : "@@ -31,7 +31,8 @@\n #include <boost/shared_ptr.hpp>\n #include <boost/thread.hpp>\n \n-extern CWallet* pwalletMain;\n+typedef CWallet* CWallet_ptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104459247",
      "id" : 104459247,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 25297921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104459247",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104467005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104467005"
         }
      },
      "body" : "This thread is created from the non-static method `CWallet::postInitProcess`, so it seems like it makes more sense for it to continue flushing a single wallet, rather than going through the global wallets list. Instead of looping and accessing the global `vpwallet` variable, `ThreadFlushWalletDB` could just take a new `CWallet* pwallet` argument and be invoked with:\r\n\r\n```\r\nthreadGroup.create_thread([this](){ThreadFlushWalletDB(this);});\r\n```\r\n\r\nfrom `CWallet::postInitProcess`.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-06T17:07:04Z",
      "diff_hunk" : "@@ -819,21 +819,23 @@ void ThreadFlushWalletDB()\n                 if (nRefCount == 0)\n                 {\n                     boost::this_thread::interruption_point();\n-                    const std::string& strFile = pwalletMain->strWalletFile;\n-                    map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n-                    if (_mi != bitdb.mapFileUseCount.end())\n-                    {\n-                        LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n-                        nLastFlushed = CWalletDB::GetUpdateCounter();\n-                        int64_t nStart = GetTimeMillis();\n-\n-                        // Flush wallet file so it's self contained\n-                        bitdb.CloseDb(strFile);\n-                        bitdb.CheckpointLSN(strFile);\n-\n-                        bitdb.mapFileUseCount.erase(_mi++);\n-                        LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                    for (CWallet_ptr pwallet : vpwallets) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104467005",
      "id" : 104467005,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 18,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 25297921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104467005",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104467401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104467401"
         }
      },
      "body" : "How come the `nLastFlushed` assignment is moving ouside of the `_mi != bitdb.mapFileUseCount.end()` condition? It seems unrelated to this change. Maybe a code comment explaining the assignment would be good here.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-06T17:08:37Z",
      "diff_hunk" : "@@ -819,21 +819,23 @@ void ThreadFlushWalletDB()\n                 if (nRefCount == 0)\n                 {\n                     boost::this_thread::interruption_point();\n-                    const std::string& strFile = pwalletMain->strWalletFile;\n-                    map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n-                    if (_mi != bitdb.mapFileUseCount.end())\n-                    {\n-                        LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n-                        nLastFlushed = CWalletDB::GetUpdateCounter();\n-                        int64_t nStart = GetTimeMillis();\n-\n-                        // Flush wallet file so it's self contained\n-                        bitdb.CloseDb(strFile);\n-                        bitdb.CheckpointLSN(strFile);\n-\n-                        bitdb.mapFileUseCount.erase(_mi++);\n-                        LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                    for (CWallet_ptr pwallet : vpwallets) {\n+                        const std::string& strFile = pwallet->strWalletFile;\n+                        map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n+                        if (_mi != bitdb.mapFileUseCount.end())\n+                        {\n+                            LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n+                            int64_t nStart = GetTimeMillis();\n+\n+                            // Flush wallet file so it's self contained\n+                            bitdb.CloseDb(strFile);\n+                            bitdb.CheckpointLSN(strFile);\n+\n+                            bitdb.mapFileUseCount.erase(_mi++);\n+                            LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                        }\n                     }\n+                    nLastFlushed = CWalletDB::GetUpdateCounter();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104467401",
      "id" : 104467401,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 34,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 25297921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104467401",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104522825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104522825"
         }
      },
      "body" : "Indeed, a shared_ptr or similar would be needed for when/if we add the ability to close wallets at runtime.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-06T21:08:54Z",
      "diff_hunk" : "@@ -31,7 +31,8 @@\n #include <boost/shared_ptr.hpp>\n #include <boost/thread.hpp>\n \n-extern CWallet* pwalletMain;\n+typedef CWallet* CWallet_ptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104522825",
      "id" : 104522825,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 25364181,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104522825",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104523089"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104523089"
         }
      },
      "body" : "Having a dedicated thread per wallet is just needlessly inefficient.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-06T21:10:00Z",
      "diff_hunk" : "@@ -819,21 +819,23 @@ void ThreadFlushWalletDB()\n                 if (nRefCount == 0)\n                 {\n                     boost::this_thread::interruption_point();\n-                    const std::string& strFile = pwalletMain->strWalletFile;\n-                    map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n-                    if (_mi != bitdb.mapFileUseCount.end())\n-                    {\n-                        LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n-                        nLastFlushed = CWalletDB::GetUpdateCounter();\n-                        int64_t nStart = GetTimeMillis();\n-\n-                        // Flush wallet file so it's self contained\n-                        bitdb.CloseDb(strFile);\n-                        bitdb.CheckpointLSN(strFile);\n-\n-                        bitdb.mapFileUseCount.erase(_mi++);\n-                        LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                    for (CWallet_ptr pwallet : vpwallets) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104523089",
      "id" : 104523089,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 18,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 25364459,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104523089",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104523568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104523568"
         }
      },
      "body" : "Because the condition is per-wallet. Maybe nLastFlushed ought to be as well...?",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-06T21:12:16Z",
      "diff_hunk" : "@@ -819,21 +819,23 @@ void ThreadFlushWalletDB()\n                 if (nRefCount == 0)\n                 {\n                     boost::this_thread::interruption_point();\n-                    const std::string& strFile = pwalletMain->strWalletFile;\n-                    map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n-                    if (_mi != bitdb.mapFileUseCount.end())\n-                    {\n-                        LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n-                        nLastFlushed = CWalletDB::GetUpdateCounter();\n-                        int64_t nStart = GetTimeMillis();\n-\n-                        // Flush wallet file so it's self contained\n-                        bitdb.CloseDb(strFile);\n-                        bitdb.CheckpointLSN(strFile);\n-\n-                        bitdb.mapFileUseCount.erase(_mi++);\n-                        LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                    for (CWallet_ptr pwallet : vpwallets) {\n+                        const std::string& strFile = pwallet->strWalletFile;\n+                        map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n+                        if (_mi != bitdb.mapFileUseCount.end())\n+                        {\n+                            LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n+                            int64_t nStart = GetTimeMillis();\n+\n+                            // Flush wallet file so it's self contained\n+                            bitdb.CloseDb(strFile);\n+                            bitdb.CheckpointLSN(strFile);\n+\n+                            bitdb.mapFileUseCount.erase(_mi++);\n+                            LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                        }\n                     }\n+                    nLastFlushed = CWalletDB::GetUpdateCounter();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r104523568",
      "id" : 104523568,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 34,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 25364997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/104523568",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "(needs another rebase)",
      "created_at" : "2017-03-08T17:00:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285100437",
      "id" : 285100437,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-08T17:00:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285100437",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Added 0.15.0 milestone.",
      "created_at" : "2017-03-09T09:22:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285298597",
      "id" : 285298597,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-09T09:22:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285298597",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105283157"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105283157"
         }
      },
      "body" : "Sanitised this better in the rebase",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-09T22:07:20Z",
      "diff_hunk" : "@@ -819,21 +819,23 @@ void ThreadFlushWalletDB()\n                 if (nRefCount == 0)\n                 {\n                     boost::this_thread::interruption_point();\n-                    const std::string& strFile = pwalletMain->strWalletFile;\n-                    map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n-                    if (_mi != bitdb.mapFileUseCount.end())\n-                    {\n-                        LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n-                        nLastFlushed = CWalletDB::GetUpdateCounter();\n-                        int64_t nStart = GetTimeMillis();\n-\n-                        // Flush wallet file so it's self contained\n-                        bitdb.CloseDb(strFile);\n-                        bitdb.CheckpointLSN(strFile);\n-\n-                        bitdb.mapFileUseCount.erase(_mi++);\n-                        LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                    for (CWallet_ptr pwallet : vpwallets) {\n+                        const std::string& strFile = pwallet->strWalletFile;\n+                        map<string, int>::iterator _mi = bitdb.mapFileUseCount.find(strFile);\n+                        if (_mi != bitdb.mapFileUseCount.end())\n+                        {\n+                            LogPrint(\"db\", \"Flushing %s\\n\", strFile);\n+                            int64_t nStart = GetTimeMillis();\n+\n+                            // Flush wallet file so it's self contained\n+                            bitdb.CloseDb(strFile);\n+                            bitdb.CheckpointLSN(strFile);\n+\n+                            bitdb.mapFileUseCount.erase(_mi++);\n+                            LogPrint(\"db\", \"Flushed %s %dms\\n\", strFile, GetTimeMillis() - nStart);\n+                        }\n                     }\n+                    nLastFlushed = CWalletDB::GetUpdateCounter();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105283157",
      "id" : 105283157,
      "original_commit_id" : "0d348d5a5646cf9c522896a297538b7d1ec1509f",
      "original_position" : 34,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 26157122,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105283157",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Significantly rebased. Also fixed minor race conditions surrounding wallet flush (it was bumping the \"have update to flush\" counter before doing the actual update).",
      "created_at" : "2017-03-09T22:08:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285499326",
      "id" : 285499326,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-09T22:08:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285499326",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "It would be preferable to increment the update counter after committing a database transaction, not after every call to a CWalletDB method.\r\nSo this would mean the destructor of `CWalletDB` and `TxnCommit()` . Which should be overridden in CWalletDB, or alternatively use composition not inheritance for CDB as I've done in the last commit in #9951.\r\nThis will simplify these changes (no need to do WriteIC/EraseIC everywhere), as well as makes sure that only changes that actually hit the database/disk are counted.\r\n",
      "created_at" : "2017-03-10T07:40:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285599692",
      "id" : 285599692,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-10T07:40:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285599692",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105344494"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105344494"
         }
      },
      "body" : "I think it is confusing for a \"Set\" function to add something to a list. If anything it should replace it.\r\nWhat do you need this for, specifically?\r\nIn the past I've defined [SoftSetMultiArg](https://github.com/laanwj/bitcoin/commit/1024183eff629b758745aa7ebf9329d987179644) to be able to define a whole list argument at once.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-10T07:44:19Z",
      "diff_hunk" : "@@ -418,6 +418,7 @@ bool SoftSetArg(const std::string& strArg, const std::string& strValue)\n     if (mapArgs.count(strArg))\n         return false;\n     mapArgs[strArg] = strValue;\n+    _mapMultiArgs[strArg].push_back(strValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105344494",
      "id" : 105344494,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/util.cpp",
      "position" : null,
      "pull_request_review_id" : 26220683,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105344494",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105344527"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105344527"
         }
      },
      "body" : "Why define pwalletMain here?",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-10T07:44:40Z",
      "diff_hunk" : "@@ -8,6 +8,8 @@\n #include \"wallet/db.h\"\n #include \"wallet/wallet.h\"\n \n+CWallet *pwalletMain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105344527",
      "id" : 105344527,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/wallet/test/wallet_test_fixture.cpp",
      "position" : 4,
      "pull_request_review_id" : 26220719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105344527",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "I think the overall approach here is good. This is another step towards multi-wallet support. As it's not anywhere on the API yet, I guess it's too early to ask for a multiwallet test?",
      "created_at" : "2017-03-10T07:46:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285600713",
      "id" : 285600713,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-10T07:46:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285600713",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105443469"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105443469"
         }
      },
      "body" : "It can't get here unless the list is currently empty. It's used to initialise `-wallet`, which is accessed as a list only now.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-10T17:16:56Z",
      "diff_hunk" : "@@ -418,6 +418,7 @@ bool SoftSetArg(const std::string& strArg, const std::string& strValue)\n     if (mapArgs.count(strArg))\n         return false;\n     mapArgs[strArg] = strValue;\n+    _mapMultiArgs[strArg].push_back(strValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105443469",
      "id" : 105443469,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/util.cpp",
      "position" : null,
      "pull_request_review_id" : 26328271,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105443469",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105443597"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105443597"
         }
      },
      "body" : "There's no need to modify the tests to use vpwallets in most cases?",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-10T17:17:36Z",
      "diff_hunk" : "@@ -8,6 +8,8 @@\n #include \"wallet/db.h\"\n #include \"wallet/wallet.h\"\n \n+CWallet *pwalletMain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105443597",
      "id" : 105443597,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/wallet/test/wallet_test_fixture.cpp",
      "position" : 4,
      "pull_request_review_id" : 26328413,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105443597",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "> It would be preferable to increment the update counter after committing a database transaction, not after every call to a CWalletDB method.\r\n\r\nIMO too much for this PR. Just trying to multiwallet here, not refactor stuff that doesn't need it. :)",
      "created_at" : "2017-03-10T17:20:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285729345",
      "id" : 285729345,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-10T17:20:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285729345",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105449231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105449231"
         }
      },
      "body" : "In commit \"Wallet: Replace pwalletMain with a vector of wallet pointers\":\r\n\r\nMaybe add a TODO comment for updating the tests to stop referencing pwalletMain, since this will be confusing to someone seeing this who isn't familiar with the pre-multiwallet history of the code.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-10T17:44:04Z",
      "diff_hunk" : "@@ -8,6 +8,8 @@\n #include \"wallet/db.h\"\n #include \"wallet/wallet.h\"\n \n+CWallet *pwalletMain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105449231",
      "id" : 105449231,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/wallet/test/wallet_test_fixture.cpp",
      "position" : 4,
      "pull_request_review_id" : 26334485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105449231",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105457768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105457768"
         }
      },
      "body" : "Depends on the reason why they are setting pwalletMain. Generally that is to communicate with stuff in wallet.cpp/walletdb.cpp I'd say.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-10T18:24:08Z",
      "diff_hunk" : "@@ -8,6 +8,8 @@\n #include \"wallet/db.h\"\n #include \"wallet/wallet.h\"\n \n+CWallet *pwalletMain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105457768",
      "id" : 105457768,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/wallet/test/wallet_test_fixture.cpp",
      "position" : 4,
      "pull_request_review_id" : 26343423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105457768",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> IMO too much for this PR. Just trying to multiwallet here, not refactor stuff that doesn't need it. :)\r\n\r\nMaybe my recommendation goes to far but I just think your current approach there is messy. The mutator functions call `WriteIC`/`EraseIC` which call `IncrementUpdateCounter` which calls `IncrementUpdateCounter(strFile)` which indexes into a global map indexed by name. This makes the wallet code even more complex and hard to understand as it introduces another place where per-wallet(-database) information is stored.\r\n\r\nWe need to decide whether CWalletDBStateInfo belongs with the database wrapper, or with the wallet.\r\n\r\n- If it is part of the database statistics side of things, the place to put it would be CDBEnv, with the other maps `mapFileUseCount` and `mapDb`. After #9951 I'm going to refactor these to put them on a CDBWrapper object which represents a single database.\r\n- If it is specific to wallets, the structure could be put on CWallet, and a reference passed in where it is needed (e.g. to CWalletDB) instead of looking it up all the time. This makes the CWallet more self-contained.",
      "created_at" : "2017-03-10T18:36:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285748918",
      "id" : 285748918,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-10T18:36:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285748918",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105461051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105461051"
         }
      },
      "body" : "In commit \"Bugfix: wallet: Increment \"update counter\" only after actually making the applicable db changes to avoid potential races\":\r\n\r\nI'm probably missing something, but if the first write above succeeds and second write fails, the counter won't be incremented. Is this wrong? Would a possible fix be to drop this line and replace all the Write/Erases above with WriteIC/EraseIC?",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-10T18:39:55Z",
      "diff_hunk" : "@@ -103,42 +94,40 @@ bool CWalletDB::WriteCryptedKey(const CPubKey& vchPubKey,\n         Erase(std::make_pair(std::string(\"key\"), vchPubKey));\n         Erase(std::make_pair(std::string(\"wkey\"), vchPubKey));\n     }\n+\n+    IncrementUpdateCounter();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105461051",
      "id" : 105461051,
      "original_commit_id" : "f1052c224c9ea7699dac4d2fba988b3a8ef2224b",
      "original_position" : 75,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 26334485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105461051",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105461805"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105461805"
         }
      },
      "body" : "In commit \"Bugfix: wallet: Increment \"update counter\" only after actually making the applicable db changes to avoid potential races\":\r\n\r\nIt seems good not to increment the counter when a write or erase fails. But I don't understand what the \"potential races\" are that could happen if the counter is incremented regardless. If you could clarify / expand the commit message on this point, I think that would be helpful.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-10T18:44:00Z",
      "diff_hunk" : "@@ -32,46 +32,38 @@ static std::atomic<unsigned int> nWalletDBUpdateCounter;\n \n bool CWalletDB::WriteName(const std::string& strAddress, const std::string& strName)\n {\n-    nWalletDBUpdateCounter++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105461805",
      "id" : 105461805,
      "original_commit_id" : "f1052c224c9ea7699dac4d2fba988b3a8ef2224b",
      "original_position" : 4,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 14,
      "pull_request_review_id" : 26334485,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105461805",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105520211"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105520211"
         }
      },
      "body" : "1. (thread 1) Increment the counter.\r\n2. (thread 2) DB gets flushed\r\n3. (thread 1) Actual change happens.\r\n4. (thread 2) Thinks DB hasn't changed, so doesn't flush again.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-11T01:25:50Z",
      "diff_hunk" : "@@ -32,46 +32,38 @@ static std::atomic<unsigned int> nWalletDBUpdateCounter;\n \n bool CWalletDB::WriteName(const std::string& strAddress, const std::string& strName)\n {\n-    nWalletDBUpdateCounter++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105520211",
      "id" : 105520211,
      "original_commit_id" : "f1052c224c9ea7699dac4d2fba988b3a8ef2224b",
      "original_position" : 4,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 14,
      "pull_request_review_id" : 26410271,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105520211",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105520237"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105520237"
         }
      },
      "body" : "Hmm, not sure what we want to happen in that case...",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-11T01:26:25Z",
      "diff_hunk" : "@@ -103,42 +94,40 @@ bool CWalletDB::WriteCryptedKey(const CPubKey& vchPubKey,\n         Erase(std::make_pair(std::string(\"key\"), vchPubKey));\n         Erase(std::make_pair(std::string(\"wkey\"), vchPubKey));\n     }\n+\n+    IncrementUpdateCounter();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105520237",
      "id" : 105520237,
      "original_commit_id" : "f1052c224c9ea7699dac4d2fba988b3a8ef2224b",
      "original_position" : 75,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 26410301,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105520237",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "@laanwj I agree that stuff should be refactored, but I don't think multiwallet needs to depend on it here.\r\n\r\n(Why is CWalletDB not just a private parent class of CWallet anyway?)",
      "created_at" : "2017-03-11T01:27:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285828510",
      "id" : 285828510,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-11T01:27:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285828510",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105528436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105528436"
         }
      },
      "body" : "This is one of the reasons why I suggested above to only update the update counter if a DB transaction actually hits the database. That's more robust than doing it per operation. It's possible for all the operations to succeed then TxnAbort() to be called and still no update happens.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-11T07:42:29Z",
      "diff_hunk" : "@@ -103,42 +94,40 @@ bool CWalletDB::WriteCryptedKey(const CPubKey& vchPubKey,\n         Erase(std::make_pair(std::string(\"key\"), vchPubKey));\n         Erase(std::make_pair(std::string(\"wkey\"), vchPubKey));\n     }\n+\n+    IncrementUpdateCounter();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r105528436",
      "id" : 105528436,
      "original_commit_id" : "f1052c224c9ea7699dac4d2fba988b3a8ef2224b",
      "original_position" : 75,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 26417967,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/105528436",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> (Why is CWalletDB not just a private parent class of CWallet anyway?)\r\n\r\n- It's named wrongly. Because CWalletDB is not a database, it provides access to it. To be exact, it is a database transaction, similar to the CDBBatch in leveldbwrapper.h. It is commited when the object goes out of scope or `TxnCommit()` is called. It is not committed if `TxnAbort()` is called.\r\n- Should at least use composition there not inheritance. A wallet *uses* a wallet database, it *is* not a wallet database. This avoids low-level implementation details from leaking through.\r\n\r\n> I agree that stuff should be refactored, but I don't think multiwallet needs to depend on it here.\r\n\r\nAs said I understand that. I'm not asking for you to do big changes. I just don't want it to become even worse and more muddled. \r\n\r\nI might pick this up myself if I have some time next week.",
      "created_at" : "2017-03-11T07:47:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-285850854",
      "id" : 285850854,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-03-11T08:48:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/285850854",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r107046358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/107046358"
         }
      },
      "body" : "Why typedef this? Its literally /more/ characters now.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-21T00:03:11Z",
      "diff_hunk" : "@@ -30,7 +30,8 @@\n \n #include <boost/shared_ptr.hpp>\n \n-extern CWallet* pwalletMain;\n+typedef CWallet* CWallet_ptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r107046358",
      "id" : 107046358,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 27996392,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/107046358",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r107046516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/107046516"
         }
      },
      "body" : "Don't you still need to delete each wallet here?",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-21T00:04:28Z",
      "diff_hunk" : "@@ -256,8 +258,7 @@ void Shutdown()\n #endif\n     UnregisterAllValidationInterfaces();\n #ifdef ENABLE_WALLET\n-    delete pwalletMain;\n-    pwalletMain = NULL;\n+    vpwallets.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r107046516",
      "id" : 107046516,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 30,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 27996392,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/107046516",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r107046936"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/107046936"
         }
      },
      "body" : "I believe this is also not correct - other threads may be using mapMultiArgs or the vector in it at the same time",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-21T00:07:31Z",
      "diff_hunk" : "@@ -418,6 +418,7 @@ bool SoftSetArg(const std::string& strArg, const std::string& strValue)\n     if (mapArgs.count(strArg))\n         return false;\n     mapArgs[strArg] = strValue;\n+    _mapMultiArgs[strArg].push_back(strValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r107046936",
      "id" : 107046936,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/util.cpp",
      "position" : null,
      "pull_request_review_id" : 27996392,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/107046936",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r108462865"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108462865"
         }
      },
      "body" : "Maybe get @jtimon to do it in #9494 and then just use it here?",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-03-28T15:58:43Z",
      "diff_hunk" : "@@ -418,6 +418,7 @@ bool SoftSetArg(const std::string& strArg, const std::string& strValue)\n     if (mapArgs.count(strArg))\n         return false;\n     mapArgs[strArg] = strValue;\n+    _mapMultiArgs[strArg].push_back(strValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r108462865",
      "id" : 108462865,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/util.cpp",
      "position" : null,
      "pull_request_review_id" : 29494953,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/108462865",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111102248"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111102248"
         }
      },
      "body" : "Typedef-ing a pointer type doesn't seem that useful to me either. I suppose the rationale is \"what if we want to change it to e.g. std::shared_ptr later\". But a) I think the code is more readable if the kind of pointer is clear from the function/struct/class signatures using it b) You might want to have different kinds of pointers to the same kind of objects in different places.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-12T09:23:47Z",
      "diff_hunk" : "@@ -30,7 +30,8 @@\n \n #include <boost/shared_ptr.hpp>\n \n-extern CWallet* pwalletMain;\n+typedef CWallet* CWallet_ptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111102248",
      "id" : 111102248,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 32321662,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111102248",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111106307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111106307"
         }
      },
      "body" : "I throwing an RPC error like `RPC_METHOD_NOT_FOUND` is better than returning `NULL`.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-12T09:42:28Z",
      "diff_hunk" : "@@ -29,7 +29,8 @@\n \n CWallet *GetWalletForJSONRPCRequest(const JSONRPCRequest& request)\n {\n-    return pwalletMain;\n+    // TODO: Some way to access secondary wallets",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111106307",
      "id" : 111106307,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 5,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 32325933,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111106307",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111106832"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111106832"
         }
      },
      "body" : "`vpwallets.clear()` ?\r\n\r\nEDIT: Meh, not really needed, just thought it would be more coherent.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-12T09:45:07Z",
      "diff_hunk" : "@@ -3724,24 +3734,17 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n bool CWallet::InitLoadWallet()\n {\n     if (GetBoolArg(\"-disablewallet\", DEFAULT_DISABLE_WALLET)) {\n-        pwalletMain = NULL;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111106832",
      "id" : 111106832,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 90,
      "path" : "src/wallet/wallet.cpp",
      "position" : 93,
      "pull_request_review_id" : 32326488,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111106832",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111107294"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111107294"
         }
      },
      "body" : "not sure it make sense either, but if it is done, better naming it to `CWalletRef` to be consistent with `CTransactionRef`",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-12T09:47:31Z",
      "diff_hunk" : "@@ -30,7 +30,8 @@\n \n #include <boost/shared_ptr.hpp>\n \n-extern CWallet* pwalletMain;\n+typedef CWallet* CWallet_ptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111107294",
      "id" : 111107294,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 5,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 32327016,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111107294",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "body" : "not blocking, but I think a `CWallets` instead of `vpwallets` it would make the code way easier to read and less error prone.\r\nWould also make locking easier to get right, and preventing some loop.\r\n\r\nIt would impact:\r\n```\r\nstd::map<std::string, CWalletDBStateInfo> WalletDBStateInfos\r\nstd::vector<CWallet_ptr> vpwallets;\r\nIncrementUpdateCounter()\r\n```\r\nThat said, this can be done in a separate PR.\r\n",
      "created_at" : "2017-04-12T09:54:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-293529526",
      "id" : 293529526,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-04-12T09:54:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/293529526",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/3020646?v=3",
         "events_url" : "https://api.github.com/users/NicolasDorier/events{/privacy}",
         "followers_url" : "https://api.github.com/users/NicolasDorier/followers",
         "following_url" : "https://api.github.com/users/NicolasDorier/following{/other_user}",
         "gists_url" : "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/NicolasDorier",
         "id" : 3020646,
         "login" : "NicolasDorier",
         "organizations_url" : "https://api.github.com/users/NicolasDorier/orgs",
         "received_events_url" : "https://api.github.com/users/NicolasDorier/received_events",
         "repos_url" : "https://api.github.com/users/NicolasDorier/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/NicolasDorier/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/NicolasDorier"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111109013"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111109013"
         }
      },
      "body" : "> It can't get here unless the list is currently empty.\r\n\r\nGood point",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-12T09:55:52Z",
      "diff_hunk" : "@@ -418,6 +418,7 @@ bool SoftSetArg(const std::string& strArg, const std::string& strValue)\n     if (mapArgs.count(strArg))\n         return false;\n     mapArgs[strArg] = strValue;\n+    _mapMultiArgs[strArg].push_back(strValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111109013",
      "id" : 111109013,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/util.cpp",
      "position" : null,
      "pull_request_review_id" : 32328960,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111109013",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111109604"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111109604"
         }
      },
      "body" : "s/NULL/nullptr?",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-12T09:58:42Z",
      "diff_hunk" : "@@ -29,7 +29,8 @@\n \n CWallet *GetWalletForJSONRPCRequest(const JSONRPCRequest& request)\n {\n-    return pwalletMain;\n+    // TODO: Some way to access secondary wallets\n+    return vpwallets.empty() ? NULL : vpwallets[0];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111109604",
      "id" : 111109604,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 6,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : null,
      "pull_request_review_id" : 32329623,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111109604",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111113071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111113071"
         }
      },
      "body" : "`walletFile.find_first_of(\"/\\\\\")` is not portable. Likely, boost::filesystem::path has a way to check a path for path separators.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-12T10:17:36Z",
      "diff_hunk" : "@@ -442,30 +442,40 @@ bool CWallet::Verify()\n     if (GetBoolArg(\"-disablewallet\", DEFAULT_DISABLE_WALLET))\n         return true;\n \n+    SoftSetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n+\n     uiInterface.InitMessage(_(\"Verifying wallet...\"));\n-    std::string walletFile = GetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n \n-    std::string strError;\n-    if (!CWalletDB::VerifyEnvironment(walletFile, GetDataDir().string(), strError))\n-        return InitError(strError);\n+    for (const std::string& walletFile : mapMultiArgs.at(\"-wallet\")) {\n+        if (walletFile.find_first_of(\"/\\\\\") != std::string::npos) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111113071",
      "id" : 111113071,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 22,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 32333487,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111113071",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111972028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111972028"
         }
      },
      "body" : "I agree, but it's outside the scope of this PR. For now, I'll just increment the counter more aggressively (merely reordering the increment to fix the race issue).",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-18T14:41:59Z",
      "diff_hunk" : "@@ -103,42 +94,40 @@ bool CWalletDB::WriteCryptedKey(const CPubKey& vchPubKey,\n         Erase(std::make_pair(std::string(\"key\"), vchPubKey));\n         Erase(std::make_pair(std::string(\"wkey\"), vchPubKey));\n     }\n+\n+    IncrementUpdateCounter();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111972028",
      "id" : 111972028,
      "original_commit_id" : "f1052c224c9ea7699dac4d2fba988b3a8ef2224b",
      "original_position" : 75,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 33251234,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111972028",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111973532"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111973532"
         }
      },
      "body" : "It is not always an error for there to be no wallet (eg, signrawtransaction).",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-18T14:47:22Z",
      "diff_hunk" : "@@ -29,7 +29,8 @@\n \n CWallet *GetWalletForJSONRPCRequest(const JSONRPCRequest& request)\n {\n-    return pwalletMain;\n+    // TODO: Some way to access secondary wallets",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111973532",
      "id" : 111973532,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 5,
      "path" : "src/wallet/rpcwallet.cpp",
      "position" : 5,
      "pull_request_review_id" : 33252999,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111973532",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111981623"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111981623"
         }
      },
      "body" : "```C++\r\n        boost::filesystem::path walletFileBoost = walletFile;\r\n        if (walletFileBoost.has_root_path() || walletFileBoost.has_parent_path()) {\r\n```\r\n\r\nThis would work, but off-topic here since this is existing code.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-18T15:15:30Z",
      "diff_hunk" : "@@ -442,30 +442,40 @@ bool CWallet::Verify()\n     if (GetBoolArg(\"-disablewallet\", DEFAULT_DISABLE_WALLET))\n         return true;\n \n+    SoftSetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n+\n     uiInterface.InitMessage(_(\"Verifying wallet...\"));\n-    std::string walletFile = GetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n \n-    std::string strError;\n-    if (!CWalletDB::VerifyEnvironment(walletFile, GetDataDir().string(), strError))\n-        return InitError(strError);\n+    for (const std::string& walletFile : mapMultiArgs.at(\"-wallet\")) {\n+        if (walletFile.find_first_of(\"/\\\\\") != std::string::npos) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111981623",
      "id" : 111981623,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 22,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 33261811,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111981623",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111981973"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111981973"
         }
      },
      "body" : "@TheBlueMatt I don't see what your concern is... We have the lock here already.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-18T15:16:39Z",
      "diff_hunk" : "@@ -418,6 +418,7 @@ bool SoftSetArg(const std::string& strArg, const std::string& strValue)\n     if (mapArgs.count(strArg))\n         return false;\n     mapArgs[strArg] = strValue;\n+    _mapMultiArgs[strArg].push_back(strValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r111981973",
      "id" : 111981973,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/util.cpp",
      "position" : null,
      "pull_request_review_id" : 33262204,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/111981973",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "In-scope nits addressed and rebased.",
      "created_at" : "2017-04-18T15:17:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-294878238",
      "id" : 294878238,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-04-18T15:17:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/294878238",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r112005561"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112005561"
         }
      },
      "body" : "why clear here? afaik this is only used for unittests now.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-18T16:48:17Z",
      "diff_hunk" : "@@ -484,6 +485,8 @@ void ForceSetArg(const std::string& strArg, const std::string& strValue)\n {\n     LOCK(cs_args);\n     mapArgs[strArg] = strValue;\n+    _mapMultiArgs[strArg].clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r112005561",
      "id" : 112005561,
      "original_commit_id" : "20e5bfc444f736ee466a21fa9c28645e67d7d070",
      "original_position" : 12,
      "path" : "src/util.cpp",
      "position" : null,
      "pull_request_review_id" : 33287575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112005561",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r112024031"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112024031"
         }
      },
      "body" : "So that there's only one value in _mapMultiArgs...",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-18T18:06:02Z",
      "diff_hunk" : "@@ -484,6 +485,8 @@ void ForceSetArg(const std::string& strArg, const std::string& strValue)\n {\n     LOCK(cs_args);\n     mapArgs[strArg] = strValue;\n+    _mapMultiArgs[strArg].clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r112024031",
      "id" : 112024031,
      "original_commit_id" : "20e5bfc444f736ee466a21fa9c28645e67d7d070",
      "original_position" : 12,
      "path" : "src/util.cpp",
      "position" : null,
      "pull_request_review_id" : 33307464,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/112024031",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r113726806"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113726806"
         }
      },
      "body" : "We do not take the lock when accessing mapMultiArgs all over the codebase. You cannot write a new entry to this map without updating the various locations in the codebase which access mapMultiArgs to also go through cs_args.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-04-27T15:24:37Z",
      "diff_hunk" : "@@ -418,6 +418,7 @@ bool SoftSetArg(const std::string& strArg, const std::string& strValue)\n     if (mapArgs.count(strArg))\n         return false;\n     mapArgs[strArg] = strValue;\n+    _mapMultiArgs[strArg].push_back(strValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r113726806",
      "id" : 113726806,
      "original_commit_id" : "3f096ca2cad68c8bc66a15142dabce28ed8e6998",
      "original_position" : 4,
      "path" : "src/util.cpp",
      "position" : null,
      "pull_request_review_id" : 35140414,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/113726806",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Rebased",
      "created_at" : "2017-05-21T00:42:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-302907619",
      "id" : 302907619,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-05-21T00:42:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/302907619",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r117797621"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117797621"
         }
      },
      "body" : "In commit \"CWalletDB: Store the update counter per wallet\"\r\n\r\nMight be nice to call this member dbw instead of wrapper for consistency with the wallet member.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-22T17:09:16Z",
      "diff_hunk" : "@@ -247,6 +245,7 @@ class CWalletDB\n     bool WriteVersion(int nVersion);\n private:\n     CDB batch;\n+    CWalletDBWrapper& wrapper;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r117797621",
      "id" : 117797621,
      "original_commit_id" : "ca8d241af308ef186786dac80403ed329fbc4172",
      "original_position" : 40,
      "path" : "src/wallet/walletdb.h",
      "position" : null,
      "pull_request_review_id" : 39534562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117797621",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r117798167"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117798167"
         }
      },
      "body" : "In commit \"Bugfix: wallet: Increment \"update counter\" only after actually making the applicable db changes to avoid potential races\"\r\n\r\nWould be helpful to have a comment mentioning that counter should be updated after the write operation, rather than before to prevent a race where the flush thread could run and store the higher counter value before the database is fully updated.\r\n\r\nCould also mention the idea of moving the counter increment to the destructor / commit function so these write and erase wrappers would be unnecessary.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-22T17:12:00Z",
      "diff_hunk" : "@@ -140,6 +140,27 @@ class CKeyMetadata\n  */\n class CWalletDB\n {\n+private:\n+    template <typename K, typename T>\n+    bool WriteIC(const K& key, const T& value, bool fOverwrite = true)\n+    {\n+        if (!batch.Write(key, value, fOverwrite)) {\n+            return false;\n+        }\n+        IncrementUpdateCounter();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r117798167",
      "id" : 117798167,
      "original_commit_id" : "7772f23ad5b1dfe1ed0a3177ef965592ec27f67d",
      "original_position" : 11,
      "path" : "src/wallet/walletdb.h",
      "position" : null,
      "pull_request_review_id" : 39534562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117798167",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r117800249"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117800249"
         }
      },
      "body" : "In commit \"Wallet: Replace pwalletMain with a vector of wallet pointers\"\r\n\r\nIt would be nice if conversion of these values from static variables to per-wallet members happened in the previous commit (\"CWalletDB: Store the update counter per wallet\") instead of this one. Would make both commits easier to follow and avoid the unusual intermediate state where globals and per-wallet members are compared to each other.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-22T17:21:53Z",
      "diff_hunk" : "@@ -122,11 +122,15 @@ class CWalletDBWrapper\n     void IncrementUpdateCounter();\n     unsigned int GetUpdateCounter();\n \n+    std::atomic<unsigned int> nUpdateCounter;\n+    unsigned int nLastSeen;\n+    unsigned int nLastFlushed;\n+    int64_t nLastWalletUpdate;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r117800249",
      "id" : 117800249,
      "original_commit_id" : "68bc5b926fadbe1d904b5138dc299d2dd06fdead",
      "original_position" : 7,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 39534562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117800249",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r117801976"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117801976"
         }
      },
      "body" : "In commit \"Wallet: Replace pwalletMain with a vector of wallet pointers\"\r\n\r\nShould initialize these values.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-22T17:30:01Z",
      "diff_hunk" : "@@ -122,11 +122,15 @@ class CWalletDBWrapper\n     void IncrementUpdateCounter();\n     unsigned int GetUpdateCounter();\n \n+    std::atomic<unsigned int> nUpdateCounter;\n+    unsigned int nLastSeen;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r117801976",
      "id" : 117801976,
      "original_commit_id" : "68bc5b926fadbe1d904b5138dc299d2dd06fdead",
      "original_position" : 5,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 39534562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117801976",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r117802544"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117802544"
         }
      },
      "body" : "In commit \"CWalletDB: Store the update counter per wallet\":\r\n\r\nShould initialize this value.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-22T17:32:57Z",
      "diff_hunk" : "@@ -119,10 +119,14 @@ class CWalletDBWrapper\n      */\n     void Flush(bool shutdown);\n \n+    void IncrementUpdateCounter();\n+    unsigned int GetUpdateCounter();\n+\n private:\n     /** BerkeleyDB specific */\n     CDBEnv *env;\n     std::string strFile;\n+    std::atomic<unsigned int> nUpdateCounter;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r117802544",
      "id" : 117802544,
      "original_commit_id" : "ca8d241af308ef186786dac80403ed329fbc4172",
      "original_position" : 11,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 39534562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117802544",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r117803568"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117803568"
         }
      },
      "body" : "In commit \"CWalletDB: Store the update counter per wallet\"\r\n\r\nMaybe call this dbw for consistency with existing wallet code.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-22T17:37:14Z",
      "diff_hunk" : "@@ -762,20 +760,22 @@ void MaybeCompactWalletDB()\n         return;\n     }\n \n-    static unsigned int nLastSeen = CWalletDB::GetUpdateCounter();\n-    static unsigned int nLastFlushed = CWalletDB::GetUpdateCounter();\n+    CWalletDBWrapper& dbh = pwalletMain->GetDBHandle();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r117803568",
      "id" : 117803568,
      "original_commit_id" : "ca8d241af308ef186786dac80403ed329fbc4172",
      "original_position" : 15,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 39534562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/117803568",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118176576"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118176576"
         }
      },
      "body" : "This redundantly opens/checks the datadir via BDB. Not sure if this is a problem...",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-24T07:03:58Z",
      "diff_hunk" : "@@ -440,30 +440,40 @@ bool CWallet::Verify()\n     if (GetBoolArg(\"-disablewallet\", DEFAULT_DISABLE_WALLET))\n         return true;\n \n+    SoftSetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n+\n     uiInterface.InitMessage(_(\"Verifying wallet...\"));\n-    std::string walletFile = GetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n \n-    std::string strError;\n-    if (!CWalletDB::VerifyEnvironment(walletFile, GetDataDir().string(), strError))\n-        return InitError(strError);\n+    for (const std::string& walletFile : gArgs.GetArgs(\"-wallet\")) {\n+        if (boost::filesystem::path(walletFile).filename() != walletFile) {\n+            return InitError(_(\"-wallet parameter must only specify a filename (not a path)\"));\n+        } else if (SanitizeString(walletFile, SAFE_CHARS_FILENAME) != walletFile) {\n+            return InitError(_(\"Invalid characters in -wallet filename\"));\n+        }\n \n-    if (GetBoolArg(\"-salvagewallet\", false))\n-    {\n-        // Recover readable keypairs:\n-        CWallet dummyWallet;\n-        if (!CWalletDB::Recover(walletFile, (void *)&dummyWallet, CWalletDB::RecoverKeysOnlyFilter))\n+        std::string strError;\n+        if (!CWalletDB::VerifyEnvironment(walletFile, GetDataDir().string(), strError))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118176576",
      "id" : 118176576,
      "original_commit_id" : "96089fffd8d4bea24b83d253e0540b9836bef2ef",
      "original_position" : 34,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 39941364,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118176576",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118183947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118183947"
         }
      },
      "body" : "Without a lock we set the assumption that `vpwallets` is immutable.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-24T07:48:26Z",
      "diff_hunk" : "@@ -785,22 +760,23 @@ void MaybeCompactWalletDB()\n         return;\n     }\n \n-    static unsigned int nLastSeen = CWalletDB::GetUpdateCounter();\n-    static unsigned int nLastFlushed = CWalletDB::GetUpdateCounter();\n-    static int64_t nLastWalletUpdate = GetTime();\n+    for (CWalletRef pwallet : vpwallets) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118183947",
      "id" : 118183947,
      "original_commit_id" : "96089fffd8d4bea24b83d253e0540b9836bef2ef",
      "original_position" : 222,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 229,
      "pull_request_review_id" : 39949204,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118183947",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118184966"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118184966"
         }
      },
      "body" : "nit: using `Verifying wallet(s)...`?",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-24T07:53:54Z",
      "diff_hunk" : "@@ -440,30 +440,40 @@ bool CWallet::Verify()\n     if (GetBoolArg(\"-disablewallet\", DEFAULT_DISABLE_WALLET))\n         return true;\n \n+    SoftSetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n+\n     uiInterface.InitMessage(_(\"Verifying wallet...\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118184966",
      "id" : 118184966,
      "original_commit_id" : "96089fffd8d4bea24b83d253e0540b9836bef2ef",
      "original_position" : 15,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 39950256,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118184966",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118185652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118185652"
         }
      },
      "body" : "This renames an arbitrary wallet name to \"wallet.%d.bak\", collisions may happen.\r\n\r\n`2017-05-24 07:56:04 Renamed test1.dat to wallet.1495612559.bak`",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-24T07:57:40Z",
      "diff_hunk" : "@@ -440,30 +440,40 @@ bool CWallet::Verify()\n     if (GetBoolArg(\"-disablewallet\", DEFAULT_DISABLE_WALLET))\n         return true;\n \n+    SoftSetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n+\n     uiInterface.InitMessage(_(\"Verifying wallet...\"));\n-    std::string walletFile = GetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n \n-    std::string strError;\n-    if (!CWalletDB::VerifyEnvironment(walletFile, GetDataDir().string(), strError))\n-        return InitError(strError);\n+    for (const std::string& walletFile : gArgs.GetArgs(\"-wallet\")) {\n+        if (boost::filesystem::path(walletFile).filename() != walletFile) {\n+            return InitError(_(\"-wallet parameter must only specify a filename (not a path)\"));\n+        } else if (SanitizeString(walletFile, SAFE_CHARS_FILENAME) != walletFile) {\n+            return InitError(_(\"Invalid characters in -wallet filename\"));\n+        }\n \n-    if (GetBoolArg(\"-salvagewallet\", false))\n-    {\n-        // Recover readable keypairs:\n-        CWallet dummyWallet;\n-        if (!CWalletDB::Recover(walletFile, (void *)&dummyWallet, CWalletDB::RecoverKeysOnlyFilter))\n+        std::string strError;\n+        if (!CWalletDB::VerifyEnvironment(walletFile, GetDataDir().string(), strError))\n+            return InitError(strError);\n+\n+        if (GetBoolArg(\"-salvagewallet\", false))\n+        {\n+            // Recover readable keypairs:\n+            CWallet dummyWallet;\n+            if (!CWalletDB::Recover(walletFile, (void *)&dummyWallet, CWalletDB::RecoverKeysOnlyFilter))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118185652",
      "id" : 118185652,
      "original_commit_id" : "96089fffd8d4bea24b83d253e0540b9836bef2ef",
      "original_position" : 41,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 39951010,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118185652",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118185864"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118185864"
         }
      },
      "body" : "Maybe we should use `<filename>.<date>.bak` (will result in something like `test1.dat.1495612559.bak` (which is preferable IMO).",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-24T07:58:58Z",
      "diff_hunk" : "@@ -440,30 +440,40 @@ bool CWallet::Verify()\n     if (GetBoolArg(\"-disablewallet\", DEFAULT_DISABLE_WALLET))\n         return true;\n \n+    SoftSetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n+\n     uiInterface.InitMessage(_(\"Verifying wallet...\"));\n-    std::string walletFile = GetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n \n-    std::string strError;\n-    if (!CWalletDB::VerifyEnvironment(walletFile, GetDataDir().string(), strError))\n-        return InitError(strError);\n+    for (const std::string& walletFile : gArgs.GetArgs(\"-wallet\")) {\n+        if (boost::filesystem::path(walletFile).filename() != walletFile) {\n+            return InitError(_(\"-wallet parameter must only specify a filename (not a path)\"));\n+        } else if (SanitizeString(walletFile, SAFE_CHARS_FILENAME) != walletFile) {\n+            return InitError(_(\"Invalid characters in -wallet filename\"));\n+        }\n \n-    if (GetBoolArg(\"-salvagewallet\", false))\n-    {\n-        // Recover readable keypairs:\n-        CWallet dummyWallet;\n-        if (!CWalletDB::Recover(walletFile, (void *)&dummyWallet, CWalletDB::RecoverKeysOnlyFilter))\n+        std::string strError;\n+        if (!CWalletDB::VerifyEnvironment(walletFile, GetDataDir().string(), strError))\n+            return InitError(strError);\n+\n+        if (GetBoolArg(\"-salvagewallet\", false))\n+        {\n+            // Recover readable keypairs:\n+            CWallet dummyWallet;\n+            if (!CWalletDB::Recover(walletFile, (void *)&dummyWallet, CWalletDB::RecoverKeysOnlyFilter))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118185864",
      "id" : 118185864,
      "original_commit_id" : "96089fffd8d4bea24b83d253e0540b9836bef2ef",
      "original_position" : 41,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 39951252,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118185864",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Tested a bit and seems to work as intended.\r\nThe only point I found during testing that needs fixing is the SalvageWallet renaming to \"wallet.%d.bak\".\r\nStep-debugged the flushing and SyncTransaction.\r\n\r\n### Conceptual:\r\nThis PR mostly goes into a direction that one has to choose the wallets-to-work-with before starting up Core. I miss the pre-work for run-time adding and removing of wallets. Sure, this may be added later. \r\nFurthermore, the \"globalness\" of the startup arguments and action like `-usehd` or `-zapwallettxes`, `--keypool`, etc. are somehow conceptual issues that need to be solved before deploying multiwallet.\r\n\r\n* Ideally creating, loading and unloading of wallets happens during runtime over an RPC call (or though the GUI).\r\n* In the long run, actions like `zapwallettx`, `salvagewallet`, `rescan`, `upgradewallet`, etc should also be moved to runtime.\r\n* Per wallet settings like `-usehd`, `-keypool`, etc. should be values that can be set during creation (or loading of a wallet).\r\n",
      "created_at" : "2017-05-24T08:18:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-303652612",
      "id" : 303652612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-05-24T08:18:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/303652612",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Gitian builds are failing (all three platforms): https://bitcoin.jonasschnelli.ch/build/147",
      "created_at" : "2017-05-24T09:22:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-303668042",
      "id" : 303668042,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-05-24T09:22:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/303668042",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "> zapwallettx, salvagewallet\r\n\r\nThese should probably become less visible or go away or move to a separate utility. \r\n\r\n> rescan\r\n\r\nWe can do this from the rpc now.\r\n\r\nNot sure about upgradewallet.",
      "created_at" : "2017-05-25T18:51:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-304092421",
      "id" : 304092421,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-05-25T18:51:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/304092421",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118586960"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118586960"
         }
      },
      "body" : "Please update to use braces. You can also combine this line with the one below.\r\n\r\nSeveral other if statements below which you can update to use braces.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-25T21:15:34Z",
      "diff_hunk" : "@@ -22,57 +22,45 @@\n #include <boost/foreach.hpp>\n #include <boost/thread.hpp>\n \n-static uint64_t nAccountingEntryNumber = 0;\n-\n-static std::atomic<unsigned int> nWalletDBUpdateCounter;\n-\n //\n // CWalletDB\n //\n \n bool CWalletDB::WriteName(const std::string& strAddress, const std::string& strName)\n {\n-    nWalletDBUpdateCounter++;\n-    return batch.Write(std::make_pair(std::string(\"name\"), strAddress), strName);\n+    return WriteIC(std::make_pair(std::string(\"name\"), strAddress), strName);\n }\n \n bool CWalletDB::EraseName(const std::string& strAddress)\n {\n     // This should only be used for sending addresses, never for receiving addresses,\n     // receiving addresses must always have an address book entry if they're not change return.\n-    nWalletDBUpdateCounter++;\n-    return batch.Erase(std::make_pair(std::string(\"name\"), strAddress));\n+    return EraseIC(std::make_pair(std::string(\"name\"), strAddress));\n }\n \n bool CWalletDB::WritePurpose(const std::string& strAddress, const std::string& strPurpose)\n {\n-    nWalletDBUpdateCounter++;\n-    return batch.Write(std::make_pair(std::string(\"purpose\"), strAddress), strPurpose);\n+    return WriteIC(std::make_pair(std::string(\"purpose\"), strAddress), strPurpose);\n }\n \n bool CWalletDB::ErasePurpose(const std::string& strPurpose)\n {\n-    nWalletDBUpdateCounter++;\n-    return batch.Erase(std::make_pair(std::string(\"purpose\"), strPurpose));\n+    return EraseIC(std::make_pair(std::string(\"purpose\"), strPurpose));\n }\n \n bool CWalletDB::WriteTx(const CWalletTx& wtx)\n {\n-    nWalletDBUpdateCounter++;\n-    return batch.Write(std::make_pair(std::string(\"tx\"), wtx.GetHash()), wtx);\n+    return WriteIC(std::make_pair(std::string(\"tx\"), wtx.GetHash()), wtx);\n }\n \n bool CWalletDB::EraseTx(uint256 hash)\n {\n-    nWalletDBUpdateCounter++;\n-    return batch.Erase(std::make_pair(std::string(\"tx\"), hash));\n+    return EraseIC(std::make_pair(std::string(\"tx\"), hash));\n }\n \n bool CWalletDB::WriteKey(const CPubKey& vchPubKey, const CPrivKey& vchPrivKey, const CKeyMetadata& keyMeta)\n {\n-    nWalletDBUpdateCounter++;\n-\n-    if (!batch.Write(std::make_pair(std::string(\"keymeta\"), vchPubKey),\n+    if (!WriteIC(std::make_pair(std::string(\"keymeta\"), vchPubKey),",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118586960",
      "id" : 118586960,
      "original_commit_id" : "96089fffd8d4bea24b83d253e0540b9836bef2ef",
      "original_position" : 61,
      "path" : "src/wallet/walletdb.cpp",
      "position" : null,
      "pull_request_review_id" : 40394941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118586960",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118987521"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118987521"
         }
      },
      "body" : "You've changed `MaybeCompactWalletDB()` to access `CDB::nUpdateCounter` directly, so this function isn't used.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-29T21:26:28Z",
      "diff_hunk" : "@@ -434,6 +434,16 @@ void CDB::Flush()\n     env->dbenv->txn_checkpoint(nMinutes ? GetArg(\"-dblogsize\", DEFAULT_WALLET_DBLOGSIZE) * 1024 : 0, nMinutes, 0);\n }\n \n+void CWalletDBWrapper::IncrementUpdateCounter()\n+{\n+    ++nUpdateCounter;\n+}\n+\n+unsigned int CWalletDBWrapper::GetUpdateCounter()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118987521",
      "id" : 118987521,
      "original_commit_id" : "96089fffd8d4bea24b83d253e0540b9836bef2ef",
      "original_position" : 9,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 40394941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118987521",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118991629"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118991629"
         }
      },
      "body" : "I agree with @jonasschnelli . This seems dangerous if `Recover()` or `VerifyDatabaseFile()` is called for multiple wallets. Should be straightforward to update `Recover()` to name the backup file uniquely (the warning string in `VerifyDatabaseFile()` will also need to be updated)",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-05-29T22:50:29Z",
      "diff_hunk" : "@@ -440,30 +440,40 @@ bool CWallet::Verify()\n     if (GetBoolArg(\"-disablewallet\", DEFAULT_DISABLE_WALLET))\n         return true;\n \n+    SoftSetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n+\n     uiInterface.InitMessage(_(\"Verifying wallet...\"));\n-    std::string walletFile = GetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n \n-    std::string strError;\n-    if (!CWalletDB::VerifyEnvironment(walletFile, GetDataDir().string(), strError))\n-        return InitError(strError);\n+    for (const std::string& walletFile : gArgs.GetArgs(\"-wallet\")) {\n+        if (boost::filesystem::path(walletFile).filename() != walletFile) {\n+            return InitError(_(\"-wallet parameter must only specify a filename (not a path)\"));\n+        } else if (SanitizeString(walletFile, SAFE_CHARS_FILENAME) != walletFile) {\n+            return InitError(_(\"Invalid characters in -wallet filename\"));\n+        }\n \n-    if (GetBoolArg(\"-salvagewallet\", false))\n-    {\n-        // Recover readable keypairs:\n-        CWallet dummyWallet;\n-        if (!CWalletDB::Recover(walletFile, (void *)&dummyWallet, CWalletDB::RecoverKeysOnlyFilter))\n+        std::string strError;\n+        if (!CWalletDB::VerifyEnvironment(walletFile, GetDataDir().string(), strError))\n+            return InitError(strError);\n+\n+        if (GetBoolArg(\"-salvagewallet\", false))\n+        {\n+            // Recover readable keypairs:\n+            CWallet dummyWallet;\n+            if (!CWalletDB::Recover(walletFile, (void *)&dummyWallet, CWalletDB::RecoverKeysOnlyFilter))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r118991629",
      "id" : 118991629,
      "original_commit_id" : "96089fffd8d4bea24b83d253e0540b9836bef2ef",
      "original_position" : 41,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 40394941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/118991629",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120211039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120211039"
         }
      },
      "body" : "It's an atomic, should have a default constructor?",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-06-05T21:11:19Z",
      "diff_hunk" : "@@ -119,10 +119,14 @@ class CWalletDBWrapper\n      */\n     void Flush(bool shutdown);\n \n+    void IncrementUpdateCounter();\n+    unsigned int GetUpdateCounter();\n+\n private:\n     /** BerkeleyDB specific */\n     CDBEnv *env;\n     std::string strFile;\n+    std::atomic<unsigned int> nUpdateCounter;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120211039",
      "id" : 120211039,
      "original_commit_id" : "ca8d241af308ef186786dac80403ed329fbc4172",
      "original_position" : 11,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 42155117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120211039",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120212883"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120212883"
         }
      },
      "body" : "> It's an atomic, should have a default constructor?\r\n\r\nYes but it seems to not initialize the value, see\r\nhttps://stackoverflow.com/questions/36320008/whats-the-default-value-for-a-stdatomic or http://en.cppreference.com/w/cpp/atomic/atomic/atomic. IMO, adding `= 0` to this line would make the code clearer anyway.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-06-05T21:20:24Z",
      "diff_hunk" : "@@ -119,10 +119,14 @@ class CWalletDBWrapper\n      */\n     void Flush(bool shutdown);\n \n+    void IncrementUpdateCounter();\n+    unsigned int GetUpdateCounter();\n+\n private:\n     /** BerkeleyDB specific */\n     CDBEnv *env;\n     std::string strFile;\n+    std::atomic<unsigned int> nUpdateCounter;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120212883",
      "id" : 120212883,
      "original_commit_id" : "ca8d241af308ef186786dac80403ed329fbc4172",
      "original_position" : 11,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 42157117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120212883",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Rebased and issues addressed",
      "created_at" : "2017-06-05T22:31:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-306329076",
      "id" : 306329076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-06-05T22:31:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306329076",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Travis falure:\r\n```\r\nRunning 255 test cases...\r\nunknown location(0): fatal error: in \"wallet_tests/importwallet_rescan\": unknown type\r\nwallet/test/wallet_tests.cpp(446): last checkpoint: \"importwallet_rescan\" entry.\r\n*** 1 failure is detected in the test module \"Bitcoin Test Suite\"\r\n```",
      "created_at" : "2017-06-06T12:39:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-306473476",
      "id" : 306473476,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-06-06T12:39:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306473476",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> Travis falure:\r\n\r\nThe importwallet_rescan test has another pwalletMain usage that needs to be changed to vpwallets.",
      "created_at" : "2017-06-06T12:44:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-306474587",
      "id" : 306474587,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-06-06T12:44:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306474587",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120379039"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120379039"
         }
      },
      "body" : "In commit \"Replace pwalletMain with a vector of wallet\"\r\n\r\nThis can probably be removed after the importwallet_rescan test is updated.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-06-06T14:36:59Z",
      "diff_hunk" : "@@ -19,6 +19,8 @@\n #include <boost/test/unit_test.hpp>\n #include <univalue.h>\n \n+extern CWallet* pwalletMain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120379039",
      "id" : 120379039,
      "original_commit_id" : "574e44eab4fd440c11e67538e57964f3862eca52",
      "original_position" : 4,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : 4,
      "pull_request_review_id" : 42336053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120379039",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120381177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120381177"
         }
      },
      "body" : "In commit \"Wallet: Support loading multiple wallets if -wallet used more than once\"\r\n\r\nRemoving GetUpdateCounter in this commit isn't related to the rest of the changes here. This change was probably meant for the \"CWalletDB: Store the update counter per wallet\" commit.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-06-06T14:44:02Z",
      "diff_hunk" : "@@ -439,11 +439,6 @@ void CWalletDBWrapper::IncrementUpdateCounter()\n     ++nUpdateCounter;\n }\n \n-unsigned int CWalletDBWrapper::GetUpdateCounter()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120381177",
      "id" : 120381177,
      "original_commit_id" : "60c5a3778d7497adad27f704842a096d61d6a765",
      "original_position" : 4,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 42336053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120381177",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120384212"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120384212"
         }
      },
      "body" : "In commit \"Wallet: Move multiwallet sanity checks to CWallet::Verify\"\r\n\r\nConsider squashing this commit into previous commit \"Wallet: Support loading multiple wallets if -wallet used more than once\", because the two commits are making parallel sets changes, and having them separate makes the interaction confusing to think about.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-06-06T14:53:28Z",
      "diff_hunk" : "@@ -440,30 +440,40 @@ bool CWallet::Verify()\n     if (GetBoolArg(\"-disablewallet\", DEFAULT_DISABLE_WALLET))\n         return true;\n \n-    uiInterface.InitMessage(_(\"Verifying wallet...\"));\n-    std::string walletFile = GetArg(\"-wallet\", DEFAULT_WALLET_DAT);\n+    SoftSetArg(\"-wallet\", DEFAULT_WALLET_DAT);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120384212",
      "id" : 120384212,
      "original_commit_id" : "4c0f78c44df11aa3fed735f20cf51e1cc4d39dcf",
      "original_position" : 6,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 42336053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120384212",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120385084"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120385084"
         }
      },
      "body" : "> Should initialize these values.\r\n\r\nNote: comment no longer applies. This is now done in two CWalletDBWrapper constructors.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-06-06T14:56:25Z",
      "diff_hunk" : "@@ -122,11 +122,15 @@ class CWalletDBWrapper\n     void IncrementUpdateCounter();\n     unsigned int GetUpdateCounter();\n \n+    std::atomic<unsigned int> nUpdateCounter;\n+    unsigned int nLastSeen;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120385084",
      "id" : 120385084,
      "original_commit_id" : "68bc5b926fadbe1d904b5138dc299d2dd06fdead",
      "original_position" : 5,
      "path" : "src/wallet/db.h",
      "position" : null,
      "pull_request_review_id" : 42336053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120385084",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120387244"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120387244"
         }
      },
      "body" : "In commit \"Bugfix: wallet: Fix warningStr, errorStr argument order\"\r\n\r\nNote: the bug seems to have been introduced in #8574.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-06-06T15:04:24Z",
      "diff_hunk" : "@@ -825,7 +825,7 @@ bool CWalletDB::VerifyEnvironment(const std::string& walletFile, const fs::path&\n \n bool CWalletDB::VerifyDatabaseFile(const std::string& walletFile, const fs::path& dataDir, std::string& warningStr, std::string& errorStr)\n {\n-    return CDB::VerifyDatabaseFile(walletFile, dataDir, errorStr, warningStr, CWalletDB::Recover);\n+    return CDB::VerifyDatabaseFile(walletFile, dataDir, warningStr, errorStr, CWalletDB::Recover);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120387244",
      "id" : 120387244,
      "original_commit_id" : "9dacebee9eec12c37749fd851bdf1ab32012b9ed",
      "original_position" : 5,
      "path" : "src/wallet/walletdb.cpp",
      "position" : 283,
      "pull_request_review_id" : 42336053,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-06T21:20:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120387244",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "I've had a quick scan and the new commits look generally good, although #10457 seems like a simpler solution to the wallet backup name issue. I don't think it's really worth passing the backup file name around through multiple function calls just so it can be printed in a single warning message.\r\n\r\nI'll fully review once the the test has been fixed.",
      "created_at" : "2017-06-06T16:10:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-306536473",
      "id" : 306536473,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-06-06T16:10:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/306536473",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120755919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120755919"
         }
      },
      "body" : "Here you say that `-salvagewallet` is only for one wallet file, but in `CWallet::Verify()`, the loop through all wallets checks for `-salvagewallet` and recovers all wallets if `-salvagewallet` is set. Which behavior is correct: salvage all wallets, or salvage only if there is one wallet?\r\n\r\nFor the latter, the `-salvagewallet` check in `CWallet::Verify()` can be moved out of the loop.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-06-07T21:59:27Z",
      "diff_hunk" : "@@ -3972,15 +3979,27 @@ bool CWallet::ParameterInteraction()\n     }\n \n     if (GetBoolArg(\"-salvagewallet\", false) && SoftSetBoolArg(\"-rescan\", true)) {\n+        if (is_multiwallet) {\n+            return InitError(strprintf(\"%s is only allowed with a single wallet file\", \"-salvagewallet\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120755919",
      "id" : 120755919,
      "original_commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "original_position" : 135,
      "path" : "src/wallet/wallet.cpp",
      "position" : 135,
      "pull_request_review_id" : 42746733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-07T22:09:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120755919",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/3782274?v=3",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120759494"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120759494"
         }
      },
      "body" : "Both are correct. If we get to ::Verify, we should salvage all wallets. But for now, we forbid this combination. Moving it out of the loop is error-prone, and creates unnecessary complexity.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-06-07T22:18:51Z",
      "diff_hunk" : "@@ -3972,15 +3979,27 @@ bool CWallet::ParameterInteraction()\n     }\n \n     if (GetBoolArg(\"-salvagewallet\", false) && SoftSetBoolArg(\"-rescan\", true)) {\n+        if (is_multiwallet) {\n+            return InitError(strprintf(\"%s is only allowed with a single wallet file\", \"-salvagewallet\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r120759494",
      "id" : 120759494,
      "original_commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "original_position" : 135,
      "path" : "src/wallet/wallet.cpp",
      "position" : 135,
      "pull_request_review_id" : 42750311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-07T22:18:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120759494",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r121222897"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121222897"
         }
      },
      "body" : "> This can probably be removed after the importwallet_rescan test is updated.\r\n\r\nNever mind, it's used by the receiverequests test.",
      "commit_id" : "c237bd750e11472f0f9639891036b975cf7faf15",
      "created_at" : "2017-06-09T21:06:47Z",
      "diff_hunk" : "@@ -19,6 +19,8 @@\n #include <boost/test/unit_test.hpp>\n #include <univalue.h>\n \n+extern CWallet* pwalletMain;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#discussion_r121222897",
      "id" : 121222897,
      "original_commit_id" : "574e44eab4fd440c11e67538e57964f3862eca52",
      "original_position" : 4,
      "path" : "src/wallet/test/wallet_tests.cpp",
      "position" : 4,
      "pull_request_review_id" : 43262043,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/8694",
      "updated_at" : "2017-06-09T21:10:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121222897",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "utACK c237bd7\r\nSeems ready to merge.",
      "created_at" : "2017-06-12T11:27:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-307762965",
      "id" : 307762965,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-06-12T11:27:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/307762965",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "> I've had a quick scan and the new commits look generally good, although #10457 seems like a simpler solution to the wallet backup name issue. I don't think it's really worth passing the backup file name around through multiple function calls just so it can be printed in a single warning message.\r\n\r\nI agree. We should probably revert that part and do #10457 afterward.",
      "created_at" : "2017-06-12T14:01:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/8694#issuecomment-307798429",
      "id" : 307798429,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/8694",
      "updated_at" : "2017-06-12T14:01:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/307798429",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
