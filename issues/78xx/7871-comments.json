[
   {
      "body" : "Nice!\r\nConcept ACK.",
      "created_at" : "2016-04-13T14:30:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-209475161",
      "id" : 209475161,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-04-13T14:30:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/209475161",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "What use cases are motivating this mode?",
      "created_at" : "2016-04-13T20:13:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-209626841",
      "id" : 209626841,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-04-13T20:13:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/209626841",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "Concept ACK\r\n\r\n> What use cases are motivating this mode?\r\n\r\nThis is explained in the original issue, #7365: if you have another application that needs to consume the block data before it's gone.\r\n",
      "created_at" : "2016-04-15T06:28:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-210304363",
      "id" : 210304363,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-04-15T06:28:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/210304363",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Should have read the issue, sorry. Concept ACK",
      "created_at" : "2016-04-15T11:12:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-210419602",
      "id" : 210419602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-04-15T11:12:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/210419602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "Concept ACK. Needs rebase.",
      "created_at" : "2016-06-02T14:30:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-223309524",
      "id" : 223309524,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-06-02T14:30:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223309524",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "Rebased. ",
      "created_at" : "2016-06-08T18:26:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-224683681",
      "id" : 224683681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-06-08T18:26:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/224683681",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7504522?v=3",
         "events_url" : "https://api.github.com/users/mrbandrews/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrbandrews/followers",
         "following_url" : "https://api.github.com/users/mrbandrews/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrbandrews/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrbandrews",
         "id" : 7504522,
         "login" : "mrbandrews",
         "organizations_url" : "https://api.github.com/users/mrbandrews/orgs",
         "received_events_url" : "https://api.github.com/users/mrbandrews/received_events",
         "repos_url" : "https://api.github.com/users/mrbandrews/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrbandrews/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrbandrews/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrbandrews"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r76030706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76030706"
         }
      },
      "body" : "I usually get told off for using global variables. Curious to know when they are permitted and when they are discouraged.\n",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-08-24T10:16:02Z",
      "diff_hunk" : "@@ -3617,10 +3618,44 @@ void UnlinkPrunedFiles(std::set<int>& setFilesToPrune)\n     }\n }\n \n+/* This function is called from the RPC code for pruneblockchain */\n+void PruneBlockFilesManual(int manualPruneHeight)\n+{\n+    // stuff the prune height into a global variable, and flush",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r76030706",
      "id" : 76030706,
      "original_commit_id" : "2695b56531dcb5b4914364a49a6431a8c91a0df0",
      "original_position" : 62,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : null,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/76030706",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1530283?v=3",
         "events_url" : "https://api.github.com/users/rebroad/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rebroad/followers",
         "following_url" : "https://api.github.com/users/rebroad/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rebroad/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rebroad",
         "id" : 1530283,
         "login" : "rebroad",
         "organizations_url" : "https://api.github.com/users/rebroad/orgs",
         "received_events_url" : "https://api.github.com/users/rebroad/received_events",
         "repos_url" : "https://api.github.com/users/rebroad/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rebroad/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rebroad"
      }
   },
   {
      "body" : "Needs rebase.",
      "created_at" : "2016-08-25T11:58:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-242360917",
      "id" : 242360917,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-08-25T11:58:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/242360917",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81861504"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81861504"
         }
      },
      "body" : "Many places, you left (pruneMode) in a boolean context. I don't see a need to change to == NONE here.\n",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-10-04T21:47:57Z",
      "diff_hunk" : "@@ -1335,7 +1338,7 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n \n                 // Check for changed -prune state.  What we are concerned about is a user who has pruned blocks\n                 // in the past, but is now trying to run unpruned.\n-                if (fHavePruned && !fPruneMode) {\n+                if (fHavePruned && pruneMode==PRUNE_NONE) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81861504",
      "id" : 81861504,
      "original_commit_id" : "518a942674066b249f8da49a82ee6c90b74fb0c6",
      "original_position" : 41,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 2810919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81861504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81861586"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81861586"
         }
      },
      "body" : "A bit ugly to have the enum and variable differ only by case.\n",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-10-04T21:48:29Z",
      "diff_hunk" : "@@ -71,13 +71,14 @@ bool fImporting = false;\n bool fReindex = false;\n bool fTxIndex = false;\n bool fHavePruned = false;\n-bool fPruneMode = false;\n+PruneMode pruneMode = PRUNE_NONE;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81861586",
      "id" : 81861586,
      "original_commit_id" : "518a942674066b249f8da49a82ee6c90b74fb0c6",
      "original_position" : 5,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 2810919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81861586",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81861912"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81861912"
         }
      },
      "body" : "This appears to be used exclusively for passing a value from a caller to a callee, so it shouldn't be a global variable.\n",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-10-04T21:50:32Z",
      "diff_hunk" : "@@ -71,13 +71,14 @@ bool fImporting = false;\n bool fReindex = false;\n bool fTxIndex = false;\n bool fHavePruned = false;\n-bool fPruneMode = false;\n+PruneMode pruneMode = PRUNE_NONE;\n bool fIsBareMultisigStd = DEFAULT_PERMIT_BAREMULTISIG;\n bool fRequireStandard = true;\n bool fCheckBlockIndex = false;\n bool fCheckpointsEnabled = DEFAULT_CHECKPOINTS_ENABLED;\n size_t nCoinCacheUsage = 5000 * 300;\n uint64_t nPruneTarget = 0;\n+unsigned int nManualPruneHeight = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81861912",
      "id" : 81861912,
      "original_commit_id" : "518a942674066b249f8da49a82ee6c90b74fb0c6",
      "original_position" : 12,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 2810919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81861912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81863471"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81863471"
         }
      },
      "body" : "`int` is the wrong type here. It is only guaranteed to hold up to 32768, which isn't very useful for block heights.\n\nLock heights will break before 29 bits are exceeded, so I suggest using either `unsigned long` or `uint32_t`\n",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-10-04T21:59:41Z",
      "diff_hunk" : "@@ -3842,10 +3843,44 @@ void UnlinkPrunedFiles(std::set<int>& setFilesToPrune)\n     }\n }\n \n+/* This function is called from the RPC code for pruneblockchain */\n+void PruneBlockFilesManual(int manualPruneHeight)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81863471",
      "id" : 81863471,
      "original_commit_id" : "518a942674066b249f8da49a82ee6c90b74fb0c6",
      "original_position" : 59,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 2810919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81863471",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81864786"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81864786"
         }
      },
      "body" : "We're trying to reduce calls to global Params() by passing things as arguments. This change has the opposite effect for no clear reason.\n",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-10-04T22:08:35Z",
      "diff_hunk" : "@@ -3842,10 +3843,44 @@ void UnlinkPrunedFiles(std::set<int>& setFilesToPrune)\n     }\n }\n \n+/* This function is called from the RPC code for pruneblockchain */\n+void PruneBlockFilesManual(int manualPruneHeight)\n+{\n+    // stuff the prune height into a global variable, and flush\n+    nManualPruneHeight = (unsigned) manualPruneHeight;\n+    fCheckForPruning = true;\n+    CValidationState state;\n+    FlushStateToDisk(state, FLUSH_STATE_NONE);\n+}\n+\n+/* Calculate the block/rev files to delete based on height specified by user with RPC command pruneblockchain */\n+void FindFilesToPruneManual(std::set<int>& setFilesToPrune)\n+{\n+    LOCK2(cs_main, cs_LastBlockFile);\n+    if (chainActive.Tip() == NULL || pruneMode != PRUNE_MANUAL) {\n+        return;\n+    }\n+\n+    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n+    unsigned int nLastBlockWeCanPrune = min(nManualPruneHeight, chainActive.Tip()->nHeight - MIN_BLOCKS_TO_KEEP);\n+    int count=0;\n+    for (int fileNumber = 0; fileNumber < nLastBlockFile; fileNumber++) {\n+        if (vinfoBlockFile[fileNumber].nSize == 0 || vinfoBlockFile[fileNumber].nHeightLast > nLastBlockWeCanPrune)\n+            continue;\n+        PruneOneBlockFile(fileNumber);\n+        setFilesToPrune.insert(fileNumber);\n+        count++;\n+    }\n+    LogPrintf(\"Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\", nLastBlockWeCanPrune, count);\n+}\n+\n /* Calculate the block/rev files that should be deleted to remain under target*/\n-void FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight)\n+void FindFilesToPruneAuto(std::set<int>& setFilesToPrune)\n {\n     LOCK2(cs_main, cs_LastBlockFile);\n+    const CChainParams& chainparams = Params();\n+    uint64_t nPruneAfterHeight = chainparams.PruneAfterHeight();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81864786",
      "id" : 81864786,
      "original_commit_id" : "518a942674066b249f8da49a82ee6c90b74fb0c6",
      "original_position" : 95,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 2810919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81864786",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81865305"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81865305"
         }
      },
      "body" : "`RPC_INVALID_PARAMETER` seems more appropriate here.\n",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-10-04T22:11:45Z",
      "diff_hunk" : "@@ -670,6 +670,32 @@ static bool GetUTXOStats(CCoinsView *view, CCoinsStats &stats)\n     return true;\n }\n \n+UniValue pruneblockchain(const UniValue& params, bool fHelp)\n+{\n+    if (fHelp || params.size() != 1)\n+        throw runtime_error(\n+            \"pruneblockchain\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"height\\\"       (int, required) The block height to prune up to.\\n\");\n+\n+    if (pruneMode != PRUNE_MANUAL) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Cannot prune via RPC unless in manual prune mode.\");\n+        return 0;\n+    }\n+\n+    LOCK(cs_main);\n+\n+    int height = params[0].get_int();\n+    if (height < 0) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Negative block height.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81865305",
      "id" : 81865305,
      "original_commit_id" : "518a942674066b249f8da49a82ee6c90b74fb0c6",
      "original_position" : 21,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 2810919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81865305",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81865459"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81865459"
         }
      },
      "body" : "Should this also check if the requested height is too close to the tip? Or maybe just return the height it was able to successfully prune up to...\n",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-10-04T22:12:41Z",
      "diff_hunk" : "@@ -670,6 +670,32 @@ static bool GetUTXOStats(CCoinsView *view, CCoinsStats &stats)\n     return true;\n }\n \n+UniValue pruneblockchain(const UniValue& params, bool fHelp)\n+{\n+    if (fHelp || params.size() != 1)\n+        throw runtime_error(\n+            \"pruneblockchain\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"height\\\"       (int, required) The block height to prune up to.\\n\");\n+\n+    if (pruneMode != PRUNE_MANUAL) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Cannot prune via RPC unless in manual prune mode.\");\n+        return 0;\n+    }\n+\n+    LOCK(cs_main);\n+\n+    int height = params[0].get_int();\n+    if (height < 0) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Negative block height.\");\n+    } else if ((unsigned int) chainActive.Height() < Params().PruneAfterHeight()) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Blockchain is too short for pruning.\");\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81865459",
      "id" : 81865459,
      "original_commit_id" : "518a942674066b249f8da49a82ee6c90b74fb0c6",
      "original_position" : 24,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 2810919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81865459",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81865686"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81865686"
         }
      },
      "body" : "`RPC_METHOD_NOT_FOUND` seems better for this (already used for wallet RPCs when the wallet is not enabled)\n",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-10-04T22:14:16Z",
      "diff_hunk" : "@@ -670,6 +670,32 @@ static bool GetUTXOStats(CCoinsView *view, CCoinsStats &stats)\n     return true;\n }\n \n+UniValue pruneblockchain(const UniValue& params, bool fHelp)\n+{\n+    if (fHelp || params.size() != 1)\n+        throw runtime_error(\n+            \"pruneblockchain\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"height\\\"       (int, required) The block height to prune up to.\\n\");\n+\n+    if (pruneMode != PRUNE_MANUAL) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Cannot prune via RPC unless in manual prune mode.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r81865686",
      "id" : 81865686,
      "original_commit_id" : "518a942674066b249f8da49a82ee6c90b74fb0c6",
      "original_position" : 13,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 2810919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/81865686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Oh, it might make sense to add \"prunemode\": \"auto\"/\"manual\" to `getblockchaininfo` also.",
      "created_at" : "2016-10-04T22:18:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-251530369",
      "id" : 251530369,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-10-04T22:18:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/251530369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=3",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "body" : "Concept ACK\r\n\r\nMy OpenTimestamps Server could use this!",
      "created_at" : "2016-10-13T23:28:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-253669103",
      "id" : 253669103,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-10-13T23:28:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/253669103",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
         "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
         "followers_url" : "https://api.github.com/users/petertodd/followers",
         "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
         "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/petertodd",
         "id" : 7042,
         "login" : "petertodd",
         "organizations_url" : "https://api.github.com/users/petertodd/orgs",
         "received_events_url" : "https://api.github.com/users/petertodd/received_events",
         "repos_url" : "https://api.github.com/users/petertodd/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/petertodd"
      }
   },
   {
      "body" : "Rebased and feedback addressed.  I didn't make a couple of the suggested changes, though:\r\n1) \"int\" for block height is used elsewhere in the code (chain.h/chain.cpp); perhaps a future PR could change the type used in each place.\r\n2) Params() - this was just a code move, although I had left one unnecessary line of code in there, which I removed now.\r\n3) heights close to tip - it will prune up to the limit and log.",
      "created_at" : "2016-10-26T18:33:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-256437892",
      "id" : 256437892,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-10-26T18:33:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/256437892",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7504522?v=3",
         "events_url" : "https://api.github.com/users/mrbandrews/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrbandrews/followers",
         "following_url" : "https://api.github.com/users/mrbandrews/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrbandrews/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrbandrews",
         "id" : 7504522,
         "login" : "mrbandrews",
         "organizations_url" : "https://api.github.com/users/mrbandrews/orgs",
         "received_events_url" : "https://api.github.com/users/mrbandrews/received_events",
         "repos_url" : "https://api.github.com/users/mrbandrews/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrbandrews/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrbandrews/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrbandrews"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88846018"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88846018"
         }
      },
      "body" : "Nit: `Use RPC call pruneblockchain(height)` - otherwise the syntax can be easily confused with a command line option.",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-21T08:20:29Z",
      "diff_hunk" : "@@ -928,12 +928,15 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n         return InitError(_(\"Prune cannot be configured with a negative value.\"));\n     }\n     nPruneTarget = (uint64_t) nSignedPruneTarget;\n-    if (nPruneTarget) {\n+    if (nPruneTarget / 1024 / 1024 == 1) {  // manual pruning: -prune=1\n+        LogPrintf(\"Manual block pruning enabled.  Use RPC call pruneblockchain=<height> to prune block and undo files.\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88846018",
      "id" : 88846018,
      "original_commit_id" : "98470f9d5bc915f74e13a2521541c5da8313bd63",
      "original_position" : 15,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 9405343,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88846018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88846138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88846138"
         }
      },
      "body" : "Let's use C++11 scoped enums in new code\r\n```\r\nenum struct PruneMode { NONE=0, AUTO, MANUAL };\r\n```\r\nThen refer to `PruneMode::NONE` etc.\r\n",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-21T08:21:25Z",
      "diff_hunk" : "@@ -191,8 +191,10 @@ static const uint64_t nMinDiskSpace = 52428800;\n /** Pruning-related variables and constants */\n /** True if any block files have ever been pruned. */\n extern bool fHavePruned;\n-/** True if we're running in -prune mode. */\n-extern bool fPruneMode;\n+enum PruneMode {PRUNE_NONE = 0, PRUNE_AUTO, PRUNE_MANUAL };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88846138",
      "id" : 88846138,
      "original_commit_id" : "98470f9d5bc915f74e13a2521541c5da8313bd63",
      "original_position" : 6,
      "path" : "src/main.h",
      "position" : null,
      "pull_request_review_id" : 9405455,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88846138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88846599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88846599"
         }
      },
      "body" : "Can we please store and compare the option value before multiplication? Doing a division here, though it achieves the correct effect, seems circuitous and unclear.",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-21T08:25:42Z",
      "diff_hunk" : "@@ -928,12 +928,15 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n         return InitError(_(\"Prune cannot be configured with a negative value.\"));\n     }\n     nPruneTarget = (uint64_t) nSignedPruneTarget;\n-    if (nPruneTarget) {\n+    if (nPruneTarget / 1024 / 1024 == 1) {  // manual pruning: -prune=1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88846599",
      "id" : 88846599,
      "original_commit_id" : "98470f9d5bc915f74e13a2521541c5da8313bd63",
      "original_position" : 14,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 9405875,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88846599",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88846787"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88846787"
         }
      },
      "body" : "Are you sure this only needs to be done in auto-pruning mode?\r\n",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-21T08:27:06Z",
      "diff_hunk" : "@@ -3317,7 +3320,7 @@ bool FindBlockPos(CValidationState &state, CDiskBlockPos &pos, unsigned int nAdd\n         unsigned int nOldChunks = (pos.nPos + BLOCKFILE_CHUNK_SIZE - 1) / BLOCKFILE_CHUNK_SIZE;\n         unsigned int nNewChunks = (vinfoBlockFile[nFile].nSize + BLOCKFILE_CHUNK_SIZE - 1) / BLOCKFILE_CHUNK_SIZE;\n         if (nNewChunks > nOldChunks) {\n-            if (fPruneMode)\n+            if (pruneMode == PRUNE_AUTO)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88846787",
      "id" : 88846787,
      "original_commit_id" : "98470f9d5bc915f74e13a2521541c5da8313bd63",
      "original_position" : 42,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 9406056,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88846787",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88847011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88847011"
         }
      },
      "body" : "As you already have to change every line on which the variable occurs anyhow, I'd prefer explicitly comparing the enumeration against a value instead of using it like a boolean: e.g. `pruneMode != PruneMode::NONE`. This makes it  clear to developers reading the code that this is an enumeration and not a boolean and can avoid them introducing silly bugs.",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-21T08:29:01Z",
      "diff_hunk" : "@@ -115,7 +115,7 @@ UniValue importprivkey(const JSONRPCRequest& request)\n     if (request.params.size() > 2)\n         fRescan = request.params[2].get_bool();\n \n-    if (fRescan && fPruneMode)\n+    if (fRescan && pruneMode)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88847011",
      "id" : 88847011,
      "original_commit_id" : "98470f9d5bc915f74e13a2521541c5da8313bd63",
      "original_position" : 5,
      "path" : "src/wallet/rpcdump.cpp",
      "position" : null,
      "pull_request_review_id" : 9406275,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88847011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88847104"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88847104"
         }
      },
      "body" : "I think it's fine.",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-21T08:29:45Z",
      "diff_hunk" : "@@ -71,13 +71,14 @@ bool fImporting = false;\n bool fReindex = false;\n bool fTxIndex = false;\n bool fHavePruned = false;\n-bool fPruneMode = false;\n+PruneMode pruneMode = PRUNE_NONE;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88847104",
      "id" : 88847104,
      "original_commit_id" : "518a942674066b249f8da49a82ee6c90b74fb0c6",
      "original_position" : 5,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 9406355,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88847104",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88847378"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88847378"
         }
      },
      "body" : "Calling this function with pruneMode != PRUNE_MANUAL should be an assertion error, as it must be a bug in the code.",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-21T08:31:56Z",
      "diff_hunk" : "@@ -3851,10 +3854,40 @@ void UnlinkPrunedFiles(std::set<int>& setFilesToPrune)\n     }\n }\n \n+/* Calculate the block/rev files to delete based on height specified by user with RPC command pruneblockchain */\n+void FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight)\n+{\n+    LOCK2(cs_main, cs_LastBlockFile);\n+    if (chainActive.Tip() == NULL || pruneMode != PRUNE_MANUAL) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88847378",
      "id" : 88847378,
      "original_commit_id" : "98470f9d5bc915f74e13a2521541c5da8313bd63",
      "original_position" : 63,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 9406625,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88847378",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88847859"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88847859"
         }
      },
      "body" : "Aside: these functions are only used within `main.cpp`, why are we exporting them?\r\n(thinking about it, let's just keep it for now, it seems common in `main.cpp` to export everything whether necessary or not, and changing will probably interfere with attempts of splitting up main such as #9183)",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-21T08:36:19Z",
      "diff_hunk" : "@@ -273,7 +280,8 @@ CAmount GetBlockSubsidy(int nHeight, const Consensus::Params& consensusParams);\n  *\n  * @param[out]   setFilesToPrune   The set of file indices that can be unlinked will be returned\n  */\n-void FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight);\n+void FindFilesToPruneAuto(std::set<int>& setFilesToPrune);\n+void FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88847859",
      "id" : 88847859,
      "original_commit_id" : "98470f9d5bc915f74e13a2521541c5da8313bd63",
      "original_position" : 39,
      "path" : "src/main.h",
      "position" : null,
      "pull_request_review_id" : 9407110,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88847859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88848260"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88848260"
         }
      },
      "body" : "No need for a return if you have a throw",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-21T08:39:42Z",
      "diff_hunk" : "@@ -814,6 +814,32 @@ static bool GetUTXOStats(CCoinsView *view, CCoinsStats &stats)\n     return true;\n }\n \n+UniValue pruneblockchain(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() != 1)\n+        throw runtime_error(\n+            \"pruneblockchain\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"height\\\"       (int, required) The block height to prune up to.\\n\");\n+\n+    if (pruneMode != PRUNE_MANUAL) {\n+        throw JSONRPCError(RPC_METHOD_NOT_FOUND, \"Cannot prune via RPC unless in manual prune mode.\");\n+        return 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88848260",
      "id" : 88848260,
      "original_commit_id" : "98470f9d5bc915f74e13a2521541c5da8313bd63",
      "original_position" : 14,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 9407479,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88848260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88849361"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88849361"
         }
      },
      "body" : "Do we need any foot-shooting checks: e.g. that the last 144 blocks are being retained to be robust against reorgs?\r\n\r\nEdit: apparently the check for `MIN_BLOCKS_TO_KEEP` happens deeper in the pruning logic, and it continues in this case by pruning the allowed blocks only. Ok, makes sense I think, although a warning in the log may make it more transparent what happens.",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-21T08:48:40Z",
      "diff_hunk" : "@@ -814,6 +814,32 @@ static bool GetUTXOStats(CCoinsView *view, CCoinsStats &stats)\n     return true;\n }\n \n+UniValue pruneblockchain(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() != 1)\n+        throw runtime_error(\n+            \"pruneblockchain\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"height\\\"       (int, required) The block height to prune up to.\\n\");\n+\n+    if (pruneMode != PRUNE_MANUAL) {\n+        throw JSONRPCError(RPC_METHOD_NOT_FOUND, \"Cannot prune via RPC unless in manual prune mode.\");\n+        return 0;\n+    }\n+\n+    LOCK(cs_main);\n+\n+    int height = request.params[0].get_int();\n+    if (height < 0) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Negative block height.\");\n+    } else if ((unsigned int) chainActive.Height() < Params().PruneAfterHeight()) {\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Blockchain is too short for pruning.\");\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r88849361",
      "id" : 88849361,
      "original_commit_id" : "98470f9d5bc915f74e13a2521541c5da8313bd63",
      "original_position" : 24,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 9408497,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/88849361",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "body" : "Feedback addressed.  Re: the code in FindBlockPos (which reset fCheckForPruning only in auto-prune mode), yes that should only be auto-prune.  I designed manual pruning to be a one-time act of pruning to the specified height.  (In looking at this code, though, I noticed that nManualPruneHeight should probably be set=0 after we do the manual pruning, so I added that line of code, in a separate commit.) \r\n\r\nSo, there's a commit responding to laanwj's feedback, and another with that one line of code.",
      "created_at" : "2016-11-21T16:31:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-261989821",
      "id" : 261989821,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-11-21T16:31:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/261989821",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7504522?v=3",
         "events_url" : "https://api.github.com/users/mrbandrews/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrbandrews/followers",
         "following_url" : "https://api.github.com/users/mrbandrews/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrbandrews/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrbandrews",
         "id" : 7504522,
         "login" : "mrbandrews",
         "organizations_url" : "https://api.github.com/users/mrbandrews/orgs",
         "received_events_url" : "https://api.github.com/users/mrbandrews/received_events",
         "repos_url" : "https://api.github.com/users/mrbandrews/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrbandrews/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrbandrews/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrbandrews"
      }
   },
   {
      "body" : "There was a merge conflict (the declaration of FlushStateToDisk near the top of main.cpp conflicted with my adding an optional parameter), so I rebased and squashed everything.  This should work now.",
      "created_at" : "2016-11-28T16:06:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-263311999",
      "id" : 263311999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-11-28T16:06:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263311999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7504522?v=3",
         "events_url" : "https://api.github.com/users/mrbandrews/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrbandrews/followers",
         "following_url" : "https://api.github.com/users/mrbandrews/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrbandrews/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrbandrews",
         "id" : 7504522,
         "login" : "mrbandrews",
         "organizations_url" : "https://api.github.com/users/mrbandrews/orgs",
         "received_events_url" : "https://api.github.com/users/mrbandrews/received_events",
         "repos_url" : "https://api.github.com/users/mrbandrews/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrbandrews/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrbandrews/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrbandrews"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r89851343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89851343"
         }
      },
      "body" : "`FindFilesToPruneAuto` is only called when `pruneMode == PruneMode::AUTO`, so why do we need this test? Maybe turn it into an assert at the beginning of the function.",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-28T18:49:58Z",
      "diff_hunk" : "@@ -4140,7 +4175,7 @@ bool CVerifyDB::VerifyDB(const CChainParams& chainparams, CCoinsView *coinsview,\n         uiInterface.ShowProgress(_(\"Verifying blocks...\"), percentageDone);\n         if (pindex->nHeight < chainActive.Height()-nCheckDepth)\n             break;\n-        if (fPruneMode && !(pindex->nStatus & BLOCK_HAVE_DATA)) {\n+        if (pruneMode != PruneMode::NONE && !(pindex->nStatus & BLOCK_HAVE_DATA)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r89851343",
      "id" : 89851343,
      "original_commit_id" : "342262d9a9aa784e40a309d8e76b0ed36e367e6f",
      "original_position" : 113,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 10383308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89851343",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r89851464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89851464"
         }
      },
      "body" : "Also, `if (pruneMode)` is equivalent to `if (pruneMode != PruneMode::NONE)`, since PruneMode::NONE is explicitly defined as 0.\r\n\r\n(applies to many changed lines in this PR)",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-28T18:50:37Z",
      "diff_hunk" : "@@ -4140,7 +4175,7 @@ bool CVerifyDB::VerifyDB(const CChainParams& chainparams, CCoinsView *coinsview,\n         uiInterface.ShowProgress(_(\"Verifying blocks...\"), percentageDone);\n         if (pindex->nHeight < chainActive.Height()-nCheckDepth)\n             break;\n-        if (fPruneMode && !(pindex->nStatus & BLOCK_HAVE_DATA)) {\n+        if (pruneMode != PruneMode::NONE && !(pindex->nStatus & BLOCK_HAVE_DATA)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r89851464",
      "id" : 89851464,
      "original_commit_id" : "342262d9a9aa784e40a309d8e76b0ed36e367e6f",
      "original_position" : 113,
      "path" : "src/main.cpp",
      "position" : null,
      "pull_request_review_id" : 10383308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89851464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r89851624"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89851624"
         }
      },
      "body" : "There are many functions in main that are not exported (see the whole namespace block for the handling of NodeState, for example).",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-28T18:51:22Z",
      "diff_hunk" : "@@ -273,7 +280,8 @@ CAmount GetBlockSubsidy(int nHeight, const Consensus::Params& consensusParams);\n  *\n  * @param[out]   setFilesToPrune   The set of file indices that can be unlinked will be returned\n  */\n-void FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight);\n+void FindFilesToPruneAuto(std::set<int>& setFilesToPrune);\n+void FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r89851624",
      "id" : 89851624,
      "original_commit_id" : "98470f9d5bc915f74e13a2521541c5da8313bd63",
      "original_position" : 39,
      "path" : "src/main.h",
      "position" : null,
      "pull_request_review_id" : 10383308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89851624",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r89852535"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89852535"
         }
      },
      "body" : "Meta question: why do we need a tristate here? I think we could allow manual pruning even when in 'auto` mode. In that case, manual-only pruning could be requested by setting the limit very high.",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-11-28T18:55:40Z",
      "diff_hunk" : "@@ -191,8 +191,10 @@ static const uint64_t nMinDiskSpace = 52428800;\n /** Pruning-related variables and constants */\n /** True if any block files have ever been pruned. */\n extern bool fHavePruned;\n-/** True if we're running in -prune mode. */\n-extern bool fPruneMode;\n+enum struct PruneMode {NONE=0, AUTO, MANUAL};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r89852535",
      "id" : 89852535,
      "original_commit_id" : "342262d9a9aa784e40a309d8e76b0ed36e367e6f",
      "original_position" : 6,
      "path" : "src/main.h",
      "position" : null,
      "pull_request_review_id" : 10383308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/89852535",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=3",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "body" : "So, originally I thought it was simpler to make manual pruning a separate mode from autoprune.  After sipa's question and giving this a little more thought, I agree that it should be the same.  So, now setting prune=1 (manual pruning) means autoprune with target=max. \r\n\r\nSorry for the late change in approach.  This makes the diff smaller, though. \r\n\r\nAlso, now I only expose in main.h that which is used elsewhere.",
      "created_at" : "2016-12-01T19:17:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-264266003",
      "id" : 264266003,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-12-01T19:17:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264266003",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7504522?v=3",
         "events_url" : "https://api.github.com/users/mrbandrews/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrbandrews/followers",
         "following_url" : "https://api.github.com/users/mrbandrews/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrbandrews/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrbandrews",
         "id" : 7504522,
         "login" : "mrbandrews",
         "organizations_url" : "https://api.github.com/users/mrbandrews/orgs",
         "received_events_url" : "https://api.github.com/users/mrbandrews/received_events",
         "repos_url" : "https://api.github.com/users/mrbandrews/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrbandrews/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrbandrews/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrbandrews"
      }
   },
   {
      "body" : "Rebased. ",
      "created_at" : "2016-12-07T15:48:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-265483410",
      "id" : 265483410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-12-07T15:48:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/265483410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7504522?v=3",
         "events_url" : "https://api.github.com/users/mrbandrews/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrbandrews/followers",
         "following_url" : "https://api.github.com/users/mrbandrews/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrbandrews/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrbandrews",
         "id" : 7504522,
         "login" : "mrbandrews",
         "organizations_url" : "https://api.github.com/users/mrbandrews/orgs",
         "received_events_url" : "https://api.github.com/users/mrbandrews/received_events",
         "repos_url" : "https://api.github.com/users/mrbandrews/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrbandrews/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrbandrews/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrbandrews"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r92273296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92273296"
         }
      },
      "body" : "Do you actually need to override this method? Would it work to just change num_nodes from 3 to 5 in the constructor above? Maybe add a comment here if keeping this is necessary.",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-12-13T21:43:55Z",
      "diff_hunk" : "@@ -31,6 +31,10 @@ def __init__(self):\n         self.utxo_cache_0 = []\n         self.utxo_cache_1 = []\n \n+    def setup_chain(self):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r92273296",
      "id" : 92273296,
      "original_commit_id" : "485684c748b477caee06bcaad207eeb805b6c3a2",
      "original_position" : 4,
      "path" : "qa/rpc-tests/pruning.py",
      "position" : null,
      "pull_request_review_id" : 12785955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92273296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r92276266"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92276266"
         }
      },
      "body" : "I think this would be clearer if the comment said specifically what was being tested and what the connection to #7494 is, e.g. \"Check that wallet loads loads successfully when restarting a pruned node after an IBD. This was reported to fail in #7494.\"",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-12-13T21:59:31Z",
      "diff_hunk" : "@@ -212,6 +227,90 @@ def reorg_back(self):\n         # Verify we can now have the data for a block previously pruned\n         assert(self.nodes[2].getblock(self.forkhash)[\"height\"] == self.forkheight)\n \n+    def manual_test(self):\n+        self.nodes[3] = start_node(3, self.options.tmpdir, [\"-debug=0\",\"-prune=1\"], timewait=900)\n+        assert_equal(self.nodes[3].getblockcount(), 995)\n+\n+        # should not prune because chain tip of node 3 (995) < PruneAfterHeight (1000)\n+        try:\n+            self.nodes[3].pruneblockchain(500)\n+            raise AssertionError(\"pruneblockchain should have failed because not yet at PruneAfterHeight\")\n+        except JSONRPCException as e:\n+            pass\n+\n+        # mine 6 blocks so we are at height 1001 (i.e., above PruneAfterHeight)\n+        self.nodes[3].generate(6)\n+\n+        # negative and zero inputs should raise an exception\n+        try:\n+            self.nodes[3].pruneblockchain(-10)\n+            raise AssertionError(\"pruneblockchain(-10) should have failed.\")\n+        except:\n+            pass\n+\n+        try:\n+            self.nodes[3].pruneblockchain(0)\n+            raise AssertionError(\"pruneblockchain(0) should have failed.\")\n+        except:\n+            pass\n+\n+        # height=100 too low to prune first block file so this is a no-op\n+        self.nodes[3].pruneblockchain(100)\n+        if not os.path.isfile(self.manualdir+\"blk00000.dat\"):\n+            raise AssertionError(\"blk00000.dat is missing when should still be there\")\n+\n+        # height=500 should prune first file\n+        self.nodes[3].pruneblockchain(500)\n+        if os.path.isfile(self.manualdir+\"blk00000.dat\"):\n+            raise AssertionError(\"blk00000.dat is still there, should be pruned by now\")\n+        if not os.path.isfile(self.manualdir+\"blk00001.dat\"):\n+            raise AssertionError(\"blk00001.dat is missing when should still be there\")\n+\n+        # height=650 should prune second file\n+        self.nodes[3].pruneblockchain(650)\n+        if os.path.isfile(self.manualdir+\"blk00001.dat\"):\n+            raise AssertionError(\"blk00001.dat is still there, should be pruned by now\")\n+\n+        # height=1000 should not prune anything more, because tip-288 is in blk00002.dat.\n+        self.nodes[3].pruneblockchain(1000)\n+        if not os.path.isfile(self.manualdir+\"blk00002.dat\"):\n+            raise AssertionError(\"blk00002.dat is still there, should be pruned by now\")\n+\n+        # advance the tip so blk00002.dat and blk00003.dat can be pruned (the last 288 blocks should now be in blk00004.dat)\n+        self.nodes[3].generate(288)\n+        self.nodes[3].pruneblockchain(1000)\n+        if os.path.isfile(self.manualdir+\"blk00002.dat\"):\n+            raise AssertionError(\"blk00002.dat is still there, should be pruned by now\")\n+        if os.path.isfile(self.manualdir+\"blk00003.dat\"):\n+            raise AssertionError(\"blk00003.dat is still there, should be pruned by now\")\n+\n+        # stop node, start back up with auto-prune at 550MB, make sure still runs\n+        stop_node(self.nodes[3],3)\n+        self.nodes[3] = start_node(3, self.options.tmpdir, [\"-debug=0\",\"-prune=550\"], timewait=900)\n+\n+        print(\"Success\")\n+\n+    def wallet_test(self):\n+        # check that the pruning node's wallet is still in good shape\n+        print(\"Stop and start pruning node to trigger wallet rescan\")\n+        try:\n+            stop_node(self.nodes[2], 2)\n+            start_node(2, self.options.tmpdir, [\"-debug=1\",\"-prune=550\"])\n+            print(\"Success\")\n+        except Exception as detail:\n+            raise AssertionError(\"Wallet test: unable to re-start the pruning node\")\n+\n+        # connect a new node for IBD while pruning, then check wallet (see issue #7494)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r92276266",
      "id" : 92276266,
      "original_commit_id" : "485684c748b477caee06bcaad207eeb805b6c3a2",
      "original_position" : 120,
      "path" : "qa/rpc-tests/pruning.py",
      "position" : null,
      "pull_request_review_id" : 12785955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92276266",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r92277626"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92277626"
         }
      },
      "body" : "Might be good to check for the specific error messages here and below, e.g. `assert_raises_message(JSONRPCException, \"Blockchain is too short for pruning.\", self.nodes[3].pruneblockchain, 500)`",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-12-13T22:06:10Z",
      "diff_hunk" : "@@ -212,6 +227,90 @@ def reorg_back(self):\n         # Verify we can now have the data for a block previously pruned\n         assert(self.nodes[2].getblock(self.forkhash)[\"height\"] == self.forkheight)\n \n+    def manual_test(self):\n+        self.nodes[3] = start_node(3, self.options.tmpdir, [\"-debug=0\",\"-prune=1\"], timewait=900)\n+        assert_equal(self.nodes[3].getblockcount(), 995)\n+\n+        # should not prune because chain tip of node 3 (995) < PruneAfterHeight (1000)\n+        try:\n+            self.nodes[3].pruneblockchain(500)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r92277626",
      "id" : 92277626,
      "original_commit_id" : "485684c748b477caee06bcaad207eeb805b6c3a2",
      "original_position" : 53,
      "path" : "qa/rpc-tests/pruning.py",
      "position" : null,
      "pull_request_review_id" : 12785955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92277626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r92277871"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92277871"
         }
      },
      "body" : "Could add a python test for this condition.",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2016-12-13T22:07:12Z",
      "diff_hunk" : "@@ -814,6 +814,36 @@ static bool GetUTXOStats(CCoinsView *view, CCoinsStats &stats)\n     return true;\n }\n \n+UniValue pruneblockchain(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() != 1)\n+        throw runtime_error(\n+            \"pruneblockchain\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"height\\\"       (int, required) The block height to prune up to.\\n\");\n+\n+    if (!fPruneMode)\n+        throw JSONRPCError(RPC_METHOD_NOT_FOUND, \"Cannot prune blocks because node is not in prune mode.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r92277871",
      "id" : 92277871,
      "original_commit_id" : "485684c748b477caee06bcaad207eeb805b6c3a2",
      "original_position" : 13,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 12785955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-10T22:24:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/92277871",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "Added a commit with edits to python test per ryanofsky review. \r\n",
      "created_at" : "2016-12-14T14:18:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-267044721",
      "id" : 267044721,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-12-14T14:18:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/267044721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7504522?v=3",
         "events_url" : "https://api.github.com/users/mrbandrews/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mrbandrews/followers",
         "following_url" : "https://api.github.com/users/mrbandrews/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mrbandrews/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mrbandrews",
         "id" : 7504522,
         "login" : "mrbandrews",
         "organizations_url" : "https://api.github.com/users/mrbandrews/orgs",
         "received_events_url" : "https://api.github.com/users/mrbandrews/received_events",
         "repos_url" : "https://api.github.com/users/mrbandrews/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mrbandrews/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mrbandrews/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mrbandrews"
      }
   },
   {
      "body" : "This is very useful for me. I'm doing some testing on this now. My application is a sql db on top of the blockchain that depends on processing incoming blocks. After processed into sql the block data is never used again so it's ideal if it can be pruned to save space, especially as I'm paying per GB on a cloud server.\r\n\r\nManual pruning allows me to start processing blocks while still syncing the chain without worry about blocks being pruned before I get to them. I had a workaround for this that disabled network access when the pruning was approaching the current block being worked on. So this is a much nicer approach and I feel there are probably more use cases for this. \r\n\r\nI noticed that the man pages are not updated with this. The cmd line help does indicate prune=1 available but the man page misses that updated detail. So it may be nice to update that page too.\r\n\r\nCurrently it appears to be working but I am still in progress with a new full sync and I'm watching that pruning of block files trails behind my block processor as expected.",
      "created_at" : "2016-12-29T09:19:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-269602358",
      "id" : 269602358,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2016-12-29T09:19:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/269602358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5811476?v=3",
         "events_url" : "https://api.github.com/users/neocogent/events{/privacy}",
         "followers_url" : "https://api.github.com/users/neocogent/followers",
         "following_url" : "https://api.github.com/users/neocogent/following{/other_user}",
         "gists_url" : "https://api.github.com/users/neocogent/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/neocogent",
         "id" : 5811476,
         "login" : "neocogent",
         "organizations_url" : "https://api.github.com/users/neocogent/orgs",
         "received_events_url" : "https://api.github.com/users/neocogent/received_events",
         "repos_url" : "https://api.github.com/users/neocogent/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/neocogent/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/neocogent/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/neocogent"
      }
   },
   {
      "body" : "I rebased this, updated the man pages, and squashed the test commit.",
      "created_at" : "2017-01-03T15:28:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-270139936",
      "id" : 270139936,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2017-01-03T15:28:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/270139936",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "body" : "utACK. Great feature!",
      "created_at" : "2017-01-08T03:40:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-271127492",
      "id" : 271127492,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2017-01-08T03:40:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271127492",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "One question: I view this feature as the perfect compliment to importmulti, that lets you be sure you've imported all your keys before you prune.  But importmulti takes its scanning argument as a timestamp, while this takes it's argument as a height.  Should we also support a timestamp option here that uses the same criteria as import multi? \r\n\r\nEdit: I think I will fix this by adding a height based option to importmulti.",
      "created_at" : "2017-01-08T03:52:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-271127917",
      "id" : 271127917,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2017-01-08T08:17:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271127917",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/858454?v=3",
         "events_url" : "https://api.github.com/users/gmaxwell/events{/privacy}",
         "followers_url" : "https://api.github.com/users/gmaxwell/followers",
         "following_url" : "https://api.github.com/users/gmaxwell/following{/other_user}",
         "gists_url" : "https://api.github.com/users/gmaxwell/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/gmaxwell",
         "id" : 858454,
         "login" : "gmaxwell",
         "organizations_url" : "https://api.github.com/users/gmaxwell/orgs",
         "received_events_url" : "https://api.github.com/users/gmaxwell/received_events",
         "repos_url" : "https://api.github.com/users/gmaxwell/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/gmaxwell/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/gmaxwell"
      }
   },
   {
      "body" : "Rebased for named arguments.\r\n\r\n@gmaxwell, I extended pruneblockchain in afffeea7d98ba358acd54a89bc0e7ae1c4d54023 to be able to take a timestamp instead of a block index. The code change is pretty small. The test change is bigger but straightforward. ",
      "created_at" : "2017-01-10T22:32:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#issuecomment-271719537",
      "id" : 271719537,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7871",
      "updated_at" : "2017-01-10T22:32:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/271719537",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r95577623"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95577623"
         }
      },
      "body" : "one post merge nit:\r\nWe should probably report the pruned height in case the user given value was overrode. ",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2017-01-11T13:30:03Z",
      "diff_hunk" : "@@ -814,6 +814,46 @@ static bool GetUTXOStats(CCoinsView *view, CCoinsStats &stats)\n     return true;\n }\n \n+UniValue pruneblockchain(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() != 1)\n+        throw runtime_error(\n+            \"pruneblockchain\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"height\\\"       (numeric, required) The block height to prune up to. May be set to a discrete height, or to a unix timestamp to prune based on block time.\\n\");\n+\n+    if (!fPruneMode)\n+        throw JSONRPCError(RPC_METHOD_NOT_FOUND, \"Cannot prune blocks because node is not in prune mode.\");\n+\n+    LOCK(cs_main);\n+\n+    int heightParam = request.params[0].get_int();\n+    if (heightParam < 0)\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Negative block height.\");\n+\n+    // Height value more than a billion is too high to be a block height, and\n+    // too low to be a block time (corresponds to timestamp from Sep 2001).\n+    if (heightParam > 1000000000) {\n+        CBlockIndex* pindex = chainActive.FindLatestBefore(heightParam);\n+        if (!pindex) {\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, \"Could not find block before specified timestamp.\");\n+        }\n+        heightParam = pindex->nHeight;\n+    }\n+\n+    unsigned int height = (unsigned int) heightParam;\n+    unsigned int chainHeight = (unsigned int) chainActive.Height();\n+    if (chainHeight < Params().PruneAfterHeight())\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Blockchain is too short for pruning.\");\n+    else if (height > chainHeight)\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Blockchain is shorter than the attempted prune height.\");\n+    else if (height > chainHeight - MIN_BLOCKS_TO_KEEP)\n+        LogPrint(\"rpc\", \"Attempt to prune blocks close to the tip.  Retaining the minimum number of blocks.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r95577623",
      "id" : 95577623,
      "original_commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "original_position" : 38,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 38,
      "pull_request_review_id" : 16136520,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-11T13:30:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95577623",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r95653011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95653011"
         }
      },
      "body" : "Done in https://github.com/bitcoin/bitcoin/pull/9518",
      "commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "created_at" : "2017-01-11T19:32:16Z",
      "diff_hunk" : "@@ -814,6 +814,46 @@ static bool GetUTXOStats(CCoinsView *view, CCoinsStats &stats)\n     return true;\n }\n \n+UniValue pruneblockchain(const JSONRPCRequest& request)\n+{\n+    if (request.fHelp || request.params.size() != 1)\n+        throw runtime_error(\n+            \"pruneblockchain\\n\"\n+            \"\\nArguments:\\n\"\n+            \"1. \\\"height\\\"       (numeric, required) The block height to prune up to. May be set to a discrete height, or to a unix timestamp to prune based on block time.\\n\");\n+\n+    if (!fPruneMode)\n+        throw JSONRPCError(RPC_METHOD_NOT_FOUND, \"Cannot prune blocks because node is not in prune mode.\");\n+\n+    LOCK(cs_main);\n+\n+    int heightParam = request.params[0].get_int();\n+    if (heightParam < 0)\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Negative block height.\");\n+\n+    // Height value more than a billion is too high to be a block height, and\n+    // too low to be a block time (corresponds to timestamp from Sep 2001).\n+    if (heightParam > 1000000000) {\n+        CBlockIndex* pindex = chainActive.FindLatestBefore(heightParam);\n+        if (!pindex) {\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, \"Could not find block before specified timestamp.\");\n+        }\n+        heightParam = pindex->nHeight;\n+    }\n+\n+    unsigned int height = (unsigned int) heightParam;\n+    unsigned int chainHeight = (unsigned int) chainActive.Height();\n+    if (chainHeight < Params().PruneAfterHeight())\n+        throw JSONRPCError(RPC_INTERNAL_ERROR, \"Blockchain is too short for pruning.\");\n+    else if (height > chainHeight)\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Blockchain is shorter than the attempted prune height.\");\n+    else if (height > chainHeight - MIN_BLOCKS_TO_KEEP)\n+        LogPrint(\"rpc\", \"Attempt to prune blocks close to the tip.  Retaining the minimum number of blocks.\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7871#discussion_r95653011",
      "id" : 95653011,
      "original_commit_id" : "afffeea7d98ba358acd54a89bc0e7ae1c4d54023",
      "original_position" : 38,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 38,
      "pull_request_review_id" : 16216284,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7871",
      "updated_at" : "2017-01-11T19:32:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/95653011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=3",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
