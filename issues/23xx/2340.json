{
   "assignee" : null,
   "body" : "Set nLockTime on wallet transactions (only, no RPC changes) such that they can only be mined by the next block, rather than a block orphaning the current best block. There are two reasons to do this, the first is the minor benefit that using nLockTime ensures related bugs get caught immediately, so protocols that need that feature don't become \"unusual\" transactions with flaky behavior.\r\n\r\nThe more important reason is to discourage \"fee sniping\" by deliberately mining blocks that orphan the current best block. Basically for a large miner the value of the transactions in the best block and the mempool can exceed the cost of deliberately attempting to mine two blocks to orphan the best block. However with nLockTime you'll soon run out of transactions you can put in the first block, which means they now need to go in the second. With limited block sizes you're run out of room, and additionally another miner now only needs to orphan one block to in-turn snipe the high-fee transactions you had to place in the second block, wrecking all your hard work.\r\n    \r\nOf course, the subsidy is high enough, and transaction volume low enough, that fee sniping isn't a problem yet, but by implementing a fix now we ensure code won't be written that makes assumptions about nLockTime that preclude a fix later. Transaction propagation is not impacted; even with non-final is non-standard the best block height implies we have at least one peer, and very soon more peers, that will accept and rebroadcast the transaction immediately.\r\n\r\n## Testing\r\n\r\n### Unit tests\r\n\r\nPass\r\n\r\n### Propagation\r\n\r\nNo issues. Used -blocknotify='bitcoind sendtoaddress' to send transactions as soon as a few block is found with worst-case of a node connected to only two 0.8 peers. Enabled -logtimestamps w/ ntp on that node and another node, and every transaction got to the second node within 5 seconds.\r\n\r\n### Services\r\n\r\nNo problems:\r\n\r\nEasywallet, Instawallet, Coinbase Wallet, Coinbase Merchant Services, Blockchain.info, BitPay, bitfetch, localbitcoins\r\n\r\nWon't accept until 1 confirmation:\r\n\r\nSatoshidice\r\n\r\nMost likely SatoshiDice implemented nLockTime == 0 rather than IsFinal() as their never-confirm nLockTime fix. I think there is an argument to be made that forcing them to make a minor change like this one would be a good way to test the waters to see if they'll make a more drastic change, as would be required if we make dust outputs non-standard.",
   "closed_at" : "2014-12-19T17:54:54Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 78,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2340/comments",
   "created_at" : "2013-03-01T11:09:14Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2340/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/2340",
   "id" : 11540169,
   "labels" : [
      {
         "color" : "02d7e1",
         "name" : "Wallet",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2340/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 2340,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/2340.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/2340",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/2340.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/2340"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Discourage fee sniping with nLockTime",
   "updated_at" : "2014-12-23T19:22:55Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/2340",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/7042?v=3",
      "events_url" : "https://api.github.com/users/petertodd/events{/privacy}",
      "followers_url" : "https://api.github.com/users/petertodd/followers",
      "following_url" : "https://api.github.com/users/petertodd/following{/other_user}",
      "gists_url" : "https://api.github.com/users/petertodd/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/petertodd",
      "id" : 7042,
      "login" : "petertodd",
      "organizations_url" : "https://api.github.com/users/petertodd/orgs",
      "received_events_url" : "https://api.github.com/users/petertodd/received_events",
      "repos_url" : "https://api.github.com/users/petertodd/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/petertodd/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/petertodd"
   }
}
