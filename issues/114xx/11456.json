{
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "This was mostly written as a way to clean things up so that the NETWORK_LIMITED PR (#10387) can be simplified a ton, but its also a nice standalone cleanup that will also require a bit of review because it tweaks a lot of stuff across net. The new functions are fine in protocol.h right now since they're straight-forward, but after NETWORK_LIMITED will really want to move elsewhere after @theuni moves the nServices-based selection to addrman from connman.\r\n\r\nAdds HasAllRelevantServices and GetRelevantServices, which check\r\nfor NETWORK|WITNESS.\r\n\r\nThis changes the following:\r\n * Removes nRelevantServices from CConnman, disconnecting it a bit\r\n   more from protocol-level logic.\r\n * Replaces our sometimes-connect-to-!WITNESS-nodes logic with\r\n   simply always requiring WITNESS|NETWORK for outbound non-feeler\r\n   connections (feelers still only require NETWORK).\r\n * This has the added benefit of removing nServicesExpected from\r\n   CNode - instead letting net_processing's VERSION message\r\n   handling simply check HasAllRelevantServices.\r\n * This implies we believe WITNESS nodes to continue to be a\r\n   significant majority of nodes on the network, but also because\r\n   we cannot sync properly from !WITNESS nodes, it is strange to\r\n   continue using our valuable outbound slots on them.\r\n * In order to prevent this change from preventing connection to\r\n   -connect= nodes which have !WITNESS, -connect nodes are now\r\n   given the \"addnode\" flag. This also allows outbound connections\r\n   to !NODE_NETWORK nodes for -connect nodes (which was already true\r\n   of addnodes).\r\n * Has the (somewhat unintended) consequence of changing one of the\r\n   eviction metrics from the same\r\n   sometimes-connect-to-!WITNESS-nodes metric to requiring\r\n   HasRelevantServices.\r\n\r\nThis should make NODE_NETWORK_LIMITED much simpler to implement.",
   "closed_at" : "2017-10-13T22:32:05Z",
   "closed_by" : {
      "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
      "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sipa/followers",
      "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sipa",
      "id" : 548488,
      "login" : "sipa",
      "organizations_url" : "https://api.github.com/users/sipa/orgs",
      "received_events_url" : "https://api.github.com/users/sipa/received_events",
      "repos_url" : "https://api.github.com/users/sipa/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sipa"
   },
   "comments" : 20,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456/comments",
   "created_at" : "2017-10-05T15:18:23Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456",
   "id" : 263165008,
   "labels" : [
      {
         "color" : "006b75",
         "default" : false,
         "id" : 98298007,
         "name" : "P2P",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 11456,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/11456.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11456",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/11456.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11456"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Replace relevant services logic with a function suite.",
   "updated_at" : "2017-10-13T22:32:05Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11456",
   "user" : {
      "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
      "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
      "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/TheBlueMatt",
      "id" : 649246,
      "login" : "TheBlueMatt",
      "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
      "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
      "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/TheBlueMatt"
   }
}
