[
   {
      "author_association" : "OWNER",
      "body" : "Concept ACK",
      "created_at" : "2017-10-10T20:26:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#issuecomment-335597201",
      "id" : 335597201,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11476",
      "updated_at" : "2017-10-10T20:26:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/335597201",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Nice clean PR!\r\nutACK ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "created_at" : "2017-10-10T20:38:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#issuecomment-335600593",
      "id" : 335600593,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11476",
      "updated_at" : "2017-10-10T20:38:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/335600593",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2017-10-11T02:46:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#issuecomment-335665977",
      "id" : 335665977,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11476",
      "updated_at" : "2017-10-11T02:46:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/335665977",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3211283?v=4",
         "events_url" : "https://api.github.com/users/MeshCollider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MeshCollider/followers",
         "following_url" : "https://api.github.com/users/MeshCollider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MeshCollider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MeshCollider",
         "id" : 3211283,
         "login" : "MeshCollider",
         "organizations_url" : "https://api.github.com/users/MeshCollider/orgs",
         "received_events_url" : "https://api.github.com/users/MeshCollider/received_events",
         "repos_url" : "https://api.github.com/users/MeshCollider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MeshCollider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MeshCollider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MeshCollider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144024650"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144024650"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Use same format as below: `CDB: Can't open database %s (open error %d)\"`.",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T14:15:24Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144024650",
      "id" : 144024650,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 12,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 68621896,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:00:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144024650",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144024708"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144024708"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Remove newline?",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T14:15:35Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //\n+                // Bitcoin will never create different databases with the same\n+                // fileid, but this error can be triggered if users manually\n+                // copy database files.\n+                u_int8_t fileid[DB_FILE_ID_LEN];\n+                ret = pdb->get_mpf()->get_fileid(fileid);\n+                if (ret != 0) {\n+                    error = strprintf(\"CDB: Can't open database %s (get_fileid error %d)\\n\", strFilename, ret);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144024708",
      "id" : 144024708,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 25,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 68621896,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:00:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144024708",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144025388"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144025388"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This error overrides the previous.",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T14:17:50Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //\n+                // Bitcoin will never create different databases with the same\n+                // fileid, but this error can be triggered if users manually\n+                // copy database files.\n+                u_int8_t fileid[DB_FILE_ID_LEN];\n+                ret = pdb->get_mpf()->get_fileid(fileid);\n+                if (ret != 0) {\n+                    error = strprintf(\"CDB: Can't open database %s (get_fileid error %d)\\n\", strFilename, ret);\n+                }\n+\n+                for (const auto& item : env->mapDb) {\n+                    u_int8_t item_fileid[DB_FILE_ID_LEN];\n+                    if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&\n+                        memcmp(fileid, item_fileid, sizeof(fileid)) == 0) {\n+                        const char* item_filename = nullptr;\n+                        item.second->get_dbname(&item_filename, nullptr);\n+                        error = strprintf(\"CDB: Can't open database %s (duplicates fileid %s from %s)\", strFilename,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144025388",
      "id" : 144025388,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 34,
      "path" : "src/wallet/db.cpp",
      "position" : 32,
      "pull_request_review_id" : 68621896,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:00:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144025388",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144025692"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144025692"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should `+= std::endl +` instead?",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T14:18:47Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //\n+                // Bitcoin will never create different databases with the same\n+                // fileid, but this error can be triggered if users manually\n+                // copy database files.\n+                u_int8_t fileid[DB_FILE_ID_LEN];\n+                ret = pdb->get_mpf()->get_fileid(fileid);\n+                if (ret != 0) {\n+                    error = strprintf(\"CDB: Can't open database %s (get_fileid error %d)\\n\", strFilename, ret);\n+                }\n+\n+                for (const auto& item : env->mapDb) {\n+                    u_int8_t item_fileid[DB_FILE_ID_LEN];\n+                    if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&\n+                        memcmp(fileid, item_fileid, sizeof(fileid)) == 0) {\n+                        const char* item_filename = nullptr;\n+                        item.second->get_dbname(&item_filename, nullptr);\n+                        error = strprintf(\"CDB: Can't open database %s (duplicates fileid %s from %s)\", strFilename,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144025692",
      "id" : 144025692,
      "in_reply_to_id" : 144025388,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 34,
      "path" : "src/wallet/db.cpp",
      "position" : 32,
      "pull_request_review_id" : 68621896,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:00:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144025692",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144025803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144025803"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Use `os.path.join`?",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T14:19:11Z",
      "diff_hunk" : "@@ -29,6 +30,10 @@ def run_test(self):\n         os.mkdir(os.path.join(self.options.tmpdir, 'node0', 'regtest', 'w11'))\n         self.assert_start_raises_init_error(0, ['-wallet=w11'], 'Error loading wallet w11. -wallet filename must be a regular file.')\n \n+        # should not initialize if one wallet is a copy of another\n+        shutil.copyfile(self.options.tmpdir + \"/node0/regtest/w2\", self.options.tmpdir + \"/node0/regtest/w22\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144025803",
      "id" : 144025803,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 13,
      "path" : "test/functional/multiwallet.py",
      "position" : null,
      "pull_request_review_id" : 68621896,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:00:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144025803",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144025939"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144025939"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, remove empty line.",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T14:19:37Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144025939",
      "id" : 144025939,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 18,
      "path" : "src/wallet/db.cpp",
      "position" : 22,
      "pull_request_review_id" : 68621896,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:00:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144025939",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144026458"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144026458"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Only `for` when `ret == 0`? ",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T14:21:09Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //\n+                // Bitcoin will never create different databases with the same\n+                // fileid, but this error can be triggered if users manually\n+                // copy database files.\n+                u_int8_t fileid[DB_FILE_ID_LEN];\n+                ret = pdb->get_mpf()->get_fileid(fileid);\n+                if (ret != 0) {\n+                    error = strprintf(\"CDB: Can't open database %s (get_fileid error %d)\\n\", strFilename, ret);\n+                }\n+\n+                for (const auto& item : env->mapDb) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144026458",
      "id" : 144026458,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 28,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 68621896,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:00:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144026458",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144026913"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144026913"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Break on first duplicate?",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T14:22:34Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //\n+                // Bitcoin will never create different databases with the same\n+                // fileid, but this error can be triggered if users manually\n+                // copy database files.\n+                u_int8_t fileid[DB_FILE_ID_LEN];\n+                ret = pdb->get_mpf()->get_fileid(fileid);\n+                if (ret != 0) {\n+                    error = strprintf(\"CDB: Can't open database %s (get_fileid error %d)\\n\", strFilename, ret);\n+                }\n+\n+                for (const auto& item : env->mapDb) {\n+                    u_int8_t item_fileid[DB_FILE_ID_LEN];\n+                    if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&\n+                        memcmp(fileid, item_fileid, sizeof(fileid)) == 0) {\n+                        const char* item_filename = nullptr;\n+                        item.second->get_dbname(&item_filename, nullptr);\n+                        error = strprintf(\"CDB: Can't open database %s (duplicates fileid %s from %s)\", strFilename,\n+                            HexStr(std::begin(item_fileid), std::end(item_fileid)),\n+                            item_filename ? item_filename : \"\");\n+                    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144026913",
      "id" : 144026913,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 37,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 68624587,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:00:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144026913",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144054997"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144054997"
         }
      },
      "author_association" : "OWNER",
      "body" : "I guess the reason for storing the error in a string, and not just raising the exceptions at the place the error occurs, above, is to avoid duplicating this cleanup code?\r\nIt seems a bit circuitous, but I understand. An alternative would be to wrap these operations in a RAII operation.",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T15:51:05Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //\n+                // Bitcoin will never create different databases with the same\n+                // fileid, but this error can be triggered if users manually\n+                // copy database files.\n+                u_int8_t fileid[DB_FILE_ID_LEN];\n+                ret = pdb->get_mpf()->get_fileid(fileid);\n+                if (ret != 0) {\n+                    error = strprintf(\"CDB: Can't open database %s (get_fileid error %d)\\n\", strFilename, ret);\n+                }\n+\n+                for (const auto& item : env->mapDb) {\n+                    u_int8_t item_fileid[DB_FILE_ID_LEN];\n+                    if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&\n+                        memcmp(fileid, item_fileid, sizeof(fileid)) == 0) {\n+                        const char* item_filename = nullptr;\n+                        item.second->get_dbname(&item_filename, nullptr);\n+                        error = strprintf(\"CDB: Can't open database %s (duplicates fileid %s from %s)\", strFilename,\n+                            HexStr(std::begin(item_fileid), std::end(item_fileid)),\n+                            item_filename ? item_filename : \"\");\n+                    }\n+                }\n+            }\n+\n+            if (!error.empty()) {\n                 delete pdb;\n                 pdb = nullptr;\n                 --env->mapFileUseCount[strFile];\n                 strFile = \"\";\n-                throw std::runtime_error(strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename));\n+                throw std::runtime_error(error);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144054997",
      "id" : 144054997,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 47,
      "path" : "src/wallet/db.cpp",
      "position" : 46,
      "pull_request_review_id" : 68657976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:00:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144054997",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144099683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144099683"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Didn't do this to avoid changing the existing error message.",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T18:38:00Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144099683",
      "id" : 144099683,
      "in_reply_to_id" : 144024650,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 12,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 68709318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:03:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144099683",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144100229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144100229"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's intended to be a new paragraph.",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T18:40:09Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144100229",
      "id" : 144100229,
      "in_reply_to_id" : 144025939,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 18,
      "path" : "src/wallet/db.cpp",
      "position" : 22,
      "pull_request_review_id" : 68709318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:03:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144100229",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144100297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144100297"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch, removed in e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T18:40:24Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //\n+                // Bitcoin will never create different databases with the same\n+                // fileid, but this error can be triggered if users manually\n+                // copy database files.\n+                u_int8_t fileid[DB_FILE_ID_LEN];\n+                ret = pdb->get_mpf()->get_fileid(fileid);\n+                if (ret != 0) {\n+                    error = strprintf(\"CDB: Can't open database %s (get_fileid error %d)\\n\", strFilename, ret);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144100297",
      "id" : 144100297,
      "in_reply_to_id" : 144024708,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 25,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 68709318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:03:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144100297",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144100342"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144100342"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T18:40:36Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //\n+                // Bitcoin will never create different databases with the same\n+                // fileid, but this error can be triggered if users manually\n+                // copy database files.\n+                u_int8_t fileid[DB_FILE_ID_LEN];\n+                ret = pdb->get_mpf()->get_fileid(fileid);\n+                if (ret != 0) {\n+                    error = strprintf(\"CDB: Can't open database %s (get_fileid error %d)\\n\", strFilename, ret);\n+                }\n+\n+                for (const auto& item : env->mapDb) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144100342",
      "id" : 144100342,
      "in_reply_to_id" : 144026458,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 28,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 68709318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:03:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144100342",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144100621"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144100621"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed override in e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f, but I'm not clear on what std::endl comment is referring to.",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T18:41:45Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //\n+                // Bitcoin will never create different databases with the same\n+                // fileid, but this error can be triggered if users manually\n+                // copy database files.\n+                u_int8_t fileid[DB_FILE_ID_LEN];\n+                ret = pdb->get_mpf()->get_fileid(fileid);\n+                if (ret != 0) {\n+                    error = strprintf(\"CDB: Can't open database %s (get_fileid error %d)\\n\", strFilename, ret);\n+                }\n+\n+                for (const auto& item : env->mapDb) {\n+                    u_int8_t item_fileid[DB_FILE_ID_LEN];\n+                    if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&\n+                        memcmp(fileid, item_fileid, sizeof(fileid)) == 0) {\n+                        const char* item_filename = nullptr;\n+                        item.second->get_dbname(&item_filename, nullptr);\n+                        error = strprintf(\"CDB: Can't open database %s (duplicates fileid %s from %s)\", strFilename,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144100621",
      "id" : 144100621,
      "in_reply_to_id" : 144025388,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 34,
      "path" : "src/wallet/db.cpp",
      "position" : 32,
      "pull_request_review_id" : 68709318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:03:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144100621",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144100680"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144100680"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T18:41:59Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //\n+                // Bitcoin will never create different databases with the same\n+                // fileid, but this error can be triggered if users manually\n+                // copy database files.\n+                u_int8_t fileid[DB_FILE_ID_LEN];\n+                ret = pdb->get_mpf()->get_fileid(fileid);\n+                if (ret != 0) {\n+                    error = strprintf(\"CDB: Can't open database %s (get_fileid error %d)\\n\", strFilename, ret);\n+                }\n+\n+                for (const auto& item : env->mapDb) {\n+                    u_int8_t item_fileid[DB_FILE_ID_LEN];\n+                    if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&\n+                        memcmp(fileid, item_fileid, sizeof(fileid)) == 0) {\n+                        const char* item_filename = nullptr;\n+                        item.second->get_dbname(&item_filename, nullptr);\n+                        error = strprintf(\"CDB: Can't open database %s (duplicates fileid %s from %s)\", strFilename,\n+                            HexStr(std::begin(item_fileid), std::end(item_fileid)),\n+                            item_filename ? item_filename : \"\");\n+                    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144100680",
      "id" : 144100680,
      "in_reply_to_id" : 144026913,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 37,
      "path" : "src/wallet/db.cpp",
      "position" : null,
      "pull_request_review_id" : 68709318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:03:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144100680",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144101092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144101092"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This was one reason. The other reason was wanting the fix to be self-contained and not change existing code.",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T18:43:26Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //\n+                // Bitcoin will never create different databases with the same\n+                // fileid, but this error can be triggered if users manually\n+                // copy database files.\n+                u_int8_t fileid[DB_FILE_ID_LEN];\n+                ret = pdb->get_mpf()->get_fileid(fileid);\n+                if (ret != 0) {\n+                    error = strprintf(\"CDB: Can't open database %s (get_fileid error %d)\\n\", strFilename, ret);\n+                }\n+\n+                for (const auto& item : env->mapDb) {\n+                    u_int8_t item_fileid[DB_FILE_ID_LEN];\n+                    if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&\n+                        memcmp(fileid, item_fileid, sizeof(fileid)) == 0) {\n+                        const char* item_filename = nullptr;\n+                        item.second->get_dbname(&item_filename, nullptr);\n+                        error = strprintf(\"CDB: Can't open database %s (duplicates fileid %s from %s)\", strFilename,\n+                            HexStr(std::begin(item_fileid), std::end(item_fileid)),\n+                            item_filename ? item_filename : \"\");\n+                    }\n+                }\n+            }\n+\n+            if (!error.empty()) {\n                 delete pdb;\n                 pdb = nullptr;\n                 --env->mapFileUseCount[strFile];\n                 strFile = \"\";\n-                throw std::runtime_error(strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename));\n+                throw std::runtime_error(error);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144101092",
      "id" : 144101092,
      "in_reply_to_id" : 144054997,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 47,
      "path" : "src/wallet/db.cpp",
      "position" : 46,
      "pull_request_review_id" : 68709318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:05:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144101092",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144101170"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144101170"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done in e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-11T18:43:41Z",
      "diff_hunk" : "@@ -29,6 +30,10 @@ def run_test(self):\n         os.mkdir(os.path.join(self.options.tmpdir, 'node0', 'regtest', 'w11'))\n         self.assert_start_raises_init_error(0, ['-wallet=w11'], 'Error loading wallet w11. -wallet filename must be a regular file.')\n \n+        # should not initialize if one wallet is a copy of another\n+        shutil.copyfile(self.options.tmpdir + \"/node0/regtest/w2\", self.options.tmpdir + \"/node0/regtest/w22\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144101170",
      "id" : 144101170,
      "in_reply_to_id" : 144025803,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 13,
      "path" : "test/functional/multiwallet.py",
      "position" : null,
      "pull_request_review_id" : 68709318,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-11T19:03:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144101170",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144246064"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144246064"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nevermind, but the suggestion was to accumulate the errors.",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-12T10:08:39Z",
      "diff_hunk" : "@@ -402,11 +403,41 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             0);\n \n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            } else {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //\n+                // Bitcoin will never create different databases with the same\n+                // fileid, but this error can be triggered if users manually\n+                // copy database files.\n+                u_int8_t fileid[DB_FILE_ID_LEN];\n+                ret = pdb->get_mpf()->get_fileid(fileid);\n+                if (ret != 0) {\n+                    error = strprintf(\"CDB: Can't open database %s (get_fileid error %d)\\n\", strFilename, ret);\n+                }\n+\n+                for (const auto& item : env->mapDb) {\n+                    u_int8_t item_fileid[DB_FILE_ID_LEN];\n+                    if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&\n+                        memcmp(fileid, item_fileid, sizeof(fileid)) == 0) {\n+                        const char* item_filename = nullptr;\n+                        item.second->get_dbname(&item_filename, nullptr);\n+                        error = strprintf(\"CDB: Can't open database %s (duplicates fileid %s from %s)\", strFilename,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144246064",
      "id" : 144246064,
      "in_reply_to_id" : 144025388,
      "original_commit_id" : "ebc7c2ff3c31a3a5377e781d2239dae44e7b602e",
      "original_position" : 34,
      "path" : "src/wallet/db.cpp",
      "position" : 32,
      "pull_request_review_id" : 68875696,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-12T10:08:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144246064",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144246373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144246373"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe use the `ret = ...` pattern like above to make easier to read?",
      "commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "created_at" : "2017-10-12T10:10:19Z",
      "diff_hunk" : "@@ -401,12 +401,48 @@ CDB::CDB(CWalletDBWrapper& dbw, const char* pszMode, bool fFlushOnCloseIn) : pdb\n                             nFlags,                             // Flags\n                             0);\n \n+            std::string error;\n             if (ret != 0) {\n+                error = strprintf(\"CDB: Error %d, can't open database %s\", ret, strFilename);\n+            }\n+\n+            u_int8_t fileid[DB_FILE_ID_LEN];\n+            if (error.empty()) {\n+                ret = pdb->get_mpf()->get_fileid(fileid);\n+                if (ret != 0) {\n+                    error = strprintf(\"CDB: Can't open database %s (get_fileid failed with %d)\", strFilename, ret);\n+                }\n+            }\n+\n+            if (error.empty()) {\n+                // Make sure database has a unique fileid. If it doesn't, throw\n+                // an error. BDB caches do not work properly when more than one\n+                // open database has the same fileid (values written to one\n+                // database may show up in reads to other databases).\n+                //\n+                // Bitcoin will never create different databases with the same\n+                // fileid, but this error can be triggered if users manually\n+                // copy database files.\n+                for (const auto& item : env->mapDb) {\n+                    u_int8_t item_fileid[DB_FILE_ID_LEN];\n+                    if (item.second && item.second->get_mpf()->get_fileid(item_fileid) == 0 &&",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#discussion_r144246373",
      "id" : 144246373,
      "original_commit_id" : "e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f",
      "original_position" : 28,
      "path" : "src/wallet/db.cpp",
      "position" : 28,
      "pull_request_review_id" : 68876086,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/11476",
      "updated_at" : "2017-10-12T10:10:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/144246373",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I had to make another change to avoid travis failures. For some reason the get_fileid call was failing with error 22 in accounting tests (strangely only when accounting tests were run in conjunction with other tests, not when running standalone). I fixed it by skipping the get_fileid check on in-memory databases, which actually makes sense anyway.\r\n\r\nUpdated e32c2a51b757ab764ec5dbe8bf04b3fc4aa3cb5f -> 4164132f6b475d3a3b4f1492f22f515cdb98fcd8 ([pr/wid.2](https://github.com/ryanofsky/bitcoin/commits/pr/wid.2) -> [pr/wid.3](https://github.com/ryanofsky/bitcoin/commits/pr/wid.3))",
      "created_at" : "2017-10-12T15:18:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#issuecomment-336170496",
      "id" : 336170496,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11476",
      "updated_at" : "2017-10-12T15:18:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/336170496",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK 4164132f6b475d3a3b4f1492f22f515cdb98fcd8\r\n\r\nI think you could improve the code comment by saying that bdb guarantees file identification strings for different databases to be unique, and perhaps linking to the documentation (https://docs.oracle.com/cd/E17275_01/html/programmer_reference/program_copy.html).",
      "created_at" : "2017-10-12T21:18:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#issuecomment-336273913",
      "id" : 336273913,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11476",
      "updated_at" : "2017-10-12T21:18:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/336273913",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, updated comment 4164132f6b475d3a3b4f1492f22f515cdb98fcd8 -> f98832222c17c25814b9a18859e72f5041dfb55d ([pr/wid.3](https://github.com/ryanofsky/bitcoin/commits/pr/wid.3) -> [pr/wid.4](https://github.com/ryanofsky/bitcoin/commits/pr/wid.4))\r\n\r\nI didn't include the oracle link originally because I wasn't sure if the URL would be stable, but I realize the comment doesn't really make sense without that context, so it seems worth adding.",
      "created_at" : "2017-10-12T21:36:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#issuecomment-336279478",
      "id" : 336279478,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11476",
      "updated_at" : "2017-10-12T21:36:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/336279478",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I didn't include the oracle link originally because I wasn't sure if the URL would be stable\r\n\r\nYes, I considered that as well. I think it's ok to add the link now. If it dies or changes, then the comment can be updated or removed. For now, it's adding useful additional context.\r\n\r\nI can confirm that your new commit updates the comment. It also makes the following change:\r\n\r\n```\r\n-    u_int8_t fileid[DB_FILE_ID_LEN] = {0};\r\n+    u_int8_t fileid[DB_FILE_ID_LEN];\r\n```\r\n\r\nWas that intentional?",
      "created_at" : "2017-10-12T21:57:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#issuecomment-336285860",
      "id" : 336285860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11476",
      "updated_at" : "2017-10-12T21:57:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/336285860",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Was that intentional?\r\n\r\nYeah, I added the zero initialization when the get_fileid call was failing and I was considering making it optional, but it's not needed now.",
      "created_at" : "2017-10-12T22:01:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#issuecomment-336287044",
      "id" : 336287044,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11476",
      "updated_at" : "2017-10-12T22:01:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/336287044",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Tested ACK f98832222c17c25814b9a18859e72f5041dfb55d",
      "created_at" : "2017-10-13T19:09:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#issuecomment-336541882",
      "id" : 336541882,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11476",
      "updated_at" : "2017-10-13T19:09:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/336541882",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/1063656?v=4",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "Needs rebase for #11492, otherwise seems ready to merge.",
      "created_at" : "2017-10-19T13:07:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#issuecomment-337902107",
      "id" : 337902107,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11476",
      "updated_at" : "2017-10-19T13:07:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/337902107",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased f98832222c17c25814b9a18859e72f5041dfb55d -> 478a89c1ef79a75275d1b508122c06eee9386b2d ([pr/wid.4](https://github.com/ryanofsky/bitcoin/commits/pr/wid.4) -> [pr/wid.5](https://github.com/ryanofsky/bitcoin/commits/pr/wid.5))\r\n",
      "created_at" : "2017-10-19T14:44:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/11476#issuecomment-337930573",
      "id" : 337930573,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11476",
      "updated_at" : "2017-10-19T14:44:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/337930573",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
