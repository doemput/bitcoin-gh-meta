{
   "assignee" : null,
   "body" : "This is our third attempt to improve the testing framework taking into account all previous comments and suggestions. The two previous attempts are: pull requests #4688 and #4732.\r\n\r\nSummary: For several reasons the current test framework does not allow to easily incorporate new unit tests that append specially crafted blocks to the blockchain using ProcessBlock().\r\nAfter we proposed a solution in #4688 @gmaxwell and @laanwj suggested not implementing the changes because many files not directly related to the testing framework were modified by the patch.\r\nIn the pull request #4732 we implement @gmaxwell suggestion that the test framework should run under the RegTest network parameters and not under the main network parameters. It was discovered that 10 unit cases are designed for the MAIN net, RegTest inherits from TestNet, which has many differences, so switching is not simple nor desired. @mikehearn and @laanwj proposed using a special new network called UNITTEST to be as similar to the real net as possible. We implemented this final suggestion.\r\n\r\nIn this pull request we implement UNITTEST. We reintroduced the criticized possibility to disable PoW check, but we did it under Params().SkipProofOfWorkCheck(). This method is a const virtual function that returns false for MAIN net, so there is no possibility that it is switched to true, under normal circumstances. This change does not extend the attack surface in any way.\r\n\r\nThe child network UNITTEST overrides SkipProofOfWorkCheck() to provide the skipping functionality.\r\nTo allow test cases to modify network parameters, we've added the ModifiableParams() global variable and associated abstract interface, with setters. These setters are only available if the current network is UNITTEST. Again, there is no way to modify the network parameters if the current network is not UNITTEST.\r\n\r\nAs in the previous pull requests, we've:\r\n\r\na. fixed the bug in miner_tests.cpp which leaves in the memory pool invalid transactions (mempool.clear() missing).\r\nb. Added 7 unit tests:\r\n\r\nToCheckBlockUpgradeMajority (untested before)\r\nEnforceBlockUpgradeMajority (untested before)\r\nRejectBlockOutdatedMajority (untested before)\r\n\"bad-cb-height\"\r\n\"bad-version\"\r\n\"time-too-old\"\r\n\"bad-txns-nonfinal\"\r\n\r\nSergio Demian Lerner & Timo Hanke\r\n",
   "closed_at" : "2014-10-08T07:11:23Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 11,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4845/comments",
   "created_at" : "2014-09-04T19:46:54Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4845/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/4845",
   "id" : 41977387,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4845/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 4845,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/4845.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/4845",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/4845.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/4845"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Switch testing framework from MAIN to new UNITTEST network",
   "updated_at" : "2014-10-08T07:11:39Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/4845",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/1752347?v=3",
      "events_url" : "https://api.github.com/users/SergioDemianLerner/events{/privacy}",
      "followers_url" : "https://api.github.com/users/SergioDemianLerner/followers",
      "following_url" : "https://api.github.com/users/SergioDemianLerner/following{/other_user}",
      "gists_url" : "https://api.github.com/users/SergioDemianLerner/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/SergioDemianLerner",
      "id" : 1752347,
      "login" : "SergioDemianLerner",
      "organizations_url" : "https://api.github.com/users/SergioDemianLerner/orgs",
      "received_events_url" : "https://api.github.com/users/SergioDemianLerner/received_events",
      "repos_url" : "https://api.github.com/users/SergioDemianLerner/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/SergioDemianLerner/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/SergioDemianLerner/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/SergioDemianLerner"
   }
}
