[
   {
      "body" : "Concept ACK",
      "created_at" : "2016-02-26T07:20:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7556#issuecomment-189144012",
      "id" : 189144012,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7556",
      "updated_at" : "2016-02-26T07:20:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/189144012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "I still disagree that storing the last sizelimit passed to CTxMemPool::TrimToSize() are the right semantics. It strikes me as hackish, unclean and not very reusable.\r\nI would prefer any of the multiple solutions I offered in #7115. But at that point none of the solutions were acceptable to you, in fact, you were strongly opposed to https://github.com/morcos/bitcoin/commit/cf95aa1225df59139c774ca98d6a24fba88a5d4f unless I was open to \"concede\" your https://github.com/morcos/bitcoin/commit/a8261aea4a67d3482893b01c6583b58048b10b95 .\r\nMay I ask what has made you change your mind about decoupling CBlockPolicyEstimator from CTxMemPool ?\r\nAt the same time, that change of opinion seems in direct contradiction with #7557.\r\n\r\nIf anyone else prefers the solution in #7115, I'm happy to rebase and reopen (or open a new one replacing it, whatever is preferred).\r\n\r\nAlso, morcos, last time we discussed, you didn't had time to collaborate with me on policy encapsulation. If that's not the case anymore, would you mind to share your thoughts on #7145 and  #6423 (based on the apparently-impossible-to-merge #6068) now?\r\n\r\nThat would probably help me understand the differences in #7557 much better.\r\n\r\n",
      "created_at" : "2016-02-26T17:30:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7556#issuecomment-189383217",
      "id" : 189383217,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7556",
      "updated_at" : "2016-02-26T17:30:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/189383217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@jtimon Actually the only piece of this I care about is the first commit, storing the sizeLimit in TrimToSize and not having to pass it into GetMinFee.  In my opinion that is the design of the code:\r\n- The mempool is limited (there is no reason for that limit to be static).  \r\n- The size of that limit is set with TrimToSize. (unchanged in this PR)\r\n- GetMinFee does some calculations based on the mempool's current limit (oddly passed in from the outside before this PR)\r\n\r\nI added your two commits because I thought you wanted them and they were made easier after my commit.  I am still hesitant to think that the CBlockPolicyEstimator won't need to depend on the mempool, but as I'd said before, I'm willing to cross that bridge when we get to it.\r\n\r\nI'm happy to help with your other refactor commits, but my hesitation has been not wanting to review the code without knowing that is the direction other contributors want to go.  If you could get a couple concept ACK's, I'd be happy to dive in more.  I tried to limit this and #7557 to the parts that I understand well and trusted my own opinion on direction.\r\n\r\n\r\n",
      "created_at" : "2016-02-26T18:26:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7556#issuecomment-189412762",
      "id" : 189412762,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7556",
      "updated_at" : "2016-02-26T18:26:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/189412762",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "> The mempool is limited (there is no reason for that limit to be static).\r\n\r\nTrue, but is currently static. Are there any plans to make it dynamic? Can you share more about that?\r\n\r\n> The size of that limit is set with TrimToSize. (unchanged in this PR)\r\n\r\nNo, before this PR, it is set in ```GetArg(\"-maxmempool\", DEFAULT_MAX_MEMPOOL_SIZE)```, not in TrimToSize (apart from the unittests). I disagree that https://github.com/morcos/bitcoin/commit/a8261aea4a67d3482893b01c6583b58048b10b95#diff-ca74c4b28865382863b8fe7633a85cd6R958 is not change. It is a change that I'm still not able to understand. I also think it is a very counter-intuitive design and will cause confusion no matter how well is documented (by the way, you haven't updated CTxMemPool::TrimToSize's documentation when making this change).\r\n\r\n > GetMinFee does some calculations based on the mempool's current limit (oddly passed in from the outside before this PR)\r\n\r\nOddly indeed, I'm glad that you are not opposed to changing it anymore like you were in the past when you nacked https://github.com/bitcoin/bitcoin/commit/30ac1d378c71fcf84999d119f341e8e46b4022bf in  https://github.com/bitcoin/bitcoin/pull/7115#issuecomment-161045375\r\nI solved this in multiple alternative ways (none of them including your weird [at least to me] design choice of setting the value every time) and none of them was satisfactory to you at the time.\r\nSetting the max size in TrimToSize like you do here is NOT a requirement for cleaning up GetMinFee.\r\n\r\nI strongly dislike that design choice. As said, if there's interest, I'm happy to rebase/rewrite an alternative without that design choice. In the meantime, NACK from me on that particular change (although if other people understand and like that decision there's no point for me to work on an alternative without it).\r\n\r\nBtw, @laanwj shouldn't this have the \"refactoring\" label just like #7115 had?",
      "created_at" : "2016-02-26T19:59:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7556#issuecomment-189457683",
      "id" : 189457683,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7556",
      "updated_at" : "2016-02-26T20:01:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/189457683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
         "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jtimon/followers",
         "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jtimon",
         "id" : 1008458,
         "login" : "jtimon",
         "organizations_url" : "https://api.github.com/users/jtimon/orgs",
         "received_events_url" : "https://api.github.com/users/jtimon/received_events",
         "repos_url" : "https://api.github.com/users/jtimon/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jtimon"
      }
   },
   {
      "body" : "@jtimon I don't mean to be difficult but I would like to get a8261ae merged.  Will it be easier for me to achieve that if I keep your commits in this PR or if I remove them?  I am indifferent.  I'll add the commenting you suggest either way.",
      "created_at" : "2016-02-26T20:38:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7556#issuecomment-189474952",
      "id" : 189474952,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7556",
      "updated_at" : "2016-02-26T20:38:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/189474952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   }
]
