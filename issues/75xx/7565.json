{
   "assignee" : null,
   "body" : "This unifies the recent locktime validation flags with the script ones for easier consensus deployment via BIP9 as implemented in #7566. It facilitates deploying BIP113 in this way by moving the check to ConnectBlock() and use the unified consensus validation flags.\r\n\r\nLike #7566, it finally introduces \"the src/consensus/consensus.cpp file\" which is a place intended to attract new consensus code (as opposed to keep putting it in main.cpp like bip113 and bip68).\r\n\r\nThis PR introduces Consensus::CheckTxPreInputs(), which does all the consensus checks common for coinbase and noncoinbase transactions (which implies none of the checks use the inputs of the transction nor the utxo state).\r\nNote that this introduces a redundant call to main::CheckTransaction() in main::ConnectBlock() which also calls main::CheckBlock() [which calls main::CheckTransaction()].\r\nWe can eat either:\r\n\r\na) Eat the redundant main::CheckTransaction() call per tx per block.\r\nb) Remove it from main::CheckBlock()\r\nc) Don't call main::CheckTransaction() from Consensus::CheckTxPreInputs() in this PR\r\n\r\nI don't want to decide myself.\r\n\r\nIn addition to Consensus::CheckTxPreInputs(), the PR introduces Consensus::VerifyTx(), which in its current incomplete implementation seems pretty stupid, as it only calls Consensus::CheckTxPreInputs().  \r\nBut there's many more things that could be encapsulated besides that, for example, in https://github.com/jtimon/bitcoin/commits/jt see:\r\n\r\nhttps://github.com/jtimon/bitcoin/commit/a61cec80c7838045a2241f56d76f2f8f840c39aa\r\nhttps://github.com/jtimon/bitcoin/commit/a408a5d7fce48c7838017fc67f0815e7ea218656\r\nhttps://github.com/jtimon/bitcoin/commit/5817f754e71701fc198bed04fa7e809549fd1ace\r\nhttps://github.com/jtimon/bitcoin/commit/6aed9aaaf0c4d48fae673221085a6c514ae81583\r\nhttps://github.com/jtimon/bitcoin/commit/032182336d84a420f33be3ab7d204c9b5f8ae8cf\r\nhttps://github.com/jtimon/bitcoin/commit/8c28d1a4175e51199020ca8bbc3e1ecedc862e46\r\nhttps://github.com/jtimon/bitcoin/commit/473696c4624cc4a7676a42cb0e98293d29e2c864\r\n\r\nI believe #7552 should wait for a subset of those commits or equivalent to avoid duplicating code or exposing an incomplete API that is harder to change later.\r\n\r\nContext: The main goal of this PR is advancing in libconsensus phase 2 decribed in the to-be-released-because-its-fortunately-already-outdated promised document with pictures. In the absence of a publishable document with pictures for a plan to encapsulate, expose and separate libbitcoinconsensus from bitcoin core, here's a summary including open PRs and other maintained branches:\r\n\r\n** TODO libconsensus-p2: Put all the consensus critical code excluding storage in the consensus building package #NO_PR [no_branch]\r\n*** REBASE [1/4] libconsensus-p2a: Build consensus/consensus.o with the consensus package #NO_PR [libconsensus-p2a]\r\nLast version: 72cdd1f\r\n**** PR bip9/bip113/libconsensus-p2a: Deployment preparations forBIP113 + #7552 + Introduce Consensus::VerifyTx() #7565 [libconsensus-p2a-verifytx-bip113-0.12.99]\r\n**** REBASE libconsensus-p2a: Decouple pow.o from chain.o and move it to the consensus package #7563 [libconsensus-p2a-chain-cpp-interface-0.12.99]\r\n**** REBASE libconsensus-p2a: Preparations to decouple libconsensus from coins.o #7564 [libconsensus-p2a-coins-cpp-interface-0.12.99]\r\n** libconsensus-p3: Complete C API for consensus non-storage functionality (within the same package) #NO_PR [libconsensus-p3]\r\n** libconsensus-p4: Separate libconsensus into its own repository like libsecp256k1 #NO_PR [no_branch]\r\n** libconsensus-p5: Stop reusing libconsensus' internal code in Bitcoin Core\r\n** libconsensus-p6: Import libconsensus from Bitcoin Core as an external dependency\r\n\r\nlegend: \r\n[branch-name] = github/jtimon/bitcoin/branch-name\r\np2 = phase 2\r\np2a = phase 2-A\r\n\r\n(Extracted from https://github.com/jtimon/doc/blob/master/branches/bitcoin.org if you use org-mode in emacs or vim)\r\n",
   "closed_at" : "2016-03-03T10:54:59Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
      "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jtimon/followers",
      "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jtimon",
      "id" : 1008458,
      "login" : "jtimon",
      "organizations_url" : "https://api.github.com/users/jtimon/orgs",
      "received_events_url" : "https://api.github.com/users/jtimon/received_events",
      "repos_url" : "https://api.github.com/users/jtimon/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jtimon"
   },
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7565/comments",
   "created_at" : "2016-02-20T02:13:01Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7565/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/7565",
   "id" : 135021573,
   "labels" : [
      {
         "color" : "E6F6D6",
         "name" : "Refactoring",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7565/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 7565,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/7565.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7565",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/7565.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7565"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "bip9/bip113/libconsensus-p2a: Deployment preparations forBIP113 + #7552 + Introduce Consensus::VerifyTx()",
   "updated_at" : "2016-03-03T10:54:59Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7565",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/1008458?v=3",
      "events_url" : "https://api.github.com/users/jtimon/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jtimon/followers",
      "following_url" : "https://api.github.com/users/jtimon/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jtimon/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jtimon",
      "id" : 1008458,
      "login" : "jtimon",
      "organizations_url" : "https://api.github.com/users/jtimon/orgs",
      "received_events_url" : "https://api.github.com/users/jtimon/received_events",
      "repos_url" : "https://api.github.com/users/jtimon/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jtimon/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jtimon"
   }
}
