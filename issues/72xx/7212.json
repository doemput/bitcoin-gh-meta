{
   "assignee" : null,
   "body" : "* Adds unittests for several methods in CAddrMan which are not currently tested.\r\n\r\n* Creates unittests for CAddrinfo which had no test coverage. These tests validate security critical features.\r\n\r\n* Refactors addrman so that tests can overrides the random number generator to allow for deterministic tests of CAddrman.select that involve tests of more than one addr in tried or new. See justification below.\r\n\r\n* We move the MakeDeterministic method from addrman into a test class to reduce lines of code in addrman and to prevent non-test calls.\r\n\r\nDetails on GetRandInt Wrapper\r\n========\r\n\r\nTo allow for deterministic tests of the select method in CAddrMan we wrap the GetRandInt function with a method RandomInt which can be overridden in a test class CAddrManTest. The RandomInt wrapper name was used so that it would not be a prefix substring of GetRandInt to avoid find and replace mistakes. Changes to random number generators as always a concern, this approach presents no risks because only subclasses of addrman can redirect calls to GetRandInt.\r\n\r\n\r\nIPv4 IPv6 confusion\r\n=======\r\n\r\n~~Bitcoin addr constructors assume any IP string that contains a semicolon is a IPv6 address. Thus\r\nCService(\"250.1.2.1:9999\") will create an IPv6 address with a default port number 8333~~.  I have discovered this behavior only applies to CNetAddr constructors since CNetAddr does not take a port number.",
   "closed_at" : "2016-01-28T12:14:27Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 8,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7212/comments",
   "created_at" : "2015-12-14T16:01:11Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7212/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/7212",
   "id" : 122072176,
   "labels" : [
      {
         "color" : "d4c5f9",
         "name" : "Tests",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7212/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 7212,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/7212.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/7212",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/7212.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/7212"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "Adds unittests for CAddrMan and CAddrinfo, removes source of non-determinism.",
   "updated_at" : "2016-01-28T18:40:33Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/7212",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/274814?v=3",
      "events_url" : "https://api.github.com/users/EthanHeilman/events{/privacy}",
      "followers_url" : "https://api.github.com/users/EthanHeilman/followers",
      "following_url" : "https://api.github.com/users/EthanHeilman/following{/other_user}",
      "gists_url" : "https://api.github.com/users/EthanHeilman/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/EthanHeilman",
      "id" : 274814,
      "login" : "EthanHeilman",
      "organizations_url" : "https://api.github.com/users/EthanHeilman/orgs",
      "received_events_url" : "https://api.github.com/users/EthanHeilman/received_events",
      "repos_url" : "https://api.github.com/users/EthanHeilman/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/EthanHeilman/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/EthanHeilman/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/EthanHeilman"
   }
}
