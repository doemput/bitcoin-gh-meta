{
   "assignee" : null,
   "assignees" : [],
   "body" : "In init.cpp we call `InitLoadWallet` which eventually calls `CWalletDB::LoadWallet` which takes `cs_wallet`, in the course of loading the wallet it calls `LoadToWallet` which calls `MarkConflicted` which takes `cs_main`.  This is the opposite order that these locks are taking in countless other places in the code (often in a `LOCK2(cs_main, cs_wallet)`).  I don't think there is a risk of actual deadlock here because `LoadWallet` only gets called from init.cpp before network threads or rpc threads are functional.  However since it causes an assertion failure with -DDEBUG_LOCKORDER it can make it difficult to do other lock order debugging.   \r\n\r\nOne work around is to just not have any transactions in the wallet which need to be marked conflicted.\r\n\r\nIt may be the case that the proper lock order is actually wallet and then main, and the right fix is to actually fix all the other locks in the code, so I'm just noting the issue for now.\r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9772/comments",
   "created_at" : "2017-02-15T22:17:55Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9772/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/9772",
   "id" : 207946167,
   "labels" : [
      {
         "color" : "02d7e1",
         "default" : false,
         "id" : 149424,
         "name" : "Wallet",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9772/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 9772,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "Initial wallet loading takes locks in wrong order causing POTENTIAL DEADLOCK DETECTED",
   "updated_at" : "2017-02-16T07:58:29Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/9772",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/4360349?v=3",
      "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
      "followers_url" : "https://api.github.com/users/morcos/followers",
      "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
      "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/morcos",
      "id" : 4360349,
      "login" : "morcos",
      "organizations_url" : "https://api.github.com/users/morcos/orgs",
      "received_events_url" : "https://api.github.com/users/morcos/received_events",
      "repos_url" : "https://api.github.com/users/morcos/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/morcos"
   }
}
