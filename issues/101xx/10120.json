{
   "assignee" : null,
   "assignees" : [],
   "body" : "glibc-specific: On 32-bit systems set the number of arenas to 1. By default, since glibc 2.10, the C library will create up to two heap arenas per core. This is known to cause excessive virtual address space usage in our usage. Work around it by setting the maximum number of arenas to 1.\r\n\r\nI documented this before in [Reducing bitcoind memory usage](https://gist.github.com/laanwj/efe29c7661ce9b6620a7) but with the reported OOM issues in 0.14 it seems more pressing to do it by default when there is low virtual memory space (e.g. on 32 bit).\r\n\r\nTo test:\r\n```\r\nbitcoin-cli getmemoryinfo mallocinfo | grep \"<heap\"\r\n```\r\nThis will show an entry per heap.\r\n\r\nTested on 32-bit ARM, 4-core:\r\n```xml\r\n<heap nr=\"0\">\r\n```\r\n\r\nTested on 64-bit x86, 6-core:\r\n```xml\r\n<heap nr=\"0\">\r\n<heap nr=\"1\">\r\n<heap nr=\"2\">\r\n<heap nr=\"3\">\r\n<heap nr=\"4\">\r\n<heap nr=\"5\">\r\n<heap nr=\"6\">\r\n<heap nr=\"7\">\r\n<heap nr=\"8\">\r\n<heap nr=\"9\">\r\n<heap nr=\"10\">\r\n<heap nr=\"11\">\r\n<heap nr=\"12\">\r\n```",
   "closed_at" : "2017-03-31T09:31:28Z",
   "closed_by" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   },
   "comments" : 4,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10120/comments",
   "created_at" : "2017-03-30T08:16:05Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10120/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/10120",
   "id" : 218115725,
   "labels" : [
      {
         "color" : "5319e7",
         "default" : false,
         "id" : 241832923,
         "name" : "Utils and libraries",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils%20and%20libraries"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10120/labels{/name}",
   "locked" : false,
   "milestone" : {
      "closed_at" : null,
      "closed_issues" : 15,
      "created_at" : "2017-02-21T12:32:10Z",
      "creator" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/863730?v=3",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      },
      "description" : "",
      "due_on" : null,
      "html_url" : "https://github.com/bitcoin/bitcoin/milestone/27",
      "id" : 2337607,
      "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/27/labels",
      "number" : 27,
      "open_issues" : 0,
      "state" : "open",
      "title" : "0.14.1",
      "updated_at" : "2017-03-31T10:07:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/milestones/27"
   },
   "number" : 10120,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/10120.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10120",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/10120.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10120"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "util: Work around (virtual) memory exhaustion on 32-bit w/ glibc",
   "updated_at" : "2017-03-31T10:09:16Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10120",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/126646?v=3",
      "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
      "followers_url" : "https://api.github.com/users/laanwj/followers",
      "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/laanwj",
      "id" : 126646,
      "login" : "laanwj",
      "organizations_url" : "https://api.github.com/users/laanwj/orgs",
      "received_events_url" : "https://api.github.com/users/laanwj/received_events",
      "repos_url" : "https://api.github.com/users/laanwj/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/laanwj"
   }
}
