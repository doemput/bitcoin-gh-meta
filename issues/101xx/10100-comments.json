[
   {
      "body" : "@Xekyo has done some work on coin selection",
      "created_at" : "2017-03-30T02:43:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10100#issuecomment-290286111",
      "id" : 290286111,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10100",
      "updated_at" : "2017-03-30T02:43:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/290286111",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/5767891?v=3",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "body" : "Needs rebase.\r\nPing @Xekyo",
      "created_at" : "2017-04-19T10:22:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10100#issuecomment-295205036",
      "id" : 295205036,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10100",
      "updated_at" : "2017-04-19T10:22:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/295205036",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "If you want to minimize the number of inputs, you could just use Largest First selection as many have discovered before you. However, you will then create a large number of UTXOs that you'll need to spend in the future (when fees perhaps are even higher). In my simulations FIFO and random selection performed reasonably well among naive approaches.\r\n\r\nOne of the coin selection strategies that I've evaluated for my Master's thesis was aiming to create a change output of the same size as the amount to send. This did not perform well as a singular strategy in my tests, however, you seem to have different criteria to evaluate fitness.",
      "created_at" : "2017-04-25T13:04:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10100#issuecomment-297023294",
      "id" : 297023294,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10100",
      "updated_at" : "2017-04-25T13:04:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/297023294",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/4060799?v=3",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "body" : "@Xekyo  Keep in mind this isn't purely a \"optimize for amount of inputs\", as it only changes `ApproximateBestSubset` which is a fallback after the other stuff fails (which already heavily tries to consolidate utxo's). \r\n\r\nAlso one assumption you make, which doesn't necessarily hold up for \"power users\" is that sending transactions is the only way to consolidate the utxo set. This isn't really true for services anymore that are starting to do consolidation with ultra low-fee transactions for off peak times, and something that could even be exposed to the wallet directly.  \r\n\r\nSo for those reasons, I very much like greedy strategies that optimize for minimizing the inputs (and leaving big inputs if possible) -- especially if your simulations show they perform well anyway.\r\n\r\n--\r\n\r\nAlthough I kind of don't expect any make any progress to happen on coin selection as it's a lot of bike shedding, and everyone has different use cases that dictate different coin selection strategies. I think the best way would be to just code up a few simple strategies, and let users pick between them.\r\n\r\nOr another idea would be use a \"score\" based system. Where users can configure the score for different properties (e.g. optimizing for size, privacy, utxo consolidation, etc.) and then randomly generates 1000 (?) valid transactions, and picks the one with the best score",
      "created_at" : "2017-04-25T13:19:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10100#issuecomment-297027022",
      "id" : 297027022,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10100",
      "updated_at" : "2017-04-25T13:19:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/297027022",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/9326759?v=3",
         "events_url" : "https://api.github.com/users/RHavar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RHavar/followers",
         "following_url" : "https://api.github.com/users/RHavar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RHavar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RHavar",
         "id" : 9326759,
         "login" : "RHavar",
         "organizations_url" : "https://api.github.com/users/RHavar/orgs",
         "received_events_url" : "https://api.github.com/users/RHavar/received_events",
         "repos_url" : "https://api.github.com/users/RHavar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RHavar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RHavar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RHavar"
      }
   },
   {
      "body" : "@RHavar: Sorry for the late reply, I was moving to another country in the past days. At least when I analyzed Bitcoin Core's selection last year, approximate subset was used almost every run: it's only not used if you have a single UTXO that matches the target or when all UTXOs smaller than the target as a sum match the target. These two cases only occurred in less than 1.5% of the transactions in my simulation.\r\n\r\nMy simulation showed that Largest First selection minimizes short term fees, but maximizes UTXO creation. As I was assuming constant fees, I cannot offer figures for its performance in combination with low-fee consolidation transactions. I agree though, that creating a change output and spending it later for e.g. a fifth of the fee would be cheaper than adding a second input to avoid creating an output.\r\n\r\nI'm hoping to be doing some more research on coin selection in the next months with larger real world datasets, I'll be looking into extending my simulation framework to cover varying fee levels over the week, so I hope to be able to give more reliable information.\r\n\r\nMeanwhile I think that your approach would serve power users well, but I don't think that we should put Largest First selection as the default strategy for Bitcoin Core.",
      "created_at" : "2017-05-02T13:35:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10100#issuecomment-298637273",
      "id" : 298637273,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10100",
      "updated_at" : "2017-05-02T13:35:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298637273",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/4060799?v=3",
         "events_url" : "https://api.github.com/users/Xekyo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Xekyo/followers",
         "following_url" : "https://api.github.com/users/Xekyo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Xekyo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Xekyo",
         "id" : 4060799,
         "login" : "Xekyo",
         "organizations_url" : "https://api.github.com/users/Xekyo/orgs",
         "received_events_url" : "https://api.github.com/users/Xekyo/received_events",
         "repos_url" : "https://api.github.com/users/Xekyo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Xekyo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Xekyo"
      }
   },
   {
      "body" : "> These two cases only occurred in less than 1.5% of the transactions in my simulation.\r\n\r\nI'm not sure this is as meaningful as it first seems. It gets hit very infrequently  _directly because_ of the behavior of `ApproximateBestSubset`. If ApproximateBestSubset was changed to something to minimize (short term) fees, then it'll get hit more often. \r\n\r\n\r\n> I'm hoping to be doing some more research on coin selection in the next months with larger real world datasets, I'll be looking into extending my simulation framework to cover varying fee levels over the week, so I hope to be able to give more reliable information.\r\n\r\nI kind of feel like coin-selection is more of an engineering problem than a research one. There are so many different use-cases and trade offs that it'd say it's impossible to have a universally decent coin selection.\r\n\r\nLike even ideally you'd take feerate into consideration when doing coin selection. If the feerate is atypically high (e.g. spam attack) you'd want to automatically switch to something that creates as small transactions as possible. If the feerate was atypically low (e.g. weekends) you'd try throw in some extra utxo consolidation. \r\n\r\nBut not only that, you have a lot of other trade offs that are hard to quantify. Like privacy.\r\n\r\n> but I don't think that we should put Largest First selection as the default strategy for Bitcoin Core.\r\n\r\nFair enough, I'll close the issue.",
      "created_at" : "2017-05-03T16:05:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10100#issuecomment-298957318",
      "id" : 298957318,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10100",
      "updated_at" : "2017-05-03T16:05:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298957318",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/9326759?v=3",
         "events_url" : "https://api.github.com/users/RHavar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/RHavar/followers",
         "following_url" : "https://api.github.com/users/RHavar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/RHavar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/RHavar",
         "id" : 9326759,
         "login" : "RHavar",
         "organizations_url" : "https://api.github.com/users/RHavar/orgs",
         "received_events_url" : "https://api.github.com/users/RHavar/received_events",
         "repos_url" : "https://api.github.com/users/RHavar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/RHavar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/RHavar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/RHavar"
      }
   }
]
