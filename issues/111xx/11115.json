{
   "assignee" : null,
   "assignees" : [],
   "body" : "### Describe the issue\r\n\r\n### Can you reliably reproduce the issue?\r\n#### If so, please list the steps to reproduce below:\r\n\r\nIn ```prevector.h```\r\n\r\n```c\r\n345         if (capacity() < new_size) {\r\n346             change_capacity(new_size + (new_size >> 1));\r\n347         }\r\n```\r\n\r\nThis construct makes it prone to uint32_t (the default size prevector\r\nuses) overflow if new_size is very high. A loop where many many\r\nelements are added to a prevector will trigger this. std::vector does\r\nnot appear to exhibit problems when dealing with excessively large\r\namounts of data.\r\n\r\n### Expected behaviour\r\nNothing (or throwing an exception?)\r\n\r\n### Actual behaviour\r\nMemory corruption\r\n\r\n### Screenshots.\r\n\r\n### What version of bitcoin-core are you using?\r\nbitcoin-0.14.2 self-compiled\r\n\r\n### Machine specs:\r\n- OS: Linux\r\n- CPU:\r\n- RAM:\r\n- Disk size:\r\n- Disk Type (HD/SDD):\r\n\r\n### Any extra information that might be useful in the debugging process.\r\n\r\nMy prevector fuzzer ( https://github.com/guidovranken/bitcoin/blob/fuzzing/fuzzers/fuzzer-prevector.cpp ) can be used to find this. You can compile it with the flag ```-DSIZETYPE_UINT16_T``` so that prevector uses ```uint16_t``` rather than the default ```uint32_t``` as its internal size type. So rather than having to operate on buffers that are gigabytes large in order to trigger any bugs, it can be done with buffers that involve only +/- 16K buffers.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11115/comments",
   "created_at" : "2017-08-23T00:00:56Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11115/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/11115",
   "id" : 252122226,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11115/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 11115,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "prevector.h memory corruption when dealing with very large amounts of data (+/- 4GB)",
   "updated_at" : "2017-08-23T00:00:56Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/11115",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/6846644?v=4",
      "events_url" : "https://api.github.com/users/guidovranken/events{/privacy}",
      "followers_url" : "https://api.github.com/users/guidovranken/followers",
      "following_url" : "https://api.github.com/users/guidovranken/following{/other_user}",
      "gists_url" : "https://api.github.com/users/guidovranken/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/guidovranken",
      "id" : 6846644,
      "login" : "guidovranken",
      "organizations_url" : "https://api.github.com/users/guidovranken/orgs",
      "received_events_url" : "https://api.github.com/users/guidovranken/received_events",
      "repos_url" : "https://api.github.com/users/guidovranken/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/guidovranken/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/guidovranken/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/guidovranken"
   }
}
