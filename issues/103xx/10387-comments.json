[
   {
      "body" : "Rebased, overhauled and removed WIP tag.\r\nConforms now to BIP159.\r\nAdded 0.16 milestone tag.",
      "created_at" : "2017-08-08T20:53:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-321078772",
      "id" : 321078772,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-08-08T20:53:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321078772",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Added a fingerprinting counter-measure which protects from leaking the prune depth by finding it through getdata requests (21c347c8c1a9ee4803b8f8f124185c218e01db76).",
      "created_at" : "2017-08-11T19:34:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-321900407",
      "id" : 321900407,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-08-11T19:34:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/321900407",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r140946427"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946427"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: sending",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-09-26T02:46:55Z",
      "diff_hunk" : "@@ -1006,6 +1020,13 @@ void static ProcessGetData(CNode* pfrom, const Consensus::Params& consensusParam\n                     pfrom->fDisconnect = true;\n                     send = false;\n                 }\n+                // Avoid leaking prune-height by never send blocks below the NODE_NETWORK_LIMITED threshold",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r140946427",
      "id" : 140946427,
      "original_commit_id" : "3fedeac1dbb845e5529dbe6ba7e0929abcf299c6",
      "original_position" : 25,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 65089115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946427",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r140946594"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946594"
         }
      },
      "author_association" : "MEMBER",
      "body" : "s/to must be available/required",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-09-26T02:48:51Z",
      "diff_hunk" : "@@ -203,6 +203,8 @@ extern bool fPruneMode;\n extern uint64_t nPruneTarget;\n /** Block files containing a block-height within MIN_BLOCKS_TO_KEEP of chainActive.Tip() will not be pruned. */\n static const unsigned int MIN_BLOCKS_TO_KEEP = 288;\n+/** Minimum blocks to must be available to signal NODE_NETWORK_LIMITED */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r140946594",
      "id" : 140946594,
      "original_commit_id" : "3fedeac1dbb845e5529dbe6ba7e0929abcf299c6",
      "original_position" : 4,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 65089320,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/140946594",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Fixed travis trailing whitespace in test issue.",
      "created_at" : "2017-09-28T04:10:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-332722581",
      "id" : 332722581,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-09-28T04:10:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/332722581",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141752640"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141752640"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Looks like a rebase error - these functions were moved to the PeerLogicValidation.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-09-28T22:35:51Z",
      "diff_hunk" : "@@ -61,4 +61,17 @@ bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &stats);\n /** Increase a node's misbehavior score. */\n void Misbehaving(NodeId nodeid, int howmuch);\n \n+/** Process protocol messages received from a given node */\n+bool ProcessMessages(CNode* pfrom, CConnman& connman, const std::atomic<bool>& interrupt);\n+/**\n+ * Send queued protocol messages to be sent to a give node.\n+ *\n+ * @param[in]   pto             The node which we are sending messages to.\n+ * @param[in]   connman         The connection manager for that node.\n+ * @param[in]   interrupt       Interrupt condition for processing threads\n+ * @return                      True if there is more work to be done\n+ */\n+bool SendMessages(CNode* pto, CConnman& connman, const std::atomic<bool>& interrupt);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141752640",
      "id" : 141752640,
      "original_commit_id" : "837ef7497f2e0e0d3530d0de9bdbd59a9acc8946",
      "original_position" : 14,
      "path" : "src/net_processing.h",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141752640",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141753062"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753062"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, this feels pretty strange to me. Service bits indicate a commitment to provide certain services, not your current state. More importantly, IBD is always neccessarily fuzzy - we can't know how \"in sync\" we are.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-09-28T22:38:53Z",
      "diff_hunk" : "@@ -3305,6 +3314,43 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void CheckLocalServices(ServiceFlags& nLocalServices) {\n+    if (fPruneMode) {\n+        LOCK(cs_main);\n+\n+        // make sure NODE_NETWORK is disabled\n+        nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+\n+        // don't signal NODE_NETWORK_LIMITED during initial block download\n+        if (IsInitialBlockDownload()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141753062",
      "id" : 141753062,
      "original_commit_id" : "837ef7497f2e0e0d3530d0de9bdbd59a9acc8946",
      "original_position" : 28,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753062",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141753516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753516"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why? The BIP seems somewhat unclear here, but I'd stronlgy prefer that NODE_NETWORK_LIMITED simply be always set to indicate that we can always provide the most recent 288 blocks, irrespective of if we're pruned or not.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-09-28T22:42:05Z",
      "diff_hunk" : "@@ -3305,6 +3314,43 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void CheckLocalServices(ServiceFlags& nLocalServices) {\n+    if (fPruneMode) {\n+        LOCK(cs_main);\n+\n+        // make sure NODE_NETWORK is disabled\n+        nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+\n+        // don't signal NODE_NETWORK_LIMITED during initial block download\n+        if (IsInitialBlockDownload()) {\n+            return;\n+        }\n+\n+        // check how many blocks we have available (backwards from tip)\n+        // don't go futher down then chainActive.Height()-NODE_NETWORK_LIMITED\n+        CBlockIndex *block = chainActive.Tip();\n+        unsigned int chainHeight = (unsigned int) chainActive.Height();\n+        while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && chainHeight - block->nHeight < (NODE_NETWORK_LIMITED_MIN_BLOCKS + 1)) {\n+            block = block->pprev;\n+        }\n+        unsigned int height = (unsigned int) block->nHeight;\n+\n+        // set NODE_NETWORK_LIMITED flag based on the available blocks\n+        if (chainHeight - height >= NODE_NETWORK_LIMITED_MIN_BLOCKS) {\n+            nLocalServices = ServiceFlags(nLocalServices | NODE_NETWORK_LIMITED);\n+        }\n+\n+        // don't set NODE_NETWORK if manual pruning is enabled and no blocks have been pruned.\n+        // A manual prune will be very likely\n+    }\n+    else {\n+        // currently, the prune mode can't be changed during runtime\n+        // implement the service bit switch for possible future flexibility\n+        nLocalServices = ServiceFlags(nLocalServices | NODE_NETWORK);\n+        nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK_LIMITED);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141753516",
      "id" : 141753516,
      "original_commit_id" : "837ef7497f2e0e0d3530d0de9bdbd59a9acc8946",
      "original_position" : 53,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141753516",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141754105"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141754105"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems entirely redundant - even if by super rare chance we end up due to reorg short of 288 blocks, we won't be *very* short of 288 blocks, and will be caught back up within the next block or two, might as well just always set NODE_NETWORK_LIMITED (you can static_assert MIN_BLOCKS_TO_KEEP is at least 288 if you really want to have a check).",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-09-28T22:45:31Z",
      "diff_hunk" : "@@ -3305,6 +3314,43 @@ bool PeerLogicValidation::SendMessages(CNode* pto, std::atomic<bool>& interruptM\n     return true;\n }\n \n+void CheckLocalServices(ServiceFlags& nLocalServices) {\n+    if (fPruneMode) {\n+        LOCK(cs_main);\n+\n+        // make sure NODE_NETWORK is disabled\n+        nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+\n+        // don't signal NODE_NETWORK_LIMITED during initial block download\n+        if (IsInitialBlockDownload()) {\n+            return;\n+        }\n+\n+        // check how many blocks we have available (backwards from tip)\n+        // don't go futher down then chainActive.Height()-NODE_NETWORK_LIMITED",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141754105",
      "id" : 141754105,
      "original_commit_id" : "837ef7497f2e0e0d3530d0de9bdbd59a9acc8946",
      "original_position" : 33,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141754105",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755077"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If you're gonna update this maybe overhaul the text? The concept of \"want network services but don't provide them\" doesn't really make sense anymore (especially with NODE_NETWORK_LIMITED). Maybe just say \"indicates peer is capable of serving the full historical block chain\".",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-09-28T22:52:04Z",
      "diff_hunk" : "@@ -250,8 +250,8 @@ enum ServiceFlags : uint64_t {\n     // Nothing\n     NODE_NONE = 0,\n     // NODE_NETWORK means that the node is capable of serving the block chain. It is currently\n-    // set by all Bitcoin Core nodes, and is unset by SPV clients or other peers that just want\n-    // network services but don't provide them.\n+    // set by all Bitcoin Core non pruned nodes, and is unset by SPV clients or other peers\n+    // that just want network services but don't provide them.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755077",
      "id" : 141755077,
      "original_commit_id" : "e08e49f8991564d2e9115a074b7d38af3af11664",
      "original_position" : 7,
      "path" : "src/protocol.h",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755077",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755735"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm entirely unconvinced NODE_NETWORK_LIMITED needs this (and would prefer to avoid adding it until we need it, though its no big deal to add it).",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-09-28T22:55:49Z",
      "diff_hunk" : "@@ -2672,6 +2672,11 @@ ServiceFlags CConnman::GetLocalServices() const\n     return nLocalServices;\n }\n \n+void CConnman::SetLocalServices(ServiceFlags flagsIn)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755735",
      "id" : 141755735,
      "original_commit_id" : "62cdcc6ec2facdcd50fea9a20a268d94bb981d19",
      "original_position" : 4,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755735",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755926"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755926"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why do we need to do this? You can't prune deeper than 128 and NODE_NETWORK is already unset for manually-pruned nodes.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-09-28T22:56:51Z",
      "diff_hunk" : "@@ -895,6 +897,13 @@ UniValue pruneblockchain(const JSONRPCRequest& request)\n     }\n \n     PruneBlockFilesManual(height);\n+\n+    // check if we need to change the local service flags in order to signal NODE_NETWORK_LIMITED flags\n+    if(g_connman) {\n+        ServiceFlags nFlags = g_connman->GetLocalServices();\n+        CheckLocalServices(nFlags);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141755926",
      "id" : 141755926,
      "original_commit_id" : "6aae1785542eb7f79d5c08e53862476e22ac46c6",
      "original_position" : 17,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141755926",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141756696"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141756696"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This should use pfrom->GetLocalServices() not connman->GetLocalServices() - our decisions should be based on what we told the peer we support, not what we would tell a new peer to support.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-09-28T23:01:50Z",
      "diff_hunk" : "@@ -1020,6 +1020,13 @@ void static ProcessGetData(CNode* pfrom, const Consensus::Params& consensusParam\n                     pfrom->fDisconnect = true;\n                     send = false;\n                 }\n+                // Avoid leaking prune-height by never send blocks below the NODE_NETWORK_LIMITED threshold\n+                if (send && !pfrom->fWhitelisted && (\n+                        (((connman->GetLocalServices() & NODE_NETWORK_LIMITED) == NODE_NETWORK_LIMITED) && (chainActive.Tip()->nHeight - mi->second->nHeight > (int)NODE_NETWORK_LIMITED_MIN_BLOCKS) )",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r141756696",
      "id" : 141756696,
      "original_commit_id" : "39926136e6fb8d38e3da8b9aee697cd5c4c4a04c",
      "original_position" : 6,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 66018463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/141756696",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review @TheBlueMatt. I agree with all you points and most things can now go away since the NODE_NETWORK_LIMITED_HIGH flag (1152 blocks minimum) is gone.\r\n\r\nWill overhaul and simplify it now.",
      "created_at" : "2017-09-29T02:56:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-333018185",
      "id" : 333018185,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-09-29T02:56:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333018185",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Simplified the PR and addressed @TheBlueMatt and @fanquake points.",
      "created_at" : "2017-10-01T04:22:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-333352493",
      "id" : 333352493,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-10-01T04:22:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/333352493",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142410638"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142410638"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, I thought we were just going to alays set this? Why bother *only* setting it when pruned - a node that is not pruned is also capable of serving the last 288 blocks, which is the way I read the definition of NODE_NETWORK_LIMITED.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-03T14:02:04Z",
      "diff_hunk" : "@@ -1590,6 +1590,8 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n     if (fPruneMode) {\n         LogPrintf(\"Unsetting NODE_NETWORK on prune mode\\n\");\n         nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+        // always set NODE_NETWORK_LIMITED (BIP159) in pruned mode\n+        nLocalServices = ServiceFlags(nLocalServices | NODE_NETWORK_LIMITED);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142410638",
      "id" : 142410638,
      "original_commit_id" : "78011f7e2a703afc17a7c53923d89729ce3be91a",
      "original_position" : 5,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 66766749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142410638",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142469469"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142469469"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I agree. Came to complain about the same thing.\r\n\r\nNODE_NETWORK implies NODE_NETWORK_LIMITED, so _LIMITED should always be set.\r\nOtherwise, we're introducing negative service flags, which is a bad idea imo.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-03T17:34:14Z",
      "diff_hunk" : "@@ -1590,6 +1590,8 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n     if (fPruneMode) {\n         LogPrintf(\"Unsetting NODE_NETWORK on prune mode\\n\");\n         nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+        // always set NODE_NETWORK_LIMITED (BIP159) in pruned mode\n+        nLocalServices = ServiceFlags(nLocalServices | NODE_NETWORK_LIMITED);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142469469",
      "id" : 142469469,
      "in_reply_to_id" : 142410638,
      "original_commit_id" : "78011f7e2a703afc17a7c53923d89729ce3be91a",
      "original_position" : 5,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 66835442,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142469469",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142472985"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142472985"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Perhaps reference BIP 159 in the comment here for additional explanation?",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-03T17:47:51Z",
      "diff_hunk" : "@@ -267,6 +266,9 @@ enum ServiceFlags : uint64_t {\n     // NODE_XTHIN means the node supports Xtreme Thinblocks\n     // If this is turned off then the node will not service nor make xthin requests\n     NODE_XTHIN = (1 << 4),\n+    // NODE_NETWORK_LIMITED means the same as NODE_NETWORK with the limitation of only\n+    // serving the last 288 (2 day) blocks",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142472985",
      "id" : 142472985,
      "original_commit_id" : "71d9aafb07e39548240dd3f75526225a4df2f70e",
      "original_position" : 17,
      "path" : "src/protocol.h",
      "position" : 17,
      "pull_request_review_id" : 66839562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142472985",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142473809"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142473809"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We can avoid obtaining this lock if the alternative services is already NODE_NETWORK_LIMITED.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-03T17:51:01Z",
      "diff_hunk" : "@@ -818,6 +818,16 @@ void PeerLogicValidation::UpdatedBlockTip(const CBlockIndex *pindexNew, const CB\n     }\n \n     nTimeBestReceived = GetTime();\n+\n+    // update service flags\n+    {\n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142473809",
      "id" : 142473809,
      "original_commit_id" : "d1ce50c1bc9843792ddf93f8bb5a43c9af677c62",
      "original_position" : 7,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 66839562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142473809",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142475171"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142475171"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'd rather not use fClient as a proxy for NODE_NETWORK_LIMITED. It deserves its own classification.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-03T17:56:20Z",
      "diff_hunk" : "@@ -1302,7 +1312,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             pfrom->cleanSubVer = cleanSubVer;\n         }\n         pfrom->nStartingHeight = nStartingHeight;\n-        pfrom->fClient = !(nServices & NODE_NETWORK);\n+        pfrom->fClient = (!(nServices & NODE_NETWORK) && !(nServices & NODE_NETWORK_LIMITED));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142475171",
      "id" : 142475171,
      "original_commit_id" : "d1ce50c1bc9843792ddf93f8bb5a43c9af677c62",
      "original_position" : 22,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 66842269,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142475171",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142478180"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142478180"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: a default of without_foo = False isn't no bad thing for nobody.\r\n\r\nwith_time=True please :)",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-03T18:07:24Z",
      "diff_hunk" : "@@ -221,19 +221,24 @@ def ToHex(obj):\n \n class CAddress(object):\n     def __init__(self):\n+        self.time = 0\n         self.nServices = 1\n         self.pchReserved = b\"\\x00\" * 10 + b\"\\xff\" * 2\n         self.ip = \"0.0.0.0\"\n         self.port = 0\n \n-    def deserialize(self, f):\n+    def deserialize(self, f, without_time=False):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142478180",
      "id" : 142478180,
      "original_commit_id" : "f63c723953f64a4d9b7527acc45274ff0f8b8c69",
      "original_position" : 11,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : null,
      "pull_request_review_id" : 66845874,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142478180",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142478386"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142478386"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In this clause, should `nRequiredServices` get set to NODE_NETWORK_LIMITED if peer is in sync? Essentially, replace `REQUIRED_SERVICES` below with a value that goes from NODE_NETWORK to NODE_NETWORK_LIMITED when peer is out of IBD.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-03T18:08:14Z",
      "diff_hunk" : "@@ -1819,13 +1823,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 continue;\n \n             // only connect to full nodes\n-            if ((addr.nServices & REQUIRED_SERVICES) != REQUIRED_SERVICES)\n+            if ( ((addr.nServices & NODE_NETWORK) != NODE_NETWORK)\n+                 && ((addr.nServices & NODE_NETWORK_LIMITED) != NODE_NETWORK_LIMITED)) {\n                 continue;\n+            }\n \n             // only consider very recently tried nodes after 30 failed attempts\n             if (nANow - addr.nLastTry < 600 && nTries < 30)\n                 continue;\n \n+            // only consider nodes matching alternative and missing relevant services after 10 failed attempts and only if less than a fourth of the outbound are up.\n+            if ( ((addr.nServices & nAlternativeServices) == nAlternativeServices) && (addr.nServices & nRelevantServices) != nRelevantServices && (nTries < 20 || nOutbound >= (nMaxOutbound >> 2)))\n+                continue;\n+\n             // only consider nodes missing relevant services after 40 failed attempts and only if less than half the outbound are up.\n             ServiceFlags nRequiredServices = nRelevantServices;\n             if (nTries >= 40 && nOutbound < (nMaxOutbound >> 1)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142478386",
      "id" : 142478386,
      "original_commit_id" : "abd60f63ac533c6b984cadbec56155b940f7fb9e",
      "original_position" : 40,
      "path" : "src/net.cpp",
      "position" : 40,
      "pull_request_review_id" : 66839562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:32:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142478386",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142486951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142486951"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, this needs its own bool so that fClient gets checked when testing for our initial headers-sync peer. Then, fPreferredDownload is only set to false if we're still in IBD.\r\n\r\nThat way, we request from this peer as if they were a regular full node as long as we're synced.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-03T18:40:13Z",
      "diff_hunk" : "@@ -1302,7 +1312,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             pfrom->cleanSubVer = cleanSubVer;\n         }\n         pfrom->nStartingHeight = nStartingHeight;\n-        pfrom->fClient = !(nServices & NODE_NETWORK);\n+        pfrom->fClient = (!(nServices & NODE_NETWORK) && !(nServices & NODE_NETWORK_LIMITED));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142486951",
      "id" : 142486951,
      "in_reply_to_id" : 142475171,
      "original_commit_id" : "d1ce50c1bc9843792ddf93f8bb5a43c9af677c62",
      "original_position" : 22,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 66856046,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142486951",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142575819"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142575819"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Okay. Agree... will change it.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-04T03:46:38Z",
      "diff_hunk" : "@@ -1590,6 +1590,8 @@ bool AppInitMain(boost::thread_group& threadGroup, CScheduler& scheduler)\n     if (fPruneMode) {\n         LogPrintf(\"Unsetting NODE_NETWORK on prune mode\\n\");\n         nLocalServices = ServiceFlags(nLocalServices & ~NODE_NETWORK);\n+        // always set NODE_NETWORK_LIMITED (BIP159) in pruned mode\n+        nLocalServices = ServiceFlags(nLocalServices | NODE_NETWORK_LIMITED);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142575819",
      "id" : 142575819,
      "in_reply_to_id" : 142410638,
      "original_commit_id" : "78011f7e2a703afc17a7c53923d89729ce3be91a",
      "original_position" : 5,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 66955052,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142575819",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This change prefers connecting to full nodes rather than pruned nodes even if fully synced. Why is that the desired approach?\r\n> [...]\r\n> I find that the required services/relevant services/alternative services stuff is getting confusing. If I'm reading it right, the order of preference is... [...]\r\n\r\nWe probably should avoid an abrupt change for pruned peers. This approach (alternative services) would result is a slow usage of the current deployed (and then upgraded) pruned peers. Otherwise, pruned peers may see a significant overall usage (bandwidth / CPU / disk-usage) bump.\r\n\r\nSince there is no toggle to disable NODE_NETWORK_LIMITED signalling in pruned mode, I think this (slow) approach would be wise.",
      "created_at" : "2017-10-04T03:53:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-334043193",
      "id" : 334043193,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-10-04T03:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334043193",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142576781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142576781"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think we should not connect to NODE_NETWORK_LIMITED peers if IBD is still ongoing. NODE_NETWORK_LIMITED implementations really should make sure to not serve deeper then >288 blocks (fingerprinted). Seems useless to me connect until clear IBD.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-04T04:00:01Z",
      "diff_hunk" : "@@ -818,6 +818,16 @@ void PeerLogicValidation::UpdatedBlockTip(const CBlockIndex *pindexNew, const CB\n     }\n \n     nTimeBestReceived = GetTime();\n+\n+    // update service flags\n+    {\n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142576781",
      "id" : 142576781,
      "in_reply_to_id" : 142473809,
      "original_commit_id" : "d1ce50c1bc9843792ddf93f8bb5a43c9af677c62",
      "original_position" : 7,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 66956158,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142576781",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142581998"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142581998"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IMO we want pruned peers for header sync... but right, we need a protection to not request blocks from limited peers during IBD.\r\nWhat about adding an `fLimitedNode` bool and check it at the point we populate vGetData with block requests?\r\n\r\nSeems also simpler and more constant (NODE_NETWORK_LIMITED is not really a \"client\").\r\n\r\nI changed this PR and applied my approach which I have written above.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-04T05:11:40Z",
      "diff_hunk" : "@@ -1302,7 +1312,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             pfrom->cleanSubVer = cleanSubVer;\n         }\n         pfrom->nStartingHeight = nStartingHeight;\n-        pfrom->fClient = !(nServices & NODE_NETWORK);\n+        pfrom->fClient = (!(nServices & NODE_NETWORK) && !(nServices & NODE_NETWORK_LIMITED));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142581998",
      "id" : 142581998,
      "in_reply_to_id" : 142475171,
      "original_commit_id" : "d1ce50c1bc9843792ddf93f8bb5a43c9af677c62",
      "original_position" : 22,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 66961718,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:17:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142581998",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Addressed @theuni & @TheBlueMatt points. Now mentions BIP159 in `protocol.h` (found by @jimpo).",
      "created_at" : "2017-10-04T05:25:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-334053167",
      "id" : 334053167,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-10-04T05:25:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334053167",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "\"Set NODE_NETWORK_LIMITED bit in pruned mode\" commit message is confusing now. Mind rewording it to reflect the new behavior?",
      "created_at" : "2017-10-04T21:04:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-334289031",
      "id" : 334289031,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-10-04T21:04:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334289031",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@theuni: overhauled that commit message.",
      "created_at" : "2017-10-04T21:17:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-334292226",
      "id" : 334292226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-10-04T21:17:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334292226",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142797136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142797136"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, I understand that, but unless I'm missing something, this code is run every time there is a new block after IBD is done instead of happening only once. It seems possible to change the logic to exit before obtaining the lock if AlternativeServices has already been switched from NODE_NETWORK to NODE_NETWORK_LIMITED.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-04T21:25:56Z",
      "diff_hunk" : "@@ -818,6 +818,16 @@ void PeerLogicValidation::UpdatedBlockTip(const CBlockIndex *pindexNew, const CB\n     }\n \n     nTimeBestReceived = GetTime();\n+\n+    // update service flags\n+    {\n+        LOCK(cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142797136",
      "id" : 142797136,
      "in_reply_to_id" : 142473809,
      "original_commit_id" : "d1ce50c1bc9843792ddf93f8bb5a43c9af677c62",
      "original_position" : 7,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 67212434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:25:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142797136",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142800110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142800110"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems that we would never connect to limited nodes because of the code on lines 1840-1847. `nRequiredServices` is set to either `nRelevantServices` or `REQUIRED_SERVICES`, never `nAlternativeServices`.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-04T21:39:32Z",
      "diff_hunk" : "@@ -1819,13 +1823,19 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 continue;\n \n             // only connect to full nodes\n-            if ((addr.nServices & REQUIRED_SERVICES) != REQUIRED_SERVICES)\n+            if ( ((addr.nServices & NODE_NETWORK) != NODE_NETWORK)\n+                 && ((addr.nServices & NODE_NETWORK_LIMITED) != NODE_NETWORK_LIMITED)) {\n                 continue;\n+            }\n \n             // only consider very recently tried nodes after 30 failed attempts\n             if (nANow - addr.nLastTry < 600 && nTries < 30)\n                 continue;\n \n+            // only consider nodes matching alternative and missing relevant services after 10 failed attempts and only if less than a fourth of the outbound are up.\n+            if ( ((addr.nServices & nAlternativeServices) == nAlternativeServices) && (addr.nServices & nRelevantServices) != nRelevantServices && (nTries < 20 || nOutbound >= (nMaxOutbound >> 2)))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r142800110",
      "id" : 142800110,
      "original_commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "original_position" : 35,
      "path" : "src/net.cpp",
      "position" : 35,
      "pull_request_review_id" : 67215746,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-04T21:39:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/142800110",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/881253?v=4",
         "events_url" : "https://api.github.com/users/jimpo/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jimpo/followers",
         "following_url" : "https://api.github.com/users/jimpo/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jimpo/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jimpo",
         "id" : 881253,
         "login" : "jimpo",
         "organizations_url" : "https://api.github.com/users/jimpo/orgs",
         "received_events_url" : "https://api.github.com/users/jimpo/received_events",
         "repos_url" : "https://api.github.com/users/jimpo/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jimpo/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jimpo"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The nRelevantServices stuff is somewhat already a mess, and trying to work within the current code is just getting messier :/. I spent a bit of time rewriting it and (mostly) like the outcome, its at https://github.com/TheBlueMatt/bitcoin/commit/2017-09-service-flags-cleanups - and I think basing this PR on it would simplify this one a lot. It sucks to add some functions to protocol.h/cpp, especially if they have knowledge of IBD state, but that should be able to move soon once @theuni makes net.cpp not aware of service bits.",
      "created_at" : "2017-10-05T14:55:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-334490761",
      "id" : 334490761,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-10-05T14:55:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334490761",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Agree with @TheBlueMatt on taking that as a starting point. We discussed it a little, and I think defining functions for the filtered use-cases makes life much easier. @jonasschnelli it's kinda intrusive on the PR, but would it be possible to work that in?\r\n\r\nAs for making net not aware of service bits, I'm working on breaking addrman out right now. Should be pretty painless and a nice improvement.",
      "created_at" : "2017-10-05T14:59:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-334492023",
      "id" : 334492023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-10-05T14:59:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/334492023",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326141"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326141"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Remove `== True`.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-07T08:35:09Z",
      "diff_hunk" : "@@ -221,19 +221,24 @@ def ToHex(obj):\n \n class CAddress(object):\n     def __init__(self):\n+        self.time = 0\n         self.nServices = 1\n         self.pchReserved = b\"\\x00\" * 10 + b\"\\xff\" * 2\n         self.ip = \"0.0.0.0\"\n         self.port = 0\n \n-    def deserialize(self, f):\n+    def deserialize(self, f, with_time=True):\n+        if with_time == True:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326141",
      "id" : 143326141,
      "original_commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "original_position" : 12,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : 12,
      "pull_request_review_id" : 67828631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-07T08:39:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326141",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326146"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326146"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Remove `== True`.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-07T08:35:27Z",
      "diff_hunk" : "@@ -221,19 +221,24 @@ def ToHex(obj):\n \n class CAddress(object):\n     def __init__(self):\n+        self.time = 0\n         self.nServices = 1\n         self.pchReserved = b\"\\x00\" * 10 + b\"\\xff\" * 2\n         self.ip = \"0.0.0.0\"\n         self.port = 0\n \n-    def deserialize(self, f):\n+    def deserialize(self, f, with_time=True):\n+        if with_time == True:\n+            self.time = struct.unpack(\"<i\", f.read(4))[0]\n         self.nServices = struct.unpack(\"<Q\", f.read(8))[0]\n         self.pchReserved = f.read(12)\n         self.ip = socket.inet_ntoa(f.read(4))\n         self.port = struct.unpack(\">H\", f.read(2))[0]\n \n-    def serialize(self):\n+    def serialize(self, with_time=True):\n         r = b\"\"\n+        if with_time == True:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326146",
      "id" : 143326146,
      "original_commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "original_position" : 22,
      "path" : "test/functional/test_framework/mininode.py",
      "position" : 22,
      "pull_request_review_id" : 67828631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-07T08:39:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326146",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326148"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326148"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Remove `== true`.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-07T08:35:38Z",
      "diff_hunk" : "@@ -183,6 +183,10 @@ void AdvertiseLocal(CNode *pnode)\n     if (fListen && pnode->fSuccessfullyConnected)\n     {\n         CAddress addrLocal = GetLocalAddress(&pnode->addr, pnode->GetLocalServices());\n+        if (gArgs.GetBoolArg(\"-addrmantest\", false) == true) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326148",
      "id" : 143326148,
      "original_commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "original_position" : 4,
      "path" : "src/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 67828631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-07T08:39:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326148",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326152"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326152"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Remove `== true`.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-07T08:35:46Z",
      "diff_hunk" : "@@ -191,7 +195,7 @@ void AdvertiseLocal(CNode *pnode)\n         {\n             addrLocal.SetIP(pnode->GetAddrLocal());\n         }\n-        if (addrLocal.IsRoutable())\n+        if (addrLocal.IsRoutable() || gArgs.GetBoolArg(\"-addrmantest\", false) == true)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326152",
      "id" : 143326152,
      "original_commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "original_position" : 16,
      "path" : "src/net.cpp",
      "position" : 16,
      "pull_request_review_id" : 67828631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-07T08:39:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326152",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326166"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326166"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit, space after `#` here and below.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-07T08:36:35Z",
      "diff_hunk" : "@@ -0,0 +1,107 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+from test_framework.mininode import *\n+\n+class BaseNode(NodeConnCB):\n+    nServices = 0\n+    firstAddrnServices = 0\n+    def on_version(self, conn, message):\n+        self.nServices = message.nServices\n+    def on_addr(self, conn, message):\n+        self.firstAddrnServices = message.addrs[0].nServices\n+    def wait_for_addr(self, timeout=60):\n+        test_function = lambda: self.last_message.get(\"addr\")\n+        wait_until(test_function, timeout=timeout, lock=mininode_lock)\n+\n+class NodeNetworkLimitedTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.extra_args = [['-prune=550', '-addrmantest']]\n+\n+    def getSignaledServiceFlags(self):\n+        node = BaseNode()\n+        connection = NodeConn('127.0.0.1', p2p_port(0), self.nodes[0], node)\n+        node.add_connection(connection)\n+        NetworkThread().start()\n+        node.wait_for_verack()\n+        services = node.nServices\n+        connection.disconnect_node()\n+        node.wait_for_disconnect()\n+        del node\n+        return services\n+\n+    def tryGetBlockViaGetData(self, blockhash, result):\n+        node = BaseNode()\n+        connection = NodeConn('127.0.0.1', p2p_port(0), self.nodes[0], node)\n+        node.add_connection(connection)\n+        NetworkThread().start()\n+        node.wait_for_verack()\n+        node.send_message(msg_verack())\n+        getdata_request = msg_getdata()\n+        getdata_request.inv.append(CInv(2, int(blockhash, 16)))\n+        node.send_message(getdata_request)\n+        #check if we the peer sends us the block",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326166",
      "id" : 143326166,
      "original_commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "original_position" : 48,
      "path" : "test/functional/node_network_limited.py",
      "position" : 48,
      "pull_request_review_id" : 67828631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-07T08:39:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326166",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326177"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326177"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`self.restart_node(0)`.",
      "commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "created_at" : "2017-10-07T08:37:06Z",
      "diff_hunk" : "@@ -0,0 +1,107 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+from test_framework.mininode import *\n+\n+class BaseNode(NodeConnCB):\n+    nServices = 0\n+    firstAddrnServices = 0\n+    def on_version(self, conn, message):\n+        self.nServices = message.nServices\n+    def on_addr(self, conn, message):\n+        self.firstAddrnServices = message.addrs[0].nServices\n+    def wait_for_addr(self, timeout=60):\n+        test_function = lambda: self.last_message.get(\"addr\")\n+        wait_until(test_function, timeout=timeout, lock=mininode_lock)\n+\n+class NodeNetworkLimitedTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.extra_args = [['-prune=550', '-addrmantest']]\n+\n+    def getSignaledServiceFlags(self):\n+        node = BaseNode()\n+        connection = NodeConn('127.0.0.1', p2p_port(0), self.nodes[0], node)\n+        node.add_connection(connection)\n+        NetworkThread().start()\n+        node.wait_for_verack()\n+        services = node.nServices\n+        connection.disconnect_node()\n+        node.wait_for_disconnect()\n+        del node\n+        return services\n+\n+    def tryGetBlockViaGetData(self, blockhash, result):\n+        node = BaseNode()\n+        connection = NodeConn('127.0.0.1', p2p_port(0), self.nodes[0], node)\n+        node.add_connection(connection)\n+        NetworkThread().start()\n+        node.wait_for_verack()\n+        node.send_message(msg_verack())\n+        getdata_request = msg_getdata()\n+        getdata_request.inv.append(CInv(2, int(blockhash, 16)))\n+        node.send_message(getdata_request)\n+        #check if we the peer sends us the block\n+        res = False\n+        try:\n+            node.wait_for_block(int(blockhash, 16), 3)\n+            res = True\n+        except:\n+            pass\n+        assert_equal(res, result)\n+        connection.disconnect_node()\n+        node.wait_for_disconnect()\n+        del node\n+\n+    def run_test(self):\n+        #NODE_BLOOM & NODE_WITNESS & NODE_NETWORK_LIMITED must now be signaled\n+        assert_equal(self.getSignaledServiceFlags(), 1036) #1036 == 0x40C == 0100 0000 1100\n+#                                                                              |        ||\n+#                                                                              |        |^--- NODE_BLOOM\n+#                                                                              |        ^---- NODE_WITNESS\n+#                                                                              ^-- NODE_NETWORK_LIMITED\n+\n+        #now mine some blocks over the NODE_NETWORK_LIMITED target\n+        firstblock = self.nodes[0].generate(1)[0]\n+        blocks = self.nodes[0].generate(290)\n+        blockWithinLimitedRange = blocks[-1]\n+\n+        #make sure we can max retrive block at tip-288\n+        #requesting block at height 2 (tip-289) must fail (ignored)\n+        self.tryGetBlockViaGetData(firstblock, False)\n+        self.tryGetBlockViaGetData(blocks[1], True)\n+        self.tryGetBlockViaGetData(blocks[0], False)\n+\n+        #NODE_NETWORK_LIMITED must still be signaled after restart\n+        self.stop_node(0)\n+        self.start_node(0, extra_args=self.extra_args[0])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#discussion_r143326177",
      "id" : 143326177,
      "original_commit_id" : "4f5d61e86efb7c8aed5ff7b75074cc678bda67a4",
      "original_position" : 81,
      "path" : "test/functional/node_network_limited.py",
      "position" : 81,
      "pull_request_review_id" : 67828631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10387",
      "updated_at" : "2017-10-07T08:39:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/143326177",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/3534524?v=4",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased (since #11456 is now merged). Tried to keep calls to `InitialBlockDownload()` to a minimum, therefore added `initialBlockDownloadCompleted` (bool) to `protocol.h`. Not sure if this is the best idea (ping @TheBlueMatt & @theuni).",
      "created_at" : "2017-10-14T05:05:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10387#issuecomment-336610623",
      "id" : 336610623,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10387",
      "updated_at" : "2017-10-14T05:05:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/336610623",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/178464?v=4",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   }
]
