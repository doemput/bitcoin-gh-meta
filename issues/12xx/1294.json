{
   "assignee" : null,
   "body" : "Using bitcoin tag v0.6.2.2, if I press Ctrl+C right after starting bitcoind, it crashes:\n\n```\nCore was generated by `./bitcoind -dns -connect=10.210.1.1'.\nProgram terminated with signal 6, Aborted.\n#0  0x00007fa828e9e3a5 in __GI_raise (sig=6) at ../nptl/sysdeps/unix/sysv/linux/raise.c:64\n64      ../nptl/sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n        in ../nptl/sysdeps/unix/sysv/linux/raise.c\n(gdb) bt\n#0  0x00007fa828e9e3a5 in __GI_raise (sig=6) at ../nptl/sysdeps/unix/sysv/linux/raise.c:64\n#1  0x00007fa828ea1b0b in __GI_abort () at abort.c:92\n#2  0x00007fa82c382f38 in undefined_behavior_trap_handler ()\n#3  0x00007fa82c139d79 in StopNode () at net.cpp:1707\n#4  0x00007fa82bfcb6fb in Shutdown (parg=<optimized out>) at init.cpp:58\n#5  0x00007fa82bfcbcd2 in AppInit (argc=<optimized out>, argv=<optimized out>) at init.cpp:118\n#6  0x00007fa82bfcbc3a in main (argc=<optimized out>, argv=<optimized out>) at init.cpp:96\n```\nThe relevant lines of code around net.cpp:1707:StopNode():\n\n```\n1700 bool StopNode()\n1701 {\n1702     printf(\"StopNode()\\n\");\n1703     fShutdown = true;\n1704     nTransactionsUpdated++;\n1705     int64 nStart = GetTime();\n1706     for (int i=0; i<MAX_OUTBOUND_CONNECTIONS; i++)\n1707          semOutbound->post();\n```\nThe reason seems to be that semOutbound has not been initialized yet:\n\n```\n(gdb) p semOutbound\n$1 = 0\n```\nIn other words, StopNode() is being called before StartNode().\n",
   "closed_at" : "2012-05-14T13:48:39Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/168610?v=3",
      "events_url" : "https://api.github.com/users/wizeman/events{/privacy}",
      "followers_url" : "https://api.github.com/users/wizeman/followers",
      "following_url" : "https://api.github.com/users/wizeman/following{/other_user}",
      "gists_url" : "https://api.github.com/users/wizeman/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/wizeman",
      "id" : 168610,
      "login" : "wizeman",
      "organizations_url" : "https://api.github.com/users/wizeman/orgs",
      "received_events_url" : "https://api.github.com/users/wizeman/received_events",
      "repos_url" : "https://api.github.com/users/wizeman/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/wizeman/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/wizeman/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/wizeman"
   },
   "comments" : 2,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1294/comments",
   "created_at" : "2012-05-14T04:05:54Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1294/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/1294",
   "id" : 4557224,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1294/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 1294,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "title" : "NULL ptr deref when press Ctrl+C right after starting bitcoind",
   "updated_at" : "2012-05-14T13:48:39Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/1294",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/168610?v=3",
      "events_url" : "https://api.github.com/users/wizeman/events{/privacy}",
      "followers_url" : "https://api.github.com/users/wizeman/followers",
      "following_url" : "https://api.github.com/users/wizeman/following{/other_user}",
      "gists_url" : "https://api.github.com/users/wizeman/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/wizeman",
      "id" : 168610,
      "login" : "wizeman",
      "organizations_url" : "https://api.github.com/users/wizeman/orgs",
      "received_events_url" : "https://api.github.com/users/wizeman/received_events",
      "repos_url" : "https://api.github.com/users/wizeman/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/wizeman/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/wizeman/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/wizeman"
   }
}
