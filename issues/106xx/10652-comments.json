[
   {
      "body" : "Ping @theuni.",
      "created_at" : "2017-06-22T19:56:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#issuecomment-310485429",
      "id" : 310485429,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10652",
      "updated_at" : "2017-06-22T19:56:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/310485429",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r124646951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124646951"
         }
      },
      "body" : "Wouldn't this discard the rvalue reference && (move schematic)? ",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-06-28T20:24:52Z",
      "diff_hunk" : "@@ -2820,12 +2820,96 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     for (auto&& pnode : vNodes) {\n         if(pnode->GetId() == id) {\n             found = pnode;\n+            found->AddRef();\n             break;\n         }\n     }\n-    return found != nullptr && NodeFullyConnected(found) && func(found);\n+    bool res = found != nullptr && NodeFullyConnected(found) && func(found);\n+    found->Release();\n+    return res;\n }\n \n+void CConnman::ForEachNode(std::function<void (CNode* pnode)> func)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r124646951",
      "id" : 124646951,
      "original_commit_id" : "f1d25b2d54779d8b96b69a38c0cf762977ed92c2",
      "original_position" : 14,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 46957076,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124646951",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r124656961"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124656961"
         }
      },
      "body" : "I mean it does, but I'm not too worried about requiring move for a callable type (places where we std::move a lambda into this will still get the benifit of calling std::function(Callable&&)). The real concern here, of course, is that it introduces a performance penalty, but its not huge (an extra function call and few if's on top of the callback function call) and we're already calling this with lambda functions, so I dont think we were ever too worried about the performance here.",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-06-28T21:07:32Z",
      "diff_hunk" : "@@ -2820,12 +2820,96 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     for (auto&& pnode : vNodes) {\n         if(pnode->GetId() == id) {\n             found = pnode;\n+            found->AddRef();\n             break;\n         }\n     }\n-    return found != nullptr && NodeFullyConnected(found) && func(found);\n+    bool res = found != nullptr && NodeFullyConnected(found) && func(found);\n+    found->Release();\n+    return res;\n }\n \n+void CConnman::ForEachNode(std::function<void (CNode* pnode)> func)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r124656961",
      "id" : 124656961,
      "original_commit_id" : "f1d25b2d54779d8b96b69a38c0cf762977ed92c2",
      "original_position" : 14,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 46968313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124656961",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r124659622"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124659622"
         }
      },
      "body" : "Moved this commit to #10697.",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-06-28T21:19:30Z",
      "diff_hunk" : "@@ -2820,12 +2820,96 @@ bool CConnman::ForNode(NodeId id, std::function<bool(CNode* pnode)> func)\n     for (auto&& pnode : vNodes) {\n         if(pnode->GetId() == id) {\n             found = pnode;\n+            found->AddRef();\n             break;\n         }\n     }\n-    return found != nullptr && NodeFullyConnected(found) && func(found);\n+    bool res = found != nullptr && NodeFullyConnected(found) && func(found);\n+    found->Release();\n+    return res;\n }\n \n+void CConnman::ForEachNode(std::function<void (CNode* pnode)> func)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r124659622",
      "id" : 124659622,
      "original_commit_id" : "f1d25b2d54779d8b96b69a38c0cf762977ed92c2",
      "original_position" : 14,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 46971332,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/124659622",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Rebased on a rebased version of the updated #10179 and filled in more text for the \"\tMarkBlockAsReceived on NewPoWValidBlock at receive.\" commit message which helps provide a bit more context for this PR:\r\n\r\n\"Note that this also helps with future per-CNodeState locks, as those\r\nwill require no two CNodeState locks to be held at the same time\r\n(for lockorder reasons), and this prevents us from accessing\r\nanother peer's mmapBlocksInFlight entry during processing as we can\r\nmove the NewPoWValidBlock callback into the CValidationInterface\r\nbackground thread mechanics.\"",
      "created_at" : "2017-06-28T21:28:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#issuecomment-311797355",
      "id" : 311797355,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10652",
      "updated_at" : "2017-06-28T21:28:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/311797355",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126026442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126026442"
         }
      },
      "body" : "I think this wants fInitialDownload as a param so that it's always evaluated in its receiving context rather than having subscribers potentially coming to different conclusions.",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-06T21:56:19Z",
      "diff_hunk" : "@@ -3023,9 +3023,7 @@ static bool AcceptBlock(const std::shared_ptr<const CBlock>& pblock, CValidation\n     }\n \n     // Header is valid/has work, merkle tree and segwit merkle tree are good...RELAY NOW\n-    // (but if it does not build on our best tip, let the SendMessages loop relay it)\n-    if (!IsInitialBlockDownload() && chainActive.Tip() == pindex->pprev)\n-        GetMainSignals().NewPoWValidBlock(pindex, pblock);\n+    GetMainSignals().NewPoWValidBlock(pindex, pblock, chainActive.Tip() == pindex->pprev);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126026442",
      "id" : 126026442,
      "original_commit_id" : "df3001d00a4578275e22ffb770b62a568acd8178",
      "original_position" : 7,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 48474644,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126026442",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126026861"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126026861"
         }
      },
      "body" : "Probably makes sense for MarkBlockAsNotInFlight() to return whether it removed something for the peer? I think that would take care of the TODO as well.",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-06T21:58:33Z",
      "diff_hunk" : "@@ -2431,7 +2424,10 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             LOCK(cs_main);\n             // Also always process if we requested the block explicitly, as we may\n             // need it even though it is not a candidate for a new best tip.\n-            forceProcessing |= MarkBlockAsReceived(hash);\n+            // TODO: Only process if requested from this peer?\n+            forceProcessing |= mmapBlocksInFlight.count(hash);\n+            // Block is no longer in flight from this peer\n+            MarkBlockAsNotInFlight(hash, pfrom->GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126026861",
      "id" : 126026861,
      "original_commit_id" : "35bd4b620492e9b9c12b5fca24a007fd2ac8aa44",
      "original_position" : 47,
      "path" : "src/net_processing.cpp",
      "position" : 368,
      "pull_request_review_id" : 48475117,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126026861",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126248140"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126248140"
         }
      },
      "body" : "Hmm? I'm not sure I caught your point - we never get here if we already have the block on disk, and the new uses of it in net_processing need to know that we got here for any ProcessNewBlock call they make.",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-07T21:21:33Z",
      "diff_hunk" : "@@ -3023,9 +3023,7 @@ static bool AcceptBlock(const std::shared_ptr<const CBlock>& pblock, CValidation\n     }\n \n     // Header is valid/has work, merkle tree and segwit merkle tree are good...RELAY NOW\n-    // (but if it does not build on our best tip, let the SendMessages loop relay it)\n-    if (!IsInitialBlockDownload() && chainActive.Tip() == pindex->pprev)\n-        GetMainSignals().NewPoWValidBlock(pindex, pblock);\n+    GetMainSignals().NewPoWValidBlock(pindex, pblock, chainActive.Tip() == pindex->pprev);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126248140",
      "id" : 126248140,
      "original_commit_id" : "df3001d00a4578275e22ffb770b62a568acd8178",
      "original_position" : 7,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 48721311,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126248140",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126249178"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126249178"
         }
      },
      "body" : "Given the TODO has a \"?\" on it (and I dunno if we want it or not), I'll leave this for a later PR?",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-07T21:27:50Z",
      "diff_hunk" : "@@ -2431,7 +2424,10 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             LOCK(cs_main);\n             // Also always process if we requested the block explicitly, as we may\n             // need it even though it is not a candidate for a new best tip.\n-            forceProcessing |= MarkBlockAsReceived(hash);\n+            // TODO: Only process if requested from this peer?\n+            forceProcessing |= mmapBlocksInFlight.count(hash);\n+            // Block is no longer in flight from this peer\n+            MarkBlockAsNotInFlight(hash, pfrom->GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126249178",
      "id" : 126249178,
      "original_commit_id" : "35bd4b620492e9b9c12b5fca24a007fd2ac8aa44",
      "original_position" : 47,
      "path" : "src/net_processing.cpp",
      "position" : 368,
      "pull_request_review_id" : 48722451,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126249178",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Rebased.",
      "created_at" : "2017-07-07T21:28:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#issuecomment-313797410",
      "id" : 313797410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10652",
      "updated_at" : "2017-07-07T21:28:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/313797410",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126256947"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126256947"
         }
      },
      "body" : "My point was that IsInitialBlockDownload() may be false by the time it's checked in a callback on a separate thread (once that stuff comes in), though it was true in AcceptBlock. So it's potentially racy to subscribers.",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-07T22:20:04Z",
      "diff_hunk" : "@@ -3023,9 +3023,7 @@ static bool AcceptBlock(const std::shared_ptr<const CBlock>& pblock, CValidation\n     }\n \n     // Header is valid/has work, merkle tree and segwit merkle tree are good...RELAY NOW\n-    // (but if it does not build on our best tip, let the SendMessages loop relay it)\n-    if (!IsInitialBlockDownload() && chainActive.Tip() == pindex->pprev)\n-        GetMainSignals().NewPoWValidBlock(pindex, pblock);\n+    GetMainSignals().NewPoWValidBlock(pindex, pblock, chainActive.Tip() == pindex->pprev);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126256947",
      "id" : 126256947,
      "original_commit_id" : "df3001d00a4578275e22ffb770b62a568acd8178",
      "original_position" : 7,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 48730910,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126256947",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/417043?v=3",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126263585"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126263585"
         }
      },
      "body" : "Ahh, ok. Yes, is not an issue in any of my work, I believe (worst-case you have an extra few fast-announcements when you first leave IBD), but I added a comment noting the issue.",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-07T23:18:24Z",
      "diff_hunk" : "@@ -3023,9 +3023,7 @@ static bool AcceptBlock(const std::shared_ptr<const CBlock>& pblock, CValidation\n     }\n \n     // Header is valid/has work, merkle tree and segwit merkle tree are good...RELAY NOW\n-    // (but if it does not build on our best tip, let the SendMessages loop relay it)\n-    if (!IsInitialBlockDownload() && chainActive.Tip() == pindex->pprev)\n-        GetMainSignals().NewPoWValidBlock(pindex, pblock);\n+    GetMainSignals().NewPoWValidBlock(pindex, pblock, chainActive.Tip() == pindex->pprev);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126263585",
      "id" : 126263585,
      "original_commit_id" : "df3001d00a4578275e22ffb770b62a568acd8178",
      "original_position" : 7,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 48737693,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126263585",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126431389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126431389"
         }
      },
      "body" : "Missing block or same line as `if ()`.",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-10T14:08:21Z",
      "diff_hunk" : "@@ -276,6 +276,45 @@ void InitializeNode(CNode *pnode, CConnman& connman) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// Requires cs_main\n+// Helper function for MarkBlockAsReceived and MarkBlockAsNotInFlight\n+static void ClearDownloadState(BlockDownloadMap::iterator itInFlight) {\n+    AssertLockHeld(cs_main);\n+\n+    CNodeState *state = State(itInFlight->second.first);\n+    state->nBlocksInFlightValidHeaders -= itInFlight->second.second->fValidatedHeaders;\n+    if (state->nBlocksInFlightValidHeaders == 0 && itInFlight->second.second->fValidatedHeaders) {\n+        // Last validated block on the queue was received.\n+        nPeersWithValidatedDownloads--;\n+    }\n+    if (state->vBlocksInFlight.begin() == itInFlight->second.second) {\n+        // First block on the queue was received, update the start download time for the next one\n+        state->nDownloadingSince = std::max(state->nDownloadingSince, GetTimeMicros());\n+    }\n+    state->vBlocksInFlight.erase(itInFlight->second.second);\n+    state->nBlocksInFlight--;\n+    state->nStallingSince = 0;\n+}\n+\n+// Requires cs_main.\n+// Used to remove block from mmapBlocksInFlight and clear the download state for\n+// a block if for some reason block was not received. Download state clearing is\n+// skipped as an optimization in FinalizeNode.\n+static void MarkBlockAsNotInFlight(const uint256& hash, NodeId nodeid, bool clearState = true) {\n+    AssertLockHeld(cs_main);\n+\n+    std::pair<BlockDownloadMap::iterator, BlockDownloadMap::iterator> range = mmapBlocksInFlight.equal_range(hash);\n+    while (range.first != range.second) {\n+        BlockDownloadMap::iterator itInFlight = range.first;\n+        range.first++;\n+        if (itInFlight->second.first == nodeid) {\n+            if (clearState)\n+                ClearDownloadState(itInFlight);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126431389",
      "id" : 126431389,
      "original_commit_id" : "c248f0121b008e680abbba7556d5ae6ed5d4bab1",
      "original_position" : 55,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 48913977,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-12T22:48:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126431389",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126517743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126517743"
         }
      },
      "body" : "same line or braces",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-10T19:45:33Z",
      "diff_hunk" : "@@ -276,6 +276,45 @@ void InitializeNode(CNode *pnode, CConnman& connman) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// Requires cs_main\n+// Helper function for MarkBlockAsReceived and MarkBlockAsNotInFlight\n+static void ClearDownloadState(BlockDownloadMap::iterator itInFlight) {\n+    AssertLockHeld(cs_main);\n+\n+    CNodeState *state = State(itInFlight->second.first);\n+    state->nBlocksInFlightValidHeaders -= itInFlight->second.second->fValidatedHeaders;\n+    if (state->nBlocksInFlightValidHeaders == 0 && itInFlight->second.second->fValidatedHeaders) {\n+        // Last validated block on the queue was received.\n+        nPeersWithValidatedDownloads--;\n+    }\n+    if (state->vBlocksInFlight.begin() == itInFlight->second.second) {\n+        // First block on the queue was received, update the start download time for the next one\n+        state->nDownloadingSince = std::max(state->nDownloadingSince, GetTimeMicros());\n+    }\n+    state->vBlocksInFlight.erase(itInFlight->second.second);\n+    state->nBlocksInFlight--;\n+    state->nStallingSince = 0;\n+}\n+\n+// Requires cs_main.\n+// Used to remove block from mmapBlocksInFlight and clear the download state for\n+// a block if for some reason block was not received. Download state clearing is\n+// skipped as an optimization in FinalizeNode.\n+static void MarkBlockAsNotInFlight(const uint256& hash, NodeId nodeid, bool clearState = true) {\n+    AssertLockHeld(cs_main);\n+\n+    std::pair<BlockDownloadMap::iterator, BlockDownloadMap::iterator> range = mmapBlocksInFlight.equal_range(hash);\n+    while (range.first != range.second) {\n+        BlockDownloadMap::iterator itInFlight = range.first;\n+        range.first++;\n+        if (itInFlight->second.first == nodeid) {\n+            if (clearState)\n+                ClearDownloadState(itInFlight);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126517743",
      "id" : 126517743,
      "original_commit_id" : "c248f0121b008e680abbba7556d5ae6ed5d4bab1",
      "original_position" : 55,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 49009940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126517743",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126535956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126535956"
         }
      },
      "body" : "I'm a bit hesitant about this change.  I can't really remember exactly why we have this CanDirectFetch logic in compact block processing.  But this could make us unnecessarily avoid an optimistic compact block reconstruction if for some reason it took more than 200 mins to receive 2 blocks (right we do reconstructions if within 2 blocks of the announced block?)",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-10T21:01:55Z",
      "diff_hunk" : "@@ -2024,7 +2066,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n         }\n \n         // If we're not close to tip yet, give up and let parallel block fetch work its magic\n-        if (!fAlreadyInFlight && !CanDirectFetch(chainparams.GetConsensus()))\n+        if (!fInFlightFromSamePeer && !CanDirectFetch(chainparams.GetConsensus()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126535956",
      "id" : 126535956,
      "original_commit_id" : "0010932a0d8b512e8dfeefdb2b985b565586a943",
      "original_position" : 242,
      "path" : "src/net_processing.cpp",
      "position" : 241,
      "pull_request_review_id" : 49009940,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126535956",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126537259"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126537259"
         }
      },
      "body" : "Actually now that I think about it, that concern exists prior to the changes in this PR.\r\nWhy do we have the CanDirectFetch guard for compact block processing?\r\n",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-10T21:07:12Z",
      "diff_hunk" : "@@ -2024,7 +2066,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n         }\n \n         // If we're not close to tip yet, give up and let parallel block fetch work its magic\n-        if (!fAlreadyInFlight && !CanDirectFetch(chainparams.GetConsensus()))\n+        if (!fInFlightFromSamePeer && !CanDirectFetch(chainparams.GetConsensus()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126537259",
      "id" : 126537259,
      "original_commit_id" : "0010932a0d8b512e8dfeefdb2b985b565586a943",
      "original_position" : 242,
      "path" : "src/net_processing.cpp",
      "position" : 241,
      "pull_request_review_id" : 49031617,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126537259",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126576463"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126576463"
         }
      },
      "body" : "Fixed.",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-11T01:35:29Z",
      "diff_hunk" : "@@ -276,6 +276,45 @@ void InitializeNode(CNode *pnode, CConnman& connman) {\n         PushNodeVersion(pnode, connman, GetTime());\n }\n \n+// Requires cs_main\n+// Helper function for MarkBlockAsReceived and MarkBlockAsNotInFlight\n+static void ClearDownloadState(BlockDownloadMap::iterator itInFlight) {\n+    AssertLockHeld(cs_main);\n+\n+    CNodeState *state = State(itInFlight->second.first);\n+    state->nBlocksInFlightValidHeaders -= itInFlight->second.second->fValidatedHeaders;\n+    if (state->nBlocksInFlightValidHeaders == 0 && itInFlight->second.second->fValidatedHeaders) {\n+        // Last validated block on the queue was received.\n+        nPeersWithValidatedDownloads--;\n+    }\n+    if (state->vBlocksInFlight.begin() == itInFlight->second.second) {\n+        // First block on the queue was received, update the start download time for the next one\n+        state->nDownloadingSince = std::max(state->nDownloadingSince, GetTimeMicros());\n+    }\n+    state->vBlocksInFlight.erase(itInFlight->second.second);\n+    state->nBlocksInFlight--;\n+    state->nStallingSince = 0;\n+}\n+\n+// Requires cs_main.\n+// Used to remove block from mmapBlocksInFlight and clear the download state for\n+// a block if for some reason block was not received. Download state clearing is\n+// skipped as an optimization in FinalizeNode.\n+static void MarkBlockAsNotInFlight(const uint256& hash, NodeId nodeid, bool clearState = true) {\n+    AssertLockHeld(cs_main);\n+\n+    std::pair<BlockDownloadMap::iterator, BlockDownloadMap::iterator> range = mmapBlocksInFlight.equal_range(hash);\n+    while (range.first != range.second) {\n+        BlockDownloadMap::iterator itInFlight = range.first;\n+        range.first++;\n+        if (itInFlight->second.first == nodeid) {\n+            if (clearState)\n+                ClearDownloadState(itInFlight);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126576463",
      "id" : 126576463,
      "original_commit_id" : "c248f0121b008e680abbba7556d5ae6ed5d4bab1",
      "original_position" : 55,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 49073049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126576463",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126576726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126576726"
         }
      },
      "body" : "No, I think you'd have to go 200 minutes for one block for it to matter (if you go 200 minutes for two, and missed the first one, you wont compact-download that older one, but thats OK, you were probably offline or something anyway). Still, we dont have a much better way to say \"ok, I really, really only want to do this if I'm caught up\" (ie cause otherwise mempool will be worthless). We could drop it - its not the end of the world to take the extra RT to use the compact blocks and get a tiny bit of compression, but at that point you may very well be just as well off just doing a regular block fetch and not taking the extra RT.",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-11T01:38:00Z",
      "diff_hunk" : "@@ -2024,7 +2066,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n         }\n \n         // If we're not close to tip yet, give up and let parallel block fetch work its magic\n-        if (!fAlreadyInFlight && !CanDirectFetch(chainparams.GetConsensus()))\n+        if (!fInFlightFromSamePeer && !CanDirectFetch(chainparams.GetConsensus()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126576726",
      "id" : 126576726,
      "original_commit_id" : "0010932a0d8b512e8dfeefdb2b985b565586a943",
      "original_position" : 242,
      "path" : "src/net_processing.cpp",
      "position" : 241,
      "pull_request_review_id" : 49073330,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-11T15:15:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126576726",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126644583"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126644583"
         }
      },
      "body" : "Remove extra line.",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-11T09:53:10Z",
      "diff_hunk" : "@@ -139,3 +139,69 @@ size_t CScheduler::getQueueInfo(boost::chrono::system_clock::time_point &first,\n     }\n     return result;\n }\n+\n+bool CScheduler::AreThreadsServicingQueue() const {\n+    return nThreadsServicingQueue;\n+}\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126644583",
      "id" : 126644583,
      "original_commit_id" : "7145218d32b8c9067e8bcedd6f521f7ad6b45358",
      "original_position" : 8,
      "path" : "src/scheduler.cpp",
      "position" : null,
      "pull_request_review_id" : 48913977,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-12T22:48:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126644583",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126644870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126644870"
         }
      },
      "body" : "`{` in new line for all functions. ",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-11T09:54:36Z",
      "diff_hunk" : "@@ -139,3 +139,69 @@ size_t CScheduler::getQueueInfo(boost::chrono::system_clock::time_point &first,\n     }\n     return result;\n }\n+\n+bool CScheduler::AreThreadsServicingQueue() const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126644870",
      "id" : 126644870,
      "original_commit_id" : "7145218d32b8c9067e8bcedd6f521f7ad6b45358",
      "original_position" : 5,
      "path" : "src/scheduler.cpp",
      "position" : null,
      "pull_request_review_id" : 48913977,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-12T22:48:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126644870",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126646788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126646788"
         }
      },
      "body" : "Remove `it` and mutate `rangeInFlight.first`.",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-11T10:03:56Z",
      "diff_hunk" : "@@ -2158,17 +2189,27 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n         {\n             LOCK(cs_main);\n \n-            std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> >::iterator it = mapBlocksInFlight.find(resp.blockhash);\n-            if (it == mapBlocksInFlight.end() || !it->second.second->partialBlock ||\n-                    it->second.first != pfrom->GetId()) {\n+            bool fExpectedBLOCKTXN = false;\n+            std::pair<BlockDownloadMap::iterator, BlockDownloadMap::iterator> rangeInFlight = mmapBlocksInFlight.equal_range(resp.blockhash);\n+            BlockDownloadMap::iterator it = rangeInFlight.first;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126646788",
      "id" : 126646788,
      "original_commit_id" : "7145218d32b8c9067e8bcedd6f521f7ad6b45358",
      "original_position" : 301,
      "path" : "src/net_processing.cpp",
      "position" : 301,
      "pull_request_review_id" : 48913977,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-12T22:48:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126646788",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126650373"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126650373"
         }
      },
      "body" : "```cpp\r\nif (it->second.first == pfrom->GetId()) {\r\n    fExpectedBLOCKTXN = it->second.second->partialBlock;\r\n    break;\r\n}\r\n```",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-11T10:21:59Z",
      "diff_hunk" : "@@ -2158,17 +2189,27 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n         {\n             LOCK(cs_main);\n \n-            std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> >::iterator it = mapBlocksInFlight.find(resp.blockhash);\n-            if (it == mapBlocksInFlight.end() || !it->second.second->partialBlock ||\n-                    it->second.first != pfrom->GetId()) {\n+            bool fExpectedBLOCKTXN = false;\n+            std::pair<BlockDownloadMap::iterator, BlockDownloadMap::iterator> rangeInFlight = mmapBlocksInFlight.equal_range(resp.blockhash);\n+            BlockDownloadMap::iterator it = rangeInFlight.first;\n+            while (it != rangeInFlight.second) {\n+                if (it->second.first == pfrom->GetId()) {\n+                    if (it->second.second->partialBlock)\n+                        fExpectedBLOCKTXN = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126650373",
      "id" : 126650373,
      "original_commit_id" : "7145218d32b8c9067e8bcedd6f521f7ad6b45358",
      "original_position" : 305,
      "path" : "src/net_processing.cpp",
      "position" : 305,
      "pull_request_review_id" : 48913977,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-12T22:48:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126650373",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126650495"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126650495"
         }
      },
      "body" : "`expected_BLOCKTXN`?",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-11T10:22:39Z",
      "diff_hunk" : "@@ -2158,17 +2189,27 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n         {\n             LOCK(cs_main);\n \n-            std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> >::iterator it = mapBlocksInFlight.find(resp.blockhash);\n-            if (it == mapBlocksInFlight.end() || !it->second.second->partialBlock ||\n-                    it->second.first != pfrom->GetId()) {\n+            bool fExpectedBLOCKTXN = false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126650495",
      "id" : 126650495,
      "original_commit_id" : "7145218d32b8c9067e8bcedd6f521f7ad6b45358",
      "original_position" : 299,
      "path" : "src/net_processing.cpp",
      "position" : 299,
      "pull_request_review_id" : 48913977,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-12T22:48:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126650495",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126651311"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126651311"
         }
      },
      "body" : "Replace these `mmapBlocksInFlight.count()` with, for instance:\r\n```cpp\r\nforceProcessing |= IsBlockInFlight(hash);\r\n```",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-11T10:27:05Z",
      "diff_hunk" : "@@ -2382,7 +2423,10 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n             LOCK(cs_main);\n             // Also always process if we requested the block explicitly, as we may\n             // need it even though it is not a candidate for a new best tip.\n-            forceProcessing |= MarkBlockAsReceived(hash);\n+            // TODO: Only process if requested from this peer?\n+            forceProcessing |= mmapBlocksInFlight.count(hash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r126651311",
      "id" : 126651311,
      "original_commit_id" : "7145218d32b8c9067e8bcedd6f521f7ad6b45358",
      "original_position" : 366,
      "path" : "src/net_processing.cpp",
      "position" : 366,
      "pull_request_review_id" : 48913977,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-12T22:48:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/126651311",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "body" : "Rebased to remove the useless old commits, but no changes. Still would be nice to see thtis for 0.15, but not a huge deal if it misses.",
      "created_at" : "2017-07-11T15:16:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#issuecomment-314477522",
      "id" : 314477522,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10652",
      "updated_at" : "2017-07-11T15:16:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314477522",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "utACK ca66c4a\r\n\r\n\r\n",
      "created_at" : "2017-07-11T17:27:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#issuecomment-314515205",
      "id" : 314515205,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10652",
      "updated_at" : "2017-07-11T17:27:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/314515205",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/4360349?v=3",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r127092483"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127092483"
         }
      },
      "body" : "Suggestion, add `NodeId` to `QueuedBlock` structure?",
      "commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "created_at" : "2017-07-12T22:52:25Z",
      "diff_hunk" : "@@ -105,7 +105,8 @@ namespace {\n         bool fValidatedHeaders;                                  //!< Whether this block has validated headers at the time of request.\n         std::unique_ptr<PartiallyDownloadedBlock> partialBlock;  //!< Optional, used for CMPCTBLOCK downloads\n     };\n-    std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> > mapBlocksInFlight;\n+    typedef std::multimap<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator>> BlockDownloadMap;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#discussion_r127092483",
      "id" : 127092483,
      "original_commit_id" : "ca66c4a7d7b6186f3a5582b75e65ea2c0891ed30",
      "original_position" : 5,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 49641781,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10652",
      "updated_at" : "2017-07-12T22:52:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127092483",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/3534524?v=3",
         "events_url" : "https://api.github.com/users/promag/events{/privacy}",
         "followers_url" : "https://api.github.com/users/promag/followers",
         "following_url" : "https://api.github.com/users/promag/following{/other_user}",
         "gists_url" : "https://api.github.com/users/promag/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/promag",
         "id" : 3534524,
         "login" : "promag",
         "organizations_url" : "https://api.github.com/users/promag/orgs",
         "received_events_url" : "https://api.github.com/users/promag/received_events",
         "repos_url" : "https://api.github.com/users/promag/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/promag/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/promag/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/promag"
      }
   },
   {
      "body" : "This should likely be un-tagged 0.15. Its not a critical enough bugfix to merit merging at this late stage.",
      "created_at" : "2017-07-18T21:30:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#issuecomment-316203904",
      "id" : 316203904,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10652",
      "updated_at" : "2017-07-18T21:30:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/316203904",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "Closing as I believe I'm taking a different approach to beter network parallelization, however the commits here are still part of #10984, where they will remain.",
      "created_at" : "2017-08-14T19:05:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10652#issuecomment-322279937",
      "id" : 322279937,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10652",
      "updated_at" : "2017-08-14T19:05:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/322279937",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/649246?v=4",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   }
]
