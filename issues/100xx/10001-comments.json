[
   {
      "body" : "debug log from another server:\r\n\r\n```\r\n2017-03-15 12:12:30 connect() to [2001:0:34af:cdd1:414:187b:b2dd:20ab]:8333 failed: Network is unreachable (101)\r\n2017-03-15 12:13:36 connect() to [2001:0:9d38:78cf:3c1f:3759:a844:c08]:8333 failed: Network is unreachable (101)\r\n2017-03-15 12:13:48 socket recv error Connection reset by peer (104)\r\n2017-03-15 12:14:06 tor: Thread interrupt\r\n2017-03-15 12:14:06 torcontrol thread exit\r\n2017-03-15 12:14:06 opencon thread exit\r\n2017-03-15 12:14:06 scheduler thread interrupt\r\n2017-03-15 12:14:06 Shutdown: In progress...\r\n2017-03-15 12:14:06 net thread exit\r\n2017-03-15 12:14:06 msghand thread exit\r\n\r\n------------------------------------\r\n\r\n$ strace -p 21360\r\nProcess 21360 attached\r\nfutex(0x7f6a9ddea9d0, FUTEX_WAIT, 19190, NULL\r\n```",
      "created_at" : "2017-03-15T12:33:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10001#issuecomment-286728018",
      "id" : 286728018,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10001",
      "updated_at" : "2017-03-15T12:33:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286728018",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/514951?v=3",
         "events_url" : "https://api.github.com/users/bitkevin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bitkevin/followers",
         "following_url" : "https://api.github.com/users/bitkevin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bitkevin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bitkevin",
         "id" : 514951,
         "login" : "bitkevin",
         "organizations_url" : "https://api.github.com/users/bitkevin/orgs",
         "received_events_url" : "https://api.github.com/users/bitkevin/received_events",
         "repos_url" : "https://api.github.com/users/bitkevin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bitkevin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bitkevin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bitkevin"
      }
   },
   {
      "body" : "#9950 was another issue where 0.14 hung on shutdown. That was caused by having >=8 addnodes in the bitcoin.conf file. Do you have that? Are you able to paste your bitcoin.conf here?",
      "created_at" : "2017-03-15T17:44:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10001#issuecomment-286823233",
      "id" : 286823233,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10001",
      "updated_at" : "2017-03-15T17:44:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286823233",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "body" : "@jnewbery yeah, I put about **20 nodes** in the bitcoin.conf file. \r\n\r\n```\r\nrpcallowip=172.17.0.0/16\r\nrpcallowip=192.168.0.0/16\r\nrpcallowip=10.0.0.0/8\r\n\r\n # we use ZMQ to get notification when new block is coming\r\nzmqpubrawblock=tcp://0.0.0.0:8331\r\nzmqpubrawtx=tcp://0.0.0.0:8331\r\nzmqpubhashtx=tcp://0.0.0.0:8331\r\nzmqpubhashblock=tcp://0.0.0.0:8331\r\n\r\n # use 2G memory for utxo, depends on your machine's memory\r\n dbcache=1000\r\n\r\n # use 1MB block when call GBT\r\n blockmaxsize=1000000\r\n\r\n ####################################\r\n\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n addnode=xx.xx.xx.xx\r\n```\r\n",
      "created_at" : "2017-03-16T02:38:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10001#issuecomment-286941122",
      "id" : 286941122,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10001",
      "updated_at" : "2017-03-16T02:38:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286941122",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/514951?v=3",
         "events_url" : "https://api.github.com/users/bitkevin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bitkevin/followers",
         "following_url" : "https://api.github.com/users/bitkevin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bitkevin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bitkevin",
         "id" : 514951,
         "login" : "bitkevin",
         "organizations_url" : "https://api.github.com/users/bitkevin/orgs",
         "received_events_url" : "https://api.github.com/users/bitkevin/received_events",
         "repos_url" : "https://api.github.com/users/bitkevin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bitkevin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bitkevin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bitkevin"
      }
   },
   {
      "body" : "@jnewbery \r\ntemporary fix: https://github.com/btccom/btcpool/commit/656dd3dbd09ccc5e679b4ce13fe5e79adf470073\r\n\r\nusing patch: https://github.com/bitcoin/bitcoin/pull/9953\r\n\r\n```\r\n RUN cd ~/source \\\r\n   && tar zxf v0.14.0.tar.gz && cd bitcoin-0.14.0 \\\r\n+  && wget https://patch-diff.githubusercontent.com/raw/bitcoin/bitcoin/pull/9953.patch -O 9953.patch \\\r\n+  && patch -p1 < 9953.patch \\\r\n   && ./autogen.sh \\\r\n   && ./configure --disable-wallet --disable-tests \\\r\n```\r\n\r\nRight now, restart node works fine. I will put it on pool.btc.com production env.",
      "created_at" : "2017-03-16T04:30:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10001#issuecomment-286955164",
      "id" : 286955164,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10001",
      "updated_at" : "2017-03-16T04:32:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286955164",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/514951?v=3",
         "events_url" : "https://api.github.com/users/bitkevin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bitkevin/followers",
         "following_url" : "https://api.github.com/users/bitkevin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bitkevin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bitkevin",
         "id" : 514951,
         "login" : "bitkevin",
         "organizations_url" : "https://api.github.com/users/bitkevin/orgs",
         "received_events_url" : "https://api.github.com/users/bitkevin/received_events",
         "repos_url" : "https://api.github.com/users/bitkevin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bitkevin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bitkevin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bitkevin"
      }
   },
   {
      "body" : "Do note that, as per the 0.14 release notes, there is now an 8-addnode limit - after the first 8 the rest are ignored (this was previously true as well, but indirectly because they were simply used as nodes to consider for the 8 general outbound connections).\n\nMatt\n\nOn March 15, 2017 5:31:56 AM PDT, kevin <notifications@github.com> wrote:\n>### Describe the issue\n>\n>bitcoind-v0.14.0 can't shutdown.\n>\n>### Can you reliably reproduce the issue?\n>\n>Yes. Always happen.\n>\n>#### If so, please list the steps to reproduce below:\n>1. build bitcoind with docker:\n>https://github.com/btccom/btcpool/tree/master/docker/bitcoind/v0.14.0\n>2. get into docker, than shutdown node with rpc call `bitcoin-cli stop`\n>3. bitcoind process will hang up.\n>\n>### Expected behaviour\n>\n>\n>### Actual behaviour\n>\n>debug.log:\n>\n>```\n>2017-03-15 11:49:28 CreateNewBlock(): total size: 998181 block weight:\n>3992724 txs: 1516 fees: 94050467 sigops 14524\n>2017-03-15 11:49:38 CreateNewBlock(): total size: 998191 block weight:\n>3992764 txs: 1533 fees: 96320496 sigops 14772\n>2017-03-15 11:49:44 tor: Thread interrupt\n>2017-03-15 11:49:44 torcontrol thread exit\n>2017-03-15 11:49:44 opencon thread exit\n>2017-03-15 11:49:44 scheduler thread interrupt\n>2017-03-15 11:49:44 Shutdown: In progress...\n>2017-03-15 11:49:44 net thread exit\n>2017-03-15 11:49:44 msghand thread exit\n>```\n>\n>```\n>$ strace -p `pgrep bitcoind`\n>Process 31913 attached\n>futex(0x7fd03d5899d0, FUTEX_WAIT, 61, NULL^CProcess 31913 detached\n>```\n>\n>\n>### What version of bitcoin-core are you using?\n>\n>tag v0.14.0\n>\n>### Machine specs:\n>- OS: ubuntu 14.04 LTS, 64Bits\n>- CPU: Intel\n>- RAM: 8G+\n>- Disk size: 200G+\n>- Disk Type (HD/SDD): SSD\n>\n>\n>-- \n>You are receiving this because you are subscribed to this thread.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/issues/10001\n",
      "created_at" : "2017-03-16T05:17:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10001#issuecomment-286960485",
      "id" : 286960485,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10001",
      "updated_at" : "2017-03-16T05:17:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286960485",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "@TheBlueMatt why there is an 8-addnode limit? Eight is far from enough for a pool's node. At least I need to connect with mine own nodes, it's surely more that 8.",
      "created_at" : "2017-03-16T05:31:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10001#issuecomment-286962084",
      "id" : 286962084,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10001",
      "updated_at" : "2017-03-16T05:31:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286962084",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/514951?v=3",
         "events_url" : "https://api.github.com/users/bitkevin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bitkevin/followers",
         "following_url" : "https://api.github.com/users/bitkevin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bitkevin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bitkevin",
         "id" : 514951,
         "login" : "bitkevin",
         "organizations_url" : "https://api.github.com/users/bitkevin/orgs",
         "received_events_url" : "https://api.github.com/users/bitkevin/received_events",
         "repos_url" : "https://api.github.com/users/bitkevin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bitkevin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bitkevin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bitkevin"
      }
   },
   {
      "body" : "Heh, I figured I should mention it :)\n\nThere has always been an 8 addnode limit, because addnodes used to be simply extra nodes to consider when making the 8 outbound convections, now they're split out and there is a separate limit of 8. This limit was kept because there has historically been a lot of folks who just add addnodes to their bitcoin.conf without realizing the implication of potentially DoSing the network :/.\n\nIf you want to override it, you can either patch the MAX_ADDNODE_CONNECTIONS constant higher or use the \"addnode $NODE onetry\" RPC command, which bypasses the limit for the given connection, but you'd have to run that in a loop.\n\nOn March 15, 2017 10:31:17 PM PDT, kevin <notifications@github.com> wrote:\n>@TheBlueMatt why there is an 8-addnode limit? Eight is far from enough\n>for a pool's node. At least I need to connect with mine own nodes, it's\n>surely more that 8.\n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/issues/10001#issuecomment-286962084\n",
      "created_at" : "2017-03-16T05:58:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10001#issuecomment-286965295",
      "id" : 286965295,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10001",
      "updated_at" : "2017-03-16T05:58:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286965295",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/649246?v=3",
         "events_url" : "https://api.github.com/users/TheBlueMatt/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheBlueMatt/followers",
         "following_url" : "https://api.github.com/users/TheBlueMatt/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheBlueMatt",
         "id" : 649246,
         "login" : "TheBlueMatt",
         "organizations_url" : "https://api.github.com/users/TheBlueMatt/orgs",
         "received_events_url" : "https://api.github.com/users/TheBlueMatt/received_events",
         "repos_url" : "https://api.github.com/users/TheBlueMatt/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheBlueMatt/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheBlueMatt"
      }
   },
   {
      "body" : "fixed in 0.14.1",
      "created_at" : "2017-04-23T06:47:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10001#issuecomment-296423496",
      "id" : 296423496,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10001",
      "updated_at" : "2017-04-23T06:47:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/296423496",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/514951?v=3",
         "events_url" : "https://api.github.com/users/bitkevin/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bitkevin/followers",
         "following_url" : "https://api.github.com/users/bitkevin/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bitkevin/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bitkevin",
         "id" : 514951,
         "login" : "bitkevin",
         "organizations_url" : "https://api.github.com/users/bitkevin/orgs",
         "received_events_url" : "https://api.github.com/users/bitkevin/received_events",
         "repos_url" : "https://api.github.com/users/bitkevin/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bitkevin/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bitkevin/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bitkevin"
      }
   }
]
