{
   "assignee" : null,
   "assignees" : [],
   "body" : "After having run bitcoin-qt 0.14.0 for a while on Windows 10 64-bit (it needs to have run the node for a number of hours to reproduce) I closed bitcoin-qt. The \"do not shutdown computer\" message stayed up for almost two hours before it finally closed. \r\n\r\nI have been experiencing this issue consistently, and this delay has lasted even longer in prior instances (i.e. lasting for many more hours). The delay seems to be proportional to how long bitcoin-qt has been running. See below an example debug.log after closing bitcoin-qt this particular time. \r\n\r\n2017-03-16 22:03:23 tor: Thread interrupt\r\n2017-03-16 22:03:23 addcon thread exit\r\n2017-03-16 22:03:23 opencon thread exit\r\n2017-03-16 22:03:23 scheduler thread interrupt\r\n2017-03-16 22:03:23 Shutdown: In progress...\r\n2017-03-16 22:03:23 msghand thread exit\r\n2017-03-16 22:03:23 net thread exit\r\n2017-03-16 23:56:07 torcontrol thread exit\r\n2017-03-16 23:56:14 Dumped mempool: 0.031193s to copy, 6.97686s to dump\r\n2017-03-16 23:56:23 Shutdown: done\r\n\r\nTake note of the torcontrol thread not closing until almost 2 hours later. I'm not sure if this is just a coincidence or actually caused by the torcontrol thread taking forever to close, but at least it's a start. I am not running tor, but I realize that, by default, Bitcoin Core now listens for onion routing. I suspect that turning off onion listening would work around this bug (listenonion=0), but I haven't confirmed this yet (would take a while to test). In the meantime, I will let bitcoin-qt run again for a number of hours with listenonion=1 and debug=tor to see if anything more interesting appears in the log after an extended period of time.\r\n\r\nFor reference, all default settings are being used for this node, except I have maxuploadtarget set to 144.  \r\n\r\nOther possibly unique variables to consider with this node are:\r\n\r\n1.) I happen to have purposely banned a good number of non-Bitcoin Core peers, one by one, manually for a year over the past year. Not sure if this could interfere in any way.\r\n\r\n2.) While datadir is set to the default, the actual default directory in Windows is set up as a symbolic link, pointing to a directory on a USB 3.0 external drive. I don't know how this would interfere with closing a torcontrol thread, but I just thought I'd mention it to cover all bases.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10025/comments",
   "created_at" : "2017-03-18T01:03:50Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10025/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/10025",
   "id" : 215155190,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10025/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "number" : 10025,
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "title" : "0.14.0 long shutdown delay, possibly due to onion listening (but not running tor)",
   "updated_at" : "2017-03-18T01:11:14Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10025",
   "user" : {
      "avatar_url" : "https://avatars3.githubusercontent.com/u/8298277?v=3",
      "events_url" : "https://api.github.com/users/mmortal03/events{/privacy}",
      "followers_url" : "https://api.github.com/users/mmortal03/followers",
      "following_url" : "https://api.github.com/users/mmortal03/following{/other_user}",
      "gists_url" : "https://api.github.com/users/mmortal03/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/mmortal03",
      "id" : 8298277,
      "login" : "mmortal03",
      "organizations_url" : "https://api.github.com/users/mmortal03/orgs",
      "received_events_url" : "https://api.github.com/users/mmortal03/received_events",
      "repos_url" : "https://api.github.com/users/mmortal03/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/mmortal03/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/mmortal03/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/mmortal03"
   }
}
