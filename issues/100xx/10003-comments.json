[
   {
      "body" : "@pinheadmz No need to delete the contents when closing the issue.\nAlso, it might help others if you included the solution to the issue.\n\nOn Wed, Mar 15, 2017 at 8:12 PM, Matthew Zipkin\n<notifications@github.com> wrote:\n> Generate transactions spending unconfirmed change until the maximum\n> unconfirmed chain size is hit.\n>\n> See:\n> https://github.com/bitcoin/bitcoin/blob/57b34599b2deb179ff1bd97ffeab91ec9f904d85/doc/release-notes/release-notes-0.12.0.md\n>\n> \"Bitcoin Core 0.12 also introduces new default policy limits on the length\n> and size of unconfirmed transaction chains that are allowed in the mempool\n> (generally limiting the length of unconfirmed chains to 25 transactions,\n> with a total size of 101 KB).\"\n>\n> Change output of last transaction in chain does not appear in wallet balance\n> until bitcoind is restarted with -rescan, and even then balance seems\n> incorrect?\n>\n> Demonstration:\n>\n> Generate 101 blocks so only one 50 BTC subsidy is mature to spend:\n>\n> $ ./bitcoin-cli -regtest generate 101\n> [\n>   \"4a7ace38144a1aa3f6429cd44689eab15848bf5153020e28f774dd06bd953662\",\n>   ... ... ...\n>   \"441712a7e648bb65ba08c36288390d70bd418509cbc5ecacaa84d07acf024fc6\"\n> ]\n>  $ ./bitcoin-cli -regtest getinfo\n> {\n>   \"version\": 140000,\n>   \"protocolversion\": 70015,\n>   \"walletversion\": 130000,\n>   \"balance\": 50.00000000,\n>   ... ... ...\n>\n> Now attempt to generate 30 x 0.5 BTC transactions from this one output,\n> forcing bitcoind to spend unconfirmed change outputs in a chain until the\n> maximum is hit -- which is indicated by \"Insufficient funds\":\n>\n> $ for n in {1..30}; do ./bitcoin-cli -regtest sendtoaddress\n> 2NCY1Q1Mu6V5uha7fDzGNYYPUs5F1zSdXCL 0.5; done\n> f920747b040c9cbaed03e616699af2cdfb17c01ea8781aa63cc50a2a41eeabf0\n> 0dc4e1576673e41c49f9fc6440b2f8d500488164698c5b22251b422e9541dbb7\n> 8a155048ea29e0b16ea16697a688b02009cc16ab389eb8e19b51c7ec8660e6b6\n> c97c1188a7c3233c45af8e32174328bb8ad66ef4a54ef8213b4966434eb4bc15\n> b83856c1a9d3c0c3ab4af392c88168824081b3169f81a1017bd8813a235bf039\n> 8721cd61e172671b1ed3e1dcf302d9438c033fb8a5c12497ee937322bfa245d9\n> 1cc84a266f8f7c25f4ee2447e67c2f75a8674dc85d51c22d3422d5b4ed3945b4\n> dcdbf7bfa241f2bbf3b16877950494eff6ee1e1764284a3ec43c82964b513f70\n> 88ef788333ed83161ea8059316d91ee2980ad39177d75906c688c3dab440d762\n> f6989e54a4cf628763c339c32476b4424e748055f5f15097936706827f13f4c0\n> 35761b5751bf8de18c38bd695e945a1f3318c9161bbb5d56fb3719839143c2cf\n> 24c5a21aac7da653fa34380639bec49cfb1b84aa82b00453244acbc91a41a984\n> 07ef6b7a932663872657e1bc2a15540279f1bbebbbd97d0bd57a0d1f8dce4810\n> babcaef4a4946d341e96da813430ef05c33619a37af6e0f89ad6892ffe4d8959\n> 66f35a0f8d8fd9c57d4cd0af10034aa13fb295ca8ac98da615ae4670338ecdbc\n> ceb6f86970586a116ab652d8b74accdbc148f98d1be5ab0fc89bfbcdb84d43c4\n> 88df670d619d77a41d901d98125d5156b57a656e9da2447c0e6817b5a826b737\n> 235b8c35837a67a44147fbfc90f52c271705efa05f35f25194943711810c40c8\n> 3a76e4b99effc8edda75e86a35dc25445ad58871a5376af68d0d7915fec9c96a\n> 1ab0458f06b20968cdad7ec102481fe524b4533664a1a15f241458bf1e65d4ec\n> 8e14ec9f71837fe353ab3dff864131b37df7af14ca0789c504077789422e787e\n> d3913e9b617d3b9584415a8f03945699b01fc8e9c589226deabcaccf835d4ec4\n> c4cfd682bc1534b69f019aa7b93d6a1b324f8f62c8485736f3336bc5b8c9668f\n> 97e27736c144436a8e01b06ec3e290d6a49f0708c69afa23beeeb34b80cd3ee7\n> c8337941c8688f26da567d1f34702cc89d33ce1f1e11cfdb98e47857bc0ccad4\n> ec7413149a996a0e0869b6db2c739e7d189ebf9c216ea5af5e81e771f9ce21e4\n> error code: -6\n> error message:\n> Insufficient funds\n> error code: -6\n> error message:\n> Insufficient funds\n> error code: -6\n> error message:\n> Insufficient funds\n> error code: -6\n> error message:\n> Insufficient funds\n>\n> So apparently 26 transactions were generated. There should still be some\n> change left in my wallet. But...\n>\n> $ ./bitcoin-cli -regtest listunspent\n> [\n> ]\n> $ ./bitcoin-cli -regtest  getinfo\n> {\n>   \"version\": 140000,\n>   \"protocolversion\": 70015,\n>   \"walletversion\": 130000,\n>   \"balance\": 0.00000000,\n>   ... ... ...\n>\n> Ok that's weird. Let's see what's up with that very last tx that was\n> generated (tx 26)\n>\n> $ ./bitcoin-cli -regtest getrawtransaction\n> ec7413149a996a0e0869b6db2c739e7d189ebf9c216ea5af5e81e771f9ce21e4 1\n> error code: -5\n> error message:\n> No such mempool transaction. Use -txindex to enable blockchain transaction\n> queries. Use gettransaction for wallet transactions.\n>\n> This is already unexpected behavior - what happened to transaction 26? Ok\n> let's try tx 25, the penultimate tx we generated:\n>\n> $ ./bitcoin-cli -regtest getrawtransaction\n> c8337941c8688f26da567d1f34702cc89d33ce1f1e11cfdb98e47857bc0ccad4 1\n> {\n>   \"hex\":\n> \"0200000001e73ecd804bb3eebe23fa9ac608079fa4d690e2c36eb0018e6a4344c13677e297010000006b483045022100d5c4fc0d2a65e2b2465b486f33411b7896fe1a0da7e7975bcfa9f0c13e215fdd0220154afe927e19e3ba19797013d0072441d27a4cd3bc0eb340bf3afe848fe071ca012102183d0fd8535e1b0102b2b538b3e89df7fcaf99c9c213791b62df3fb7d04b23acfeffffff0280f0fa020000000017a914d396f368f3b4348ced0ed1f4138bb2906e12f7df87a8c282df000000001976a9143439f1a39955abc35bf688c57ba50ec7a4fabc8288ac65000000\",\n>   \"txid\":\n> \"c8337941c8688f26da567d1f34702cc89d33ce1f1e11cfdb98e47857bc0ccad4\",\n>   \"hash\":\n> \"c8337941c8688f26da567d1f34702cc89d33ce1f1e11cfdb98e47857bc0ccad4\",\n>   \"size\": 224,\n>   \"vsize\": 224,\n>   \"version\": 2,\n>   \"locktime\": 101,\n>   \"vin\": [\n>     {\n>       \"txid\":\n> \"97e27736c144436a8e01b06ec3e290d6a49f0708c69afa23beeeb34b80cd3ee7\",\n>       \"vout\": 1,\n>       \"scriptSig\": {\n>         \"asm\":\n> \"3045022100d5c4fc0d2a65e2b2465b486f33411b7896fe1a0da7e7975bcfa9f0c13e215fdd0220154afe927e19e3ba19797013d0072441d27a4cd3bc0eb340bf3afe848fe071ca[ALL]\n> 02183d0fd8535e1b0102b2b538b3e89df7fcaf99c9c213791b62df3fb7d04b23ac\",\n>         \"hex\":\n> \"483045022100d5c4fc0d2a65e2b2465b486f33411b7896fe1a0da7e7975bcfa9f0c13e215fdd0220154afe927e19e3ba19797013d0072441d27a4cd3bc0eb340bf3afe848fe071ca012102183d0fd8535e1b0102b2b538b3e89df7fcaf99c9c213791b62df3fb7d04b23ac\"\n>       },\n>       \"sequence\": 4294967294\n>     }\n>   ],\n>   \"vout\": [\n>     {\n>       \"value\": 0.50000000,\n>       \"n\": 0,\n>       \"scriptPubKey\": {\n>         \"asm\": \"OP_HASH160 d396f368f3b4348ced0ed1f4138bb2906e12f7df\n> OP_EQUAL\",\n>         \"hex\": \"a914d396f368f3b4348ced0ed1f4138bb2906e12f7df87\",\n>         \"reqSigs\": 1,\n>         \"type\": \"scripthash\",\n>         \"addresses\": [\n>           \"2NCY1Q1Mu6V5uha7fDzGNYYPUs5F1zSdXCL\"\n>         ]\n>       }\n>     },\n>     {\n>       \"value\": 37.49888680,\n>       \"n\": 1,\n>       \"scriptPubKey\": {\n>         \"asm\": \"OP_DUP OP_HASH160 3439f1a39955abc35bf688c57ba50ec7a4fabc82\n> OP_EQUALVERIFY OP_CHECKSIG\",\n>         \"hex\": \"76a9143439f1a39955abc35bf688c57ba50ec7a4fabc8288ac\",\n>         \"reqSigs\": 1,\n>         \"type\": \"pubkeyhash\",\n>         \"addresses\": [\n>           \"mkH6r3PzZy8atSaYbVsxK6GqkHACxuU1X9\"\n>         ]\n>       }\n>     }\n>   ]\n> }\n>\n> Ok, so there's my last valid output, worth 37.49888680. Let's mine a block\n> with all those transactions, note how my new balance is still just 50 BTC,\n> from that second block maturing:\n>\n> $ ./bitcoin-cli -regtest generate 1\n> [\n>   \"3424e6fe7a07954a322eac83d09b429ca4eb4ff4068c98071512ea0fff42b59a\"\n> ]\n> $ ./bitcoin-cli -regtest getinfo\n> {\n>   \"version\": 140000,\n>   \"protocolversion\": 70015,\n>   \"walletversion\": 130000,\n>   \"balance\": 50.00000000,\n>   ... ... ...\n>\n> Also note that transaction 26 DID NOT make it into the block:\n>\n> $ ./bitcoin-cli -regtest getblock\n> 3424e6fe7a07954a322eac83d09b429ca4eb4ff4068c98071512ea0fff42b59a\n> {\n>   ... ... ...\n>   \"tx\": [\n>     \"a66dd96e95107bf14d809690729c0257aacaefcdf336a57b3b6bd261f79c85ef\",\n>     \"f920747b040c9cbaed03e616699af2cdfb17c01ea8781aa63cc50a2a41eeabf0\",\n>     \"0dc4e1576673e41c49f9fc6440b2f8d500488164698c5b22251b422e9541dbb7\",\n>     \"8a155048ea29e0b16ea16697a688b02009cc16ab389eb8e19b51c7ec8660e6b6\",\n>     \"c97c1188a7c3233c45af8e32174328bb8ad66ef4a54ef8213b4966434eb4bc15\",\n>     \"b83856c1a9d3c0c3ab4af392c88168824081b3169f81a1017bd8813a235bf039\",\n>     \"8721cd61e172671b1ed3e1dcf302d9438c033fb8a5c12497ee937322bfa245d9\",\n>     \"1cc84a266f8f7c25f4ee2447e67c2f75a8674dc85d51c22d3422d5b4ed3945b4\",\n>     \"dcdbf7bfa241f2bbf3b16877950494eff6ee1e1764284a3ec43c82964b513f70\",\n>     \"88ef788333ed83161ea8059316d91ee2980ad39177d75906c688c3dab440d762\",\n>     \"f6989e54a4cf628763c339c32476b4424e748055f5f15097936706827f13f4c0\",\n>     \"35761b5751bf8de18c38bd695e945a1f3318c9161bbb5d56fb3719839143c2cf\",\n>     \"24c5a21aac7da653fa34380639bec49cfb1b84aa82b00453244acbc91a41a984\",\n>     \"07ef6b7a932663872657e1bc2a15540279f1bbebbbd97d0bd57a0d1f8dce4810\",\n>     \"babcaef4a4946d341e96da813430ef05c33619a37af6e0f89ad6892ffe4d8959\",\n>     \"66f35a0f8d8fd9c57d4cd0af10034aa13fb295ca8ac98da615ae4670338ecdbc\",\n>     \"ceb6f86970586a116ab652d8b74accdbc148f98d1be5ab0fc89bfbcdb84d43c4\",\n>     \"88df670d619d77a41d901d98125d5156b57a656e9da2447c0e6817b5a826b737\",\n>     \"235b8c35837a67a44147fbfc90f52c271705efa05f35f25194943711810c40c8\",\n>     \"3a76e4b99effc8edda75e86a35dc25445ad58871a5376af68d0d7915fec9c96a\",\n>     \"1ab0458f06b20968cdad7ec102481fe524b4533664a1a15f241458bf1e65d4ec\",\n>     \"8e14ec9f71837fe353ab3dff864131b37df7af14ca0789c504077789422e787e\",\n>     \"d3913e9b617d3b9584415a8f03945699b01fc8e9c589226deabcaccf835d4ec4\",\n>     \"c4cfd682bc1534b69f019aa7b93d6a1b324f8f62c8485736f3336bc5b8c9668f\",\n>     \"97e27736c144436a8e01b06ec3e290d6a49f0708c69afa23beeeb34b80cd3ee7\",\n>     \"c8337941c8688f26da567d1f34702cc89d33ce1f1e11cfdb98e47857bc0ccad4\"\n>  ],\n>   ... ... ...\n>\n> Now restart bitcoind with -rescan to pick up that missing change output:\n>\n> $ ./bitcoind -daemon -regtest -rescan\n> Bitcoin server starting\n> $ ./bitcoin-cli -regtest listunspent\n> [\n>   {\n>     \"txid\":\n> \"99d10bd2e5b31c7112b981e6fa5d4dd879ac9e46cabc3ecf0eb1b52376e98e0e\",\n>     \"vout\": 0,\n>     \"address\": \"mvtjzs8G7F2HkPfMKfEowhdyKq2rvKjnFy\",\n>     \"scriptPubKey\":\n> \"2102bc847fcca9f32804a1127e20627516da2db3a93803bfedfd5d98b9e9c1a1c1bbac\",\n>     \"amount\": 50.00000000,\n>     \"confirmations\": 101,\n>     \"spendable\": true,\n>     \"solvable\": true\n>   }\n> ]\n> $ ./bitcoin-cli -regtest getinfo\n> {\n>   \"version\": 140000,\n>   \"protocolversion\": 70015,\n>   \"walletversion\": 130000,\n>   \"balance\": 86.99884200,\n>   ... ... ...\n>\n> Multiple unexpected results here: First, the balance is wrong - remember how\n> the last tx change output that I generated was worth 37.49888680? Shouldn't\n> my balance be 87.49888680 then? It's almost like that missing transaction 26\n> DID work, but it's not in the block...?! And why is there only one output\n> listed by listunspent? It literally does not add up!\n>\n> Ã¢ÂÂ\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub, or mute the thread.\n",
      "created_at" : "2017-03-15T19:24:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10003#issuecomment-286852183",
      "id" : 286852183,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10003",
      "updated_at" : "2017-03-15T19:24:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/286852183",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
