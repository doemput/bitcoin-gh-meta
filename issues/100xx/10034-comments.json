[
   {
      "body" : "Can you write down some steps to reproduce... a little test told me if working correct. But maybe I'm wrong.\r\n\r\nStarted `./src/bitcoind  -printtoconsole --regtest --paytxfee=100`\r\nSent with SFA: `./src/bitcoin-cli --regtest sendtoaddress n3NkSZqoPMCQN5FENxUBw4qVATbytH6FDK 1 \"\" \"\" true`\r\nList tx tells me:\r\n```\r\n  \"details\": [\r\n    {\r\n      \"account\": \"\",\r\n      \"address\": \"n3NkSZqoPMCQN5FENxUBw4qVATbytH6FDK\",\r\n      \"category\": \"send\",\r\n      \"amount\": -0.90000000,\r\n      \"label\": \"\",\r\n      \"vout\": 1,\r\n      \"fee\": -0.10000000,\r\n      \"abandoned\": false\r\n    }\r\n```",
      "created_at" : "2017-03-19T08:54:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10034#issuecomment-287603075",
      "id" : 287603075,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10034",
      "updated_at" : "2017-03-19T08:54:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/287603075",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/178464?v=3",
         "events_url" : "https://api.github.com/users/jonasschnelli/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonasschnelli/followers",
         "following_url" : "https://api.github.com/users/jonasschnelli/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonasschnelli",
         "id" : 178464,
         "login" : "jonasschnelli",
         "organizations_url" : "https://api.github.com/users/jonasschnelli/orgs",
         "received_events_url" : "https://api.github.com/users/jonasschnelli/received_events",
         "repos_url" : "https://api.github.com/users/jonasschnelli/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonasschnelli/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonasschnelli"
      }
   },
   {
      "body" : "Hi Jonas,\r\n\r\nI have a bash script pay.sh that just calls:\r\n\r\n#!/bin/bash\r\nbitcoin-cli sendtoaddress $1 $2 \"\" \"\" true\r\n\r\nI then call this like ./pay.sh {address} {amount}\r\n\r\nMy current info is:\r\n\r\n~/.bitcoin$ bitcoin-cli getinfo\r\n{\r\n  \"version\": 140000,\r\n  \"protocolversion\": 70015,\r\n  \"walletversion\": 130000,\r\n  \"balance\": X.XXXXXXXX,\r\n  \"blocks\": 457937,\r\n  \"timeoffset\": 0,\r\n  \"connections\": XX,\r\n  \"proxy\": \"\",\r\n  \"difficulty\": 475705205061.6292,\r\n  \"testnet\": false,\r\n  \"keypoololdest\": 1489899731,\r\n  \"keypoolsize\": 100,\r\n  \"paytxfee\": 0.0016XXXX,\r\n  \"relayfee\": 0.00005000,\r\n  \"errors\": \"\"\r\n}\r\n\r\nI routinely empty this wallet. I also have a CRON running on the hour that adjusts fees to target 5 block confirmation:\r\n\r\n#!/bin/bash\r\nFEE=\"$(bitcoin-cli estimatefee 5)\"\r\nbitcoin-cli settxfee $FEE\r\n\r\nHowever, when I call pay.sh for the first time after receiving a deposit, it doesn't seem to respect the value of paytxfee (and has been paying 0.004 BTC/KB). I noticed that if I call the sendtoaddress command without referencing subtractfeefromamount, and then call my pay.sh script, the subtractfeefromamount will then reference the correctly defined paytxfee. Very odd to say the least.\r\n\r\nI am happy to provide txids privately if you'd like which will demonstrate the behavior above.\r\n\r\nThank you for taking a look.\r\n",
      "created_at" : "2017-03-19T09:00:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10034#issuecomment-287603320",
      "id" : 287603320,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10034",
      "updated_at" : "2017-03-19T09:00:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/287603320",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/6997221?v=3",
         "events_url" : "https://api.github.com/users/cryptogenesis/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cryptogenesis/followers",
         "following_url" : "https://api.github.com/users/cryptogenesis/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cryptogenesis/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cryptogenesis",
         "id" : 6997221,
         "login" : "cryptogenesis",
         "organizations_url" : "https://api.github.com/users/cryptogenesis/orgs",
         "received_events_url" : "https://api.github.com/users/cryptogenesis/received_events",
         "repos_url" : "https://api.github.com/users/cryptogenesis/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cryptogenesis/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cryptogenesis/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cryptogenesis"
      }
   },
   {
      "body" : "If this only and always happens the fist time you send, there might be a bug in your code to set fees. Otherwise, this is might be an instance of the known issue: https://github.com/bitcoin/bitcoin/blob/baae3149d63909c527e7b28c52c9124957ce8206/src/wallet/wallet.cpp#L2567",
      "created_at" : "2017-03-19T09:07:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10034#issuecomment-287603598",
      "id" : 287603598,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10034",
      "updated_at" : "2017-03-19T09:07:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/287603598",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/6399679?v=3",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "body" : "@cryptogenesis sorry for the delay, but i'm going to take another look at this.\r\nIf you'd be willing to point me to a few txid's, i'm not sure if it will help or not\r\n\r\nmorcos at chaincode.com\r\n\r\nThanks\r\n",
      "created_at" : "2017-07-27T19:14:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10034#issuecomment-318459517",
      "id" : 318459517,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10034",
      "updated_at" : "2017-07-27T19:14:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/318459517",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/4360349?v=4",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "@cryptogenesis I opened #10942 to fix a (hopefully very rare) edge case that was not yet fixed.  But I'm not sure that's the cause of your issue.\r\n\r\nYou are sure that the estimatefee call wasn't sometimes causing you to settxfee to a higher feerate?\r\n\r\nI looked through the code and didn't see anything obviously wrong, but am willing to look more if you have more information (I realize its quite old now).\r\n",
      "created_at" : "2017-07-27T21:29:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10034#issuecomment-318491999",
      "id" : 318491999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10034",
      "updated_at" : "2017-07-27T21:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/318491999",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/4360349?v=4",
         "events_url" : "https://api.github.com/users/morcos/events{/privacy}",
         "followers_url" : "https://api.github.com/users/morcos/followers",
         "following_url" : "https://api.github.com/users/morcos/following{/other_user}",
         "gists_url" : "https://api.github.com/users/morcos/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/morcos",
         "id" : 4360349,
         "login" : "morcos",
         "organizations_url" : "https://api.github.com/users/morcos/orgs",
         "received_events_url" : "https://api.github.com/users/morcos/received_events",
         "repos_url" : "https://api.github.com/users/morcos/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/morcos/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/morcos/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/morcos"
      }
   },
   {
      "body" : "Most likely fixed in #10942 by @morcos!",
      "created_at" : "2017-08-03T11:44:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/10034#issuecomment-319945949",
      "id" : 319945949,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10034",
      "updated_at" : "2017-08-03T11:44:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/319945949",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
